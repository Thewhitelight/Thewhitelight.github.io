{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"source/robots.txt","path":"robots.txt","modified":1,"renderable":0},{"_id":"themes/next/source/lib/anime.min.js","path":"lib/anime.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/local-search.js","path":"js/local-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16.jpg","path":"images/favicon-16x16.jpg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32.jpg","path":"images/favicon-32x32.jpg","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.jpg","path":"images/avatar.jpg","modified":1,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/schemes/pisces.js","path":"js/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1}],"Cache":[{"_id":"source/CNAME","hash":"6b329537bb053c22ab25a56b0ef10515fe8cdb5f","modified":1574596140680},{"_id":"themes/next/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1574579205680},{"_id":"source/robots.txt","hash":"120170e1a9d9708959706e5d1b487092d28f4ab1","modified":1574596140680},{"_id":"themes/next/.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1574579205680},{"_id":"themes/next/.gitignore","hash":"7b68ca7a46104cf9aa84ec0541a4856ab1836eca","modified":1574579205690},{"_id":"themes/next/LICENSE.md","hash":"18144d8ed58c75af66cb419d54f3f63374cd5c5b","modified":1574579205690},{"_id":"themes/next/gulpfile.js","hash":"72e6d5a6e32d5f95d82e4c4d0c963d39555bb760","modified":1574579205710},{"_id":"themes/next/.editorconfig","hash":"8570735a8d8d034a3a175afd1dd40b39140b3e6a","modified":1574579205680},{"_id":"themes/next/.travis.yml","hash":"ecca3b919a5b15886e3eca58aa84aafc395590da","modified":1574579205690},{"_id":"themes/next/README.md","hash":"d3035c6961280c1b4afb3a07661f5a635ce1eaff","modified":1582557447930},{"_id":"themes/next/.stylintrc","hash":"2cf4d637b56d8eb423f59656a11f6403aa90f550","modified":1574579205690},{"_id":"themes/next/crowdin.yml","hash":"e026078448c77dcdd9ef50256bb6635a8f83dca6","modified":1574579205690},{"_id":"themes/next/_config.yml","hash":"d644848380f405090f0ce4300a3607a81cf563ae","modified":1582557498310},{"_id":"themes/next/package.json","hash":"42cadbbe64ebbc2ddf55854f9b61d28289ae9380","modified":1582557447960},{"_id":"source/_posts/android-memory-optimization-2.md","hash":"911d639170dfc5a1a31d0486510208289449a2d6","modified":1574596007050},{"_id":"source/_posts/android-design-pattern.md","hash":"b59c8a055bf6428ff8b29f8cb9c65c1ee3d9c378","modified":1574596007050},{"_id":"source/_posts/android-memory-optimization.md","hash":"d8570e0f98fec1602adaee758ebe1ad6f3049fc5","modified":1592484411360},{"_id":"source/_posts/android-slideback.md","hash":"c8cc6ac6401e0fce59f6ab26bee03c2feb64882f","modified":1574596007050},{"_id":"source/_posts/android-tips.md","hash":"1a5d2bf35f6d39eee6a24f8574b4d2b3293c21f6","modified":1576495605620},{"_id":"source/_posts/avatar-select-img.md","hash":"fd8fe99b77c4cde95d196e189b1f2cf645966c93","modified":1574596007050},{"_id":"source/_posts/androidx-migrate-script.md","hash":"280f162513e2cd870e7d1f2c022a7b55629b2d76","modified":1575707359170},{"_id":"source/_posts/android-track-log.md","hash":"8a4f94c2b29555e1be57728248fb20a8140b82c1","modified":1574596007050},{"_id":"source/_posts/best-price-calculation.md","hash":"a7c817af7a205561c0609c95d5b24a2a2adcb0b3","modified":1574596007050},{"_id":"source/_posts/camera-id-card.md","hash":"522e4c60aab400595243a94aaa17777c5c876cf1","modified":1574596007050},{"_id":"source/_posts/android-p-invoke.md","hash":"8de1d012cf1df1431da708994b6052f0bbdb7d66","modified":1574596007060},{"_id":"source/_posts/android-memory-optimization-3.md","hash":"c2250f65365155bef2103a1b25a12051bb64c22f","modified":1574596007050},{"_id":"source/_posts/android-exception-summary.md","hash":"ee3d4f182019ba8941ae1234e42d246062dffc9a","modified":1576674356650},{"_id":"source/_posts/choreographer.md","hash":"512aaa1e7c4649065fdf90b27d5b8cfe0f7ebdf0","modified":1574596007050},{"_id":"source/_posts/coin-best-combination.md","hash":"cf7b1ce887cc2c64701f0c1adf81b0fe05bb1eb7","modified":1574596007050},{"_id":"source/_posts/clean-code-1.md","hash":"dad17633d5935a5ae15c3a169b56140cc5f5d611","modified":1574596007050},{"_id":"source/_posts/clean-code-2.md","hash":"b41ee8593d7cf37c97c13c4c14161aafc26b0c67","modified":1574596007050},{"_id":"source/_posts/github-page-https.md","hash":"8afd850ff135cbf3cfc03aa70875254add01d55e","modified":1574596007060},{"_id":"source/_posts/git-commit-message-generate-changelog.md","hash":"72a3a9e4f24ddf3847f128b4c5dec48d74a56ab3","modified":1574856743830},{"_id":"source/_posts/flutter-douban.md","hash":"5cd885c7af302078be9ca0b773cc080fdfb80e42","modified":1574596007060},{"_id":"source/_posts/flutter-douban-2.md","hash":"01c72e792660295c599999286a168df106b5d9e7","modified":1592484410222},{"_id":"source/_posts/gradle-dependencies-because.md","hash":"e771cc013110f3f93ef187f8f96bf0a6dd100e99","modified":1592484412819},{"_id":"source/_posts/maven-related.md","hash":"dcaa8adb8a8ea83fad2364ad9e8a58501163aea0","modified":1585642811120},{"_id":"source/_posts/notification-8-0-sound.md","hash":"f2ba6936b012aa40182af1c6b42105556c7298ed","modified":1574596007060},{"_id":"source/_posts/okhttp-host-switch.md","hash":"2d8bbd24e5bc912dc1734ba45a760961a6b58e5e","modified":1574596007060},{"_id":"source/_posts/react-native-check-version.md","hash":"4d365a7ef8e37a05924d60d046c08a3b10f9a863","modified":1592484407673},{"_id":"source/_posts/react-native-moudle-lifecycle.md","hash":"4d29e99aaa97e8b6cf9efcdb6273f28077933817","modified":1592410923099},{"_id":"source/_posts/react-natvie-manager-abstractclass.md","hash":"5fa11fd441a7978f8bd796b24479d7ad4b2ea577","modified":1583070713350},{"_id":"source/_posts/you-thought-you-knew-android.md","hash":"e432108c53fbd796dff7e84d67474908cb6a2aa6","modified":1574596007060},{"_id":"source/categories/index.md","hash":"431796e2bdb440fb3f98041f5cb3de34326c9cc4","modified":1574596775780},{"_id":"source/tags/index.md","hash":"42b259494b18728634015f508e66fd6d302cf14e","modified":1574596798920},{"_id":"themes/next/.git/COMMIT_EDITMSG","hash":"bfc86cf8412c8ce724119084ec70823c8de2afc7","modified":1582557574810},{"_id":"themes/next/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1574579205660},{"_id":"themes/next/.git/FETCH_HEAD","hash":"4b501c019105a0bcc4fa36a4a4d7de287e0ceb7d","modified":1582557644890},{"_id":"themes/next/.git/config","hash":"fe249d1414680c5173cfc379a4743897ccf45a70","modified":1574579205660},{"_id":"themes/next/.git/ORIG_HEAD","hash":"238c870adb753304ff2d7e5fb7893d4c908f51bc","modified":1582557447920},{"_id":"source/_posts/intellij-plugin-eventbus-1.md","hash":"1cb7bab3e742eebb9ac6fdb9e2b2eb89443305d7","modified":1574596007060},{"_id":"source/_posts/intellij-plugin-eventbus-2.md","hash":"d59b00a7ff5d8f3eaedd8ed53555f32649fba8e8","modified":1574596007060},{"_id":"source/_posts/install_apk_refer.md","hash":"7f0121b10be88c6ad6dd74d6f558f75f2acd3d1a","modified":1592484409168},{"_id":"themes/next/.git/index","hash":"8d699120a0749200c6f4d513b8cd4b1af8cd5e79","modified":1592481654814},{"_id":"themes/next/.git/packed-refs","hash":"a69284b7958fe097f93e51be2fcc354dca8e2c77","modified":1574579205660},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"aa4cb7aff595ca628cb58160ee1eee117989ec4e","modified":1574579205680},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"398a107b5e28fd61fb759b0c0f1c8f39d1c6d2ad","modified":1582557447930},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"1b87a7d22d466d78856900bd94875944181c991a","modified":1582557447930},{"_id":"themes/next/.github/config.yml","hash":"e4f4b9afe59bc508c4f7634895b33d7d460a7cb1","modified":1582557447930},{"_id":"themes/next/.github/issue-close-app.yml","hash":"7cba457eec47dbfcfd4086acd1c69eaafca2f0cd","modified":1582557447930},{"_id":"themes/next/.github/issue_label_bot.yaml","hash":"fca600ddef6f80c5e61aeed21722d191e5606e5b","modified":1582557447930},{"_id":"themes/next/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1574578883730},{"_id":"themes/next/.github/release-drafter.yml","hash":"3cc10ce75ecc03a5ce86b00363e2a17eb65d15ea","modified":1574579205690},{"_id":"themes/next/.github/support.yml","hash":"d75db6ffa7b4ca3b865a925f9de9aef3fc51925c","modified":1574579205690},{"_id":"themes/next/.github/lock.yml","hash":"61173b9522ebac13db2c544e138808295624f7fd","modified":1574579205690},{"_id":"themes/next/.github/stale.yml","hash":"941209526c2f7d916c76163c9e1ac1af9d956679","modified":1574579205690},{"_id":"themes/next/.github/mergeable.yml","hash":"0ee56e23bbc71e1e76427d2bd255a9879bd36e22","modified":1574579205690},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1574579205690},{"_id":"themes/next/docs/INSTALLATION.md","hash":"af88bcce035780aaa061261ed9d0d6c697678618","modified":1574579205690},{"_id":"themes/next/docs/AUTHORS.md","hash":"10135a2f78ac40e9f46b3add3e360c025400752f","modified":1574579205690},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"08cda41b4bcf687facfda19ab39718ec7a05ae54","modified":1574579205690},{"_id":"themes/next/docs/MATH.md","hash":"d645b025ec7fb9fbf799b9bb76af33b9f5b9ed93","modified":1582557447930},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"682937d48bf5d243842a76190921322e26c75247","modified":1582557447930},{"_id":"themes/next/languages/de.yml","hash":"109943f7adcd5cdbe4c6c95c9d279603f07edacb","modified":1582557447940},{"_id":"themes/next/languages/default.yml","hash":"20f951dc4df8602ffdd05a1d5899c5a9bc1759cc","modified":1582557447940},{"_id":"themes/next/languages/en.yml","hash":"20f951dc4df8602ffdd05a1d5899c5a9bc1759cc","modified":1582557447940},{"_id":"themes/next/languages/es.yml","hash":"53ef4a621fd628748b8ed711fe86080e9c9c91c8","modified":1582557447940},{"_id":"themes/next/languages/fa.yml","hash":"a24e0cf28e9f137d0d2219498778693c3c3960b2","modified":1582557447940},{"_id":"themes/next/languages/fr.yml","hash":"578a30a51b9ecbbcb4c200362ad9a37ffd3272db","modified":1582557447940},{"_id":"themes/next/languages/hu.yml","hash":"074d069af9aed5ad34fa809bd058a3b9e2d01051","modified":1582557447940},{"_id":"themes/next/languages/id.yml","hash":"6037450ecd02796e08ca2e98037845b7c30c2807","modified":1582557447940},{"_id":"themes/next/languages/it.yml","hash":"ba2c8f51f2f719dabe71b6053c6fe6866161ec66","modified":1582557447940},{"_id":"themes/next/languages/ja.yml","hash":"5e13b521201944815665bd077b65d7ce69622b81","modified":1582557447940},{"_id":"themes/next/languages/ko.yml","hash":"4aa8f3bf06e02879863b19901476cb23ecd2d709","modified":1582557447940},{"_id":"themes/next/languages/nl.yml","hash":"e27b29c60d88ef4c30de291b595cf8cad639c5d1","modified":1582557447940},{"_id":"themes/next/languages/pt-BR.yml","hash":"0660471e067d01ec80962d5721ae282aafff274d","modified":1582557447940},{"_id":"themes/next/languages/pt.yml","hash":"f7516b9d86b52c80bf63d3efc7ee6fd985205001","modified":1582557447940},{"_id":"themes/next/languages/ru.yml","hash":"7dcb2aab65a4b202476856f3e004862334229bcb","modified":1582557447940},{"_id":"themes/next/languages/tr.yml","hash":"145d28f6f051129dc6393affe8f68cd7ba925078","modified":1582557447940},{"_id":"themes/next/languages/uk.yml","hash":"21a573cdf8e26d87d5e32c5555bc645983268abe","modified":1582557447940},{"_id":"themes/next/languages/vi.yml","hash":"ffc144f606e171fdd8cdb41808ac36e406015a54","modified":1582557447940},{"_id":"themes/next/languages/zh-CN.yml","hash":"038c3a650d2e3a288be9ba6580564172c50b4289","modified":1582557447940},{"_id":"themes/next/languages/zh-HK.yml","hash":"2620632caa3c94022d9513ab1971d15512e737e7","modified":1582557447940},{"_id":"themes/next/languages/zh-TW.yml","hash":"0964e90406bbd495e901d6b9d5f10124c8cad950","modified":1582557447940},{"_id":"themes/next/layout/_layout.swig","hash":"29ee038b0d5ffdb45327598733ea968588367769","modified":1582557447940},{"_id":"themes/next/layout/archive.swig","hash":"26526c09a4334099e2141456697696fcd1f9783f","modified":1582557447960},{"_id":"themes/next/layout/index.swig","hash":"3bc6fb1e9707d74b96e1346d3f03fe6584f764f4","modified":1574579205790},{"_id":"themes/next/layout/page.swig","hash":"e61d64c055b6497a04affc143f47fdd0a6dc495b","modified":1574579205790},{"_id":"themes/next/layout/post.swig","hash":"382d9f9a9b35e1f369585f7f9f9b5dd6fa58d2f0","modified":1574579205790},{"_id":"themes/next/layout/tag.swig","hash":"7ff6e34d557a3da1c6a29ecd97842bf73ff213dc","modified":1574579205810},{"_id":"themes/next/scripts/renderer.js","hash":"49a65df2028a1bc24814dc72fa50d52231ca4f05","modified":1574579205830},{"_id":"themes/next/layout/category.swig","hash":"c55debb2588e4746b02d31ec249bf0a84fdea260","modified":1574579205790},{"_id":"themes/next/docs/DATA-FILES.md","hash":"40a8089076005e0d26ef7c0db58a2b5b464cda6c","modified":1582557447930},{"_id":"themes/next/docs/LICENSE.txt","hash":"368bf2c29d70f27d8726dd914f1b3211cae4bbab","modified":1574579205700},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"c7a994b9542040317d8f99affa1405c143a94a38","modified":1582557447930},{"_id":"themes/next/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1574578883730},{"_id":"themes/next/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1574578883740},{"_id":"themes/next/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1574578883730},{"_id":"themes/next/.git/hooks/pre-commit.sample","hash":"33729ad4ce51acda35094e581e4088f3167a0af8","modified":1574578883730},{"_id":"themes/next/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1574578883740},{"_id":"themes/next/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1574578883730},{"_id":"themes/next/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1574578883730},{"_id":"themes/next/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1574578883740},{"_id":"themes/next/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1574578883740},{"_id":"themes/next/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1574578883730},{"_id":"themes/next/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1574578883740},{"_id":"themes/next/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1574578883730},{"_id":"themes/next/.git/hooks/pre-merge-commit.sample","hash":"04c64e58bc25c149482ed45dbd79e40effb89eb7","modified":1574578883740},{"_id":"themes/next/.github/ISSUE_TEMPLATE/bug-report.md","hash":"8ae029084b9ac482adf0fae2a0979dd388476513","modified":1582557447930},{"_id":"themes/next/.git/logs/HEAD","hash":"4ad700a064ed6f06df320c3e809daba519a5d962","modified":1582557574810},{"_id":"themes/next/.github/ISSUE_TEMPLATE/feature-request.md","hash":"7a9526f749205c882d672a4f51e6a3033c80ca6e","modified":1582557447930},{"_id":"themes/next/.github/ISSUE_TEMPLATE/question.md","hash":"789a3cceb8f37a4b63b1fb2452a03332a3c365ed","modified":1582557447930},{"_id":"themes/next/.github/ISSUE_TEMPLATE/other.md","hash":"89667adbb85c25716dba607cd7a38191acf60736","modified":1582557447930},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"0bd2d696f62a997a11a7d84fec0130122234174e","modified":1582557447930},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"fe3f5cda1975114884d84bef384a562920d70335","modified":1574579205700},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"fb23b85db6f7d8279d73ae1f41631f92f64fc864","modified":1582557447930},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"d3f03be036b75dc71cf3c366cd75aee7c127c874","modified":1582557447940},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"ca1030efdfca5e20f9db2e7a428998e66a24c0d0","modified":1582557447940},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"579c7bd8341873fb8be4732476d412814f1a3df7","modified":1574579205700},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"0b0b9ec6ec4a89e701a3b91f8d7d95752d3e241b","modified":1582557447940},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"b92585d251f1f9ebe401abb5d932cb920f9b8b10","modified":1582557447940},{"_id":"themes/next/docs/zh-CN/README.md","hash":"e5f6668c3a79e4a364931b9b4e5fa92f8c771ec8","modified":1582557447940},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"7f37327bbcae7ed7d04d187fd5e9bc6bbf14926a","modified":1582557447940},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"815676d904f92748ddf4f529bed2baf066997bc6","modified":1574579205720},{"_id":"themes/next/layout/_macro/post.swig","hash":"ee01368d65fbb8d387f0956398daf62ae9ba1645","modified":1582557447940},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"e2c9db54cc9e154e882008fde6588b065fadc9a7","modified":1574579205720},{"_id":"themes/next/layout/_partials/comments.swig","hash":"0c4914a5fd08f15beec71940218c814ad9a89f3f","modified":1582557447940},{"_id":"themes/next/layout/_partials/footer.swig","hash":"1ee6335c12773dc43f8b92136770cb10d460c25c","modified":1582557447950},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1582557447950},{"_id":"themes/next/layout/_partials/widgets.swig","hash":"83a40ce83dfd5cada417444fb2d6f5470aae6bb0","modified":1574579205750},{"_id":"themes/next/layout/_scripts/index.swig","hash":"cea942b450bcb0f352da78d76dc6d6f1d23d5029","modified":1574579205760},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"d1f2bfde6f1da51a2b35a7ab9e7e8eb6eefd1c6b","modified":1574579205760},{"_id":"themes/next/layout/_scripts/pjax.swig","hash":"a3462c37ab6d7642b1e95860ea5c4cfbac78efab","modified":1582557447950},{"_id":"themes/next/layout/_scripts/three.swig","hash":"a4f42f2301866bd25a784a2281069d8b66836d0b","modified":1574579205760},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"ef38c213679e7b6d2a4116f56c9e55d678446069","modified":1574579205760},{"_id":"themes/next/layout/_third-party/baidu-push.swig","hash":"8627c8c8b031ecee16c522433b66fa4d6979b8ea","modified":1574579205770},{"_id":"themes/next/layout/_third-party/index.swig","hash":"70c3c01dd181de81270c57f3d99b6d8f4c723404","modified":1574579205780},{"_id":"themes/next/layout/_third-party/quicklink.swig","hash":"dd6bd817cb69b5ad5e9746498146314b54054ff8","modified":1574579205780},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"2731e262a6b88eaee2a3ca61e6a3583a7f594702","modified":1582557447950},{"_id":"themes/next/scripts/events/index.js","hash":"9047d8ae2670e43429b16a7919a08a0a0a81afe0","modified":1574579205810},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"aec50ed57b9d5d3faf2db3c88374f107203617e0","modified":1574579205820},{"_id":"themes/next/scripts/filters/front-matter.js","hash":"703bdd142a671b4b67d3d9dfb4a19d1dd7e7e8f7","modified":1574579205820},{"_id":"themes/next/scripts/filters/locals.js","hash":"5bbfdc1c373542159660b7a68ed0b57ca18ad10b","modified":1582557447960},{"_id":"themes/next/scripts/filters/minify.js","hash":"19985723b9f677ff775f3b17dcebf314819a76ac","modified":1574579205820},{"_id":"themes/next/scripts/filters/post.js","hash":"f2f566f2577c554377fd704442399acdd14a8118","modified":1582557447960},{"_id":"themes/next/scripts/helpers/engine.js","hash":"cb211b6b50913454b1737782e9e2af96cfa40448","modified":1582557447960},{"_id":"themes/next/scripts/helpers/font.js","hash":"32268fb4c59c5b37c1eb1c9582ab630e09e5cc7d","modified":1574579205830},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"5e11f30ddb5093a88a687446617a46b048fa02e5","modified":1582557447960},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"58347687b02f7ab5e64bef07525c8efa97c9e8fb","modified":1582557447960},{"_id":"themes/next/scripts/tags/button.js","hash":"1d1d25f7e579d92fa563778dd0f163e8eda190da","modified":1574579205830},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"94e0bbc7999b359baa42fa3731bdcf89c79ae2b3","modified":1582557447960},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"f13430d9d1c9773b390787c2f046bb1f12a79878","modified":1574579205830},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"d902fd313e8d35c3cc36f237607c2a0536c9edf1","modified":1582557447970},{"_id":"themes/next/scripts/tags/label.js","hash":"fc5b267d903facb7a35001792db28b801cccb1f8","modified":1574579205830},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"983c6c4adea86160ecc0ba2204bc312aa338121d","modified":1574579205830},{"_id":"themes/next/scripts/tags/note.js","hash":"0a02bb4c15aec41f6d5f1271cdb5c65889e265d9","modified":1574579205830},{"_id":"themes/next/scripts/tags/pdf.js","hash":"f780cc72bff91d2720626e7af69eed25e9c12a29","modified":1574579205830},{"_id":"themes/next/scripts/tags/tabs.js","hash":"00ca6340d4fe0ccdae7525373e4729117775bbfa","modified":1574579205830},{"_id":"themes/next/scripts/tags/video.js","hash":"e5ff4c44faee604dd3ea9db6b222828c4750c227","modified":1574579205830},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"34b88784ec120dfdc20fa82aadeb5f64ef614d14","modified":1582557447930},{"_id":"themes/next/docs/ru/README.md","hash":"2b3988e79d96b66640d6a98f0c0e6de9099805e6","modified":1582557447930},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"9c4fe2873123bf9ceacab5c50d17d8a0f1baef27","modified":1574579205700},{"_id":"themes/next/source/lib/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1574579206000},{"_id":"themes/next/source/js/local-search.js","hash":"3f7606d2007dbf3b1bdf08b37bff4312c1c3d7a1","modified":1582557448010},{"_id":"themes/next/source/js/algolia-search.js","hash":"77cd98b1c790df12dd6cd8119bb3d99f72866635","modified":1582557448010},{"_id":"themes/next/source/js/bookmark.js","hash":"a00945ff886e9f6f835731cdaf29a3a3727c8877","modified":1582557448010},{"_id":"themes/next/source/js/next-boot.js","hash":"f7045763e277e685c271bd4b4c37e531d699ac63","modified":1574579205990},{"_id":"themes/next/source/js/motion.js","hash":"72df86f6dfa29cce22abeff9d814c9dddfcf13a9","modified":1582557448010},{"_id":"themes/next/source/js/utils.js","hash":"4faf7598289774fe091f33fa693b2e6b2ca1e994","modified":1582557448020},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"ec119560b382b2624e00144ae01c137186e91621","modified":1574579205970},{"_id":"themes/next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1574579205970},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1574579205970},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1574579205980},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1574579205980},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1574579205980},{"_id":"themes/next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1574579205980},{"_id":"themes/next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1574579205980},{"_id":"themes/next/source/images/favicon-16x16.jpg","hash":"2e7574c664306c98c31fe2d831aaf4865f1a9ddf","modified":1574599390350},{"_id":"themes/next/source/images/favicon-32x32.jpg","hash":"ed68ec491cd18e065654de7047920942dac9d586","modified":1574599433530},{"_id":"themes/next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1574579205980},{"_id":"themes/next/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1574579205980},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1574579205980},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1574579205970},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1574579205970},{"_id":"themes/next/source/images/avatar.jpg","hash":"8d6fe5f2d8e21c0fa3dae9580795ce433059ad41","modified":1533194148000},{"_id":"themes/next/source/css/_colors.styl","hash":"7d07d83cb5c9a5f23751bb46019e853eb4d0cd0a","modified":1582557447970},{"_id":"themes/next/source/css/_mixins.styl","hash":"b79ff3debd5709397b122292fc7e551ae9d40782","modified":1582557448020},{"_id":"themes/next/source/css/main.styl","hash":"a3a3bbb5a973052f0186b3523911cb2539ff7b88","modified":1582557448010},{"_id":"themes/next/.git/objects/12/55291f108be3ec588a7b267662659325c3427b","hash":"e6bcf9c94021814c2e0de89e8c9eae738586e418","modified":1582557574000},{"_id":"themes/next/.git/objects/54/99bfbe153b02786830d45c686923e2484fca12","hash":"3e73942f80f5fb6642118c10b11444b29bbd7251","modified":1582557574800},{"_id":"themes/next/.git/objects/2e/bcaba811c277816fdd96a6f83f94b343957bbc","hash":"8c2f8128a121d6197db33c353c97c808fe04e18c","modified":1574599640150},{"_id":"themes/next/.git/objects/46/41293955751d4a6fb7f8c0eabf18ab2a6b14c6","hash":"6c436d7fb627c658711b882a8847f3dd4d2883d8","modified":1574599662410},{"_id":"themes/next/.git/objects/72/0b8c88198f664810482668e588c34241e6933a","hash":"3024803d6d0a28f6ba4c786f77889a2ef21f03a2","modified":1574599640150},{"_id":"themes/next/.git/objects/82/62dd830222c5e06ba6c3ddd37125125298281b","hash":"25743c5d3a88d496c2575b0465a381104c174650","modified":1574599640150},{"_id":"themes/next/.git/objects/9d/a7e0ab7910e318165e3942745b45a264a3a1fb","hash":"e163617d0e848efb5e998fbac801ed9fe8d76afb","modified":1582557574800},{"_id":"themes/next/.git/objects/a9/1bc1f5174bb12860369022ec4c3275a38f6d91","hash":"6f0dc5ddce2cc49638c19c9bcd542a65b771c71b","modified":1582557574810},{"_id":"themes/next/.git/objects/91/f5eed540b7f06566948926e60714390a7920e4","hash":"ad5c63e42ea9df701e39a55a43f1daf76d597056","modified":1574599640150},{"_id":"themes/next/.git/objects/a4/a96ac9d2cafd533b86a9b217431e9780f5a6b6","hash":"bd469f4189e96fddaa77fb925f6b351a4c6778d4","modified":1582557448030},{"_id":"themes/next/.git/objects/d7/3699d846ba4e4f0c0ea09657150edfbd5a88e0","hash":"4d98461ca0107a988a241ea98a194a08a7d611ab","modified":1574599658990},{"_id":"themes/next/.git/objects/pack/pack-b7da4ae24632d2a3258ba09018405d3e5265f712.idx","hash":"719cafe57708fdf4d9b7769e85235eac5324d76e","modified":1582557448560},{"_id":"themes/next/.git/objects/96/b69b680415f40b256cf9edd1d96e156edcc7c2","hash":"f0a08e0d9ab594b79183d2c7fbbddd2a528151d5","modified":1574599662420},{"_id":"themes/next/.git/objects/pack/pack-bb626a209f351d5ef96927bf6925432c87df1fd2.idx","hash":"f74dac87aaee7735dc4a90e34a5f866561a359e5","modified":1582557447850},{"_id":"themes/next/.git/refs/heads/master","hash":"7ab0f76683c4c187454e6b70343e60cfe284967b","modified":1582557574810},{"_id":"themes/next/.git/refs/tags/v7.7.0","hash":"b36294c4a5df9cb1df8e582752dee5d4821aad00","modified":1582557447900},{"_id":"themes/next/.git/refs/tags/v7.6.0","hash":"48b43ab84fc77e4de9217c6f781177781d29fa31","modified":1582557447900},{"_id":"themes/next/.git/objects/df/2cdabedc133e6761212a39fc0cec10200cbdaf","hash":"eda08b2f57b72618e11e1091c57c47421cea2815","modified":1574599662420},{"_id":"themes/next/.git/refs/tags/v7.7.1","hash":"88c02f7029cb659858b0e0554b79fa64e9f64494","modified":1582557447900},{"_id":"themes/next/.git/objects/d8/4b2310796822e7dd9ffac02c1eb2eab5dbd288","hash":"7ea4d41afd97458dbec4b00c072755c2ea31c94e","modified":1574599640160},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"1638483d2d2dad1da4c841a6fb9f6ee96b850187","modified":1582557447950},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"1ea12d4b9490d9065ebf1b8739b90ce5defd6398","modified":1582557447950},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"d3a16f0f343ea70b59e33e4b9cdecae3c8df91cd","modified":1582557447950},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"30528a8da30994b1ef9355a72b09b2cd85a7c0e9","modified":1574579205740},{"_id":"themes/next/layout/_partials/header/menu-item.swig","hash":"e6076865dba066c5f0008e22217efb850d5af69c","modified":1582557447950},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"bbf0c8e42491fac70f4f8165224f1d7d92a040d7","modified":1582557447950},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"54ba9508a901c295a02c8e34e9cece7c7dcad518","modified":1582557447950},{"_id":"themes/next/layout/_partials/page/breadcrumb.swig","hash":"c851717497ca64789f2176c9ecd1dedab237b752","modified":1574579205750},{"_id":"themes/next/layout/_partials/page/page-header.swig","hash":"a56e4f6ad95c106f361d354f828d1ef4810b1d76","modified":1574579205750},{"_id":"themes/next/layout/_partials/post/post-copyright.swig","hash":"94d54b0c65d504f772af1e62424952e092b6c21d","modified":1582557447950},{"_id":"themes/next/layout/_partials/post/post-followme.swig","hash":"14c33bd544903e74388739599fffe3ecb66ed4b0","modified":1582557447950},{"_id":"themes/next/layout/_partials/post/post-footer.swig","hash":"8f14f3f8a1b2998d5114cc56b680fb5c419a6b07","modified":1574579205750},{"_id":"themes/next/layout/_partials/post/post-related.swig","hash":"f79c44692451db26efce704813f7a8872b7e63a0","modified":1574579205750},{"_id":"themes/next/layout/_partials/post/post-reward.swig","hash":"2b1a73556595c37951e39574df5a3f20b2edeaef","modified":1582557447950},{"_id":"themes/next/layout/_partials/search/algolia-search.swig","hash":"48430bd03b8f19c9b8cdb2642005ed67d56c6e0b","modified":1582557447950},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"d6fa9e4432b87004c5678dfe2d4b2c1f4a702b93","modified":1574579205750},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"2791a8dc20a276704fc8b03f9822f76578a9152d","modified":1582557447950},{"_id":"themes/next/layout/_partials/sidebar/site-overview.swig","hash":"716b78cd90addc4216413719554721cb362b0c18","modified":1582557447950},{"_id":"themes/next/layout/_scripts/pages/schedule.swig","hash":"a2bb0bec243685e670b60a3d54142950adc03af0","modified":1582557447950},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1574579205760},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1574579205760},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"7f14ef43d9e82bc1efc204c5adf0b1dbfc919a9f","modified":1574579205760},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"1c910fc066c06d5fbbe9f2b0c47447539e029af7","modified":1574579205760},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"2fa2b51d56bfac6a1ea76d651c93b9c20b01c09b","modified":1574579205770},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"4790058691b7d36cf6d2d6b4e93795a7b8d608ad","modified":1574579205770},{"_id":"themes/next/layout/_third-party/analytics/growingio.swig","hash":"5adea065641e8c55994dd2328ddae53215604928","modified":1574579205770},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"1472cabb0181f60a6a0b7fec8899a4d03dfb2040","modified":1574579205770},{"_id":"themes/next/layout/_third-party/chat/chatra.swig","hash":"f910618292c63871ca2e6c6e66c491f344fa7b1f","modified":1582557447950},{"_id":"themes/next/layout/_third-party/chat/tidio.swig","hash":"cba0e6e0fad08568a9e74ba9a5bee5341cfc04c1","modified":1574579205770},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"f39a5bf3ce9ee9adad282501235e0c588e4356ec","modified":1582557447950},{"_id":"themes/next/layout/_third-party/comments/disqusjs.swig","hash":"82f5b6822aa5ec958aa987b101ef860494c6cf1f","modified":1582557447950},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"b14908644225d78c864cd0a9b60c52407de56183","modified":1582557447950},{"_id":"themes/next/layout/_third-party/comments/gitalk.swig","hash":"d6ceb70648555338a80ae5724b778c8c58d7060d","modified":1582557447950},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"be0a8eccf1f6dc21154af297fc79555343031277","modified":1582557447950},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"f7a9eca599a682479e8ca863db59be7c9c7508c8","modified":1582557447950},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"6c5976621efd5db5f7c4c6b4f11bc79d6554885f","modified":1574579205780},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"4791c977a730f29c846efcf6c9c15131b9400ead","modified":1574579205780},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"a18a9b52f58c7988c411a819518d8e7715e5fb92","modified":1582557447950},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"767b6c714c22588bcd26ba70b0fc19b6810cbacd","modified":1574579205780},{"_id":"themes/next/layout/_third-party/search/algolia-search.swig","hash":"d35a999d67f4c302f76fdf13744ceef3c6506481","modified":1582557447950},{"_id":"themes/next/layout/_third-party/search/swiftype.swig","hash":"ba0dbc06b9d244073a1c681ff7a722dcbf920b51","modified":1574579205780},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.swig","hash":"d7258d02bcf0dac6c0fd8377c0909ddecb09d1d4","modified":1574579205780},{"_id":"themes/next/layout/_third-party/statistics/cnzz-analytics.swig","hash":"a17ace37876822327a2f9306a472974442c9005d","modified":1574579205780},{"_id":"themes/next/layout/_third-party/statistics/firestore.swig","hash":"b26ac2bfbe91dd88267f8b96aee6bb222b265b7a","modified":1582557447950},{"_id":"themes/next/layout/_third-party/statistics/index.swig","hash":"5f6a966c509680dbfa70433f9d658cee59c304d7","modified":1574579205790},{"_id":"themes/next/layout/_third-party/tags/mermaid.swig","hash":"f3c43664a071ff3c0b28bd7e59b5523446829576","modified":1582557447960},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.swig","hash":"a239f1558d1209012ce4571cbc665fe461291e41","modified":1582557447960},{"_id":"themes/next/layout/_third-party/tags/pdf.swig","hash":"529d752f269afcf8f64e07a1eacd6fda70fb211f","modified":1582557447960},{"_id":"themes/next/scripts/events/lib/config.js","hash":"b205d72a56b1827681f0a260c266e0c02065fd08","modified":1582557447960},{"_id":"themes/next/scripts/events/lib/injects-point.js","hash":"6661c1c91c7cbdefc6a5e6a034b443b8811235a1","modified":1574579205810},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"1f20213af8da3127701e6bb9da995e5c91be2051","modified":1582557447960},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"f233d8d0103ae7f9b861344aa65c1a3c1de8a845","modified":1574579205810},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"0803d4f4d3d02c24417c163ad0b27b60fda79250","modified":1574579205820},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"7f2d93af012c1e14b8596fecbfc7febb43d9b7f5","modified":1574579205820},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"19cbd24880d0fbbd4d5698cd54da598f03b942da","modified":1582557447960},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"7f8b92913d21070b489457fa5ed996d2a55f2c32","modified":1582557447960},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"e51dc3072c1ba0ea3008f09ecae8b46242ec6021","modified":1574579205820},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"d5fefc31fba4ab0188305b1af1feb61da49fdeb0","modified":1582557447960},{"_id":"themes/next/scripts/filters/comment/valine.js","hash":"6a72b5928cdab9526a288177991e4b2aedd028cf","modified":1582557447960},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"69d152fa46b517141ec3b1114dd6134724494d83","modified":1574579206000},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"a2aaaf12378db56bd10596ba3daae30950eac051","modified":1574579206000},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"279a8a718ab6c930a67c41237f0aac166c1b9440","modified":1574579206010},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1574579206020},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"dcf470ab3a358103bb896a539cc03caeda10fa8b","modified":1574579206000},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1574579206020},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"4f7bf961f1bed448f6ba99aeb9219fabf930ba96","modified":1574579206000},{"_id":"themes/next/source/js/schemes/muse.js","hash":"47c4f60eb7f7dc3303e84914b611dc34827069e1","modified":1582557448010},{"_id":"themes/next/source/js/schemes/pisces.js","hash":"f068b46f8c305c7436c2767492a6bed42dcd764c","modified":1582557448020},{"_id":"themes/next/.git/objects/1a/2bbb52f0646f431a95f4d854fb20dd28c14fa1","hash":"bfbd082fc06d4cc2706a0d8b7fb36b33d7b16956","modified":1574599658990},{"_id":"themes/next/.git/objects/2b/f963585cfca976cae4924bec8448ffc9f36f28","hash":"0753e0de348f7692f05bf96353c2d90d6ebf9edb","modified":1582557567310},{"_id":"themes/next/.git/objects/26/8d07ae4a711ecdb16e9393e98344e8c94df0e5","hash":"2e264fcf4715ede68bb17e84e686fb5738d2c8fd","modified":1574599658990},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"f4e694e5db81e57442c7e34505a416d818b3044a","modified":1582557448010},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"38597817ede20418e73ae4afc50047ea5088c73e","modified":1582557448010},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"62df49459d552bbf73841753da8011a1f5e875c8","modified":1582557448010},{"_id":"themes/next/source/css/_variables/base.styl","hash":"85c46ac85689e7c5f5398fc8b6b40b7a8e94bafb","modified":1582557448010},{"_id":"themes/next/.git/logs/refs/heads/master","hash":"4ad700a064ed6f06df320c3e809daba519a5d962","modified":1582557574810},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"9840998e1a1fbcd419c52a1e38fa54a003eac963","modified":1582557448010},{"_id":"themes/next/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1574579205660},{"_id":"themes/next/.git/refs/remotes/origin/cdn","hash":"23fdaf87369768022f24935266c99f594921ab3f","modified":1582557447870},{"_id":"themes/next/.git/refs/remotes/origin/i18n","hash":"104b943ef370606a1f89cc8be836d86b2644297c","modified":1582557447870},{"_id":"themes/next/.git/refs/remotes/origin/master","hash":"8921592f425ed2a913c09d3af4dcecf1f020d115","modified":1582557447870},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1574579206010},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1574579206010},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"0189d278706509412bac4745f96c83984e1d59f4","modified":1574579206010},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"a47725574e1bee3bc3b63b0ff2039cc982b17eff","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"ca5e70662dcfb261c25191cc5db5084dcf661c76","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"e2355c213fc25d635f1179fe317b826e0b9dad17","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/rainbow.styl","hash":"bc87cea0b534f2d75db60f300b069456f6516d1b","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"170c4598cbbe49cd1527f94158d97d2320a6b906","modified":1574579205860},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"44fe82eadbdbb2f66adda37ac83ebd0f85876bfc","modified":1574579205890},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"990bd301ce2de0a6b936781c58318f3945d81bc2","modified":1574579205890},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"3fee8cbe5704a04107ff0816db1221edb40dbb9b","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"38f632dce42481da83a5ffab382c281269885e9c","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1574579205910},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"62209da61b4ac49e3a7ff8174e28e075060835ec","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"8f58570a1bbc34c4989a47a1b7d42a8030f38b06","modified":1574579205910},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1574579205910},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"b3bea92eef0e1fe2e7e294dac2184d16b5b8d666","modified":1582557447990},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"a30db9fffd34d522d378aeaeaa400d1a84505b38","modified":1582557448000},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"41e5a7c567735e780ef9bfdacd4af1ff4b5e1d2a","modified":1582557448000},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"7104b9cef90ca3b140d7a7afcf15540a250218fc","modified":1582557448000},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"a717969829fa6ef88225095737df3f8ee86c286b","modified":1574579205940},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"f6516d0f7d89dc7b6c6e143a5af54b926f585d82","modified":1582557448000},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"179e33b8ac7f4d8a8e76736a7e4f965fe9ab8b42","modified":1574579205920},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"21003fd0b43dc3b3592e916d585f7f78478cbeb3","modified":1582557448000},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1574579205950},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"4794bd45d5e32ea005c805bcbc65b871e9927d02","modified":1582557448000},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"bb392700f04d956bb5f606efb052453efeade53d","modified":1582557448000},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"2b2e7b5cea7783c9c8bb92655e26a67c266886f0","modified":1582557448010},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"4d1c17345d2d39ef7698f7acf82dfc0f59308c34","modified":1574579205940},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"ccb71d732b12acd02ac26ed6bbda4861d027857d","modified":1582557448010},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"e282df938bd029f391c466168d0e68389978f120","modified":1582557448010},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1574579205950},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"70a4324b70501132855b5e59029acfc5d3da1ebd","modified":1582557448010},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"e4f958677a75de87ee1caf7e22ba46a0602f22dd","modified":1582557448010},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"82025c3ad7af12e532e2e81be98deb0a74ff23ac","modified":1582557448010},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1574579205960},{"_id":"themes/next/.git/logs/refs/remotes/origin/HEAD","hash":"030475cc1bdab4360440e2f5cbdffd60d197a281","modified":1574579205660},{"_id":"themes/next/.git/logs/refs/remotes/origin/cdn","hash":"5d547d7d21b0416bcdbb11b53aad0862d7afbb58","modified":1582557447870},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1574579206020},{"_id":"themes/next/.git/logs/refs/remotes/origin/master","hash":"66c7b25cd7d2c04d3ea3b7e1620fdc2ba2a9ec4b","modified":1582557447870},{"_id":"themes/next/.git/logs/refs/remotes/origin/i18n","hash":"e5786ea9f46ab3cebd3b9aee0c97ff96247aadbc","modified":1582557447870},{"_id":"themes/next/.git/objects/pack/pack-03ffaec0e5f95a3c7df82b4579bd1180ba8286f8.idx","hash":"e70bccfb9b8cdcf28fcb138acf9a6a8c4fb063e1","modified":1574579205630},{"_id":"themes/next/.git/objects/pack/pack-b7da4ae24632d2a3258ba09018405d3e5265f712.pack","hash":"9b51d7228a24f2ed78d6fe2bdc9e5853c901edaf","modified":1582557574000},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"fafc96c86926b22afba8bb9418c05e6afbc05a57","modified":1574579205840},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"2bd0eb1512415325653b26d62a4463e6de83c5ac","modified":1574579205840},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1574579205840},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"7ddb7453bf9b85b01bff136e9d10a7f06baac9e8","modified":1574579205840},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"c1daeb60c23945f745703ac2c3f4bf99d0ea3d95","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"b49e9fbd3c182b8fc066b8c2caf248e3eb748619","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"8a7fc03a568b95be8d3337195e38bc7ec5ba2b23","modified":1574579205860},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"705759bdd1649e9aa1caedb82f6432a991ae3e71","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"e2992846b39bf3857b5104675af02ba73e72eed5","modified":1574579205880},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"9a878d0119785a2316f42aebcceaa05a120b9a7a","modified":1574579205880},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"0672ea2acf28dcc2cfc5244da36d3387d71a17cb","modified":1574579205880},{"_id":"themes/next/source/css/_common/outline/header/header.styl","hash":"a793cfff86ad4af818faef04c18013077873f8f0","modified":1582557447980},{"_id":"themes/next/source/css/_common/outline/header/headerband.styl","hash":"0caf32492692ba8e854da43697a2ec8a41612194","modified":1574579205880},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"555762730f1f31451113e8fdc84ec438ea738d90","modified":1582557447980},{"_id":"themes/next/source/css/_common/outline/footer/footer.styl","hash":"f5821481440a0624c8aec5fc85f093de1527095f","modified":1582557447980},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"b2fc519828fe89a1f8f03ff7b809ad68cd46f3d7","modified":1582557447980},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"e02b1097a72a7d2ddc45ea8d53aa6d77c25ac407","modified":1574579205880},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"0ec7bafed7eec36504df7781207ccd1ce4448536","modified":1582557447980},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"2cb1876e9e0c9ac32160888af27b1178dbcb0616","modified":1574579205890},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"fa0222197b5eee47e18ac864cdc6eac75678b8fe","modified":1582557447990},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"44487d9ab290dc97871fa8dd4487016deb56e123","modified":1582557447990},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"a237c290e8934d1a8cbbf22b3f30503d9663021d","modified":1582557447990},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"9b479c2f9a9bfed77885e5093b8245cc5d768ec7","modified":1574579205890},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"a960a2dd587b15d3b3fe1b59525d6fa971c6a6ec","modified":1582557447990},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"a05a4031e799bc864a4536f9ef61fe643cd421af","modified":1582557447990},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"b3220db827e1adbca7880c2bb23e78fa7cbe95cb","modified":1574579205900},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar.styl","hash":"a9cd93c36bae5af9223e7804963096274e8a4f03","modified":1582557447990},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"2a47f8a6bb589c2fb635e6c1e4a2563c7f63c407","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"796415ae7490e17857e64ffef7e470b65c655a6b","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/highlight/diff.styl","hash":"d3f73688bb7423e3ab0de1efdf6db46db5e34f80","modified":1574579205910},{"_id":"themes/next/source/css/_common/scaffolding/highlight/theme.styl","hash":"3b3acc5caa0b95a2598bef4eeacb21bab21bea56","modified":1574579205910},{"_id":"themes/next/source/css/_common/scaffolding/highlight/highlight.styl","hash":"8136f9efe1f018ebe4b4a2d8bd3683bb393ff456","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"7213e3d0ad7c95717ecd4e701d6ee9248ef2bf9f","modified":1574579205910},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"709d10f763e357e1472d6471f8be384ec9e2d983","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"1a14c1b92d8a4dd8aabb5949333ac0ac79094c6c","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"d7fce4b51b5f4b7c31d93a9edb6c6ce740aa0d6b","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/tags/tags.styl","hash":"9e4c0653cfd3cc6908fa0d97581bcf80861fb1e7","modified":1574579205920},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"5ac97054b302fe3ce47822a03a3b56aa3d582005","modified":1582557447990},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"2dc2a5b7becb11de1d4bdab6b5195588ae878cfc","modified":1574579205920},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"c0944ea35dc2bd3b2da9b64f5d05e7e78b6660f1","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"e3ade812b5541eca5b863ad3ff234ea95925bf31","modified":1574579205850},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"5d5c022aa3b2f89c2f2a178212338bb64804dd75","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"f49ca072b5a800f735e8f01fc3518f885951dd8e","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"72d495a88f7d6515af425c12cbc67308a57d88ea","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"887aa8de61ae060150a6312d5cb00d4da065db77","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"796eb941ba0ca03fd5ca6d15a1f6a56afd9aa174","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"f5c2788a78790aca1a2f37f7149d6058afb539e0","modified":1574579205850},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"99e12c9ce3d14d4837e3d3f12fc867ba9c565317","modified":1574579205850},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"5b5649b9749e3fd8b63aef22ceeece0a6e1df605","modified":1574579205850},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"1e4190c10c9e0c9ce92653b0dbcec21754b0b69d","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"c7939407797acbd1ae0d8bae8e13b2bf045f870e","modified":1582557447970},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"eca4d80dd0df1c3b1bc06bd39e6a4bd6c56198df","modified":1574579205850},{"_id":"themes/next/.git/objects/pack/pack-bb626a209f351d5ef96927bf6925432c87df1fd2.pack","hash":"f9ad9df1d4dfbf42e4a49153f5c2db97c40cc57e","modified":1582557447850},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1574579206020},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1574579206010},{"_id":"themes/next/.git/objects/pack/pack-03ffaec0e5f95a3c7df82b4579bd1180ba8286f8.pack","hash":"423a56c3a4e4086f64a746d038aafc3c70638d62","modified":1574579205630}],"Category":[{"name":"","_id":"ckbksjs9s0004ndf23jdevosp"},{"name":"","_id":"ckbksjs9x0009ndf2ldnidv5i"},{"name":"","_id":"ckbksjsa7000rndf24s38vv5r"}],"Data":[],"Page":[{"title":"categories","date":"2019-11-24T11:58:37.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2019-11-24 19:58:37\ntype: \"categories\"\n---\n","updated":"2019-11-24T11:59:35.780Z","path":"categories/index.html","comments":1,"layout":"page","_id":"ckbksjs9p0001ndf2g8m8aob8","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2019-11-24T11:59:48.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2019-11-24 19:59:48\ntype: \"tags\"\n---\n","updated":"2019-11-24T11:59:58.920Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ckbksjs9r0003ndf2rkcrsj6x","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Android ()","date":"2018-09-10T07:02:46.000Z","_content":", OOM ,,,,.\n\n# ViewPager \n ViewPager  Fragment, ViewPager  ViewPager, Activity  Fragment ,,..\nFragmentActivity,Fragment,,Activity. Fragment `setUserVisibleHint(boolean isVisibleToUser)`,Fragment .\n<!-- more -->\n``` java\npublic abstract class LazyFrgment extends Fragment {\n\n    /**\n     * setUserVisibleHintonCreateView\n     */\n    private boolean isPrepared;\n    /**\n     * \n     */\n    private boolean isVisible;\n\n    /**\n     * onAttach\n     */\n    private boolean hasNotLazyLoad;\n\n    public void setHasNotLazyLoad(boolean hasNotLazyLoad) {\n        this.hasNotLazyLoad = hasNotLazyLoad;\n    }\n\n    @Nullable\n    @Override\n    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n        isPrepared = true;\n        return inflater.inflate(getContentView(), container, false);\n    }\n\n    @Override\n    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n        super.onViewCreated(view, savedInstanceState);\n        initView(view);\n    }\n\n    @Override\n    public void onActivityCreated(@Nullable Bundle savedInstanceState) {\n        super.onActivityCreated(savedInstanceState);\n        if (hasNotLazyLoad) {\n            initData();\n            loadData();\n        }\n    }\n\n    @Override\n    public void setUserVisibleHint(boolean isVisibleToUser) {\n        super.setUserVisibleHint(isVisibleToUser);\n        isVisible = getUserVisibleHint();\n        if (isVisible) {\n            onVisible();\n        } else {\n            onInvisible();\n        }\n    }\n\n    protected void onVisible() {\n        lazyLoad();\n    }\n\n    protected void onInvisible() {\n\n    }\n\n    protected void lazyLoad() {\n        if (isVisible && isPrepared && !hasNotLazyLoad) {\n            isPrepared = false;\n            initData();\n            loadData();\n        }\n    }\n\n    /**\n     * Fragment\n     *\n     * @return Id\n     */\n    protected abstract int getContentView();\n\n    /**\n     * View\n     *\n     * @param view ContentView\n     */\n    protected abstract void initView(View view);\n\n\n    /**\n     * View\n     */\n    protected abstract void initData();\n\n    /**\n     * \n     */\n    protected abstract void loadData();\n\n}\n```\n LazyFragment ,,. Token . ViewPager  Fragment ,,`setOffscreenPageLimit` ViewPager  limit , ViewPager  Fragment , Fragment .\n# \n,,, OOM, OOM ,.,,.,,.\n API 14,Application . Activity .\n``` java\n    /**\n     *  Application  onCreate \n     */\n    private void registerMainProcessActivityLife() {\n        //,Activity ,\n        final Stack<Activity> activities = new Stack<>();\n        //\n        final int maxGoodDetailActivityNum = 3;\n        registerActivityLifecycleCallbacks(new ActivityLifecycleCallbacks() {\n            @Override\n            public void onActivityCreated(Activity activity, Bundle savedInstanceState) {\n                if (activity instanceof GoodsDetailActivity) {\n                    if (activities.size() >= maxGoodDetailActivityNum) {\n                        activities.peek().finish(); //\n                    }\n                    activities.add(activity);\n                }\n            }\n\n            @Override\n            public void onActivityStarted(Activity activity) {\n\n            }\n\n            @Override\n            public void onActivityResumed(Activity activity) {\n\n            }\n\n            @Override\n            public void onActivityPaused(Activity activity) {\n\n            }\n\n            @Override\n            public void onActivityStopped(Activity activity) {\n\n            }\n\n            @Override\n            public void onActivitySaveInstanceState(Activity activity, Bundle outState) {\n\n            }\n\n            @Override\n            public void onActivityDestroyed(Activity activity) {\n                activities.remove(activity);\n            }\n        });\n    }\n```\n#  vlayout\n,,, ScrollView , RecyclerView ,.[vlayout](https://github.com/alibaba/vlayout),.,.vlayout .`vlayout  RecyclerView  LayoutManager , LayoutManagerRecyclerViewLayoutManagerLayoutHelperLayoutHelperLayoutHelperLayoutHelperRecyclerViewLinearLayoutManagerGridLayoutManagerLayoutHelper.`\n# onDestroy \n,Activity finish  Activity , Actiivty Activity.JVM.,.\n,.","source":"_posts/android-memory-optimization-2.md","raw":"---\ntitle: Android ()\ndate: 2018-09-10 15:02:46\ntags:\n    - Android\n    - \ncategories: \n    - \n---\n, OOM ,,,,.\n\n# ViewPager \n ViewPager  Fragment, ViewPager  ViewPager, Activity  Fragment ,,..\nFragmentActivity,Fragment,,Activity. Fragment `setUserVisibleHint(boolean isVisibleToUser)`,Fragment .\n<!-- more -->\n``` java\npublic abstract class LazyFrgment extends Fragment {\n\n    /**\n     * setUserVisibleHintonCreateView\n     */\n    private boolean isPrepared;\n    /**\n     * \n     */\n    private boolean isVisible;\n\n    /**\n     * onAttach\n     */\n    private boolean hasNotLazyLoad;\n\n    public void setHasNotLazyLoad(boolean hasNotLazyLoad) {\n        this.hasNotLazyLoad = hasNotLazyLoad;\n    }\n\n    @Nullable\n    @Override\n    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n        isPrepared = true;\n        return inflater.inflate(getContentView(), container, false);\n    }\n\n    @Override\n    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n        super.onViewCreated(view, savedInstanceState);\n        initView(view);\n    }\n\n    @Override\n    public void onActivityCreated(@Nullable Bundle savedInstanceState) {\n        super.onActivityCreated(savedInstanceState);\n        if (hasNotLazyLoad) {\n            initData();\n            loadData();\n        }\n    }\n\n    @Override\n    public void setUserVisibleHint(boolean isVisibleToUser) {\n        super.setUserVisibleHint(isVisibleToUser);\n        isVisible = getUserVisibleHint();\n        if (isVisible) {\n            onVisible();\n        } else {\n            onInvisible();\n        }\n    }\n\n    protected void onVisible() {\n        lazyLoad();\n    }\n\n    protected void onInvisible() {\n\n    }\n\n    protected void lazyLoad() {\n        if (isVisible && isPrepared && !hasNotLazyLoad) {\n            isPrepared = false;\n            initData();\n            loadData();\n        }\n    }\n\n    /**\n     * Fragment\n     *\n     * @return Id\n     */\n    protected abstract int getContentView();\n\n    /**\n     * View\n     *\n     * @param view ContentView\n     */\n    protected abstract void initView(View view);\n\n\n    /**\n     * View\n     */\n    protected abstract void initData();\n\n    /**\n     * \n     */\n    protected abstract void loadData();\n\n}\n```\n LazyFragment ,,. Token . ViewPager  Fragment ,,`setOffscreenPageLimit` ViewPager  limit , ViewPager  Fragment , Fragment .\n# \n,,, OOM, OOM ,.,,.,,.\n API 14,Application . Activity .\n``` java\n    /**\n     *  Application  onCreate \n     */\n    private void registerMainProcessActivityLife() {\n        //,Activity ,\n        final Stack<Activity> activities = new Stack<>();\n        //\n        final int maxGoodDetailActivityNum = 3;\n        registerActivityLifecycleCallbacks(new ActivityLifecycleCallbacks() {\n            @Override\n            public void onActivityCreated(Activity activity, Bundle savedInstanceState) {\n                if (activity instanceof GoodsDetailActivity) {\n                    if (activities.size() >= maxGoodDetailActivityNum) {\n                        activities.peek().finish(); //\n                    }\n                    activities.add(activity);\n                }\n            }\n\n            @Override\n            public void onActivityStarted(Activity activity) {\n\n            }\n\n            @Override\n            public void onActivityResumed(Activity activity) {\n\n            }\n\n            @Override\n            public void onActivityPaused(Activity activity) {\n\n            }\n\n            @Override\n            public void onActivityStopped(Activity activity) {\n\n            }\n\n            @Override\n            public void onActivitySaveInstanceState(Activity activity, Bundle outState) {\n\n            }\n\n            @Override\n            public void onActivityDestroyed(Activity activity) {\n                activities.remove(activity);\n            }\n        });\n    }\n```\n#  vlayout\n,,, ScrollView , RecyclerView ,.[vlayout](https://github.com/alibaba/vlayout),.,.vlayout .`vlayout  RecyclerView  LayoutManager , LayoutManagerRecyclerViewLayoutManagerLayoutHelperLayoutHelperLayoutHelperLayoutHelperRecyclerViewLinearLayoutManagerGridLayoutManagerLayoutHelper.`\n# onDestroy \n,Activity finish  Activity , Actiivty Activity.JVM.,.\n,.","slug":"android-memory-optimization-2","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjs9l0000ndf2o4m87nkj","content":"<p>, OOM ,,,,.</p>\n<h1 id=\"ViewPager-\"><a href=\"#ViewPager-\" class=\"headerlink\" title=\"ViewPager \"></a>ViewPager </h1><p> ViewPager  Fragment, ViewPager  ViewPager, Activity  Fragment ,,..<br>FragmentActivity,Fragment,,Activity. Fragment <code>setUserVisibleHint(boolean isVisibleToUser)</code>,Fragment .<br><a id=\"more\"></a><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LazyFrgment</span> <span class=\"keyword\">extends</span> <span class=\"title\">Fragment</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * setUserVisibleHintonCreateView</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> isPrepared;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> isVisible;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * onAttach</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> hasNotLazyLoad;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setHasNotLazyLoad</span><span class=\"params\">(<span class=\"keyword\">boolean</span> hasNotLazyLoad)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hasNotLazyLoad = hasNotLazyLoad;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">onCreateView</span><span class=\"params\">(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        isPrepared = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> inflater.inflate(getContentView(), container, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onViewCreated</span><span class=\"params\">(@NonNull View view, @Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onViewCreated(view, savedInstanceState);</span><br><span class=\"line\">        initView(view);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityCreated</span><span class=\"params\">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onActivityCreated(savedInstanceState);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (hasNotLazyLoad) &#123;</span><br><span class=\"line\">            initData();</span><br><span class=\"line\">            loadData();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserVisibleHint</span><span class=\"params\">(<span class=\"keyword\">boolean</span> isVisibleToUser)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.setUserVisibleHint(isVisibleToUser);</span><br><span class=\"line\">        isVisible = getUserVisibleHint();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isVisible) &#123;</span><br><span class=\"line\">            onVisible();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            onInvisible();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onVisible</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        lazyLoad();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onInvisible</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">lazyLoad</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isVisible &amp;&amp; isPrepared &amp;&amp; !hasNotLazyLoad) &#123;</span><br><span class=\"line\">            isPrepared = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            initData();</span><br><span class=\"line\">            loadData();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Fragment</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> Id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">int</span> <span class=\"title\">getContentView</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * View</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> view ContentView</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">initView</span><span class=\"params\">(View view)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * View</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">initData</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">loadData</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> LazyFragment ,,. Token . ViewPager  Fragment ,,<code>setOffscreenPageLimit</code> ViewPager  limit , ViewPager  Fragment , Fragment .</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>,,, OOM, OOM ,.,,.,,.<br> API 14,Application . Activity .<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  Application  onCreate </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">registerMainProcessActivityLife</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//,Activity ,</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Stack&lt;Activity&gt; activities = <span class=\"keyword\">new</span> Stack&lt;&gt;();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> maxGoodDetailActivityNum = <span class=\"number\">3</span>;</span><br><span class=\"line\">    registerActivityLifecycleCallbacks(<span class=\"keyword\">new</span> ActivityLifecycleCallbacks() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityCreated</span><span class=\"params\">(Activity activity, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (activity <span class=\"keyword\">instanceof</span> GoodsDetailActivity) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (activities.size() &gt;= maxGoodDetailActivityNum) &#123;</span><br><span class=\"line\">                    activities.peek().finish(); <span class=\"comment\">//</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                activities.add(activity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityStarted</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityResumed</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityPaused</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityStopped</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivitySaveInstanceState</span><span class=\"params\">(Activity activity, Bundle outState)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityDestroyed</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\">            activities.remove(activity);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"-vlayout\"><a href=\"#-vlayout\" class=\"headerlink\" title=\" vlayout\"></a> vlayout</h1><p>,,, ScrollView , RecyclerView ,.<a href=\"https://github.com/alibaba/vlayout\">vlayout</a>,.,.vlayout .<code>vlayout  RecyclerView  LayoutManager , LayoutManagerRecyclerViewLayoutManagerLayoutHelperLayoutHelperLayoutHelperLayoutHelperRecyclerViewLinearLayoutManagerGridLayoutManagerLayoutHelper.</code></p>\n<h1 id=\"onDestroy-\"><a href=\"#onDestroy-\" class=\"headerlink\" title=\"onDestroy \"></a>onDestroy </h1><p>,Activity finish  Activity , Actiivty Activity.JVM.,.<br>,.</p>\n","site":{"data":{}},"excerpt":"<p>, OOM ,,,,.</p>\n<h1 id=\"ViewPager-\"><a href=\"#ViewPager-\" class=\"headerlink\" title=\"ViewPager \"></a>ViewPager </h1><p> ViewPager  Fragment, ViewPager  ViewPager, Activity  Fragment ,,..<br>FragmentActivity,Fragment,,Activity. Fragment <code>setUserVisibleHint(boolean isVisibleToUser)</code>,Fragment .<br>","more":"<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LazyFrgment</span> <span class=\"keyword\">extends</span> <span class=\"title\">Fragment</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * setUserVisibleHintonCreateView</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> isPrepared;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> isVisible;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * onAttach</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> hasNotLazyLoad;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setHasNotLazyLoad</span><span class=\"params\">(<span class=\"keyword\">boolean</span> hasNotLazyLoad)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.hasNotLazyLoad = hasNotLazyLoad;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> View <span class=\"title\">onCreateView</span><span class=\"params\">(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        isPrepared = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> inflater.inflate(getContentView(), container, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onViewCreated</span><span class=\"params\">(@NonNull View view, @Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onViewCreated(view, savedInstanceState);</span><br><span class=\"line\">        initView(view);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityCreated</span><span class=\"params\">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onActivityCreated(savedInstanceState);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (hasNotLazyLoad) &#123;</span><br><span class=\"line\">            initData();</span><br><span class=\"line\">            loadData();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUserVisibleHint</span><span class=\"params\">(<span class=\"keyword\">boolean</span> isVisibleToUser)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.setUserVisibleHint(isVisibleToUser);</span><br><span class=\"line\">        isVisible = getUserVisibleHint();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isVisible) &#123;</span><br><span class=\"line\">            onVisible();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            onInvisible();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onVisible</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        lazyLoad();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onInvisible</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">lazyLoad</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isVisible &amp;&amp; isPrepared &amp;&amp; !hasNotLazyLoad) &#123;</span><br><span class=\"line\">            isPrepared = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            initData();</span><br><span class=\"line\">            loadData();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Fragment</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> Id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">int</span> <span class=\"title\">getContentView</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * View</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> view ContentView</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">initView</span><span class=\"params\">(View view)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * View</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">initData</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">loadData</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> LazyFragment ,,. Token . ViewPager  Fragment ,,<code>setOffscreenPageLimit</code> ViewPager  limit , ViewPager  Fragment , Fragment .</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>,,, OOM, OOM ,.,,.,,.<br> API 14,Application . Activity .<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  Application  onCreate </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">registerMainProcessActivityLife</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//,Activity ,</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Stack&lt;Activity&gt; activities = <span class=\"keyword\">new</span> Stack&lt;&gt;();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> maxGoodDetailActivityNum = <span class=\"number\">3</span>;</span><br><span class=\"line\">    registerActivityLifecycleCallbacks(<span class=\"keyword\">new</span> ActivityLifecycleCallbacks() &#123;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityCreated</span><span class=\"params\">(Activity activity, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (activity <span class=\"keyword\">instanceof</span> GoodsDetailActivity) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (activities.size() &gt;= maxGoodDetailActivityNum) &#123;</span><br><span class=\"line\">                    activities.peek().finish(); <span class=\"comment\">//</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                activities.add(activity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityStarted</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityResumed</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityPaused</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityStopped</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivitySaveInstanceState</span><span class=\"params\">(Activity activity, Bundle outState)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onActivityDestroyed</span><span class=\"params\">(Activity activity)</span> </span>&#123;</span><br><span class=\"line\">            activities.remove(activity);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"-vlayout\"><a href=\"#-vlayout\" class=\"headerlink\" title=\" vlayout\"></a> vlayout</h1><p>,,, ScrollView , RecyclerView ,.<a href=\"https://github.com/alibaba/vlayout\">vlayout</a>,.,.vlayout .<code>vlayout  RecyclerView  LayoutManager , LayoutManagerRecyclerViewLayoutManagerLayoutHelperLayoutHelperLayoutHelperLayoutHelperRecyclerViewLinearLayoutManagerGridLayoutManagerLayoutHelper.</code></p>\n<h1 id=\"onDestroy-\"><a href=\"#onDestroy-\" class=\"headerlink\" title=\"onDestroy \"></a>onDestroy </h1><p>,Activity finish  Activity , Actiivty Activity.JVM.,.<br>,.</p>"},{"title":"","date":"2018-07-20T08:27:58.000Z","_content":"## \n\n* (SRP):\n* (OCP):\n* (LSP):\n* (DIP):\n* (ISP):\n* (LOD):\n\n\n<!-- more -->\n## \n\n:\n\n:IO\n\n\n* \n* \n* \n* \n\n\nAndroidApplication,onCreateContextApplication Context\n\n## Builder\n\n:\n\n:\n* \n* \n* \n\nAndroidAlertDialog.Builder,AlertDialogBuilderDialog,IntentBuilder\n\n## \n\n:\n\n:\n* \n* new\n* \n\nCloneable\n\n## \n\n:\n\n:\n\nActivityView\n\n## \n\n:\n\n:\n\n\n\n## \n\n:\n\n:\n* \n* \n* if-elseswitch-case\n\n\n\n## \n\n:\n\n:\n* \n* \n\nView\n\n## \n\n:\n\n:\n* \n* \n* \n\nAndroid\n\n## \n\n:\n\n:\n* \n* \n\nAndroidAndroidManifest\n\n## \n\n:\n\n:\n* \n* \n* \n* \n* \n\n\n\n## \n\n:\n\n:\n* \n* \n* \n\nAndroidBroadcastReceiverListView\n\n## \n\n:\n\n:\n* \n* \n\nAndroidActivityFragmentView\n\n## \n\n:\n\n:\n\nAndroidCursor,ORM,\n\n## \n\n:\n\n:\n* \n* \n*  \n\nAndroidActivityFragmentAsyncTask\n\n## \n\n:\n\n:\n* \n* \"\"\n\n\n\n\n## \n\n:\n\n:\n* \n* \n\nAndroidBinderView\n\n## \n\n:\n\n:\n\nAndroidAMSRetrofit\n\n## \n\n:-\n\n:\n* -\n* \n\nAndroidViewViewGroupView\n\n## \n\n:\n\n:\n* \n* \n* \n\nListViewRecyclerView\n\n## \n\n:\n\n:\n\nAndroidContextWrapper\n\n## \n\n:\n\n:\n* \n* \n* \n\nMessageequals,==\n\n## \n\n:\n\n:\n* \n* \n\nContextImpl,Module\n\n## \n\n:\n\n:\n* \n* \n* \n\nAndroidapi\n","source":"_posts/android-design-pattern.md","raw":"---\ntitle: \ndate: 2018-07-20 16:27:58\ntags:\n    - Android\n    - \ncategories: \n---\n## \n\n* (SRP):\n* (OCP):\n* (LSP):\n* (DIP):\n* (ISP):\n* (LOD):\n\n\n<!-- more -->\n## \n\n:\n\n:IO\n\n\n* \n* \n* \n* \n\n\nAndroidApplication,onCreateContextApplication Context\n\n## Builder\n\n:\n\n:\n* \n* \n* \n\nAndroidAlertDialog.Builder,AlertDialogBuilderDialog,IntentBuilder\n\n## \n\n:\n\n:\n* \n* new\n* \n\nCloneable\n\n## \n\n:\n\n:\n\nActivityView\n\n## \n\n:\n\n:\n\n\n\n## \n\n:\n\n:\n* \n* \n* if-elseswitch-case\n\n\n\n## \n\n:\n\n:\n* \n* \n\nView\n\n## \n\n:\n\n:\n* \n* \n* \n\nAndroid\n\n## \n\n:\n\n:\n* \n* \n\nAndroidAndroidManifest\n\n## \n\n:\n\n:\n* \n* \n* \n* \n* \n\n\n\n## \n\n:\n\n:\n* \n* \n* \n\nAndroidBroadcastReceiverListView\n\n## \n\n:\n\n:\n* \n* \n\nAndroidActivityFragmentView\n\n## \n\n:\n\n:\n\nAndroidCursor,ORM,\n\n## \n\n:\n\n:\n* \n* \n*  \n\nAndroidActivityFragmentAsyncTask\n\n## \n\n:\n\n:\n* \n* \"\"\n\n\n\n\n## \n\n:\n\n:\n* \n* \n\nAndroidBinderView\n\n## \n\n:\n\n:\n\nAndroidAMSRetrofit\n\n## \n\n:-\n\n:\n* -\n* \n\nAndroidViewViewGroupView\n\n## \n\n:\n\n:\n* \n* \n* \n\nListViewRecyclerView\n\n## \n\n:\n\n:\n\nAndroidContextWrapper\n\n## \n\n:\n\n:\n* \n* \n* \n\nMessageequals,==\n\n## \n\n:\n\n:\n* \n* \n\nContextImpl,Module\n\n## \n\n:\n\n:\n* \n* \n* \n\nAndroidapi\n","slug":"android-design-pattern","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjs9q0002ndf2o47zrqvk","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>(SRP):</li>\n<li>(OCP):</li>\n<li>(LSP):</li>\n<li>(DIP):</li>\n<li>(ISP):</li>\n<li>(LOD):</li>\n</ul>\n<p><br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:IO</p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><br>AndroidApplication,onCreateContextApplication Context</p>\n<h2 id=\"Builder\"><a href=\"#Builder\" class=\"headerlink\" title=\"Builder\"></a>Builder</h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidAlertDialog.Builder,AlertDialogBuilderDialog,IntentBuilder</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li>new</li>\n<li></li>\n</ul>\n<p>Cloneable</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p>ActivityView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li>if-elseswitch-case</li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>View</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Android</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidAndroidManifest</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidBroadcastReceiverListView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidActivityFragmentView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p>AndroidCursor,ORM,</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li> </li>\n</ul>\n<p>AndroidActivityFragmentAsyncTask</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidBinderView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p>AndroidAMSRetrofit</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:-</p>\n<p>:</p>\n<ul>\n<li>-</li>\n<li></li>\n</ul>\n<p>AndroidViewViewGroupView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>ListViewRecyclerView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p>AndroidContextWrapper</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Messageequals,==</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>ContextImpl,Module</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Androidapi</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>(SRP):</li>\n<li>(OCP):</li>\n<li>(LSP):</li>\n<li>(DIP):</li>\n<li>(ISP):</li>\n<li>(LOD):</li>\n</ul>\n<p><br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:IO</p>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p><br>AndroidApplication,onCreateContextApplication Context</p>\n<h2 id=\"Builder\"><a href=\"#Builder\" class=\"headerlink\" title=\"Builder\"></a>Builder</h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidAlertDialog.Builder,AlertDialogBuilderDialog,IntentBuilder</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li>new</li>\n<li></li>\n</ul>\n<p>Cloneable</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p>ActivityView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li>if-elseswitch-case</li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>View</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Android</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidAndroidManifest</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidBroadcastReceiverListView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidActivityFragmentView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p>AndroidCursor,ORM,</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li> </li>\n</ul>\n<p>AndroidActivityFragmentAsyncTask</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>AndroidBinderView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p>AndroidAMSRetrofit</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:-</p>\n<p>:</p>\n<ul>\n<li>-</li>\n<li></li>\n</ul>\n<p>AndroidViewViewGroupView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>ListViewRecyclerView</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<p>AndroidContextWrapper</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Messageequals,==</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n</ul>\n<p>ContextImpl,Module</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<p>:</p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Androidapi</p>"},{"title":"Android ()","date":"2018-09-03T07:13:44.000Z","_content":",,,,.\n,,,,, WebView ,., Tab 40%,,30%, bugly  OOM ,.\n<!-- more -->\n# ,:\n1. \n    1. \n    2. , xhdpi ,,\n2. \n    1.  View , xml  LinearLayout , ViewGroup,\n    2. ,RelativeLayout ,\n    3.  View  Gone , ViewStub,\n3.  ViewPager \n4. ,, OOM \n5.  ScrollView,\n6. onDestroy ,\n7. WebView\n   1.  Web  WebView,,\n   2. Web, WebView  VR ,\n\n# \n,,,,.\n,,.\n,,.\n\n.&#123;% note danger %&#1235;  &#123; endnote %&#125;,,.\n\n# \n ## \n Glide3.7.0 , library ,,,,.Fresco ,,,,.\n\n, ImageView, Glide  View ,,,,..\n\n,, View ,,,, Activity  Activity ,,**,**..,,,,.\n\n, View ,.`onAttachedToWindow``onDetachedFromWindow` View .Activity  onAttachedToWindow onResume , onDetachedFromWindow  onDestroy , Activity , Activity ,, Activity ,,.\n``` java\npublic class SmartImageView extends AppCompatImageView {\n\n     \n    private String mUrl;\n\n    @Override\n    protected void onAttachedToWindow() {\n        super.onAttachedToWindow();\n        onAttach();\n    }\n\n    @Override\n    protected void onDetachedFromWindow() {\n        super.onDetachedFromWindow();\n        onDetach();\n    }\n\n    //Viwe,\n    private void onAttach() {\n        setImageUrl(mUrl);\n    }\n\n    //,View\n    private void onDetach() {\n        setImageDrawable(null);\n    }\n    \n    //,,,View,,override,\n    public void setImageUrl(String url){\n        DrawableRequestBuilder<String> builder = Glide.with(getContext().getApplicationContext())\n                    .load(url)\n                    .dontAnimate()//,,\n                    .fitCenter();\n            //builder.into(this) ContextApplicationContext,view,,\n            builder.into(new SimpleTarget<GlideDrawable>() {\n                @Override\n                public void onResourceReady(GlideDrawable resource, GlideAnimation<? super GlideDrawable> glideAnimation) {\n                    if (resource != null && getContext() != null) {\n                        setImageDrawable(resource);\n                    }\n                }\n            });\n    }\n}\n```\n,..\n Android 8.0 , Native , ****,,, Native  OOM,.  Android 2.3 ,, Android 8.0  Native  NativeAllocationRegistry,..\n## \n* ,,,.\n*  webp,, Android4.2 bug,, Android4.1 .\n*  xxhdpi, OOM.\n## \n*  View , Activity ,, LinearLayout  LayouInfflate r xml ,,, Layout Inspector ,.\n    *  Layout new widget,, java ,.\n    *  Layout  LayoutInflater  xml , xml  merge,.\n      ,.\n``` xml\n<merge xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    tools:layout_height=\"match_parent\"\n    tools:layout_width=\"match_parent\"\n    tools:parentTag=\"android.widget.FrameLayout\">\n</merge>\n```\n parentTag ., java .\n* Google  2016 I/O  ConstrainLayout . Layouts ,, LinearLayout, FrameLayout  ConstrainLayout .[ConstrainLayout Guide](https://developer.android.com/training/constraint-layout/).\n* Activity,:, Activity , setVisible(GONE),. ViewStub , ViewStub ,,. ViewStub  merge . WebView,.\n``` java\n((ViewStub) findViewById(R.id.my_layout)).setVisibility(View.VISIBLE);\n// \nView importPanel = ((ViewStub) findViewById(R.id.my_layout)).inflate();\n```\n    ``` xml\n<!--  android:layout -->\n<ViewStub\n        android:id=\"@+id/stub_home_web\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:background=\"@android:color/transparent\"\n        android:layout=\"@layout/layout_web\" />\n    ```\n# Android Profiler\n,,Android Studio , Android Profiler  CPU.[Android Profiler ](https://developer.android.google.cn/studio/profile/memory-profiler),.","source":"_posts/android-memory-optimization.md","raw":"---\ntitle: Android ()\ndate: 2018-09-03 15:13:44\ntags:\n    - Android\n    - \ncategories: \n    - \n---\n,,,,.\n,,,,, WebView ,., Tab 40%,,30%, bugly  OOM ,.\n<!-- more -->\n# ,:\n1. \n    1. \n    2. , xhdpi ,,\n2. \n    1.  View , xml  LinearLayout , ViewGroup,\n    2. ,RelativeLayout ,\n    3.  View  Gone , ViewStub,\n3.  ViewPager \n4. ,, OOM \n5.  ScrollView,\n6. onDestroy ,\n7. WebView\n   1.  Web  WebView,,\n   2. Web, WebView  VR ,\n\n# \n,,,,.\n,,.\n,,.\n\n.&#123;% note danger %&#1235;  &#123; endnote %&#125;,,.\n\n# \n ## \n Glide3.7.0 , library ,,,,.Fresco ,,,,.\n\n, ImageView, Glide  View ,,,,..\n\n,, View ,,,, Activity  Activity ,,**,**..,,,,.\n\n, View ,.`onAttachedToWindow``onDetachedFromWindow` View .Activity  onAttachedToWindow onResume , onDetachedFromWindow  onDestroy , Activity , Activity ,, Activity ,,.\n``` java\npublic class SmartImageView extends AppCompatImageView {\n\n     \n    private String mUrl;\n\n    @Override\n    protected void onAttachedToWindow() {\n        super.onAttachedToWindow();\n        onAttach();\n    }\n\n    @Override\n    protected void onDetachedFromWindow() {\n        super.onDetachedFromWindow();\n        onDetach();\n    }\n\n    //Viwe,\n    private void onAttach() {\n        setImageUrl(mUrl);\n    }\n\n    //,View\n    private void onDetach() {\n        setImageDrawable(null);\n    }\n    \n    //,,,View,,override,\n    public void setImageUrl(String url){\n        DrawableRequestBuilder<String> builder = Glide.with(getContext().getApplicationContext())\n                    .load(url)\n                    .dontAnimate()//,,\n                    .fitCenter();\n            //builder.into(this) ContextApplicationContext,view,,\n            builder.into(new SimpleTarget<GlideDrawable>() {\n                @Override\n                public void onResourceReady(GlideDrawable resource, GlideAnimation<? super GlideDrawable> glideAnimation) {\n                    if (resource != null && getContext() != null) {\n                        setImageDrawable(resource);\n                    }\n                }\n            });\n    }\n}\n```\n,..\n Android 8.0 , Native , ****,,, Native  OOM,.  Android 2.3 ,, Android 8.0  Native  NativeAllocationRegistry,..\n## \n* ,,,.\n*  webp,, Android4.2 bug,, Android4.1 .\n*  xxhdpi, OOM.\n## \n*  View , Activity ,, LinearLayout  LayouInfflate r xml ,,, Layout Inspector ,.\n    *  Layout new widget,, java ,.\n    *  Layout  LayoutInflater  xml , xml  merge,.\n      ,.\n``` xml\n<merge xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    tools:layout_height=\"match_parent\"\n    tools:layout_width=\"match_parent\"\n    tools:parentTag=\"android.widget.FrameLayout\">\n</merge>\n```\n parentTag ., java .\n* Google  2016 I/O  ConstrainLayout . Layouts ,, LinearLayout, FrameLayout  ConstrainLayout .[ConstrainLayout Guide](https://developer.android.com/training/constraint-layout/).\n* Activity,:, Activity , setVisible(GONE),. ViewStub , ViewStub ,,. ViewStub  merge . WebView,.\n``` java\n((ViewStub) findViewById(R.id.my_layout)).setVisibility(View.VISIBLE);\n// \nView importPanel = ((ViewStub) findViewById(R.id.my_layout)).inflate();\n```\n    ``` xml\n<!--  android:layout -->\n<ViewStub\n        android:id=\"@+id/stub_home_web\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:background=\"@android:color/transparent\"\n        android:layout=\"@layout/layout_web\" />\n    ```\n# Android Profiler\n,,Android Studio , Android Profiler  CPU.[Android Profiler ](https://developer.android.google.cn/studio/profile/memory-profiler),.","slug":"android-memory-optimization","published":1,"updated":"2020-06-18T12:46:51.360Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjs9u0006ndf2qcmc1qzx","content":"<p>,,,,.<br>,,,,, WebView ,., Tab 40%,,30%, bugly  OOM ,.<br><a id=\"more\"></a></p>\n<h1 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",:\"></a>,:</h1><ol>\n<li><ol>\n<li></li>\n<li>, xhdpi ,,</li>\n</ol>\n</li>\n<li><ol>\n<li> View , xml  LinearLayout , ViewGroup,</li>\n<li>,RelativeLayout ,</li>\n<li> View  Gone , ViewStub,</li>\n</ol>\n</li>\n<li> ViewPager </li>\n<li>,, OOM </li>\n<li> ScrollView,</li>\n<li>onDestroy ,</li>\n<li>WebView<ol>\n<li> Web  WebView,,</li>\n<li>Web, WebView  VR ,</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>,,,,.<br>,,.<br>,,.</p>\n<p>.&#123;% note danger %&#1235;  &#123; endnote %&#125;,,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Glide3.7.0 , library ,,,,.Fresco ,,,,.</p>\n<p>, ImageView, Glide  View ,,,,..</p>\n<p>,, View ,,,, Activity  Activity ,,<strong>,</strong>..,,,,.</p>\n<p>, View ,.<code>onAttachedToWindow</code><code>onDetachedFromWindow</code> View .Activity  onAttachedToWindow onResume , onDetachedFromWindow  onDestroy , Activity , Activity ,, Activity ,,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SmartImageView</span> <span class=\"keyword\">extends</span> <span class=\"title\">AppCompatImageView</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String mUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onAttachedToWindow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onAttachedToWindow();</span><br><span class=\"line\">        onAttach();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onDetachedFromWindow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDetachedFromWindow();</span><br><span class=\"line\">        onDetach();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Viwe,</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">onAttach</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        setImageUrl(mUrl);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//,View</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">onDetach</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        setImageDrawable(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//,,,View,,override,</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setImageUrl</span><span class=\"params\">(String url)</span></span>&#123;</span><br><span class=\"line\">        DrawableRequestBuilder&lt;String&gt; builder = Glide.with(getContext().getApplicationContext())</span><br><span class=\"line\">                    .load(url)</span><br><span class=\"line\">                    .dontAnimate()<span class=\"comment\">//,,</span></span><br><span class=\"line\">                    .fitCenter();</span><br><span class=\"line\">            <span class=\"comment\">//builder.into(this) ContextApplicationContext,view,,</span></span><br><span class=\"line\">            builder.into(<span class=\"keyword\">new</span> SimpleTarget&lt;GlideDrawable&gt;() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onResourceReady</span><span class=\"params\">(GlideDrawable resource, GlideAnimation&lt;? <span class=\"keyword\">super</span> GlideDrawable&gt; glideAnimation)</span> </span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (resource != <span class=\"keyword\">null</span> &amp;&amp; getContext() != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        setImageDrawable(resource);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>,..<br> Android 8.0 , Native , <strong></strong>,,, Native  OOM,.  Android 2.3 ,, Android 8.0  Native  NativeAllocationRegistry,..</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>,,,.</li>\n<li> webp,, Android4.2 bug,, Android4.1 .</li>\n<li> xxhdpi, OOM.<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2></li>\n<li> View , Activity ,, LinearLayout  LayouInfflate r xml ,,, Layout Inspector ,.<ul>\n<li> Layout new widget,, java ,.</li>\n<li> Layout  LayoutInflater  xml , xml  merge,.<br>,.<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">merge</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:parentTag</span>=<span class=\"string\">\"android.widget.FrameLayout\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">merge</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<p> parentTag ., java .</p>\n<ul>\n<li>Google  2016 I/O  ConstrainLayout . Layouts ,, LinearLayout, FrameLayout  ConstrainLayout .<a href=\"https://developer.android.com/training/constraint-layout/\" target=\"_blank\" rel=\"noopener\">ConstrainLayout Guide</a>.</li>\n<li><p>Activity,:, Activity , setVisible(GONE),. ViewStub , ViewStub ,,. ViewStub  merge . WebView,.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">((ViewStub) findViewById(R.id.my_layout)).setVisibility(View.VISIBLE);</span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">View importPanel = ((ViewStub) findViewById(R.id.my_layout)).inflate();</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  android:layout --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ViewStub</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/stub_home_web\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:background</span>=<span class=\"string\">\"@android:color/transparent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout</span>=<span class=\"string\">\"@layout/layout_web\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h1 id=\"Android-Profiler\"><a href=\"#Android-Profiler\" class=\"headerlink\" title=\"Android Profiler\"></a>Android Profiler</h1><p>,,Android Studio , Android Profiler  CPU.<a href=\"https://developer.android.google.cn/studio/profile/memory-profiler\" target=\"_blank\" rel=\"noopener\">Android Profiler </a>,.</p>\n","site":{"data":{}},"excerpt":"<p>,,,,.<br>,,,,, WebView ,., Tab 40%,,30%, bugly  OOM ,.<br>","more":"</p>\n<h1 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",:\"></a>,:</h1><ol>\n<li><ol>\n<li></li>\n<li>, xhdpi ,,</li>\n</ol>\n</li>\n<li><ol>\n<li> View , xml  LinearLayout , ViewGroup,</li>\n<li>,RelativeLayout ,</li>\n<li> View  Gone , ViewStub,</li>\n</ol>\n</li>\n<li> ViewPager </li>\n<li>,, OOM </li>\n<li> ScrollView,</li>\n<li>onDestroy ,</li>\n<li>WebView<ol>\n<li> Web  WebView,,</li>\n<li>Web, WebView  VR ,</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>,,,,.<br>,,.<br>,,.</p>\n<p>.&#123;% note danger %&#1235;  &#123; endnote %&#125;,,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Glide3.7.0 , library ,,,,.Fresco ,,,,.</p>\n<p>, ImageView, Glide  View ,,,,..</p>\n<p>,, View ,,,, Activity  Activity ,,<strong>,</strong>..,,,,.</p>\n<p>, View ,.<code>onAttachedToWindow</code><code>onDetachedFromWindow</code> View .Activity  onAttachedToWindow onResume , onDetachedFromWindow  onDestroy , Activity , Activity ,, Activity ,,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SmartImageView</span> <span class=\"keyword\">extends</span> <span class=\"title\">AppCompatImageView</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">     </span><br><span class=\"line\">    <span class=\"keyword\">private</span> String mUrl;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onAttachedToWindow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onAttachedToWindow();</span><br><span class=\"line\">        onAttach();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onDetachedFromWindow</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDetachedFromWindow();</span><br><span class=\"line\">        onDetach();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Viwe,</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">onAttach</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        setImageUrl(mUrl);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//,View</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">onDetach</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        setImageDrawable(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//,,,View,,override,</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setImageUrl</span><span class=\"params\">(String url)</span></span>&#123;</span><br><span class=\"line\">        DrawableRequestBuilder&lt;String&gt; builder = Glide.with(getContext().getApplicationContext())</span><br><span class=\"line\">                    .load(url)</span><br><span class=\"line\">                    .dontAnimate()<span class=\"comment\">//,,</span></span><br><span class=\"line\">                    .fitCenter();</span><br><span class=\"line\">            <span class=\"comment\">//builder.into(this) ContextApplicationContext,view,,</span></span><br><span class=\"line\">            builder.into(<span class=\"keyword\">new</span> SimpleTarget&lt;GlideDrawable&gt;() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onResourceReady</span><span class=\"params\">(GlideDrawable resource, GlideAnimation&lt;? <span class=\"keyword\">super</span> GlideDrawable&gt; glideAnimation)</span> </span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (resource != <span class=\"keyword\">null</span> &amp;&amp; getContext() != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        setImageDrawable(resource);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>,..<br> Android 8.0 , Native , <strong></strong>,,, Native  OOM,.  Android 2.3 ,, Android 8.0  Native  NativeAllocationRegistry,..</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>,,,.</li>\n<li> webp,, Android4.2 bug,, Android4.1 .</li>\n<li> xxhdpi, OOM.<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2></li>\n<li> View , Activity ,, LinearLayout  LayouInfflate r xml ,,, Layout Inspector ,.<ul>\n<li> Layout new widget,, java ,.</li>\n<li> Layout  LayoutInflater  xml , xml  merge,.<br>,.<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">merge</span> <span class=\"attr\">xmlns:android</span>=<span class=\"string\">\"http://schemas.android.com/apk/res/android\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlns:tools</span>=<span class=\"string\">\"http://schemas.android.com/tools\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">tools:parentTag</span>=<span class=\"string\">\"android.widget.FrameLayout\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">merge</span>&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<p> parentTag ., java .</p>\n<ul>\n<li>Google  2016 I/O  ConstrainLayout . Layouts ,, LinearLayout, FrameLayout  ConstrainLayout .<a href=\"https://developer.android.com/training/constraint-layout/\" target=\"_blank\" rel=\"noopener\">ConstrainLayout Guide</a>.</li>\n<li><p>Activity,:, Activity , setVisible(GONE),. ViewStub , ViewStub ,,. ViewStub  merge . WebView,.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">((ViewStub) findViewById(R.id.my_layout)).setVisibility(View.VISIBLE);</span><br><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">View importPanel = ((ViewStub) findViewById(R.id.my_layout)).inflate();</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  android:layout --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ViewStub</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/stub_home_web\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"match_parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:background</span>=<span class=\"string\">\"@android:color/transparent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:layout</span>=<span class=\"string\">\"@layout/layout_web\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h1 id=\"Android-Profiler\"><a href=\"#Android-Profiler\" class=\"headerlink\" title=\"Android Profiler\"></a>Android Profiler</h1><p>,,Android Studio , Android Profiler  CPU.<a href=\"https://developer.android.google.cn/studio/profile/memory-profiler\" target=\"_blank\" rel=\"noopener\">Android Profiler </a>,.</p>"},{"title":"","date":"2018-09-28T15:37:35.000Z","_content":",iPhone ,Android...,.\n<!-- more -->\n\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/7g4t2-ihykn.gif)\n\n Activity  DecorView  View, View,,, BaseActivity  setContentView `activity.getWindow().getDecorView()`, content `FrameLayout content = viewGroup.findViewById(android.R.id.content); content.addView(slideBackView);` View  FameLayout ,.\n\n# ,\n* , View  onTouchEvent ,\n* ,,, Android ,,,,\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_3.png)\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_6.png)\n\n## View\n``` java\n//, View  1/3\nprivate float thresholdLeft;\n//, View  2/3\nprivate float thresholdRight;\n//\nprivate float backMaxWidth;\n//\nprivate float backEdgeWidth;\n//\nprivate float bufferX;\n\n    @Override\n    public boolean onTouchEvent(MotionEvent ev) {\n        // View X, getRawX,\n        float currentX = ev.getX();\n        currentY = ev.getY();\n        switch (ev.getAction()) {\n            case MotionEvent.ACTION_DOWN:\n                // View X\n                downX = ev.getX();\n                forwardX = downX;\n                if (downX <= backEdgeWidth) {\n                //X<,\n                    isEdge = true;\n                    left = true;\n                    right = false;\n                } else if (downX >= getWidth() - backEdgeWidth) {\n                //X>(View -),\n                    isEdge = true;\n                    right = true;\n                    left = false;\n                }\n                break;\n            case MotionEvent.ACTION_MOVE:\n                //X\n                deltaX = currentX - downX;\n                // \n                float diff = forwardX - currentX;\n                if (diff > 0) {\n                    //\n                    if (currentX < thresholdLeft && left) {\n                        //1/3,\n                        deltaX = backMaxWidth;\n                        deltaX -= (thresholdLeft - currentX) / 2;\n                        bufferX = deltaX;\n                        if (deltaX < 0) {\n                            deltaX = 0;\n                            bufferX = 0;\n                        }\n                    } else if ((currentX > thresholdRight) && right) {\n                        //2/3,\n                         bufferX -= diff;\n                         deltaX = bufferX;\n                    }\n                } else {\n                    //\n                    if ((currentX < thresholdLeft) && left) {\n                        //1/3,\n                        bufferX += Math.abs(diff);\n                        deltaX = bufferX;\n                    } else if (currentX > thresholdRight && right) {\n                         //2/3,\n                        deltaX = -backMaxWidth;\n                        deltaX += (currentX - thresholdRight) / 2;\n                        bufferX = deltaX;\n                        if (deltaX < -backMaxWidth) {\n                            deltaX = -backMaxWidth;\n                            bufferX = -backMaxWidth;\n                        }\n                    }\n                }\n                //X,\n                forwardX = currentX;\n                if (isEdge) {\n                    invalidate();\n                }\n                break;\n            case MotionEvent.ACTION_UP:\n                if (isEdge) {\n                    if (deltaX >= backMaxWidth && left) {\n                        //,\n                        back();\n                    } else if (Math.abs(deltaX) >= backMaxWidth && right) {\n                        if (!isOnlyLeftBack) {\n                            //,\n                            back();\n                        }\n                    }\n                    deltaX = 0;\n                    invalidate();\n                }\n                left = false;\n                right = false;\n                isEdge = false;\n                bufferX = 0;\n                break;\n            default:\n                break;\n        }\n        return isEdge;\n    }\n```\n,,,.\n## \n.\n``` java\n    //\n    private Paint backPaint;\n    //\n    private Paint arrowPaint;\n    //\n    private Path backPath;\n    //\n    private Path arrowPath;\n\n    private void init() {\n        backPath = new Path();\n        arrowPath = new Path();\n\n        backPaint = new Paint(Paint.ANTI_ALIAS_FLAG);\n        backPaint.setColor(0xAA000000);\n        backPaint.setStyle(Paint.Style.FILL_AND_STROKE);\n\n        arrowPaint = new Paint(Paint.ANTI_ALIAS_FLAG);\n        arrowPaint.setColor(Color.WHITE);\n        arrowPaint.setStyle(Paint.Style.STROKE);\n        arrowPaint.setStrokeWidth(6);\n    }\n\n@Override\n    protected void onDraw(Canvas canvas) {\n        super.onDraw(canvas);\n        //deltaX,\n        if (deltaX > backMaxWidth && left) {\n            deltaX = backMaxWidth;\n        } else if (deltaX < -backMaxWidth && right) {\n            deltaX = -backMaxWidth;\n        }\n        //Y\n        float deltaY = currentY - backViewHeight / 2;\n        backPath.reset();\n        arrowPath.reset();\n\n        if (deltaX > 0 && left) {\n            backPath.moveTo(0, deltaY);\n            backPath.quadTo(0, backViewHeight / 4 + deltaY, deltaX / 3, backViewHeight * 3 / 8 + deltaY);\n            backPath.quadTo(deltaX * 5 / 8, backViewHeight / 2 + deltaY, deltaX / 3, backViewHeight * 5 / 8 + deltaY);\n            backPath.quadTo(0, backViewHeight * 6 / 8 + deltaY, 0, backViewHeight + deltaY);\n            canvas.drawPath(backPath, backPaint);\n\n            arrowPath.moveTo(deltaX / 6 + (15 * (deltaX / (width / 6))), backViewHeight * 15 / 32 + deltaY);\n            arrowPath.lineTo(deltaX / 6, backViewHeight * 16.1f / 32 + deltaY);\n            arrowPath.moveTo(deltaX / 6, backViewHeight * 15.9f / 32 + deltaY);\n            arrowPath.lineTo(deltaX / 6 + (15 * (deltaX / (width / 6))), backViewHeight * 17 / 32 + deltaY);\n            canvas.drawPath(arrowPath, arrowPaint);\n        } else if (deltaX < 0 && right) {\n            if (!isOnlyLeftBack) {\n                deltaX = Math.abs(deltaX);\n                backPath.moveTo(width, deltaY);\n                backPath.quadTo(width, backViewHeight / 4 + deltaY, width - deltaX / 3, backViewHeight * 3 / 8 + deltaY);\n                backPath.quadTo(width - deltaX * 5 / 8, backViewHeight / 2 + deltaY, width - deltaX / 3, backViewHeight * 5 / 8 + deltaY);\n                backPath.quadTo(width, backViewHeight * 6 / 8 + deltaY, width, backViewHeight + deltaY);\n                canvas.drawPath(backPath, backPaint);\n\n                arrowPath.moveTo(width - deltaX / 6 - (15 * (deltaX / (width / 6))), backViewHeight * 15 / 32 + deltaY);\n                arrowPath.lineTo(width - deltaX / 6, backViewHeight * 16.1f / 32 + deltaY);\n                arrowPath.moveTo(width - deltaX / 6, backViewHeight * 15.9f / 32 + deltaY);\n                arrowPath.lineTo(width - deltaX / 6 - (15 * (deltaX / (width / 6))), backViewHeight * 17 / 32 + deltaY);\n                canvas.drawPath(arrowPath, arrowPaint);\n            }\n        }\n        setAlpha(deltaX / backMaxWidth);\n    }\n```\n,,,.\n\n# \nSlideBack\n``` java\n//setContent(layoutResID) \nSlideBack.Builder().init(layoutResID).build(this)\n```\n View , onTouchEventonMeasureonLayoutonDraw ,. Android ,.\n# \n[GitHub](https://github.com/Thewhitelight/Tinder)  library \n`cn.libery:slideback:latest` \n[ ![Maven](https://api.bintray.com/packages/light/Avatar/SlideBack/images/download.svg) ](https://bintray.com/light/Avatar/SlideBack/_latestVersion) ","source":"_posts/android-slideback.md","raw":"---\ntitle: \ndate: 2018-09-28 23:37:35\ntags:\n    - Android\ncategories: \n    - \n---\n,iPhone ,Android...,.\n<!-- more -->\n\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/7g4t2-ihykn.gif)\n\n Activity  DecorView  View, View,,, BaseActivity  setContentView `activity.getWindow().getDecorView()`, content `FrameLayout content = viewGroup.findViewById(android.R.id.content); content.addView(slideBackView);` View  FameLayout ,.\n\n# ,\n* , View  onTouchEvent ,\n* ,,, Android ,,,,\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_3.png)\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_6.png)\n\n## View\n``` java\n//, View  1/3\nprivate float thresholdLeft;\n//, View  2/3\nprivate float thresholdRight;\n//\nprivate float backMaxWidth;\n//\nprivate float backEdgeWidth;\n//\nprivate float bufferX;\n\n    @Override\n    public boolean onTouchEvent(MotionEvent ev) {\n        // View X, getRawX,\n        float currentX = ev.getX();\n        currentY = ev.getY();\n        switch (ev.getAction()) {\n            case MotionEvent.ACTION_DOWN:\n                // View X\n                downX = ev.getX();\n                forwardX = downX;\n                if (downX <= backEdgeWidth) {\n                //X<,\n                    isEdge = true;\n                    left = true;\n                    right = false;\n                } else if (downX >= getWidth() - backEdgeWidth) {\n                //X>(View -),\n                    isEdge = true;\n                    right = true;\n                    left = false;\n                }\n                break;\n            case MotionEvent.ACTION_MOVE:\n                //X\n                deltaX = currentX - downX;\n                // \n                float diff = forwardX - currentX;\n                if (diff > 0) {\n                    //\n                    if (currentX < thresholdLeft && left) {\n                        //1/3,\n                        deltaX = backMaxWidth;\n                        deltaX -= (thresholdLeft - currentX) / 2;\n                        bufferX = deltaX;\n                        if (deltaX < 0) {\n                            deltaX = 0;\n                            bufferX = 0;\n                        }\n                    } else if ((currentX > thresholdRight) && right) {\n                        //2/3,\n                         bufferX -= diff;\n                         deltaX = bufferX;\n                    }\n                } else {\n                    //\n                    if ((currentX < thresholdLeft) && left) {\n                        //1/3,\n                        bufferX += Math.abs(diff);\n                        deltaX = bufferX;\n                    } else if (currentX > thresholdRight && right) {\n                         //2/3,\n                        deltaX = -backMaxWidth;\n                        deltaX += (currentX - thresholdRight) / 2;\n                        bufferX = deltaX;\n                        if (deltaX < -backMaxWidth) {\n                            deltaX = -backMaxWidth;\n                            bufferX = -backMaxWidth;\n                        }\n                    }\n                }\n                //X,\n                forwardX = currentX;\n                if (isEdge) {\n                    invalidate();\n                }\n                break;\n            case MotionEvent.ACTION_UP:\n                if (isEdge) {\n                    if (deltaX >= backMaxWidth && left) {\n                        //,\n                        back();\n                    } else if (Math.abs(deltaX) >= backMaxWidth && right) {\n                        if (!isOnlyLeftBack) {\n                            //,\n                            back();\n                        }\n                    }\n                    deltaX = 0;\n                    invalidate();\n                }\n                left = false;\n                right = false;\n                isEdge = false;\n                bufferX = 0;\n                break;\n            default:\n                break;\n        }\n        return isEdge;\n    }\n```\n,,,.\n## \n.\n``` java\n    //\n    private Paint backPaint;\n    //\n    private Paint arrowPaint;\n    //\n    private Path backPath;\n    //\n    private Path arrowPath;\n\n    private void init() {\n        backPath = new Path();\n        arrowPath = new Path();\n\n        backPaint = new Paint(Paint.ANTI_ALIAS_FLAG);\n        backPaint.setColor(0xAA000000);\n        backPaint.setStyle(Paint.Style.FILL_AND_STROKE);\n\n        arrowPaint = new Paint(Paint.ANTI_ALIAS_FLAG);\n        arrowPaint.setColor(Color.WHITE);\n        arrowPaint.setStyle(Paint.Style.STROKE);\n        arrowPaint.setStrokeWidth(6);\n    }\n\n@Override\n    protected void onDraw(Canvas canvas) {\n        super.onDraw(canvas);\n        //deltaX,\n        if (deltaX > backMaxWidth && left) {\n            deltaX = backMaxWidth;\n        } else if (deltaX < -backMaxWidth && right) {\n            deltaX = -backMaxWidth;\n        }\n        //Y\n        float deltaY = currentY - backViewHeight / 2;\n        backPath.reset();\n        arrowPath.reset();\n\n        if (deltaX > 0 && left) {\n            backPath.moveTo(0, deltaY);\n            backPath.quadTo(0, backViewHeight / 4 + deltaY, deltaX / 3, backViewHeight * 3 / 8 + deltaY);\n            backPath.quadTo(deltaX * 5 / 8, backViewHeight / 2 + deltaY, deltaX / 3, backViewHeight * 5 / 8 + deltaY);\n            backPath.quadTo(0, backViewHeight * 6 / 8 + deltaY, 0, backViewHeight + deltaY);\n            canvas.drawPath(backPath, backPaint);\n\n            arrowPath.moveTo(deltaX / 6 + (15 * (deltaX / (width / 6))), backViewHeight * 15 / 32 + deltaY);\n            arrowPath.lineTo(deltaX / 6, backViewHeight * 16.1f / 32 + deltaY);\n            arrowPath.moveTo(deltaX / 6, backViewHeight * 15.9f / 32 + deltaY);\n            arrowPath.lineTo(deltaX / 6 + (15 * (deltaX / (width / 6))), backViewHeight * 17 / 32 + deltaY);\n            canvas.drawPath(arrowPath, arrowPaint);\n        } else if (deltaX < 0 && right) {\n            if (!isOnlyLeftBack) {\n                deltaX = Math.abs(deltaX);\n                backPath.moveTo(width, deltaY);\n                backPath.quadTo(width, backViewHeight / 4 + deltaY, width - deltaX / 3, backViewHeight * 3 / 8 + deltaY);\n                backPath.quadTo(width - deltaX * 5 / 8, backViewHeight / 2 + deltaY, width - deltaX / 3, backViewHeight * 5 / 8 + deltaY);\n                backPath.quadTo(width, backViewHeight * 6 / 8 + deltaY, width, backViewHeight + deltaY);\n                canvas.drawPath(backPath, backPaint);\n\n                arrowPath.moveTo(width - deltaX / 6 - (15 * (deltaX / (width / 6))), backViewHeight * 15 / 32 + deltaY);\n                arrowPath.lineTo(width - deltaX / 6, backViewHeight * 16.1f / 32 + deltaY);\n                arrowPath.moveTo(width - deltaX / 6, backViewHeight * 15.9f / 32 + deltaY);\n                arrowPath.lineTo(width - deltaX / 6 - (15 * (deltaX / (width / 6))), backViewHeight * 17 / 32 + deltaY);\n                canvas.drawPath(arrowPath, arrowPaint);\n            }\n        }\n        setAlpha(deltaX / backMaxWidth);\n    }\n```\n,,,.\n\n# \nSlideBack\n``` java\n//setContent(layoutResID) \nSlideBack.Builder().init(layoutResID).build(this)\n```\n View , onTouchEventonMeasureonLayoutonDraw ,. Android ,.\n# \n[GitHub](https://github.com/Thewhitelight/Tinder)  library \n`cn.libery:slideback:latest` \n[ ![Maven](https://api.bintray.com/packages/light/Avatar/SlideBack/images/download.svg) ](https://bintray.com/light/Avatar/SlideBack/_latestVersion) ","slug":"android-slideback","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjs9v0007ndf20e8tt1or","content":"<p>,iPhone ,Android...,.<br><a id=\"more\"></a><br><br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/7g4t2-ihykn.gif\" alt></p>\n<p> Activity  DecorView  View, View,,, BaseActivity  setContentView <code>activity.getWindow().getDecorView()</code>, content <code>FrameLayout content = viewGroup.findViewById(android.R.id.content); content.addView(slideBackView);</code> View  FameLayout ,.</p>\n<h1 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",\"></a>,</h1><ul>\n<li>, View  onTouchEvent ,</li>\n<li>,,, Android ,,,,<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_3.png\" alt=\"\"><br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_6.png\" alt=\"\"></li>\n</ul>\n<h2 id=\"View\"><a href=\"#View\" class=\"headerlink\" title=\"View\"></a>View</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//, View  1/3</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> thresholdLeft;</span><br><span class=\"line\"><span class=\"comment\">//, View  2/3</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> thresholdRight;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> backMaxWidth;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> backEdgeWidth;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> bufferX;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onTouchEvent</span><span class=\"params\">(MotionEvent ev)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// View X, getRawX,</span></span><br><span class=\"line\">        <span class=\"keyword\">float</span> currentX = ev.getX();</span><br><span class=\"line\">        currentY = ev.getY();</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (ev.getAction()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_DOWN:</span><br><span class=\"line\">                <span class=\"comment\">// View X</span></span><br><span class=\"line\">                downX = ev.getX();</span><br><span class=\"line\">                forwardX = downX;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (downX &lt;= backEdgeWidth) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//X&lt;,</span></span><br><span class=\"line\">                    isEdge = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                    left = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                    right = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (downX &gt;= getWidth() - backEdgeWidth) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//X&gt;(View -),</span></span><br><span class=\"line\">                    isEdge = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                    right = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                    left = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_MOVE:</span><br><span class=\"line\">                <span class=\"comment\">//X</span></span><br><span class=\"line\">                deltaX = currentX - downX;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"keyword\">float</span> diff = forwardX - currentX;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (diff &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (currentX &lt; thresholdLeft &amp;&amp; left) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//1/3,</span></span><br><span class=\"line\">                        deltaX = backMaxWidth;</span><br><span class=\"line\">                        deltaX -= (thresholdLeft - currentX) / <span class=\"number\">2</span>;</span><br><span class=\"line\">                        bufferX = deltaX;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (deltaX &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                            deltaX = <span class=\"number\">0</span>;</span><br><span class=\"line\">                            bufferX = <span class=\"number\">0</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((currentX &gt; thresholdRight) &amp;&amp; right) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//2/3,</span></span><br><span class=\"line\">                         bufferX -= diff;</span><br><span class=\"line\">                         deltaX = bufferX;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((currentX &lt; thresholdLeft) &amp;&amp; left) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//1/3,</span></span><br><span class=\"line\">                        bufferX += Math.abs(diff);</span><br><span class=\"line\">                        deltaX = bufferX;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (currentX &gt; thresholdRight &amp;&amp; right) &#123;</span><br><span class=\"line\">                         <span class=\"comment\">//2/3,</span></span><br><span class=\"line\">                        deltaX = -backMaxWidth;</span><br><span class=\"line\">                        deltaX += (currentX - thresholdRight) / <span class=\"number\">2</span>;</span><br><span class=\"line\">                        bufferX = deltaX;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (deltaX &lt; -backMaxWidth) &#123;</span><br><span class=\"line\">                            deltaX = -backMaxWidth;</span><br><span class=\"line\">                            bufferX = -backMaxWidth;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//X,</span></span><br><span class=\"line\">                forwardX = currentX;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (isEdge) &#123;</span><br><span class=\"line\">                    invalidate();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_UP:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (isEdge) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (deltaX &gt;= backMaxWidth &amp;&amp; left) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//,</span></span><br><span class=\"line\">                        back();</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (Math.abs(deltaX) &gt;= backMaxWidth &amp;&amp; right) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (!isOnlyLeftBack) &#123;</span><br><span class=\"line\">                            <span class=\"comment\">//,</span></span><br><span class=\"line\">                            back();</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    deltaX = <span class=\"number\">0</span>;</span><br><span class=\"line\">                    invalidate();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                left = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                right = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                isEdge = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                bufferX = <span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> isEdge;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>,,,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Paint backPaint;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Paint arrowPaint;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Path backPath;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Path arrowPath;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        backPath = <span class=\"keyword\">new</span> Path();</span><br><span class=\"line\">        arrowPath = <span class=\"keyword\">new</span> Path();</span><br><span class=\"line\"></span><br><span class=\"line\">        backPaint = <span class=\"keyword\">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class=\"line\">        backPaint.setColor(<span class=\"number\">0xAA000000</span>);</span><br><span class=\"line\">        backPaint.setStyle(Paint.Style.FILL_AND_STROKE);</span><br><span class=\"line\"></span><br><span class=\"line\">        arrowPaint = <span class=\"keyword\">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class=\"line\">        arrowPaint.setColor(Color.WHITE);</span><br><span class=\"line\">        arrowPaint.setStyle(Paint.Style.STROKE);</span><br><span class=\"line\">        arrowPaint.setStrokeWidth(<span class=\"number\">6</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onDraw</span><span class=\"params\">(Canvas canvas)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDraw(canvas);</span><br><span class=\"line\">        <span class=\"comment\">//deltaX,</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (deltaX &gt; backMaxWidth &amp;&amp; left) &#123;</span><br><span class=\"line\">            deltaX = backMaxWidth;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (deltaX &lt; -backMaxWidth &amp;&amp; right) &#123;</span><br><span class=\"line\">            deltaX = -backMaxWidth;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//Y</span></span><br><span class=\"line\">        <span class=\"keyword\">float</span> deltaY = currentY - backViewHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">        backPath.reset();</span><br><span class=\"line\">        arrowPath.reset();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (deltaX &gt; <span class=\"number\">0</span> &amp;&amp; left) &#123;</span><br><span class=\"line\">            backPath.moveTo(<span class=\"number\">0</span>, deltaY);</span><br><span class=\"line\">            backPath.quadTo(<span class=\"number\">0</span>, backViewHeight / <span class=\"number\">4</span> + deltaY, deltaX / <span class=\"number\">3</span>, backViewHeight * <span class=\"number\">3</span> / <span class=\"number\">8</span> + deltaY);</span><br><span class=\"line\">            backPath.quadTo(deltaX * <span class=\"number\">5</span> / <span class=\"number\">8</span>, backViewHeight / <span class=\"number\">2</span> + deltaY, deltaX / <span class=\"number\">3</span>, backViewHeight * <span class=\"number\">5</span> / <span class=\"number\">8</span> + deltaY);</span><br><span class=\"line\">            backPath.quadTo(<span class=\"number\">0</span>, backViewHeight * <span class=\"number\">6</span> / <span class=\"number\">8</span> + deltaY, <span class=\"number\">0</span>, backViewHeight + deltaY);</span><br><span class=\"line\">            canvas.drawPath(backPath, backPaint);</span><br><span class=\"line\"></span><br><span class=\"line\">            arrowPath.moveTo(deltaX / <span class=\"number\">6</span> + (<span class=\"number\">15</span> * (deltaX / (width / <span class=\"number\">6</span>))), backViewHeight * <span class=\"number\">15</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">            arrowPath.lineTo(deltaX / <span class=\"number\">6</span>, backViewHeight * <span class=\"number\">16.1f</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">            arrowPath.moveTo(deltaX / <span class=\"number\">6</span>, backViewHeight * <span class=\"number\">15.9f</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">            arrowPath.lineTo(deltaX / <span class=\"number\">6</span> + (<span class=\"number\">15</span> * (deltaX / (width / <span class=\"number\">6</span>))), backViewHeight * <span class=\"number\">17</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">            canvas.drawPath(arrowPath, arrowPaint);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (deltaX &lt; <span class=\"number\">0</span> &amp;&amp; right) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!isOnlyLeftBack) &#123;</span><br><span class=\"line\">                deltaX = Math.abs(deltaX);</span><br><span class=\"line\">                backPath.moveTo(width, deltaY);</span><br><span class=\"line\">                backPath.quadTo(width, backViewHeight / <span class=\"number\">4</span> + deltaY, width - deltaX / <span class=\"number\">3</span>, backViewHeight * <span class=\"number\">3</span> / <span class=\"number\">8</span> + deltaY);</span><br><span class=\"line\">                backPath.quadTo(width - deltaX * <span class=\"number\">5</span> / <span class=\"number\">8</span>, backViewHeight / <span class=\"number\">2</span> + deltaY, width - deltaX / <span class=\"number\">3</span>, backViewHeight * <span class=\"number\">5</span> / <span class=\"number\">8</span> + deltaY);</span><br><span class=\"line\">                backPath.quadTo(width, backViewHeight * <span class=\"number\">6</span> / <span class=\"number\">8</span> + deltaY, width, backViewHeight + deltaY);</span><br><span class=\"line\">                canvas.drawPath(backPath, backPaint);</span><br><span class=\"line\"></span><br><span class=\"line\">                arrowPath.moveTo(width - deltaX / <span class=\"number\">6</span> - (<span class=\"number\">15</span> * (deltaX / (width / <span class=\"number\">6</span>))), backViewHeight * <span class=\"number\">15</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">                arrowPath.lineTo(width - deltaX / <span class=\"number\">6</span>, backViewHeight * <span class=\"number\">16.1f</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">                arrowPath.moveTo(width - deltaX / <span class=\"number\">6</span>, backViewHeight * <span class=\"number\">15.9f</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">                arrowPath.lineTo(width - deltaX / <span class=\"number\">6</span> - (<span class=\"number\">15</span> * (deltaX / (width / <span class=\"number\">6</span>))), backViewHeight * <span class=\"number\">17</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">                canvas.drawPath(arrowPath, arrowPaint);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        setAlpha(deltaX / backMaxWidth);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>,,,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>SlideBack<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//setContent(layoutResID) </span></span><br><span class=\"line\">SlideBack.Builder().init(layoutResID).build(<span class=\"keyword\">this</span>)</span><br></pre></td></tr></table></figure></p>\n<p> View , onTouchEventonMeasureonLayoutonDraw ,. Android ,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://github.com/Thewhitelight/Tinder\">GitHub</a>  library <br><code>cn.libery:slideback:latest</code><br><a href=\"https://bintray.com/light/Avatar/SlideBack/_latestVersion\" target=\"_blank\" rel=\"noopener\"> <img src=\"https://api.bintray.com/packages/light/Avatar/SlideBack/images/download.svg\" alt=\"Maven\"> </a> </p>\n","site":{"data":{}},"excerpt":"<p>,iPhone ,Android...,.<br>","more":"<br><br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/7g4t2-ihykn.gif\" alt></p>\n<p> Activity  DecorView  View, View,,, BaseActivity  setContentView <code>activity.getWindow().getDecorView()</code>, content <code>FrameLayout content = viewGroup.findViewById(android.R.id.content); content.addView(slideBackView);</code> View  FameLayout ,.</p>\n<h1 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",\"></a>,</h1><ul>\n<li>, View  onTouchEvent ,</li>\n<li>,,, Android ,,,,<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_3.png\" alt=\"\"><br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_6.png\" alt=\"\"></li>\n</ul>\n<h2 id=\"View\"><a href=\"#View\" class=\"headerlink\" title=\"View\"></a>View</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//, View  1/3</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> thresholdLeft;</span><br><span class=\"line\"><span class=\"comment\">//, View  2/3</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> thresholdRight;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> backMaxWidth;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> backEdgeWidth;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">float</span> bufferX;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onTouchEvent</span><span class=\"params\">(MotionEvent ev)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// View X, getRawX,</span></span><br><span class=\"line\">        <span class=\"keyword\">float</span> currentX = ev.getX();</span><br><span class=\"line\">        currentY = ev.getY();</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (ev.getAction()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_DOWN:</span><br><span class=\"line\">                <span class=\"comment\">// View X</span></span><br><span class=\"line\">                downX = ev.getX();</span><br><span class=\"line\">                forwardX = downX;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (downX &lt;= backEdgeWidth) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//X&lt;,</span></span><br><span class=\"line\">                    isEdge = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                    left = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                    right = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (downX &gt;= getWidth() - backEdgeWidth) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//X&gt;(View -),</span></span><br><span class=\"line\">                    isEdge = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                    right = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                    left = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_MOVE:</span><br><span class=\"line\">                <span class=\"comment\">//X</span></span><br><span class=\"line\">                deltaX = currentX - downX;</span><br><span class=\"line\">                <span class=\"comment\">// </span></span><br><span class=\"line\">                <span class=\"keyword\">float</span> diff = forwardX - currentX;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (diff &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (currentX &lt; thresholdLeft &amp;&amp; left) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//1/3,</span></span><br><span class=\"line\">                        deltaX = backMaxWidth;</span><br><span class=\"line\">                        deltaX -= (thresholdLeft - currentX) / <span class=\"number\">2</span>;</span><br><span class=\"line\">                        bufferX = deltaX;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (deltaX &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                            deltaX = <span class=\"number\">0</span>;</span><br><span class=\"line\">                            bufferX = <span class=\"number\">0</span>;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> ((currentX &gt; thresholdRight) &amp;&amp; right) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//2/3,</span></span><br><span class=\"line\">                         bufferX -= diff;</span><br><span class=\"line\">                         deltaX = bufferX;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((currentX &lt; thresholdLeft) &amp;&amp; left) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//1/3,</span></span><br><span class=\"line\">                        bufferX += Math.abs(diff);</span><br><span class=\"line\">                        deltaX = bufferX;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (currentX &gt; thresholdRight &amp;&amp; right) &#123;</span><br><span class=\"line\">                         <span class=\"comment\">//2/3,</span></span><br><span class=\"line\">                        deltaX = -backMaxWidth;</span><br><span class=\"line\">                        deltaX += (currentX - thresholdRight) / <span class=\"number\">2</span>;</span><br><span class=\"line\">                        bufferX = deltaX;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (deltaX &lt; -backMaxWidth) &#123;</span><br><span class=\"line\">                            deltaX = -backMaxWidth;</span><br><span class=\"line\">                            bufferX = -backMaxWidth;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//X,</span></span><br><span class=\"line\">                forwardX = currentX;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (isEdge) &#123;</span><br><span class=\"line\">                    invalidate();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> MotionEvent.ACTION_UP:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (isEdge) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (deltaX &gt;= backMaxWidth &amp;&amp; left) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">//,</span></span><br><span class=\"line\">                        back();</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (Math.abs(deltaX) &gt;= backMaxWidth &amp;&amp; right) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (!isOnlyLeftBack) &#123;</span><br><span class=\"line\">                            <span class=\"comment\">//,</span></span><br><span class=\"line\">                            back();</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    deltaX = <span class=\"number\">0</span>;</span><br><span class=\"line\">                    invalidate();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                left = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                right = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                isEdge = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">                bufferX = <span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> isEdge;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>,,,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Paint backPaint;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Paint arrowPaint;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Path backPath;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Path arrowPath;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        backPath = <span class=\"keyword\">new</span> Path();</span><br><span class=\"line\">        arrowPath = <span class=\"keyword\">new</span> Path();</span><br><span class=\"line\"></span><br><span class=\"line\">        backPaint = <span class=\"keyword\">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class=\"line\">        backPaint.setColor(<span class=\"number\">0xAA000000</span>);</span><br><span class=\"line\">        backPaint.setStyle(Paint.Style.FILL_AND_STROKE);</span><br><span class=\"line\"></span><br><span class=\"line\">        arrowPaint = <span class=\"keyword\">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class=\"line\">        arrowPaint.setColor(Color.WHITE);</span><br><span class=\"line\">        arrowPaint.setStyle(Paint.Style.STROKE);</span><br><span class=\"line\">        arrowPaint.setStrokeWidth(<span class=\"number\">6</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">onDraw</span><span class=\"params\">(Canvas canvas)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onDraw(canvas);</span><br><span class=\"line\">        <span class=\"comment\">//deltaX,</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (deltaX &gt; backMaxWidth &amp;&amp; left) &#123;</span><br><span class=\"line\">            deltaX = backMaxWidth;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (deltaX &lt; -backMaxWidth &amp;&amp; right) &#123;</span><br><span class=\"line\">            deltaX = -backMaxWidth;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//Y</span></span><br><span class=\"line\">        <span class=\"keyword\">float</span> deltaY = currentY - backViewHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">        backPath.reset();</span><br><span class=\"line\">        arrowPath.reset();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (deltaX &gt; <span class=\"number\">0</span> &amp;&amp; left) &#123;</span><br><span class=\"line\">            backPath.moveTo(<span class=\"number\">0</span>, deltaY);</span><br><span class=\"line\">            backPath.quadTo(<span class=\"number\">0</span>, backViewHeight / <span class=\"number\">4</span> + deltaY, deltaX / <span class=\"number\">3</span>, backViewHeight * <span class=\"number\">3</span> / <span class=\"number\">8</span> + deltaY);</span><br><span class=\"line\">            backPath.quadTo(deltaX * <span class=\"number\">5</span> / <span class=\"number\">8</span>, backViewHeight / <span class=\"number\">2</span> + deltaY, deltaX / <span class=\"number\">3</span>, backViewHeight * <span class=\"number\">5</span> / <span class=\"number\">8</span> + deltaY);</span><br><span class=\"line\">            backPath.quadTo(<span class=\"number\">0</span>, backViewHeight * <span class=\"number\">6</span> / <span class=\"number\">8</span> + deltaY, <span class=\"number\">0</span>, backViewHeight + deltaY);</span><br><span class=\"line\">            canvas.drawPath(backPath, backPaint);</span><br><span class=\"line\"></span><br><span class=\"line\">            arrowPath.moveTo(deltaX / <span class=\"number\">6</span> + (<span class=\"number\">15</span> * (deltaX / (width / <span class=\"number\">6</span>))), backViewHeight * <span class=\"number\">15</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">            arrowPath.lineTo(deltaX / <span class=\"number\">6</span>, backViewHeight * <span class=\"number\">16.1f</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">            arrowPath.moveTo(deltaX / <span class=\"number\">6</span>, backViewHeight * <span class=\"number\">15.9f</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">            arrowPath.lineTo(deltaX / <span class=\"number\">6</span> + (<span class=\"number\">15</span> * (deltaX / (width / <span class=\"number\">6</span>))), backViewHeight * <span class=\"number\">17</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">            canvas.drawPath(arrowPath, arrowPaint);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (deltaX &lt; <span class=\"number\">0</span> &amp;&amp; right) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!isOnlyLeftBack) &#123;</span><br><span class=\"line\">                deltaX = Math.abs(deltaX);</span><br><span class=\"line\">                backPath.moveTo(width, deltaY);</span><br><span class=\"line\">                backPath.quadTo(width, backViewHeight / <span class=\"number\">4</span> + deltaY, width - deltaX / <span class=\"number\">3</span>, backViewHeight * <span class=\"number\">3</span> / <span class=\"number\">8</span> + deltaY);</span><br><span class=\"line\">                backPath.quadTo(width - deltaX * <span class=\"number\">5</span> / <span class=\"number\">8</span>, backViewHeight / <span class=\"number\">2</span> + deltaY, width - deltaX / <span class=\"number\">3</span>, backViewHeight * <span class=\"number\">5</span> / <span class=\"number\">8</span> + deltaY);</span><br><span class=\"line\">                backPath.quadTo(width, backViewHeight * <span class=\"number\">6</span> / <span class=\"number\">8</span> + deltaY, width, backViewHeight + deltaY);</span><br><span class=\"line\">                canvas.drawPath(backPath, backPaint);</span><br><span class=\"line\"></span><br><span class=\"line\">                arrowPath.moveTo(width - deltaX / <span class=\"number\">6</span> - (<span class=\"number\">15</span> * (deltaX / (width / <span class=\"number\">6</span>))), backViewHeight * <span class=\"number\">15</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">                arrowPath.lineTo(width - deltaX / <span class=\"number\">6</span>, backViewHeight * <span class=\"number\">16.1f</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">                arrowPath.moveTo(width - deltaX / <span class=\"number\">6</span>, backViewHeight * <span class=\"number\">15.9f</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">                arrowPath.lineTo(width - deltaX / <span class=\"number\">6</span> - (<span class=\"number\">15</span> * (deltaX / (width / <span class=\"number\">6</span>))), backViewHeight * <span class=\"number\">17</span> / <span class=\"number\">32</span> + deltaY);</span><br><span class=\"line\">                canvas.drawPath(arrowPath, arrowPaint);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        setAlpha(deltaX / backMaxWidth);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>,,,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>SlideBack<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//setContent(layoutResID) </span></span><br><span class=\"line\">SlideBack.Builder().init(layoutResID).build(<span class=\"keyword\">this</span>)</span><br></pre></td></tr></table></figure></p>\n<p> View , onTouchEventonMeasureonLayoutonDraw ,. Android ,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://github.com/Thewhitelight/Tinder\">GitHub</a>  library <br><code>cn.libery:slideback:latest</code><br><a href=\"https://bintray.com/light/Avatar/SlideBack/_latestVersion\" target=\"_blank\" rel=\"noopener\"> <img src=\"https://api.bintray.com/packages/light/Avatar/SlideBack/images/download.svg\" alt=\"Maven\"> </a> </p>"},{"title":"Android ","date":"2018-12-07T03:37:10.000Z","_content":"\n## ConstraintLayout \n TextView  View ,\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_constaint_1.png)\n**:**\n`layout_width=\"match_parent\"``ayout_width=\"wrap_content\"`,\n`layout_width=\"0dp\" layout_constraintLeft_toLeftOf  layout_constraintRight_toLeftOf `,.\n ConstraintLayout ,.\n:\n``` xml\n <TextView\n        android:id=\"@+id/pin_tuan_title\"\n        android:layout_width=\"0dp\" \n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"@dimen/toolbar_expand_size\"\n        android:layout_marginRight=\"12dp\"\n        android:ellipsize=\"end\"\n        android:includeFontPadding=\"false\"\n        android:maxLines=\"1\"\n        android:textColor=\"@color/main_black\"\n        android:textSize=\"16sp\"\n        android:textStyle=\"bold\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toLeftOf=\"@id/pin_tuan_more\"\n        tools:text=\"\" />\n```\n<!-- more -->\n##  BottomSheet\n,, AndroidManifest `<meta-data \n\tandroid:name=\"android.max_aspect\"\n\tandroid:value=\"2.1\"/>`, BottomSheetDialog ,\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_bottomsheet.png),.\n**:**\n BottomSheetDialogFragment .\n## \n View `android:animateLayoutChanges=\"true\"`,,`LayoutTransition`..","source":"_posts/android-tips.md","raw":"---\ntitle: Android \ndate: 2018-12-07 11:37:10\ntags:\n    - Android\n    - Tips\ncategories: \n    - \n---\n\n## ConstraintLayout \n TextView  View ,\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_constaint_1.png)\n**:**\n`layout_width=\"match_parent\"``ayout_width=\"wrap_content\"`,\n`layout_width=\"0dp\" layout_constraintLeft_toLeftOf  layout_constraintRight_toLeftOf `,.\n ConstraintLayout ,.\n:\n``` xml\n <TextView\n        android:id=\"@+id/pin_tuan_title\"\n        android:layout_width=\"0dp\" \n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"@dimen/toolbar_expand_size\"\n        android:layout_marginRight=\"12dp\"\n        android:ellipsize=\"end\"\n        android:includeFontPadding=\"false\"\n        android:maxLines=\"1\"\n        android:textColor=\"@color/main_black\"\n        android:textSize=\"16sp\"\n        android:textStyle=\"bold\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toLeftOf=\"@id/pin_tuan_more\"\n        tools:text=\"\" />\n```\n<!-- more -->\n##  BottomSheet\n,, AndroidManifest `<meta-data \n\tandroid:name=\"android.max_aspect\"\n\tandroid:value=\"2.1\"/>`, BottomSheetDialog ,\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_bottomsheet.png),.\n**:**\n BottomSheetDialogFragment .\n## \n View `android:animateLayoutChanges=\"true\"`,,`LayoutTransition`..","slug":"android-tips","published":1,"updated":"2019-12-16T11:26:45.620Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjs9w0008ndf2rmeodug0","content":"<p></p>\n<h2 id=\"ConstraintLayout-\"><a href=\"#ConstraintLayout-\" class=\"headerlink\" title=\"ConstraintLayout \"></a>ConstraintLayout </h2><p> TextView  View ,<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_constaint_1.png\" alt><br><strong>:</strong><br><code>layout_width=&quot;match_parent&quot;</code><code>ayout_width=&quot;wrap_content&quot;</code>,<br><code>layout_width=&quot;0dp&quot; layout_constraintLeft_toLeftOf  layout_constraintRight_toLeftOf </code>,.<br> ConstraintLayout ,.<br>:<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/pin_tuan_title\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"0dp\"</span> </span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:layout_marginTop</span>=<span class=\"string\">\"@dimen/toolbar_expand_size\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:layout_marginRight</span>=<span class=\"string\">\"12dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:ellipsize</span>=<span class=\"string\">\"end\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:includeFontPadding</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:maxLines</span>=<span class=\"string\">\"1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:textColor</span>=<span class=\"string\">\"@color/main_black\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:textSize</span>=<span class=\"string\">\"16sp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:textStyle</span>=<span class=\"string\">\"bold\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">app:layout_constraintLeft_toLeftOf</span>=<span class=\"string\">\"parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">app:layout_constraintRight_toLeftOf</span>=<span class=\"string\">\"@id/pin_tuan_more\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">tools:text</span>=<span class=\"string\">\"\"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<h2 id=\"-BottomSheet\"><a href=\"#-BottomSheet\" class=\"headerlink\" title=\" BottomSheet\"></a> BottomSheet</h2><p>,, AndroidManifest <code>&lt;meta-data \n    android:name=&quot;android.max_aspect&quot;\n    android:value=&quot;2.1&quot;/&gt;</code>, BottomSheetDialog ,<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_bottomsheet.png\" alt>,.<br><strong>:</strong><br> BottomSheetDialogFragment .</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> View <code>android:animateLayoutChanges=&quot;true&quot;</code>,,<code>LayoutTransition</code>..</p>\n","site":{"data":{}},"excerpt":"<p></p>\n<h2 id=\"ConstraintLayout-\"><a href=\"#ConstraintLayout-\" class=\"headerlink\" title=\"ConstraintLayout \"></a>ConstraintLayout </h2><p> TextView  View ,<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_constaint_1.png\" alt><br><strong>:</strong><br><code>layout_width=&quot;match_parent&quot;</code><code>ayout_width=&quot;wrap_content&quot;</code>,<br><code>layout_width=&quot;0dp&quot; layout_constraintLeft_toLeftOf  layout_constraintRight_toLeftOf </code>,.<br> ConstraintLayout ,.<br>:<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">TextView</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:id</span>=<span class=\"string\">\"@+id/pin_tuan_title\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:layout_width</span>=<span class=\"string\">\"0dp\"</span> </span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:layout_height</span>=<span class=\"string\">\"wrap_content\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:layout_marginTop</span>=<span class=\"string\">\"@dimen/toolbar_expand_size\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:layout_marginRight</span>=<span class=\"string\">\"12dp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:ellipsize</span>=<span class=\"string\">\"end\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:includeFontPadding</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:maxLines</span>=<span class=\"string\">\"1\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:textColor</span>=<span class=\"string\">\"@color/main_black\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:textSize</span>=<span class=\"string\">\"16sp\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">android:textStyle</span>=<span class=\"string\">\"bold\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">app:layout_constraintLeft_toLeftOf</span>=<span class=\"string\">\"parent\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">app:layout_constraintRight_toLeftOf</span>=<span class=\"string\">\"@id/pin_tuan_more\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">tools:text</span>=<span class=\"string\">\"\"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>","more":"<h2 id=\"-BottomSheet\"><a href=\"#-BottomSheet\" class=\"headerlink\" title=\" BottomSheet\"></a> BottomSheet</h2><p>,, AndroidManifest <code>&lt;meta-data \n    android:name=&quot;android.max_aspect&quot;\n    android:value=&quot;2.1&quot;/&gt;</code>, BottomSheetDialog ,<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_bottomsheet.png\" alt>,.<br><strong>:</strong><br> BottomSheetDialogFragment .</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> View <code>android:animateLayoutChanges=&quot;true&quot;</code>,,<code>LayoutTransition</code>..</p>"},{"title":" Library","date":"2018-08-06T15:30:56.000Z","_content":"\n, Android , API , onActivityResult ,,,,,.\n\n#### \n\n##### Android 6.0 \n\n Android 6.0 App, SD ,, App ,, onRequestPermissionsResult .\n\n##### Android 7.0 StrictMode \n\n Android 7.0  StrictMode App file://  URI, FileUriExposedException , FileProvider .\n\n##### \n\n,,90, ExifInterface , orientation ,.\n\n#### \n\n library .. Activity ,,,.\n\n<!-- more -->\n\n```  java \n // \n Avatar.getInstance()\n                    // ALL  CAMERA  GALLERY \n                    .setSelectMode(Avatar.ALL)\n                    //  \n                    .setImageFileDir(\"Tinder\")\n                    //\n                    .setHasCrop(true)\n                    //\n                    .imageFile { imageFile ->\n                        run {\n                            Log.e(\"file:\", imageFile.absolutePath)\n                            img.setImageBitmap(BitmapFactory.decodeFile(imageFile.absolutePath))\n                        }\n                    }\n                    .build(this)\n```\n Avatar ,, Activity ,SelectAvatarActivity ,.\n\n``` java \nAvatar.java\n\n    private Avatar() {\n    }\n\n    public static Avatar getInstance() {\n        return AvatarHolder.INSTANCE;\n    }\n\n    public static class AvatarHolder {\n        static final Avatar INSTANCE = new Avatar();\n    }\n\nSelectAvatarActivity.java\n\n    //setImageFile ,,\n    Avatar.getInstance().setImageFile(mAvatarFile);\n\n    //\n    Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);\n        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.N) {\n            mOrigUri = Uri.fromFile(cameraFile);\n        } else {\n            ContentValues contentValues = new ContentValues(1);\n            contentValues.put(MediaStore.Images.Media.DATA, cameraFile.getAbsolutePath());\n            mOrigUri = getContentResolver().insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, contentValues);\n        }\n        intent.putExtra(MediaStore.EXTRA_OUTPUT, mOrigUri);\n        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_CAMERA);\n\n    //\n    Intent intent;\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {\n            intent = new Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n        } else {\n            intent = new Intent(Intent.ACTION_GET_CONTENT);\n            intent.setType(\"image/*\");\n        }\n        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_SDCARD);\n\n        //,ExifInterface,Matrix\n        public static int readPictureDegree(String path) {\n        int degree = 0;\n        try {\n            ExifInterface exifInterface = new ExifInterface(path);\n            int orientation = exifInterface.getAttributeInt(\n                    ExifInterface.TAG_ORIENTATION,\n                    ExifInterface.ORIENTATION_NORMAL);\n            switch (orientation) {\n                case ExifInterface.ORIENTATION_ROTATE_90:\n                    degree = 90;\n                    break;\n                case ExifInterface.ORIENTATION_ROTATE_180:\n                    degree = 180;\n                    break;\n                case ExifInterface.ORIENTATION_ROTATE_270:\n                    degree = 270;\n                    break;\n                default:\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return degree;\n    }\n\nImageUtil.java \n    //\n    public static Bitmap rotateImageView(int angle, Bitmap bitmap) {\n        Matrix matrix = new Matrix();\n        matrix.postRotate(angle);\n        if (bitmap != null) {\n            return Bitmap.createBitmap(bitmap, 0, 0, bitmap.getWidth(), bitmap.getHeight(), matrix, true);\n        } else {\n            return null;\n        }\n    }\n\n```\n\n``` xml\n    <!--  -->\n    <style name=\"TransparentTheme\" parent=\"Theme.AppCompat.Light.NoActionBar\">\n        <item name=\"colorPrimary\">@android:color/transparent</item>\n        <item name=\"colorPrimaryDark\">@android:color/transparent</item>\n        <item name=\"android:windowBackground\">@android:color/transparent</item>\n        <item name=\"android:windowIsTranslucent\">true</item>\n        <item name=\"android:windowAnimationStyle\">@android:style/Animation.Translucent</item>\n        <item name=\"android:windowNoTitle\">true</item>\n        <item name=\"android:windowContentOverlay\">@null</item>\n    </style>\n\n    <!-- FileProvider 7.0-->\n    <provider\n            android:name=\"android.support.v4.content.FileProvider\"\n            android:authorities=\"${applicationId}.fileProvider\"\n            android:exported=\"false\"\n            android:grantUriPermissions=\"true\">\n            <meta-data\n                android:name=\"android.support.FILE_PROVIDER_PATHS\"\n                android:resource=\"@xml/provider_paths\" />\n    </provider>\n\n    <!-- provider_paths.xml -->\n    <paths>\n    <!--  root-path ,,external-path-->\n    <root-path\n        name=\"root_path\"\n        path=\".\"/>\n    </paths>\n```\n```<paths>``` ``` <files-path>``` app; ```<external-path>``` ; ```<cache-path> ```..\n\n,,, API , library .\n**[](https://github.com/Thewhitelight/Tinder)**","source":"_posts/avatar-select-img.md","raw":"---\ntitle:  Library\ndate: 2018-08-06 23:30:56\ntags:\n    - Android\ncategories: \n---\n\n, Android , API , onActivityResult ,,,,,.\n\n#### \n\n##### Android 6.0 \n\n Android 6.0 App, SD ,, App ,, onRequestPermissionsResult .\n\n##### Android 7.0 StrictMode \n\n Android 7.0  StrictMode App file://  URI, FileUriExposedException , FileProvider .\n\n##### \n\n,,90, ExifInterface , orientation ,.\n\n#### \n\n library .. Activity ,,,.\n\n<!-- more -->\n\n```  java \n // \n Avatar.getInstance()\n                    // ALL  CAMERA  GALLERY \n                    .setSelectMode(Avatar.ALL)\n                    //  \n                    .setImageFileDir(\"Tinder\")\n                    //\n                    .setHasCrop(true)\n                    //\n                    .imageFile { imageFile ->\n                        run {\n                            Log.e(\"file:\", imageFile.absolutePath)\n                            img.setImageBitmap(BitmapFactory.decodeFile(imageFile.absolutePath))\n                        }\n                    }\n                    .build(this)\n```\n Avatar ,, Activity ,SelectAvatarActivity ,.\n\n``` java \nAvatar.java\n\n    private Avatar() {\n    }\n\n    public static Avatar getInstance() {\n        return AvatarHolder.INSTANCE;\n    }\n\n    public static class AvatarHolder {\n        static final Avatar INSTANCE = new Avatar();\n    }\n\nSelectAvatarActivity.java\n\n    //setImageFile ,,\n    Avatar.getInstance().setImageFile(mAvatarFile);\n\n    //\n    Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);\n        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.N) {\n            mOrigUri = Uri.fromFile(cameraFile);\n        } else {\n            ContentValues contentValues = new ContentValues(1);\n            contentValues.put(MediaStore.Images.Media.DATA, cameraFile.getAbsolutePath());\n            mOrigUri = getContentResolver().insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, contentValues);\n        }\n        intent.putExtra(MediaStore.EXTRA_OUTPUT, mOrigUri);\n        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_CAMERA);\n\n    //\n    Intent intent;\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {\n            intent = new Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n        } else {\n            intent = new Intent(Intent.ACTION_GET_CONTENT);\n            intent.setType(\"image/*\");\n        }\n        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_SDCARD);\n\n        //,ExifInterface,Matrix\n        public static int readPictureDegree(String path) {\n        int degree = 0;\n        try {\n            ExifInterface exifInterface = new ExifInterface(path);\n            int orientation = exifInterface.getAttributeInt(\n                    ExifInterface.TAG_ORIENTATION,\n                    ExifInterface.ORIENTATION_NORMAL);\n            switch (orientation) {\n                case ExifInterface.ORIENTATION_ROTATE_90:\n                    degree = 90;\n                    break;\n                case ExifInterface.ORIENTATION_ROTATE_180:\n                    degree = 180;\n                    break;\n                case ExifInterface.ORIENTATION_ROTATE_270:\n                    degree = 270;\n                    break;\n                default:\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return degree;\n    }\n\nImageUtil.java \n    //\n    public static Bitmap rotateImageView(int angle, Bitmap bitmap) {\n        Matrix matrix = new Matrix();\n        matrix.postRotate(angle);\n        if (bitmap != null) {\n            return Bitmap.createBitmap(bitmap, 0, 0, bitmap.getWidth(), bitmap.getHeight(), matrix, true);\n        } else {\n            return null;\n        }\n    }\n\n```\n\n``` xml\n    <!--  -->\n    <style name=\"TransparentTheme\" parent=\"Theme.AppCompat.Light.NoActionBar\">\n        <item name=\"colorPrimary\">@android:color/transparent</item>\n        <item name=\"colorPrimaryDark\">@android:color/transparent</item>\n        <item name=\"android:windowBackground\">@android:color/transparent</item>\n        <item name=\"android:windowIsTranslucent\">true</item>\n        <item name=\"android:windowAnimationStyle\">@android:style/Animation.Translucent</item>\n        <item name=\"android:windowNoTitle\">true</item>\n        <item name=\"android:windowContentOverlay\">@null</item>\n    </style>\n\n    <!-- FileProvider 7.0-->\n    <provider\n            android:name=\"android.support.v4.content.FileProvider\"\n            android:authorities=\"${applicationId}.fileProvider\"\n            android:exported=\"false\"\n            android:grantUriPermissions=\"true\">\n            <meta-data\n                android:name=\"android.support.FILE_PROVIDER_PATHS\"\n                android:resource=\"@xml/provider_paths\" />\n    </provider>\n\n    <!-- provider_paths.xml -->\n    <paths>\n    <!--  root-path ,,external-path-->\n    <root-path\n        name=\"root_path\"\n        path=\".\"/>\n    </paths>\n```\n```<paths>``` ``` <files-path>``` app; ```<external-path>``` ; ```<cache-path> ```..\n\n,,, API , library .\n**[](https://github.com/Thewhitelight/Tinder)**","slug":"avatar-select-img","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjs9y000cndf2vixjouex","content":"<p>, Android , API , onActivityResult ,,,,,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"Android-6-0-\"><a href=\"#Android-6-0-\" class=\"headerlink\" title=\"Android 6.0 \"></a>Android 6.0 </h5><p> Android 6.0 App, SD ,, App ,, onRequestPermissionsResult .</p>\n<h5 id=\"Android-7-0-StrictMode-\"><a href=\"#Android-7-0-StrictMode-\" class=\"headerlink\" title=\"Android 7.0 StrictMode \"></a>Android 7.0 StrictMode </h5><p> Android 7.0  StrictMode App file://  URI, FileUriExposedException , FileProvider .</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>,,90, ExifInterface , orientation ,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> library .. Activity ,,,.</p>\n<a id=\"more\"></a>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">Avatar.getInstance()</span><br><span class=\"line\">                   <span class=\"comment\">// ALL  CAMERA  GALLERY </span></span><br><span class=\"line\">                   .setSelectMode(Avatar.ALL)</span><br><span class=\"line\">                   <span class=\"comment\">//  </span></span><br><span class=\"line\">                   .setImageFileDir(<span class=\"string\">\"Tinder\"</span>)</span><br><span class=\"line\">                   <span class=\"comment\">//</span></span><br><span class=\"line\">                   .setHasCrop(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">                   <span class=\"comment\">//</span></span><br><span class=\"line\">                   .imageFile &#123; imageFile -&gt;</span><br><span class=\"line\">                       run &#123;</span><br><span class=\"line\">                           Log.e(<span class=\"string\">\"file:\"</span>, imageFile.absolutePath)</span><br><span class=\"line\">                           img.setImageBitmap(BitmapFactory.decodeFile(imageFile.absolutePath))</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">                   .build(<span class=\"keyword\">this</span>)</span><br></pre></td></tr></table></figure>\n<p> Avatar ,, Activity ,SelectAvatarActivity ,.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Avatar.java</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Avatar</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Avatar <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> AvatarHolder.INSTANCE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AvatarHolder</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Avatar INSTANCE = <span class=\"keyword\">new</span> Avatar();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">SelectAvatarActivity.java</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//setImageFile ,,</span></span><br><span class=\"line\">    Avatar.getInstance().setImageFile(mAvatarFile);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Intent intent = <span class=\"keyword\">new</span> Intent(MediaStore.ACTION_IMAGE_CAPTURE);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) &#123;</span><br><span class=\"line\">            mOrigUri = Uri.fromFile(cameraFile);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            ContentValues contentValues = <span class=\"keyword\">new</span> ContentValues(<span class=\"number\">1</span>);</span><br><span class=\"line\">            contentValues.put(MediaStore.Images.Media.DATA, cameraFile.getAbsolutePath());</span><br><span class=\"line\">            mOrigUri = getContentResolver().insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, contentValues);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        intent.putExtra(MediaStore.EXTRA_OUTPUT, mOrigUri);</span><br><span class=\"line\">        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_CAMERA);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Intent intent;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class=\"line\">            intent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            intent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_GET_CONTENT);</span><br><span class=\"line\">            intent.setType(<span class=\"string\">\"image/*\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_SDCARD);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//,ExifInterface,Matrix</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">readPictureDegree</span><span class=\"params\">(String path)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> degree = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            ExifInterface exifInterface = <span class=\"keyword\">new</span> ExifInterface(path);</span><br><span class=\"line\">            <span class=\"keyword\">int</span> orientation = exifInterface.getAttributeInt(</span><br><span class=\"line\">                    ExifInterface.TAG_ORIENTATION,</span><br><span class=\"line\">                    ExifInterface.ORIENTATION_NORMAL);</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (orientation) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> ExifInterface.ORIENTATION_ROTATE_90:</span><br><span class=\"line\">                    degree = <span class=\"number\">90</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> ExifInterface.ORIENTATION_ROTATE_180:</span><br><span class=\"line\">                    degree = <span class=\"number\">180</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> ExifInterface.ORIENTATION_ROTATE_270:</span><br><span class=\"line\">                    degree = <span class=\"number\">270</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> degree;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ImageUtil.java </span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Bitmap <span class=\"title\">rotateImageView</span><span class=\"params\">(<span class=\"keyword\">int</span> angle, Bitmap bitmap)</span> </span>&#123;</span><br><span class=\"line\">        Matrix matrix = <span class=\"keyword\">new</span> Matrix();</span><br><span class=\"line\">        matrix.postRotate(angle);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bitmap != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Bitmap.createBitmap(bitmap, <span class=\"number\">0</span>, <span class=\"number\">0</span>, bitmap.getWidth(), bitmap.getHeight(), matrix, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">name</span>=<span class=\"string\">\"TransparentTheme\"</span> <span class=\"attr\">parent</span>=<span class=\"string\">\"Theme.AppCompat.Light.NoActionBar\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimary\"</span>&gt;</span>@android:color/transparent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimaryDark\"</span>&gt;</span>@android:color/transparent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowBackground\"</span>&gt;</span>@android:color/transparent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowIsTranslucent\"</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowAnimationStyle\"</span>&gt;</span>@android:style/Animation.Translucent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowNoTitle\"</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowContentOverlay\"</span>&gt;</span>@null<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- FileProvider 7.0--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">provider</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.support.v4.content.FileProvider\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:authorities</span>=<span class=\"string\">\"$&#123;applicationId&#125;.fileProvider\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:exported</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:grantUriPermissions</span>=<span class=\"string\">\"true\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta-data</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.support.FILE_PROVIDER_PATHS\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:resource</span>=<span class=\"string\">\"@xml/provider_paths\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">provider</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- provider_paths.xml --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">paths</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  root-path ,,external-path--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">root-path</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">name</span>=<span class=\"string\">\"root_path\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">path</span>=<span class=\"string\">\".\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code>&lt;paths&gt;</code> <code>&lt;files-path&gt;</code> app; <code>&lt;external-path&gt;</code> ; <code>&lt;cache-path&gt;</code>..</p>\n<p>,,, API , library .<br><strong><a href=\"https://github.com/Thewhitelight/Tinder\"></a></strong></p>\n","site":{"data":{}},"excerpt":"<p>, Android , API , onActivityResult ,,,,,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"Android-6-0-\"><a href=\"#Android-6-0-\" class=\"headerlink\" title=\"Android 6.0 \"></a>Android 6.0 </h5><p> Android 6.0 App, SD ,, App ,, onRequestPermissionsResult .</p>\n<h5 id=\"Android-7-0-StrictMode-\"><a href=\"#Android-7-0-StrictMode-\" class=\"headerlink\" title=\"Android 7.0 StrictMode \"></a>Android 7.0 StrictMode </h5><p> Android 7.0  StrictMode App file://  URI, FileUriExposedException , FileProvider .</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>,,90, ExifInterface , orientation ,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> library .. Activity ,,,.</p>","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// </span></span><br><span class=\"line\">Avatar.getInstance()</span><br><span class=\"line\">                   <span class=\"comment\">// ALL  CAMERA  GALLERY </span></span><br><span class=\"line\">                   .setSelectMode(Avatar.ALL)</span><br><span class=\"line\">                   <span class=\"comment\">//  </span></span><br><span class=\"line\">                   .setImageFileDir(<span class=\"string\">\"Tinder\"</span>)</span><br><span class=\"line\">                   <span class=\"comment\">//</span></span><br><span class=\"line\">                   .setHasCrop(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">                   <span class=\"comment\">//</span></span><br><span class=\"line\">                   .imageFile &#123; imageFile -&gt;</span><br><span class=\"line\">                       run &#123;</span><br><span class=\"line\">                           Log.e(<span class=\"string\">\"file:\"</span>, imageFile.absolutePath)</span><br><span class=\"line\">                           img.setImageBitmap(BitmapFactory.decodeFile(imageFile.absolutePath))</span><br><span class=\"line\">                       &#125;</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">                   .build(<span class=\"keyword\">this</span>)</span><br></pre></td></tr></table></figure>\n<p> Avatar ,, Activity ,SelectAvatarActivity ,.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Avatar.java</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Avatar</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Avatar <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> AvatarHolder.INSTANCE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AvatarHolder</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Avatar INSTANCE = <span class=\"keyword\">new</span> Avatar();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">SelectAvatarActivity.java</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//setImageFile ,,</span></span><br><span class=\"line\">    Avatar.getInstance().setImageFile(mAvatarFile);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Intent intent = <span class=\"keyword\">new</span> Intent(MediaStore.ACTION_IMAGE_CAPTURE);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) &#123;</span><br><span class=\"line\">            mOrigUri = Uri.fromFile(cameraFile);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            ContentValues contentValues = <span class=\"keyword\">new</span> ContentValues(<span class=\"number\">1</span>);</span><br><span class=\"line\">            contentValues.put(MediaStore.Images.Media.DATA, cameraFile.getAbsolutePath());</span><br><span class=\"line\">            mOrigUri = getContentResolver().insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, contentValues);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        intent.putExtra(MediaStore.EXTRA_OUTPUT, mOrigUri);</span><br><span class=\"line\">        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_CAMERA);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Intent intent;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class=\"line\">            intent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            intent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_GET_CONTENT);</span><br><span class=\"line\">            intent.setType(<span class=\"string\">\"image/*\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_SDCARD);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//,ExifInterface,Matrix</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">readPictureDegree</span><span class=\"params\">(String path)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> degree = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            ExifInterface exifInterface = <span class=\"keyword\">new</span> ExifInterface(path);</span><br><span class=\"line\">            <span class=\"keyword\">int</span> orientation = exifInterface.getAttributeInt(</span><br><span class=\"line\">                    ExifInterface.TAG_ORIENTATION,</span><br><span class=\"line\">                    ExifInterface.ORIENTATION_NORMAL);</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (orientation) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> ExifInterface.ORIENTATION_ROTATE_90:</span><br><span class=\"line\">                    degree = <span class=\"number\">90</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> ExifInterface.ORIENTATION_ROTATE_180:</span><br><span class=\"line\">                    degree = <span class=\"number\">180</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> ExifInterface.ORIENTATION_ROTATE_270:</span><br><span class=\"line\">                    degree = <span class=\"number\">270</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> degree;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ImageUtil.java </span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Bitmap <span class=\"title\">rotateImageView</span><span class=\"params\">(<span class=\"keyword\">int</span> angle, Bitmap bitmap)</span> </span>&#123;</span><br><span class=\"line\">        Matrix matrix = <span class=\"keyword\">new</span> Matrix();</span><br><span class=\"line\">        matrix.postRotate(angle);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bitmap != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Bitmap.createBitmap(bitmap, <span class=\"number\">0</span>, <span class=\"number\">0</span>, bitmap.getWidth(), bitmap.getHeight(), matrix, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">name</span>=<span class=\"string\">\"TransparentTheme\"</span> <span class=\"attr\">parent</span>=<span class=\"string\">\"Theme.AppCompat.Light.NoActionBar\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimary\"</span>&gt;</span>@android:color/transparent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"colorPrimaryDark\"</span>&gt;</span>@android:color/transparent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowBackground\"</span>&gt;</span>@android:color/transparent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowIsTranslucent\"</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowAnimationStyle\"</span>&gt;</span>@android:style/Animation.Translucent<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowNoTitle\"</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;<span class=\"name\">item</span> <span class=\"attr\">name</span>=<span class=\"string\">\"android:windowContentOverlay\"</span>&gt;</span>@null<span class=\"tag\">&lt;/<span class=\"name\">item</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- FileProvider 7.0--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">provider</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.support.v4.content.FileProvider\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:authorities</span>=<span class=\"string\">\"$&#123;applicationId&#125;.fileProvider\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:exported</span>=<span class=\"string\">\"false\"</span></span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">android:grantUriPermissions</span>=<span class=\"string\">\"true\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta-data</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.support.FILE_PROVIDER_PATHS\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:resource</span>=<span class=\"string\">\"@xml/provider_paths\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">provider</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- provider_paths.xml --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">paths</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  root-path ,,external-path--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">root-path</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">name</span>=<span class=\"string\">\"root_path\"</span></span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">path</span>=<span class=\"string\">\".\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code>&lt;paths&gt;</code> <code>&lt;files-path&gt;</code> app; <code>&lt;external-path&gt;</code> ; <code>&lt;cache-path&gt;</code>..</p>\n<p>,,, API , library .<br><strong><a href=\"https://github.com/Thewhitelight/Tinder\"></a></strong></p>"},{"title":"AndroidX ","date":"2019-12-07T02:59:16.000Z","_content":"# \n Android 10 , targetVersion 29 AndroidX  AndriodX ,, AndroidX , QQ  GoogleMap  SDK  AndroidX . Refactor->Migrate to AndroiX ,,, AndroidX .,.\n# \n\n1. checkout \n2.  gradle \n3.  gradle tool \n4. gradle.properties  AndroidX \n5.  support \n6.  support \n7. \n\n,. AndroidX  gradle tool 3.2 ,, supprot 28 .\n<!-- more -->\n## checkout \n``` git\n$(cd .. | git branch androidx_migrate)\n$(cd .. | git checkout androidx_migrate)\n```\n##  gradle \n gradle .`>/dev/null`.\n`./gradlew wrapper --gradle-version 5.4.1 >/dev/null`\n##  gradle tools\n``` shell\n$(sed -i \"\" \"s/com.android.tools.build:gradle:.*/com.android.tools.build:gradle:3.5.2/g\" ${BUILD_FILE})\n```\n`${BUILD_FILE}``build.gradle`,. gradle tool  gradle .\n##  gradle.properties\n``` shell\necho '\\nandroid.useAndroidX=true\nandroid.enableJetifier=true' >>$PROJECT_DIR/gradle.properties\n```\n`android.useAndroidX=true`Android  AndroidX \n`android.enableJetifier=true`Android  AndroidX\n##  support \n support  androidx , google [](https://developer.android.com/jetpack/androidx/migrate/class-mappings),\n``` shell\nfrom_pkgs=\"\"\nreplace=\"\"\nwhile IFS=, read -r from_pkg to_pkg\ndo\n    from_pkgs+=\" -e $from_pkg\"\n    replace+=\"; s/$from_pkg/$to_pkg/g\"\ndone <<< \"$(tail -n +2 $MAPPING_FILE)\"\n\nrg --files-with-matches -t java -t kotlin -t xml -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e \"$replace\"\n```\n`$MAPPING_FILE)` androidx_class_map.csv , gooogle ,,,.\n`$(tail -n +2 $MAPPING_FILE)``cat`2.1 support .\n`replace+=\"; s/$from_pkg/$to_pkg/g\"`,`sed`.`$to_pkg``$from_pkg`,`;`.\n`rg``find`.`rg`,,.`xml`, support .\n`xargs`.\n`perl``sed`,.\n##  support \n``` shell\nfrom_pkgs=\"\"\nreplace=\"\"\nwhile IFS=, read -r from_pkg to_pkg\ndo\n    from_pkgs+=\" -e $from_pkg\"\n    replace+=\"; s/(\\\"|')$from_pkg.*(\\\"|')/\\\"$to_pkg\\\"/g\"\n    #sed ,\n    #replace+=\"; s/\\(\\\\\\\"\\|'\\)$from_pkg.*\\(\\\\\\\"\\|'\\)/\\\\\\\"$to_pkg\\\\\\\"/g\"\ndone <<< \"$(tail -n +2 $ARTIFACT_MAPPING_FILE)\"\n\nrg --files-with-matches -t groovy -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e \"$replace\"\n```\n support ,,.\n\n```\napi \"com.android.support:support-v4:${rootProject.ext.supportLibVersion}\"\napi \"com.android.support:support-v4:28.0.0\"\napi 'com.android.support:support-v4:28.0.0'\n```\n`(\"|')package.*(\"|')`.\n`$ARTIFACT_MAPPING_FILE`.\n``` csv\nOld build artifact,AndroidX build artifact\ncom.android.support:support-v4:,androidx.legacy:legacy-support-v4:1.0.0\n```\n`1.0.0`.`${rootProject.ext.v4Version}`.\n## \n\n```\n-dontwarn com.google.android.material.**\n-keep class com.google.android.material.** { *; }\n\n-dontwarn androidx.**\n-keep class androidx.** { *; }\n-keep interface androidx.** { *; }\n```\n\n\n,, gradle,..\n[](https://github.com/Thewhitelight/androidx_migrate_scripts)\n# \n[rg ](https://www.hi-linux.com/posts/29245.html)\n[](https://developer.android.com/jetpack/androidx)\n[](https://gist.github.com/loganj/7535a13e98be83460f362b63dbd13e07)","source":"_posts/androidx-migrate-script.md","raw":"---\ntitle: AndroidX \ndate: 2019-12-07 10:59:16\ntags:\n  - Git\n  - Shell\ncategories:\n  - \n---\n# \n Android 10 , targetVersion 29 AndroidX  AndriodX ,, AndroidX , QQ  GoogleMap  SDK  AndroidX . Refactor->Migrate to AndroiX ,,, AndroidX .,.\n# \n\n1. checkout \n2.  gradle \n3.  gradle tool \n4. gradle.properties  AndroidX \n5.  support \n6.  support \n7. \n\n,. AndroidX  gradle tool 3.2 ,, supprot 28 .\n<!-- more -->\n## checkout \n``` git\n$(cd .. | git branch androidx_migrate)\n$(cd .. | git checkout androidx_migrate)\n```\n##  gradle \n gradle .`>/dev/null`.\n`./gradlew wrapper --gradle-version 5.4.1 >/dev/null`\n##  gradle tools\n``` shell\n$(sed -i \"\" \"s/com.android.tools.build:gradle:.*/com.android.tools.build:gradle:3.5.2/g\" ${BUILD_FILE})\n```\n`${BUILD_FILE}``build.gradle`,. gradle tool  gradle .\n##  gradle.properties\n``` shell\necho '\\nandroid.useAndroidX=true\nandroid.enableJetifier=true' >>$PROJECT_DIR/gradle.properties\n```\n`android.useAndroidX=true`Android  AndroidX \n`android.enableJetifier=true`Android  AndroidX\n##  support \n support  androidx , google [](https://developer.android.com/jetpack/androidx/migrate/class-mappings),\n``` shell\nfrom_pkgs=\"\"\nreplace=\"\"\nwhile IFS=, read -r from_pkg to_pkg\ndo\n    from_pkgs+=\" -e $from_pkg\"\n    replace+=\"; s/$from_pkg/$to_pkg/g\"\ndone <<< \"$(tail -n +2 $MAPPING_FILE)\"\n\nrg --files-with-matches -t java -t kotlin -t xml -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e \"$replace\"\n```\n`$MAPPING_FILE)` androidx_class_map.csv , gooogle ,,,.\n`$(tail -n +2 $MAPPING_FILE)``cat`2.1 support .\n`replace+=\"; s/$from_pkg/$to_pkg/g\"`,`sed`.`$to_pkg``$from_pkg`,`;`.\n`rg``find`.`rg`,,.`xml`, support .\n`xargs`.\n`perl``sed`,.\n##  support \n``` shell\nfrom_pkgs=\"\"\nreplace=\"\"\nwhile IFS=, read -r from_pkg to_pkg\ndo\n    from_pkgs+=\" -e $from_pkg\"\n    replace+=\"; s/(\\\"|')$from_pkg.*(\\\"|')/\\\"$to_pkg\\\"/g\"\n    #sed ,\n    #replace+=\"; s/\\(\\\\\\\"\\|'\\)$from_pkg.*\\(\\\\\\\"\\|'\\)/\\\\\\\"$to_pkg\\\\\\\"/g\"\ndone <<< \"$(tail -n +2 $ARTIFACT_MAPPING_FILE)\"\n\nrg --files-with-matches -t groovy -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e \"$replace\"\n```\n support ,,.\n\n```\napi \"com.android.support:support-v4:${rootProject.ext.supportLibVersion}\"\napi \"com.android.support:support-v4:28.0.0\"\napi 'com.android.support:support-v4:28.0.0'\n```\n`(\"|')package.*(\"|')`.\n`$ARTIFACT_MAPPING_FILE`.\n``` csv\nOld build artifact,AndroidX build artifact\ncom.android.support:support-v4:,androidx.legacy:legacy-support-v4:1.0.0\n```\n`1.0.0`.`${rootProject.ext.v4Version}`.\n## \n\n```\n-dontwarn com.google.android.material.**\n-keep class com.google.android.material.** { *; }\n\n-dontwarn androidx.**\n-keep class androidx.** { *; }\n-keep interface androidx.** { *; }\n```\n\n\n,, gradle,..\n[](https://github.com/Thewhitelight/androidx_migrate_scripts)\n# \n[rg ](https://www.hi-linux.com/posts/29245.html)\n[](https://developer.android.com/jetpack/androidx)\n[](https://gist.github.com/loganj/7535a13e98be83460f362b63dbd13e07)","slug":"androidx-migrate-script","published":1,"updated":"2019-12-07T08:29:19.170Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsa0000dndf2ta0ut7fe","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> Android 10 , targetVersion 29 AndroidX  AndriodX ,, AndroidX , QQ  GoogleMap  SDK  AndroidX . Refactor-&gt;Migrate to AndroiX ,,, AndroidX .,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ol>\n<li>checkout </li>\n<li> gradle </li>\n<li> gradle tool </li>\n<li>gradle.properties  AndroidX </li>\n<li> support </li>\n<li> support </li>\n<li></li>\n</ol>\n<p>,. AndroidX  gradle tool 3.2 ,, supprot 28 .<br><a id=\"more\"></a></p>\n<h2 id=\"checkout-\"><a href=\"#checkout-\" class=\"headerlink\" title=\"checkout \"></a>checkout </h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(cd .. | git branch androidx_migrate)</span><br><span class=\"line\">$(cd .. | git checkout androidx_migrate)</span><br></pre></td></tr></table></figure>\n<h2 id=\"-gradle-\"><a href=\"#-gradle-\" class=\"headerlink\" title=\" gradle \"></a> gradle </h2><p> gradle .<code>&gt;/dev/null</code>.<br><code>./gradlew wrapper --gradle-version 5.4.1 &gt;/dev/null</code></p>\n<h2 id=\"-gradle-tools\"><a href=\"#-gradle-tools\" class=\"headerlink\" title=\" gradle tools\"></a> gradle tools</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span>(sed -i \"\" \"s/com.android.tools.build:gradle:.*/com.android.tools.build:gradle:3.5.2/g\" $&#123;BUILD_FILE&#125;)</span><br></pre></td></tr></table></figure>\n<p><code>${BUILD_FILE}</code><code>build.gradle</code>,. gradle tool  gradle .</p>\n<h2 id=\"-gradle-properties\"><a href=\"#-gradle-properties\" class=\"headerlink\" title=\" gradle.properties\"></a> gradle.properties</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo '\\nandroid.useAndroidX=true</span><br><span class=\"line\">android.enableJetifier=true' &gt;&gt;$PROJECT_DIR/gradle.properties</span><br></pre></td></tr></table></figure>\n<p><code>android.useAndroidX=true</code>Android  AndroidX <br><code>android.enableJetifier=true</code>Android  AndroidX</p>\n<h2 id=\"-support-\"><a href=\"#-support-\" class=\"headerlink\" title=\" support \"></a> support </h2><p> support  androidx , google <a href=\"https://developer.android.com/jetpack/androidx/migrate/class-mappings\" target=\"_blank\" rel=\"noopener\"></a>,<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from_pkgs=\"\"</span><br><span class=\"line\">replace=\"\"</span><br><span class=\"line\">while IFS=, read -r from_pkg to_pkg</span><br><span class=\"line\">do</span><br><span class=\"line\">    from_pkgs+=\" -e $from_pkg\"</span><br><span class=\"line\">    replace+=\"; s/$from_pkg/$to_pkg/g\"</span><br><span class=\"line\">done &lt;&lt;&lt; \"$(tail -n +2 $MAPPING_FILE)\"</span><br><span class=\"line\"></span><br><span class=\"line\">rg --files-with-matches -t java -t kotlin -t xml -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e \"$replace\"</span><br></pre></td></tr></table></figure></p>\n<p><code>$MAPPING_FILE)</code> androidx_class_map.csv , gooogle ,,,.<br><code>$(tail -n +2 $MAPPING_FILE)</code><code>cat</code>2.1 support .<br><code>replace+=&quot;; s/$from_pkg/$to_pkg/g&quot;</code>,<code>sed</code>.<code>$to_pkg</code><code>$from_pkg</code>,<code>;</code>.<br><code>rg</code><code>find</code>.<code>rg</code>,,.<code>xml</code>, support .<br><code>xargs</code>.<br><code>perl</code><code>sed</code>,.</p>\n<h2 id=\"-support-\"><a href=\"#-support-\" class=\"headerlink\" title=\" support \"></a> support </h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from_pkgs=\"\"</span><br><span class=\"line\">replace=\"\"</span><br><span class=\"line\">while IFS=, read -r from_pkg to_pkg</span><br><span class=\"line\">do</span><br><span class=\"line\">    from_pkgs+=\" -e $from_pkg\"</span><br><span class=\"line\">    replace+=\"; s/(\\\"|')$from_pkg.*(\\\"|')/\\\"$to_pkg\\\"/g\"</span><br><span class=\"line\">    #sed ,</span><br><span class=\"line\">    #replace+=\"; s/\\(\\\\\\\"\\|'\\)$from_pkg.*\\(\\\\\\\"\\|'\\)/\\\\\\\"$to_pkg\\\\\\\"/g\"</span><br><span class=\"line\">done &lt;&lt;&lt; \"$(tail -n +2 $ARTIFACT_MAPPING_FILE)\"</span><br><span class=\"line\"></span><br><span class=\"line\">rg --files-with-matches -t groovy -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e \"$replace\"</span><br></pre></td></tr></table></figure>\n<p> support ,,.<br><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">api &quot;com.android.support:support-v4:$&#123;rootProject.ext.supportLibVersion&#125;&quot;</span><br><span class=\"line\">api &quot;com.android.support:support-v4:28.0.0&quot;</span><br><span class=\"line\">api &apos;com.android.support:support-v4:28.0.0&apos;</span><br></pre></td></tr></table></figure></p>\n<p><code>(&quot;|&#39;)package.*(&quot;|&#39;)</code>.<br><code>$ARTIFACT_MAPPING_FILE</code>.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Old build artifact,AndroidX build artifact</span><br><span class=\"line\">com.android.support:support-v4:,androidx.legacy:legacy-support-v4:1.0.0</span><br></pre></td></tr></table></figure></p>\n<p><code>1.0.0</code>.<code>${rootProject.ext.v4Version}</code>.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn com.google.android.material.**</span><br><span class=\"line\">-keep class com.google.android.material.** &#123; *; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-dontwarn androidx.**</span><br><span class=\"line\">-keep class androidx.** &#123; *; &#125;</span><br><span class=\"line\">-keep interface androidx.** &#123; *; &#125;</span><br></pre></td></tr></table></figure></p>\n<p><br>,, gradle,..<br><a href=\"https://github.com/Thewhitelight/androidx_migrate_scripts\"></a></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://www.hi-linux.com/posts/29245.html\" target=\"_blank\" rel=\"noopener\">rg </a><br><a href=\"https://developer.android.com/jetpack/androidx\" target=\"_blank\" rel=\"noopener\"></a><br><a href=\"https://gist.github.com/loganj/7535a13e98be83460f362b63dbd13e07\" target=\"_blank\" rel=\"noopener\"></a></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> Android 10 , targetVersion 29 AndroidX  AndriodX ,, AndroidX , QQ  GoogleMap  SDK  AndroidX . Refactor-&gt;Migrate to AndroiX ,,, AndroidX .,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<ol>\n<li>checkout </li>\n<li> gradle </li>\n<li> gradle tool </li>\n<li>gradle.properties  AndroidX </li>\n<li> support </li>\n<li> support </li>\n<li></li>\n</ol>\n<p>,. AndroidX  gradle tool 3.2 ,, supprot 28 .<br>","more":"</p>\n<h2 id=\"checkout-\"><a href=\"#checkout-\" class=\"headerlink\" title=\"checkout \"></a>checkout </h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(cd .. | git branch androidx_migrate)</span><br><span class=\"line\">$(cd .. | git checkout androidx_migrate)</span><br></pre></td></tr></table></figure>\n<h2 id=\"-gradle-\"><a href=\"#-gradle-\" class=\"headerlink\" title=\" gradle \"></a> gradle </h2><p> gradle .<code>&gt;/dev/null</code>.<br><code>./gradlew wrapper --gradle-version 5.4.1 &gt;/dev/null</code></p>\n<h2 id=\"-gradle-tools\"><a href=\"#-gradle-tools\" class=\"headerlink\" title=\" gradle tools\"></a> gradle tools</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">$</span>(sed -i \"\" \"s/com.android.tools.build:gradle:.*/com.android.tools.build:gradle:3.5.2/g\" $&#123;BUILD_FILE&#125;)</span><br></pre></td></tr></table></figure>\n<p><code>${BUILD_FILE}</code><code>build.gradle</code>,. gradle tool  gradle .</p>\n<h2 id=\"-gradle-properties\"><a href=\"#-gradle-properties\" class=\"headerlink\" title=\" gradle.properties\"></a> gradle.properties</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo '\\nandroid.useAndroidX=true</span><br><span class=\"line\">android.enableJetifier=true' &gt;&gt;$PROJECT_DIR/gradle.properties</span><br></pre></td></tr></table></figure>\n<p><code>android.useAndroidX=true</code>Android  AndroidX <br><code>android.enableJetifier=true</code>Android  AndroidX</p>\n<h2 id=\"-support-\"><a href=\"#-support-\" class=\"headerlink\" title=\" support \"></a> support </h2><p> support  androidx , google <a href=\"https://developer.android.com/jetpack/androidx/migrate/class-mappings\" target=\"_blank\" rel=\"noopener\"></a>,<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from_pkgs=\"\"</span><br><span class=\"line\">replace=\"\"</span><br><span class=\"line\">while IFS=, read -r from_pkg to_pkg</span><br><span class=\"line\">do</span><br><span class=\"line\">    from_pkgs+=\" -e $from_pkg\"</span><br><span class=\"line\">    replace+=\"; s/$from_pkg/$to_pkg/g\"</span><br><span class=\"line\">done &lt;&lt;&lt; \"$(tail -n +2 $MAPPING_FILE)\"</span><br><span class=\"line\"></span><br><span class=\"line\">rg --files-with-matches -t java -t kotlin -t xml -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e \"$replace\"</span><br></pre></td></tr></table></figure></p>\n<p><code>$MAPPING_FILE)</code> androidx_class_map.csv , gooogle ,,,.<br><code>$(tail -n +2 $MAPPING_FILE)</code><code>cat</code>2.1 support .<br><code>replace+=&quot;; s/$from_pkg/$to_pkg/g&quot;</code>,<code>sed</code>.<code>$to_pkg</code><code>$from_pkg</code>,<code>;</code>.<br><code>rg</code><code>find</code>.<code>rg</code>,,.<code>xml</code>, support .<br><code>xargs</code>.<br><code>perl</code><code>sed</code>,.</p>\n<h2 id=\"-support-\"><a href=\"#-support-\" class=\"headerlink\" title=\" support \"></a> support </h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from_pkgs=\"\"</span><br><span class=\"line\">replace=\"\"</span><br><span class=\"line\">while IFS=, read -r from_pkg to_pkg</span><br><span class=\"line\">do</span><br><span class=\"line\">    from_pkgs+=\" -e $from_pkg\"</span><br><span class=\"line\">    replace+=\"; s/(\\\"|')$from_pkg.*(\\\"|')/\\\"$to_pkg\\\"/g\"</span><br><span class=\"line\">    #sed ,</span><br><span class=\"line\">    #replace+=\"; s/\\(\\\\\\\"\\|'\\)$from_pkg.*\\(\\\\\\\"\\|'\\)/\\\\\\\"$to_pkg\\\\\\\"/g\"</span><br><span class=\"line\">done &lt;&lt;&lt; \"$(tail -n +2 $ARTIFACT_MAPPING_FILE)\"</span><br><span class=\"line\"></span><br><span class=\"line\">rg --files-with-matches -t groovy -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e \"$replace\"</span><br></pre></td></tr></table></figure>\n<p> support ,,.<br><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">api &quot;com.android.support:support-v4:$&#123;rootProject.ext.supportLibVersion&#125;&quot;</span><br><span class=\"line\">api &quot;com.android.support:support-v4:28.0.0&quot;</span><br><span class=\"line\">api &apos;com.android.support:support-v4:28.0.0&apos;</span><br></pre></td></tr></table></figure></p>\n<p><code>(&quot;|&#39;)package.*(&quot;|&#39;)</code>.<br><code>$ARTIFACT_MAPPING_FILE</code>.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Old build artifact,AndroidX build artifact</span><br><span class=\"line\">com.android.support:support-v4:,androidx.legacy:legacy-support-v4:1.0.0</span><br></pre></td></tr></table></figure></p>\n<p><code>1.0.0</code>.<code>${rootProject.ext.v4Version}</code>.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-dontwarn com.google.android.material.**</span><br><span class=\"line\">-keep class com.google.android.material.** &#123; *; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-dontwarn androidx.**</span><br><span class=\"line\">-keep class androidx.** &#123; *; &#125;</span><br><span class=\"line\">-keep interface androidx.** &#123; *; &#125;</span><br></pre></td></tr></table></figure></p>\n<p><br>,, gradle,..<br><a href=\"https://github.com/Thewhitelight/androidx_migrate_scripts\"></a></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://www.hi-linux.com/posts/29245.html\" target=\"_blank\" rel=\"noopener\">rg </a><br><a href=\"https://developer.android.com/jetpack/androidx\" target=\"_blank\" rel=\"noopener\"></a><br><a href=\"https://gist.github.com/loganj/7535a13e98be83460f362b63dbd13e07\" target=\"_blank\" rel=\"noopener\"></a></p>"},{"title":" AOP ","date":"2019-01-02T03:34:18.000Z","_content":",,.,.\n#### \n\n1. \n2. \n3. \n4. \n<!-- more -->\n\n#### \n Javassist .\n##### AspectJ\n JakeWharton  hugo , AspectJ  Log .,,.` @Pointcut(\"execution(* \" + BuildConfig.PACKAGE_NAME + \"..*.*(..))  BuildConfig.PACKAGE_NAME ` ,,,,. hugo .[Github](https://github.com/Thewhitelight/Analysis)  AspectJ , Kotlin.\nAspectj , AOP , Kotlin , AspectJ ,,.\n##### Javassist\nJavassist  Java   . ASM , cglib ,.\n gradle plugin ,.,.\n\n###### TraceExtension  plugin \n\n``` groovy\nclass TraceExtension {\n    //\n    List<String> classExcludes = new ArrayList<>()\n    //\n    List<String> packageExcludes = new ArrayList<>()\n    //\n    def enabled = true\n    //,applicationId\n    def packageName\n    //\n    def logLevel = \"d\"\n}\n```\n\nTraceExtension ,.\n\n###### Trace \n\n``` groovy\nclass Trace implements Plugin<Project> {\n\n    @Override\n    void apply(Project project) {\n\n        def hasApp = project.plugins.withType(AppPlugin)\n        def hasLib = project.plugins.withType(LibraryPlugin)\n\n        if (!hasApp && !hasLib) {\n            throw new IllegalStateException(\"'android' or 'android-library' plugin required.\")\n        }\n\n        final def variants\n        if (hasApp) {\n            variants = project.android.applicationVariants\n        } else {\n            variants = project.android.libraryVariants\n        }\n\n        final def log = project.logger\n        variants.all { variant ->\n            if (!variant.buildType.isDebuggable()) {\n                log.debug(\"Skipping non-debuggable build type '${variant.buildType.name}'.\")\n                return\n            } else if (!project.Trace.enabled) {\n                log.debug(\"Trace is not disabled.\")\n                return\n            }\n        }\n\n        project.extensions.create('Trace', TraceExtension)\n\n        println(\"=== Trace Plugin ===\")\n        def android = project.extensions.findByType(AppExtension)\n        // Transform,\n        android.registerTransform(new TraceTransform(project))\n    }\n\n}\n```\n\nTrace , release  Log .\n\n###### TraceTransform \n\n``` groovy\nclass TraceTransform extends Transform {\n\n    Project project\n\n    TraceTransform(Project project) {\n        this.project = project\n    }\n\n    @Override\n    String getName() {\n        return \"TraceTransform\"\n    }\n\n    /**\n     * \n     */\n    @Override\n    Set<QualifiedContent.ContentType> getInputTypes() {\n        return TransformManager.CONTENT_CLASS\n    }\n\n    /**\n     * \n     */\n    @Override\n    Set<? super QualifiedContent.Scope> getScopes() {\n        // \n        return TransformManager.SCOPE_FULL_PROJECT\n    }\n\n    @Override\n    boolean isIncremental() {\n        return false\n    }\n\n    @Override\n    void transform(TransformInvocation transformInvocation) throws TransformException, InterruptedException, IOException {\n        super.transform(transformInvocation)\n        if (!project.Trace.enabled) {\n            return\n        }\n\n        def outputProvider = transformInvocation.outputProvider\n\n        transformInvocation.inputs.each { TransformInput input ->\n            //\n            input.directoryInputs.each { DirectoryInput directoryInput ->\n                //\n                TraceInject.injectDirCode(directoryInput.file.absolutePath, project)\n                def dest = outputProvider.getContentLocation(\n                        directoryInput.name,\n                        directoryInput.contentTypes,\n                        directoryInput.scopes,\n                        Format.DIRECTORY)\n                FileUtils.copyDirectory(directoryInput.file, dest)\n            }\n\n            //jar jar,out .\n            input.jarInputs.each { JarInput jarInput ->\n                def jarName = jarInput.name\n                def md5Name = DigestUtils.md5Hex(jarInput.file.getAbsolutePath())\n                if (jarName.endsWith(\".jar\")) {\n                    jarName = jarName.substring(0, jarName.length() - 4)\n                }\n                def dest = outputProvider.getContentLocation(\n                        jarName + md5Name,\n                        jarInput.contentTypes,\n                        jarInput.scopes,\n                        Format.JAR)\n                FileUtils.copyFile(jarInput.file, dest)\n            }\n        }\n\n    }\n}\n```\n\n Log  class  dex ,Tranfrom  Task dex, AspectJ  Task .\n\n###### TraceInject  Log\n\n``` groovy\nclass TraceInject {\n\n    static String TAG = \"Trace\"\n    static ClassPool POOL = ClassPool.getDefault()\n\n    static void injectDirCode(String path, Project project) {\n        POOL.appendClassPath(path)\n        // Android SDK \n        POOL.appendClassPath(project.android.bootClasspath[0].toString())\n        File dir = new File(path)\n        if (dir.isDirectory()) {\n            dir.eachFileRecurse { File file ->\n                String filePath = file.absolutePath\n                //class\n                if (filePath.endsWith(\".class\")\n                        && !filePath.contains('R$')\n                        && !filePath.contains('R.class')\n                        && !filePath.contains(\"BuildConfig.class\")) {\n                    modifyClass(project, path, filePath)\n                }\n            }\n        }\n    }\n    static void modifyClass(Project project, String path, String filePath) {\n        String classPath\n        def packageName = project.Trace.packageName\n        filePath = filePath.replace(\"/\", \".\")\n\n        if (classExcludes(project, filePath)) {\n            return\n        }\n        if (packageExcludes(project, filePath)) {\n            return\n        }\n\n        if (filePath.contains(packageName)) {\n            int index = filePath.indexOf(packageName)\n            classPath = filePath.substring(index, filePath.length())\n        } else {\n            println(\"project can not inject\")\n            return\n        }\n        //\n        String className = classPath.substring(0, classPath.length() - 6)\n                .replace('/', '.')\n                .replace('/', '.')\n        CtClass c = POOL.getCtClass(className)\n        //,\n        if (c.isFrozen()) {\n            c.defrost()\n        }\n        CtMethod[] methods = c.getDeclaredMethods()\n        int i = 0\n        for (CtMethod method : methods) {\n            // native \n            if (method.isEmpty() || Modifier.isNative(method.getModifiers())) {\n                return\n            }\n            i++\n            insertTime(project.Trace.logLevel, className.replace(packageName + \".\", \"\"), method)\n        }\n        c.writeFile(path)\n        c.detach()\n    }\n\n    static void insertTime(String logLevel, String className, CtMethod method) {\n        try {\n            int pos = 1\n\n            CodeAttribute codeAttribute = method.getMethodInfo().getCodeAttribute()\n            LocalVariableAttribute attribute = (LocalVariableAttribute) codeAttribute.getAttribute(LocalVariableAttribute.tag)\n            int size = method.getParameterTypes().length\n            String[] paramTypes = new String[size]\n            if (attribute == null) {\n                return\n            }\n            for (int i = 0; i < size; i++) {\n                //\n                paramTypes[i] = method.getParameterTypes()[i].name\n            }\n\n            def stringType = POOL.getCtClass(\"java.lang.String\")\n            def objType = POOL.getCtClass(\"java.lang.Object\")\n            //\n            method.addLocalVariable(\"startTime\", CtClass.longType)\n            method.addLocalVariable(\"endTime\", CtClass.longType)\n            //\n            method.addLocalVariable(\"className\", stringType)\n            //\n            method.addLocalVariable(\"methodName\", stringType)\n            //\n            method.addLocalVariable(\"lineNumber\", CtClass.intType)\n            //\n            method.addLocalVariable(\"returnObj\", objType)\n\n            StringBuilder startInjectSB = new StringBuilder()\n            \n            //*** \n\n            // Log\n            method.insertBefore(startInjectSB.toString())\n\n            StringBuilder endInjectSB = new StringBuilder()\n            //*** \n\n            // return  Log\n            method.insertAfter(endInjectSB.toString())\n\n        } catch (Exception e) {\n            e.printStackTrace()\n        }\n    }\n}\n```\nJavassit ,.\n\n#### \n\n``` gradle\n gradle\nclasspath 'cn.libery.analysis:trace:1.0.1' \nmodule gradle\napply plugin: 'analysis-trace' \nTrace {\n        //   clean \n        //\n        enabled true\n        //( applicationId)\n        packageName \"cn.libery.analysis.sample\"\n        //  Logcat \n        logLevel \"i\"\n        //,\n        classExcludes = [\"cn.libery.analysis.sample.Logger\",\n                        \"cn.libery.analysis.sample.Logger2\"]\n        //,\n        packageExcludes = [\"cn.libery.analysis.sample.test\"]\n    }\n```\n\n Github  sample \n[Github](https://github.com/Thewhitelight/Analysis)\n [ ![Download](https://api.bintray.com/packages/light/Android/trace/images/download.svg) ](https://bintray.com/light/Android/trace/_latestVersion)\n\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/ic_analysis_trace.png)\n-> \n<- \n#### \n[ AspectJ](https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx)\n[Javassist ](https://www.jianshu.com/p/43424242846b)\n[AspectJ  Javassist ](https://www.jianshu.com/p/44d39585fc20)\n[AspectJ ](https://www.mekau.com/4880.html)\n[hugo](https://github.com/JakeWharton/hugo)\n[AspectJ  Kotlin](https://stackoverflow.com/questions/44364633/aspectj-doesnt-work-with-kotlin)","source":"_posts/android-track-log.md","raw":"---\ntitle:  AOP \ndate: 2019-01-02 11:34:18\ntags:\n    - Android\n    - AspectJ\n    - Javassist\ncategories: \n    - \n---\n,,.,.\n#### \n\n1. \n2. \n3. \n4. \n<!-- more -->\n\n#### \n Javassist .\n##### AspectJ\n JakeWharton  hugo , AspectJ  Log .,,.` @Pointcut(\"execution(* \" + BuildConfig.PACKAGE_NAME + \"..*.*(..))  BuildConfig.PACKAGE_NAME ` ,,,,. hugo .[Github](https://github.com/Thewhitelight/Analysis)  AspectJ , Kotlin.\nAspectj , AOP , Kotlin , AspectJ ,,.\n##### Javassist\nJavassist  Java   . ASM , cglib ,.\n gradle plugin ,.,.\n\n###### TraceExtension  plugin \n\n``` groovy\nclass TraceExtension {\n    //\n    List<String> classExcludes = new ArrayList<>()\n    //\n    List<String> packageExcludes = new ArrayList<>()\n    //\n    def enabled = true\n    //,applicationId\n    def packageName\n    //\n    def logLevel = \"d\"\n}\n```\n\nTraceExtension ,.\n\n###### Trace \n\n``` groovy\nclass Trace implements Plugin<Project> {\n\n    @Override\n    void apply(Project project) {\n\n        def hasApp = project.plugins.withType(AppPlugin)\n        def hasLib = project.plugins.withType(LibraryPlugin)\n\n        if (!hasApp && !hasLib) {\n            throw new IllegalStateException(\"'android' or 'android-library' plugin required.\")\n        }\n\n        final def variants\n        if (hasApp) {\n            variants = project.android.applicationVariants\n        } else {\n            variants = project.android.libraryVariants\n        }\n\n        final def log = project.logger\n        variants.all { variant ->\n            if (!variant.buildType.isDebuggable()) {\n                log.debug(\"Skipping non-debuggable build type '${variant.buildType.name}'.\")\n                return\n            } else if (!project.Trace.enabled) {\n                log.debug(\"Trace is not disabled.\")\n                return\n            }\n        }\n\n        project.extensions.create('Trace', TraceExtension)\n\n        println(\"=== Trace Plugin ===\")\n        def android = project.extensions.findByType(AppExtension)\n        // Transform,\n        android.registerTransform(new TraceTransform(project))\n    }\n\n}\n```\n\nTrace , release  Log .\n\n###### TraceTransform \n\n``` groovy\nclass TraceTransform extends Transform {\n\n    Project project\n\n    TraceTransform(Project project) {\n        this.project = project\n    }\n\n    @Override\n    String getName() {\n        return \"TraceTransform\"\n    }\n\n    /**\n     * \n     */\n    @Override\n    Set<QualifiedContent.ContentType> getInputTypes() {\n        return TransformManager.CONTENT_CLASS\n    }\n\n    /**\n     * \n     */\n    @Override\n    Set<? super QualifiedContent.Scope> getScopes() {\n        // \n        return TransformManager.SCOPE_FULL_PROJECT\n    }\n\n    @Override\n    boolean isIncremental() {\n        return false\n    }\n\n    @Override\n    void transform(TransformInvocation transformInvocation) throws TransformException, InterruptedException, IOException {\n        super.transform(transformInvocation)\n        if (!project.Trace.enabled) {\n            return\n        }\n\n        def outputProvider = transformInvocation.outputProvider\n\n        transformInvocation.inputs.each { TransformInput input ->\n            //\n            input.directoryInputs.each { DirectoryInput directoryInput ->\n                //\n                TraceInject.injectDirCode(directoryInput.file.absolutePath, project)\n                def dest = outputProvider.getContentLocation(\n                        directoryInput.name,\n                        directoryInput.contentTypes,\n                        directoryInput.scopes,\n                        Format.DIRECTORY)\n                FileUtils.copyDirectory(directoryInput.file, dest)\n            }\n\n            //jar jar,out .\n            input.jarInputs.each { JarInput jarInput ->\n                def jarName = jarInput.name\n                def md5Name = DigestUtils.md5Hex(jarInput.file.getAbsolutePath())\n                if (jarName.endsWith(\".jar\")) {\n                    jarName = jarName.substring(0, jarName.length() - 4)\n                }\n                def dest = outputProvider.getContentLocation(\n                        jarName + md5Name,\n                        jarInput.contentTypes,\n                        jarInput.scopes,\n                        Format.JAR)\n                FileUtils.copyFile(jarInput.file, dest)\n            }\n        }\n\n    }\n}\n```\n\n Log  class  dex ,Tranfrom  Task dex, AspectJ  Task .\n\n###### TraceInject  Log\n\n``` groovy\nclass TraceInject {\n\n    static String TAG = \"Trace\"\n    static ClassPool POOL = ClassPool.getDefault()\n\n    static void injectDirCode(String path, Project project) {\n        POOL.appendClassPath(path)\n        // Android SDK \n        POOL.appendClassPath(project.android.bootClasspath[0].toString())\n        File dir = new File(path)\n        if (dir.isDirectory()) {\n            dir.eachFileRecurse { File file ->\n                String filePath = file.absolutePath\n                //class\n                if (filePath.endsWith(\".class\")\n                        && !filePath.contains('R$')\n                        && !filePath.contains('R.class')\n                        && !filePath.contains(\"BuildConfig.class\")) {\n                    modifyClass(project, path, filePath)\n                }\n            }\n        }\n    }\n    static void modifyClass(Project project, String path, String filePath) {\n        String classPath\n        def packageName = project.Trace.packageName\n        filePath = filePath.replace(\"/\", \".\")\n\n        if (classExcludes(project, filePath)) {\n            return\n        }\n        if (packageExcludes(project, filePath)) {\n            return\n        }\n\n        if (filePath.contains(packageName)) {\n            int index = filePath.indexOf(packageName)\n            classPath = filePath.substring(index, filePath.length())\n        } else {\n            println(\"project can not inject\")\n            return\n        }\n        //\n        String className = classPath.substring(0, classPath.length() - 6)\n                .replace('/', '.')\n                .replace('/', '.')\n        CtClass c = POOL.getCtClass(className)\n        //,\n        if (c.isFrozen()) {\n            c.defrost()\n        }\n        CtMethod[] methods = c.getDeclaredMethods()\n        int i = 0\n        for (CtMethod method : methods) {\n            // native \n            if (method.isEmpty() || Modifier.isNative(method.getModifiers())) {\n                return\n            }\n            i++\n            insertTime(project.Trace.logLevel, className.replace(packageName + \".\", \"\"), method)\n        }\n        c.writeFile(path)\n        c.detach()\n    }\n\n    static void insertTime(String logLevel, String className, CtMethod method) {\n        try {\n            int pos = 1\n\n            CodeAttribute codeAttribute = method.getMethodInfo().getCodeAttribute()\n            LocalVariableAttribute attribute = (LocalVariableAttribute) codeAttribute.getAttribute(LocalVariableAttribute.tag)\n            int size = method.getParameterTypes().length\n            String[] paramTypes = new String[size]\n            if (attribute == null) {\n                return\n            }\n            for (int i = 0; i < size; i++) {\n                //\n                paramTypes[i] = method.getParameterTypes()[i].name\n            }\n\n            def stringType = POOL.getCtClass(\"java.lang.String\")\n            def objType = POOL.getCtClass(\"java.lang.Object\")\n            //\n            method.addLocalVariable(\"startTime\", CtClass.longType)\n            method.addLocalVariable(\"endTime\", CtClass.longType)\n            //\n            method.addLocalVariable(\"className\", stringType)\n            //\n            method.addLocalVariable(\"methodName\", stringType)\n            //\n            method.addLocalVariable(\"lineNumber\", CtClass.intType)\n            //\n            method.addLocalVariable(\"returnObj\", objType)\n\n            StringBuilder startInjectSB = new StringBuilder()\n            \n            //*** \n\n            // Log\n            method.insertBefore(startInjectSB.toString())\n\n            StringBuilder endInjectSB = new StringBuilder()\n            //*** \n\n            // return  Log\n            method.insertAfter(endInjectSB.toString())\n\n        } catch (Exception e) {\n            e.printStackTrace()\n        }\n    }\n}\n```\nJavassit ,.\n\n#### \n\n``` gradle\n gradle\nclasspath 'cn.libery.analysis:trace:1.0.1' \nmodule gradle\napply plugin: 'analysis-trace' \nTrace {\n        //   clean \n        //\n        enabled true\n        //( applicationId)\n        packageName \"cn.libery.analysis.sample\"\n        //  Logcat \n        logLevel \"i\"\n        //,\n        classExcludes = [\"cn.libery.analysis.sample.Logger\",\n                        \"cn.libery.analysis.sample.Logger2\"]\n        //,\n        packageExcludes = [\"cn.libery.analysis.sample.test\"]\n    }\n```\n\n Github  sample \n[Github](https://github.com/Thewhitelight/Analysis)\n [ ![Download](https://api.bintray.com/packages/light/Android/trace/images/download.svg) ](https://bintray.com/light/Android/trace/_latestVersion)\n\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/ic_analysis_trace.png)\n-> \n<- \n#### \n[ AspectJ](https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx)\n[Javassist ](https://www.jianshu.com/p/43424242846b)\n[AspectJ  Javassist ](https://www.jianshu.com/p/44d39585fc20)\n[AspectJ ](https://www.mekau.com/4880.html)\n[hugo](https://github.com/JakeWharton/hugo)\n[AspectJ  Kotlin](https://stackoverflow.com/questions/44364633/aspectj-doesnt-work-with-kotlin)","slug":"android-track-log","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsa2000indf2vwwu96v5","content":"<p>,,.,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ol>\n<li></li>\n<li></li>\n<li></li>\n<li><a id=\"more\"></a>\n</li>\n</ol>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Javassist .</p>\n<h5 id=\"AspectJ\"><a href=\"#AspectJ\" class=\"headerlink\" title=\"AspectJ\"></a>AspectJ</h5><p> JakeWharton  hugo , AspectJ  Log .,,.<code>@Pointcut(&quot;execution(* &quot; + BuildConfig.PACKAGE_NAME + &quot;..*.*(..))  BuildConfig.PACKAGE_NAME </code> ,,,,. hugo .<a href=\"https://github.com/Thewhitelight/Analysis\">Github</a>  AspectJ , Kotlin.<br>Aspectj , AOP , Kotlin , AspectJ ,,.</p>\n<h5 id=\"Javassist\"><a href=\"#Javassist\" class=\"headerlink\" title=\"Javassist\"></a>Javassist</h5><p>Javassist  Java   . ASM , cglib ,.<br> gradle plugin ,.,.</p>\n<h6 id=\"TraceExtension--plugin-\"><a href=\"#TraceExtension--plugin-\" class=\"headerlink\" title=\"TraceExtension  plugin \"></a>TraceExtension  plugin </h6><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TraceExtension</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    List&lt;String&gt; classExcludes = <span class=\"keyword\">new</span> ArrayList&lt;&gt;()</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    List&lt;String&gt; packageExcludes = <span class=\"keyword\">new</span> ArrayList&lt;&gt;()</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> enabled = <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">//,applicationId</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> packageName</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> logLevel = <span class=\"string\">\"d\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>TraceExtension ,.</p>\n<h6 id=\"Trace\"><a href=\"#Trace\" class=\"headerlink\" title=\"Trace\"></a>Trace</h6><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Trace</span> <span class=\"keyword\">implements</span> <span class=\"title\">Plugin</span>&lt;<span class=\"title\">Project</span>&gt; &#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> apply(Project project) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">def</span> hasApp = project.plugins.withType(AppPlugin)</span><br><span class=\"line\">        <span class=\"keyword\">def</span> hasLib = project.plugins.withType(LibraryPlugin)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!hasApp &amp;&amp; !hasLib) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">\"'android' or 'android-library' plugin required.\"</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">def</span> variants</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (hasApp) &#123;</span><br><span class=\"line\">            variants = project.android.applicationVariants</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            variants = project.android.libraryVariants</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">def</span> log = project.logger</span><br><span class=\"line\">        variants.all &#123; variant -&gt;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!variant.buildType.isDebuggable()) &#123;</span><br><span class=\"line\">                log.debug(<span class=\"string\">\"Skipping non-debuggable build type '$&#123;variant.buildType.name&#125;'.\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!project.Trace.enabled) &#123;</span><br><span class=\"line\">                log.debug(<span class=\"string\">\"Trace is not disabled.\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        project.extensions.create(<span class=\"string\">'Trace'</span>, TraceExtension)</span><br><span class=\"line\"></span><br><span class=\"line\">        println(<span class=\"string\">\"=== Trace Plugin ===\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">def</span> android = project.extensions.findByType(AppExtension)</span><br><span class=\"line\">        <span class=\"comment\">// Transform,</span></span><br><span class=\"line\">        android.registerTransform(<span class=\"keyword\">new</span> TraceTransform(project))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Trace , release  Log .</p>\n<h6 id=\"TraceTransform\"><a href=\"#TraceTransform\" class=\"headerlink\" title=\"TraceTransform\"></a>TraceTransform</h6><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TraceTransform</span> <span class=\"keyword\">extends</span> <span class=\"title\">Transform</span> &#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Project project</span><br><span class=\"line\"></span><br><span class=\"line\">    TraceTransform(Project project) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.project = project</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    String getName() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"TraceTransform\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    Set&lt;QualifiedContent.ContentType&gt; getInputTypes() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> TransformManager.CONTENT_CLASS</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    Set&lt;? super QualifiedContent.Scope&gt; getScopes() &#123;</span><br><span class=\"line\">        // </span><br><span class=\"line\">        return TransformManager.SCOPE_FULL_PROJECT</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    boolean isIncremental() &#123;</span><br><span class=\"line\">        return false</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    void transform(TransformInvocation transformInvocation) throws TransformException, InterruptedException, IOException &#123;</span><br><span class=\"line\">        super.transform(transformInvocation)</span><br><span class=\"line\">        if (!project.Trace.enabled) &#123;</span><br><span class=\"line\">            return</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        def outputProvider = transformInvocation.outputProvider</span><br><span class=\"line\"></span><br><span class=\"line\">        transformInvocation.inputs.each &#123; TransformInput input -&gt;</span><br><span class=\"line\">            //</span><br><span class=\"line\">            input.directoryInputs.each &#123; DirectoryInput directoryInput -&gt;</span><br><span class=\"line\">                //</span><br><span class=\"line\">                TraceInject.injectDirCode(directoryInput.file.absolutePath, project)</span><br><span class=\"line\">                def dest = outputProvider.getContentLocation(</span><br><span class=\"line\">                        directoryInput.name,</span><br><span class=\"line\">                        directoryInput.contentTypes,</span><br><span class=\"line\">                        directoryInput.scopes,</span><br><span class=\"line\">                        Format.DIRECTORY)</span><br><span class=\"line\">                FileUtils.copyDirectory(directoryInput.file, dest)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            //jar jar,out .</span><br><span class=\"line\">            input.jarInputs.each &#123; JarInput jarInput -&gt;</span><br><span class=\"line\">                def jarName = jarInput.name</span><br><span class=\"line\">                def md5Name = DigestUtils.md5Hex(jarInput.file.getAbsolutePath())</span><br><span class=\"line\">                if (jarName.endsWith(\".jar\")) &#123;</span><br><span class=\"line\">                    jarName = jarName.substring(0, jarName.length() - 4)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                def dest = outputProvider.getContentLocation(</span><br><span class=\"line\">                        jarName + md5Name,</span><br><span class=\"line\">                        jarInput.contentTypes,</span><br><span class=\"line\">                        jarInput.scopes,</span><br><span class=\"line\">                        Format.JAR)</span><br><span class=\"line\">                FileUtils.copyFile(jarInput.file, dest)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> Log  class  dex ,Tranfrom  Task dex, AspectJ  Task .</p>\n<h6 id=\"TraceInject--Log\"><a href=\"#TraceInject--Log\" class=\"headerlink\" title=\"TraceInject  Log\"></a>TraceInject  Log</h6><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TraceInject</span> &#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> String TAG = <span class=\"string\">\"Trace\"</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> ClassPool POOL = ClassPool.getDefault()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> injectDirCode(String path, Project project) &#123;</span><br><span class=\"line\">        POOL.appendClassPath(path)</span><br><span class=\"line\">        <span class=\"comment\">// Android SDK </span></span><br><span class=\"line\">        POOL.appendClassPath(project.android.bootClasspath[<span class=\"number\">0</span>].toString())</span><br><span class=\"line\">        File dir = <span class=\"keyword\">new</span> File(path)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dir.isDirectory()) &#123;</span><br><span class=\"line\">            dir.eachFileRecurse &#123; File file -&gt;</span><br><span class=\"line\">                String filePath = file.absolutePath</span><br><span class=\"line\">                <span class=\"comment\">//class</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (filePath.endsWith(<span class=\"string\">\".class\"</span>)</span><br><span class=\"line\">                        &amp;&amp; !filePath.contains(<span class=\"string\">'R$'</span>)</span><br><span class=\"line\">                        &amp;&amp; !filePath.contains(<span class=\"string\">'R.class'</span>)</span><br><span class=\"line\">                        &amp;&amp; !filePath.contains(<span class=\"string\">\"BuildConfig.class\"</span>)) &#123;</span><br><span class=\"line\">                    modifyClass(project, path, filePath)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> modifyClass(Project project, String path, String filePath) &#123;</span><br><span class=\"line\">        String classPath</span><br><span class=\"line\">        <span class=\"keyword\">def</span> packageName = project.Trace.packageName</span><br><span class=\"line\">        filePath = filePath.replace(<span class=\"string\">\"/\"</span>, <span class=\"string\">\".\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (classExcludes(project, filePath)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (packageExcludes(project, filePath)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (filePath.contains(packageName)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> index = filePath.indexOf(packageName)</span><br><span class=\"line\">            classPath = filePath.substring(index, filePath.length())</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            println(<span class=\"string\">\"project can not inject\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        String className = classPath.substring(<span class=\"number\">0</span>, classPath.length() - <span class=\"number\">6</span>)</span><br><span class=\"line\">                .replace(<span class=\"string\">'/'</span>, <span class=\"string\">'.'</span>)</span><br><span class=\"line\">                .replace(<span class=\"string\">'/'</span>, <span class=\"string\">'.'</span>)</span><br><span class=\"line\">        CtClass c = POOL.getCtClass(className)</span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c.isFrozen()) &#123;</span><br><span class=\"line\">            c.defrost()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        CtMethod[] methods = c.getDeclaredMethods()</span><br><span class=\"line\">        <span class=\"keyword\">int</span> i = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (CtMethod <span class=\"string\">method :</span> methods) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// native </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (method.isEmpty() || Modifier.isNative(method.getModifiers())) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            i++</span><br><span class=\"line\">            insertTime(project.Trace.logLevel, className.replace(packageName + <span class=\"string\">\".\"</span>, <span class=\"string\">\"\"</span>), method)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        c.writeFile(path)</span><br><span class=\"line\">        c.detach()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> insertTime(String logLevel, String className, CtMethod method) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> pos = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            CodeAttribute codeAttribute = method.getMethodInfo().getCodeAttribute()</span><br><span class=\"line\">            LocalVariableAttribute attribute = (LocalVariableAttribute) codeAttribute.getAttribute(LocalVariableAttribute.tag)</span><br><span class=\"line\">            <span class=\"keyword\">int</span> size = method.getParameterTypes().length</span><br><span class=\"line\">            String[] paramTypes = <span class=\"keyword\">new</span> String[size]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (attribute == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                paramTypes[i] = method.getParameterTypes()[i].name</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">def</span> stringType = POOL.getCtClass(<span class=\"string\">\"java.lang.String\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">def</span> objType = POOL.getCtClass(<span class=\"string\">\"java.lang.Object\"</span>)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"startTime\"</span>, CtClass.longType)</span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"endTime\"</span>, CtClass.longType)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"className\"</span>, stringType)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"methodName\"</span>, stringType)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"lineNumber\"</span>, CtClass.intType)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"returnObj\"</span>, objType)</span><br><span class=\"line\"></span><br><span class=\"line\">            StringBuilder startInjectSB = <span class=\"keyword\">new</span> StringBuilder()</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//*** </span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Log</span></span><br><span class=\"line\">            method.insertBefore(startInjectSB.toString())</span><br><span class=\"line\"></span><br><span class=\"line\">            StringBuilder endInjectSB = <span class=\"keyword\">new</span> StringBuilder()</span><br><span class=\"line\">            <span class=\"comment\">//*** </span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// return  Log</span></span><br><span class=\"line\">            method.insertAfter(endInjectSB.toString())</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Javassit ,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> gradle</span><br><span class=\"line\"><span class=\"keyword\">classpath</span> <span class=\"string\">'cn.libery.analysis:trace:1.0.1'</span> </span><br><span class=\"line\">module gradle</span><br><span class=\"line\">apply plugin: <span class=\"string\">'analysis-trace'</span> </span><br><span class=\"line\">Trace &#123;</span><br><span class=\"line\">        <span class=\"comment\">//   clean </span></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        enabled <span class=\"keyword\">true</span></span><br><span class=\"line\">        <span class=\"comment\">//( applicationId)</span></span><br><span class=\"line\">        packageName <span class=\"string\">\"cn.libery.analysis.sample\"</span></span><br><span class=\"line\">        <span class=\"comment\">//  Logcat </span></span><br><span class=\"line\">        logLevel <span class=\"string\">\"i\"</span></span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        classExcludes = [<span class=\"string\">\"cn.libery.analysis.sample.Logger\"</span>,</span><br><span class=\"line\">                        <span class=\"string\">\"cn.libery.analysis.sample.Logger2\"</span>]</span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        packageExcludes = [<span class=\"string\">\"cn.libery.analysis.sample.test\"</span>]</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p> Github  sample <br><a href=\"https://github.com/Thewhitelight/Analysis\">Github</a><br> <a href=\"https://bintray.com/light/Android/trace/_latestVersion\" target=\"_blank\" rel=\"noopener\"> <img src=\"https://api.bintray.com/packages/light/Android/trace/images/download.svg\" alt=\"Download\"> </a></p>\n<p><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/ic_analysis_trace.png\" alt=\"\"><br>-&gt; <br>&lt;- </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx\"> AspectJ</a><br><a href=\"https://www.jianshu.com/p/43424242846b\" target=\"_blank\" rel=\"noopener\">Javassist </a><br><a href=\"https://www.jianshu.com/p/44d39585fc20\" target=\"_blank\" rel=\"noopener\">AspectJ  Javassist </a><br><a href=\"https://www.mekau.com/4880.html\" target=\"_blank\" rel=\"noopener\">AspectJ </a><br><a href=\"https://github.com/JakeWharton/hugo\">hugo</a><br><a href=\"https://stackoverflow.com/questions/44364633/aspectj-doesnt-work-with-kotlin\" target=\"_blank\" rel=\"noopener\">AspectJ  Kotlin</a></p>\n","site":{"data":{}},"excerpt":"<p>,,.,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ol>\n<li></li>\n<li></li>\n<li></li>\n<li>","more":"</li>\n</ol>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Javassist .</p>\n<h5 id=\"AspectJ\"><a href=\"#AspectJ\" class=\"headerlink\" title=\"AspectJ\"></a>AspectJ</h5><p> JakeWharton  hugo , AspectJ  Log .,,.<code>@Pointcut(&quot;execution(* &quot; + BuildConfig.PACKAGE_NAME + &quot;..*.*(..))  BuildConfig.PACKAGE_NAME </code> ,,,,. hugo .<a href=\"https://github.com/Thewhitelight/Analysis\">Github</a>  AspectJ , Kotlin.<br>Aspectj , AOP , Kotlin , AspectJ ,,.</p>\n<h5 id=\"Javassist\"><a href=\"#Javassist\" class=\"headerlink\" title=\"Javassist\"></a>Javassist</h5><p>Javassist  Java   . ASM , cglib ,.<br> gradle plugin ,.,.</p>\n<h6 id=\"TraceExtension--plugin-\"><a href=\"#TraceExtension--plugin-\" class=\"headerlink\" title=\"TraceExtension  plugin \"></a>TraceExtension  plugin </h6><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TraceExtension</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    List&lt;String&gt; classExcludes = <span class=\"keyword\">new</span> ArrayList&lt;&gt;()</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    List&lt;String&gt; packageExcludes = <span class=\"keyword\">new</span> ArrayList&lt;&gt;()</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> enabled = <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">//,applicationId</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> packageName</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> logLevel = <span class=\"string\">\"d\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>TraceExtension ,.</p>\n<h6 id=\"Trace\"><a href=\"#Trace\" class=\"headerlink\" title=\"Trace\"></a>Trace</h6><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Trace</span> <span class=\"keyword\">implements</span> <span class=\"title\">Plugin</span>&lt;<span class=\"title\">Project</span>&gt; &#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> apply(Project project) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">def</span> hasApp = project.plugins.withType(AppPlugin)</span><br><span class=\"line\">        <span class=\"keyword\">def</span> hasLib = project.plugins.withType(LibraryPlugin)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!hasApp &amp;&amp; !hasLib) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">\"'android' or 'android-library' plugin required.\"</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">def</span> variants</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (hasApp) &#123;</span><br><span class=\"line\">            variants = project.android.applicationVariants</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            variants = project.android.libraryVariants</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">def</span> log = project.logger</span><br><span class=\"line\">        variants.all &#123; variant -&gt;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!variant.buildType.isDebuggable()) &#123;</span><br><span class=\"line\">                log.debug(<span class=\"string\">\"Skipping non-debuggable build type '$&#123;variant.buildType.name&#125;'.\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!project.Trace.enabled) &#123;</span><br><span class=\"line\">                log.debug(<span class=\"string\">\"Trace is not disabled.\"</span>)</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        project.extensions.create(<span class=\"string\">'Trace'</span>, TraceExtension)</span><br><span class=\"line\"></span><br><span class=\"line\">        println(<span class=\"string\">\"=== Trace Plugin ===\"</span>)</span><br><span class=\"line\">        <span class=\"keyword\">def</span> android = project.extensions.findByType(AppExtension)</span><br><span class=\"line\">        <span class=\"comment\">// Transform,</span></span><br><span class=\"line\">        android.registerTransform(<span class=\"keyword\">new</span> TraceTransform(project))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Trace , release  Log .</p>\n<h6 id=\"TraceTransform\"><a href=\"#TraceTransform\" class=\"headerlink\" title=\"TraceTransform\"></a>TraceTransform</h6><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TraceTransform</span> <span class=\"keyword\">extends</span> <span class=\"title\">Transform</span> &#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Project project</span><br><span class=\"line\"></span><br><span class=\"line\">    TraceTransform(Project project) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.project = project</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    String getName() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"TraceTransform\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    Set&lt;QualifiedContent.ContentType&gt; getInputTypes() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> TransformManager.CONTENT_CLASS</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    Set&lt;? super QualifiedContent.Scope&gt; getScopes() &#123;</span><br><span class=\"line\">        // </span><br><span class=\"line\">        return TransformManager.SCOPE_FULL_PROJECT</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    boolean isIncremental() &#123;</span><br><span class=\"line\">        return false</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    void transform(TransformInvocation transformInvocation) throws TransformException, InterruptedException, IOException &#123;</span><br><span class=\"line\">        super.transform(transformInvocation)</span><br><span class=\"line\">        if (!project.Trace.enabled) &#123;</span><br><span class=\"line\">            return</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        def outputProvider = transformInvocation.outputProvider</span><br><span class=\"line\"></span><br><span class=\"line\">        transformInvocation.inputs.each &#123; TransformInput input -&gt;</span><br><span class=\"line\">            //</span><br><span class=\"line\">            input.directoryInputs.each &#123; DirectoryInput directoryInput -&gt;</span><br><span class=\"line\">                //</span><br><span class=\"line\">                TraceInject.injectDirCode(directoryInput.file.absolutePath, project)</span><br><span class=\"line\">                def dest = outputProvider.getContentLocation(</span><br><span class=\"line\">                        directoryInput.name,</span><br><span class=\"line\">                        directoryInput.contentTypes,</span><br><span class=\"line\">                        directoryInput.scopes,</span><br><span class=\"line\">                        Format.DIRECTORY)</span><br><span class=\"line\">                FileUtils.copyDirectory(directoryInput.file, dest)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            //jar jar,out .</span><br><span class=\"line\">            input.jarInputs.each &#123; JarInput jarInput -&gt;</span><br><span class=\"line\">                def jarName = jarInput.name</span><br><span class=\"line\">                def md5Name = DigestUtils.md5Hex(jarInput.file.getAbsolutePath())</span><br><span class=\"line\">                if (jarName.endsWith(\".jar\")) &#123;</span><br><span class=\"line\">                    jarName = jarName.substring(0, jarName.length() - 4)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                def dest = outputProvider.getContentLocation(</span><br><span class=\"line\">                        jarName + md5Name,</span><br><span class=\"line\">                        jarInput.contentTypes,</span><br><span class=\"line\">                        jarInput.scopes,</span><br><span class=\"line\">                        Format.JAR)</span><br><span class=\"line\">                FileUtils.copyFile(jarInput.file, dest)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> Log  class  dex ,Tranfrom  Task dex, AspectJ  Task .</p>\n<h6 id=\"TraceInject--Log\"><a href=\"#TraceInject--Log\" class=\"headerlink\" title=\"TraceInject  Log\"></a>TraceInject  Log</h6><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TraceInject</span> &#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> String TAG = <span class=\"string\">\"Trace\"</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> ClassPool POOL = ClassPool.getDefault()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> injectDirCode(String path, Project project) &#123;</span><br><span class=\"line\">        POOL.appendClassPath(path)</span><br><span class=\"line\">        <span class=\"comment\">// Android SDK </span></span><br><span class=\"line\">        POOL.appendClassPath(project.android.bootClasspath[<span class=\"number\">0</span>].toString())</span><br><span class=\"line\">        File dir = <span class=\"keyword\">new</span> File(path)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dir.isDirectory()) &#123;</span><br><span class=\"line\">            dir.eachFileRecurse &#123; File file -&gt;</span><br><span class=\"line\">                String filePath = file.absolutePath</span><br><span class=\"line\">                <span class=\"comment\">//class</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (filePath.endsWith(<span class=\"string\">\".class\"</span>)</span><br><span class=\"line\">                        &amp;&amp; !filePath.contains(<span class=\"string\">'R$'</span>)</span><br><span class=\"line\">                        &amp;&amp; !filePath.contains(<span class=\"string\">'R.class'</span>)</span><br><span class=\"line\">                        &amp;&amp; !filePath.contains(<span class=\"string\">\"BuildConfig.class\"</span>)) &#123;</span><br><span class=\"line\">                    modifyClass(project, path, filePath)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> modifyClass(Project project, String path, String filePath) &#123;</span><br><span class=\"line\">        String classPath</span><br><span class=\"line\">        <span class=\"keyword\">def</span> packageName = project.Trace.packageName</span><br><span class=\"line\">        filePath = filePath.replace(<span class=\"string\">\"/\"</span>, <span class=\"string\">\".\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (classExcludes(project, filePath)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (packageExcludes(project, filePath)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (filePath.contains(packageName)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> index = filePath.indexOf(packageName)</span><br><span class=\"line\">            classPath = filePath.substring(index, filePath.length())</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            println(<span class=\"string\">\"project can not inject\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        String className = classPath.substring(<span class=\"number\">0</span>, classPath.length() - <span class=\"number\">6</span>)</span><br><span class=\"line\">                .replace(<span class=\"string\">'/'</span>, <span class=\"string\">'.'</span>)</span><br><span class=\"line\">                .replace(<span class=\"string\">'/'</span>, <span class=\"string\">'.'</span>)</span><br><span class=\"line\">        CtClass c = POOL.getCtClass(className)</span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (c.isFrozen()) &#123;</span><br><span class=\"line\">            c.defrost()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        CtMethod[] methods = c.getDeclaredMethods()</span><br><span class=\"line\">        <span class=\"keyword\">int</span> i = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (CtMethod <span class=\"string\">method :</span> methods) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// native </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (method.isEmpty() || Modifier.isNative(method.getModifiers())) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            i++</span><br><span class=\"line\">            insertTime(project.Trace.logLevel, className.replace(packageName + <span class=\"string\">\".\"</span>, <span class=\"string\">\"\"</span>), method)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        c.writeFile(path)</span><br><span class=\"line\">        c.detach()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> insertTime(String logLevel, String className, CtMethod method) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> pos = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">            CodeAttribute codeAttribute = method.getMethodInfo().getCodeAttribute()</span><br><span class=\"line\">            LocalVariableAttribute attribute = (LocalVariableAttribute) codeAttribute.getAttribute(LocalVariableAttribute.tag)</span><br><span class=\"line\">            <span class=\"keyword\">int</span> size = method.getParameterTypes().length</span><br><span class=\"line\">            String[] paramTypes = <span class=\"keyword\">new</span> String[size]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (attribute == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                paramTypes[i] = method.getParameterTypes()[i].name</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">def</span> stringType = POOL.getCtClass(<span class=\"string\">\"java.lang.String\"</span>)</span><br><span class=\"line\">            <span class=\"keyword\">def</span> objType = POOL.getCtClass(<span class=\"string\">\"java.lang.Object\"</span>)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"startTime\"</span>, CtClass.longType)</span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"endTime\"</span>, CtClass.longType)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"className\"</span>, stringType)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"methodName\"</span>, stringType)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"lineNumber\"</span>, CtClass.intType)</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            method.addLocalVariable(<span class=\"string\">\"returnObj\"</span>, objType)</span><br><span class=\"line\"></span><br><span class=\"line\">            StringBuilder startInjectSB = <span class=\"keyword\">new</span> StringBuilder()</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//*** </span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// Log</span></span><br><span class=\"line\">            method.insertBefore(startInjectSB.toString())</span><br><span class=\"line\"></span><br><span class=\"line\">            StringBuilder endInjectSB = <span class=\"keyword\">new</span> StringBuilder()</span><br><span class=\"line\">            <span class=\"comment\">//*** </span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// return  Log</span></span><br><span class=\"line\">            method.insertAfter(endInjectSB.toString())</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Javassit ,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> gradle</span><br><span class=\"line\"><span class=\"keyword\">classpath</span> <span class=\"string\">'cn.libery.analysis:trace:1.0.1'</span> </span><br><span class=\"line\">module gradle</span><br><span class=\"line\">apply plugin: <span class=\"string\">'analysis-trace'</span> </span><br><span class=\"line\">Trace &#123;</span><br><span class=\"line\">        <span class=\"comment\">//   clean </span></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        enabled <span class=\"keyword\">true</span></span><br><span class=\"line\">        <span class=\"comment\">//( applicationId)</span></span><br><span class=\"line\">        packageName <span class=\"string\">\"cn.libery.analysis.sample\"</span></span><br><span class=\"line\">        <span class=\"comment\">//  Logcat </span></span><br><span class=\"line\">        logLevel <span class=\"string\">\"i\"</span></span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        classExcludes = [<span class=\"string\">\"cn.libery.analysis.sample.Logger\"</span>,</span><br><span class=\"line\">                        <span class=\"string\">\"cn.libery.analysis.sample.Logger2\"</span>]</span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        packageExcludes = [<span class=\"string\">\"cn.libery.analysis.sample.test\"</span>]</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p> Github  sample <br><a href=\"https://github.com/Thewhitelight/Analysis\">Github</a><br> <a href=\"https://bintray.com/light/Android/trace/_latestVersion\" target=\"_blank\" rel=\"noopener\"> <img src=\"https://api.bintray.com/packages/light/Android/trace/images/download.svg\" alt=\"Download\"> </a></p>\n<p><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/ic_analysis_trace.png\" alt=\"\"><br>-&gt; <br>&lt;- </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx\"> AspectJ</a><br><a href=\"https://www.jianshu.com/p/43424242846b\" target=\"_blank\" rel=\"noopener\">Javassist </a><br><a href=\"https://www.jianshu.com/p/44d39585fc20\" target=\"_blank\" rel=\"noopener\">AspectJ  Javassist </a><br><a href=\"https://www.mekau.com/4880.html\" target=\"_blank\" rel=\"noopener\">AspectJ </a><br><a href=\"https://github.com/JakeWharton/hugo\">hugo</a><br><a href=\"https://stackoverflow.com/questions/44364633/aspectj-doesnt-work-with-kotlin\" target=\"_blank\" rel=\"noopener\">AspectJ  Kotlin</a></p>"},{"title":"","date":"2018-08-09T13:47:26.000Z","_content":"\n,.,,.,,,.,.\n\n#### \n\n205,2010,205,2021(,),20,30,60,200,,,..\n\n#### \n\n,,,=-(,)-.,for,.,,,105,108,108,58,58,.\n\n<!-- more -->\n\n#### \n\n\n``` java\npublic class Coupon {\n    /**\n     * id\n     */\n    public String id;\n    /**\n     * \n     */\n    public double spending;\n    /**\n     *  0\n     */\n    public int every;\n    /**\n     * \n     */\n    public double discount;\n}\n\npublic class Booking {\n    /**\n     * Id\n     */\n    public String id;\n    /**\n     * \n     */\n    public double amount;\n}\n\npublic class BestCombination {\n    /**\n     * \n     */\n    public double bookingAmount;\n    /**\n     * \n     */\n    public double couponAmount;\n    /**\n     * \n     */\n    public Booking booking;\n    /**\n     * \n     */\n    public Coupon coupon;\n\n    public BestCombination(Booking booking, Coupon coupon, double bookingAmount, double couponAmount) {\n        this.booking = booking;\n        this.coupon = coupon;\n        this.bookingAmount = bookingAmount;\n        this.couponAmount = couponAmount;\n    }\n}\n```\n\n``` java\nprivate List<Coupon> initCoupon(double totalPrice, List<Coupon> coupons) {\n        List<Coupon> result = new ArrayList<>();\n        if (coupons.size() > 0) {\n            for (Coupon b : coupons) {\n                //\n                if (b.spending <= totalPrice) {\n                    result.add(b);\n                }\n            }\n        }\n\n        //\n        Collections.sort(result, new Comparator<Coupon>() {\n            @Override\n            public int compare(Coupon o1, Coupon o2) {\n                //\n                int compareEvery = Integer.compare(o2.every, o1.every);\n                if (compareEvery == 0) {\n                    //,\n                    int compareSpending = Double.compare(o1.spending, o2.spending);\n                    if (compareSpending == 0) {\n                        return Double.compare(o1.discount, o2.discount);\n                    } else {\n                        return compareSpending;\n                    }\n                } else {\n                    return compareEvery;\n                }\n            }\n        });\n\n        //,\n        Coupon emptyCoupon = new Coupon();\n        emptyCoupon.discount = 0;\n        emptyCoupon.spending = 0;\n        emptyCoupon.id = \"-1\";\n        emptyCoupon.every = 0;\n        result.add(emptyCoupon);\n        return result;\n    }\n\n    //\n    private List<Booking> initBooking(List<Booking> bookings) {\n        List<Booking> result = new ArrayList<>();\n        if (bookings.size() > 0) {\n            result.addAll(bookings);\n        }\n\n        Booking emptyBooking = new Booking();\n        emptyBooking.amount = 0;\n        emptyBooking.id = \"-1\";\n        result.add(emptyBooking);\n        return result;\n    }\n\n```\n\n``` java\n  /**\n     * \n     *\n     * @param totalPrice \n     * @param coupons    \n     * @param bookings   \n     * @return \n     */\n    public static BestCombination calculatorBestCombination(double totalPrice, List<Coupon> coupons, List<Booking> bookings) {\n        //TreeMapkey,,key\n        SortedMap<Double, BestCombination> map = new TreeMap<>();\n        double couponPrice;\n\n        for (Coupon c : coupons) {\n            for (Booking b : bookings) {\n                double tempPrice = totalPrice;\n                if (c.every == 1) {\n                    // *\n                    couponPrice = Math.floor(tempPrice / c.spending) * c.discount;\n                } else {\n                    couponPrice = c.discount;\n                }\n                //-\n                tempPrice = tempPrice - couponPrice;\n\n                //\n                tempPrice = tempPrice - b.amount;\n                //\n                if (!(tempPrice < 0 && b.amount > 0)) {\n                    if (map.containsKey(tempPrice)) {\n                        //,()\n                        BestCombination best = map.get(tempPrice);\n                        if (best.bookingAmount >= b.amount) {\n                            map.put(tempPrice, new BestCombination(b, c, b.amount, couponPrice));\n                        }\n                    } else {\n                        map.put(tempPrice, new BestCombination(b, c, b.amount, couponPrice));\n                    }\n                }\n\n            }\n        }\n        BestCombination bestCombination;\n        if (map.size() <= 0) {\n            //\n            bestCombination = null;\n        } else {\n            if (map.firstKey() >= 0) {\n                //\n                bestCombination = map.get(map.firstKey());\n            } else {\n                double key = 0;\n                for (Map.Entry<Double, BestCombination> e : map.entrySet()) {\n                    System.out.println(e.getKey() + \" \" + e.getValue().toString());\n                    if (e.getValue().booking.amount > 0) {\n                        if (e.getKey() >= 0) {\n                            break;\n                        } else {\n                            //1020 \n                            key = e.getKey();\n                        }\n                    } else {\n                        if (e.getKey() > 0) {\n                            break;\n                        } else {\n                            //0 \n                            key = e.getKey();\n                        }\n                    }\n                }\n                bestCombination = map.get(key);\n            }\n        }\n        return bestCombination;\n    }\n```\n,.***[](https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/BestOfferTest.java)***.","source":"_posts/best-price-calculation.md","raw":"---\ntitle: \ndate: 2018-08-09 21:47:26\ntags:\n    - \ncategories: \n---\n\n,.,,.,,,.,.\n\n#### \n\n205,2010,205,2021(,),20,30,60,200,,,..\n\n#### \n\n,,,=-(,)-.,for,.,,,105,108,108,58,58,.\n\n<!-- more -->\n\n#### \n\n\n``` java\npublic class Coupon {\n    /**\n     * id\n     */\n    public String id;\n    /**\n     * \n     */\n    public double spending;\n    /**\n     *  0\n     */\n    public int every;\n    /**\n     * \n     */\n    public double discount;\n}\n\npublic class Booking {\n    /**\n     * Id\n     */\n    public String id;\n    /**\n     * \n     */\n    public double amount;\n}\n\npublic class BestCombination {\n    /**\n     * \n     */\n    public double bookingAmount;\n    /**\n     * \n     */\n    public double couponAmount;\n    /**\n     * \n     */\n    public Booking booking;\n    /**\n     * \n     */\n    public Coupon coupon;\n\n    public BestCombination(Booking booking, Coupon coupon, double bookingAmount, double couponAmount) {\n        this.booking = booking;\n        this.coupon = coupon;\n        this.bookingAmount = bookingAmount;\n        this.couponAmount = couponAmount;\n    }\n}\n```\n\n``` java\nprivate List<Coupon> initCoupon(double totalPrice, List<Coupon> coupons) {\n        List<Coupon> result = new ArrayList<>();\n        if (coupons.size() > 0) {\n            for (Coupon b : coupons) {\n                //\n                if (b.spending <= totalPrice) {\n                    result.add(b);\n                }\n            }\n        }\n\n        //\n        Collections.sort(result, new Comparator<Coupon>() {\n            @Override\n            public int compare(Coupon o1, Coupon o2) {\n                //\n                int compareEvery = Integer.compare(o2.every, o1.every);\n                if (compareEvery == 0) {\n                    //,\n                    int compareSpending = Double.compare(o1.spending, o2.spending);\n                    if (compareSpending == 0) {\n                        return Double.compare(o1.discount, o2.discount);\n                    } else {\n                        return compareSpending;\n                    }\n                } else {\n                    return compareEvery;\n                }\n            }\n        });\n\n        //,\n        Coupon emptyCoupon = new Coupon();\n        emptyCoupon.discount = 0;\n        emptyCoupon.spending = 0;\n        emptyCoupon.id = \"-1\";\n        emptyCoupon.every = 0;\n        result.add(emptyCoupon);\n        return result;\n    }\n\n    //\n    private List<Booking> initBooking(List<Booking> bookings) {\n        List<Booking> result = new ArrayList<>();\n        if (bookings.size() > 0) {\n            result.addAll(bookings);\n        }\n\n        Booking emptyBooking = new Booking();\n        emptyBooking.amount = 0;\n        emptyBooking.id = \"-1\";\n        result.add(emptyBooking);\n        return result;\n    }\n\n```\n\n``` java\n  /**\n     * \n     *\n     * @param totalPrice \n     * @param coupons    \n     * @param bookings   \n     * @return \n     */\n    public static BestCombination calculatorBestCombination(double totalPrice, List<Coupon> coupons, List<Booking> bookings) {\n        //TreeMapkey,,key\n        SortedMap<Double, BestCombination> map = new TreeMap<>();\n        double couponPrice;\n\n        for (Coupon c : coupons) {\n            for (Booking b : bookings) {\n                double tempPrice = totalPrice;\n                if (c.every == 1) {\n                    // *\n                    couponPrice = Math.floor(tempPrice / c.spending) * c.discount;\n                } else {\n                    couponPrice = c.discount;\n                }\n                //-\n                tempPrice = tempPrice - couponPrice;\n\n                //\n                tempPrice = tempPrice - b.amount;\n                //\n                if (!(tempPrice < 0 && b.amount > 0)) {\n                    if (map.containsKey(tempPrice)) {\n                        //,()\n                        BestCombination best = map.get(tempPrice);\n                        if (best.bookingAmount >= b.amount) {\n                            map.put(tempPrice, new BestCombination(b, c, b.amount, couponPrice));\n                        }\n                    } else {\n                        map.put(tempPrice, new BestCombination(b, c, b.amount, couponPrice));\n                    }\n                }\n\n            }\n        }\n        BestCombination bestCombination;\n        if (map.size() <= 0) {\n            //\n            bestCombination = null;\n        } else {\n            if (map.firstKey() >= 0) {\n                //\n                bestCombination = map.get(map.firstKey());\n            } else {\n                double key = 0;\n                for (Map.Entry<Double, BestCombination> e : map.entrySet()) {\n                    System.out.println(e.getKey() + \" \" + e.getValue().toString());\n                    if (e.getValue().booking.amount > 0) {\n                        if (e.getKey() >= 0) {\n                            break;\n                        } else {\n                            //1020 \n                            key = e.getKey();\n                        }\n                    } else {\n                        if (e.getKey() > 0) {\n                            break;\n                        } else {\n                            //0 \n                            key = e.getKey();\n                        }\n                    }\n                }\n                bestCombination = map.get(key);\n            }\n        }\n        return bestCombination;\n    }\n```\n,.***[](https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/BestOfferTest.java)***.","slug":"best-price-calculation","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsa5000lndf2zyenemr7","content":"<p>,.,,.,,,.,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>205,2010,205,2021(,),20,30,60,200,,,..</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>,,,=-(,)-.,for,.,,,105,108,108,58,58,.</p>\n<a id=\"more\"></a>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Coupon</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String id;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> spending;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  0</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">int</span> every;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> discount;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Booking</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String id;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> amount;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BestCombination</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> bookingAmount;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> couponAmount;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Booking booking;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Coupon coupon;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">BestCombination</span><span class=\"params\">(Booking booking, Coupon coupon, <span class=\"keyword\">double</span> bookingAmount, <span class=\"keyword\">double</span> couponAmount)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.booking = booking;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.coupon = coupon;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.bookingAmount = bookingAmount;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.couponAmount = couponAmount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> List&lt;Coupon&gt; <span class=\"title\">initCoupon</span><span class=\"params\">(<span class=\"keyword\">double</span> totalPrice, List&lt;Coupon&gt; coupons)</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Coupon&gt; result = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (coupons.size() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Coupon b : coupons) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (b.spending &lt;= totalPrice) &#123;</span><br><span class=\"line\">                    result.add(b);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        Collections.sort(result, <span class=\"keyword\">new</span> Comparator&lt;Coupon&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">compare</span><span class=\"params\">(Coupon o1, Coupon o2)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">int</span> compareEvery = Integer.compare(o2.every, o1.every);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (compareEvery == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//,</span></span><br><span class=\"line\">                    <span class=\"keyword\">int</span> compareSpending = Double.compare(o1.spending, o2.spending);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (compareSpending == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> Double.compare(o1.discount, o2.discount);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> compareSpending;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> compareEvery;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        Coupon emptyCoupon = <span class=\"keyword\">new</span> Coupon();</span><br><span class=\"line\">        emptyCoupon.discount = <span class=\"number\">0</span>;</span><br><span class=\"line\">        emptyCoupon.spending = <span class=\"number\">0</span>;</span><br><span class=\"line\">        emptyCoupon.id = <span class=\"string\">\"-1\"</span>;</span><br><span class=\"line\">        emptyCoupon.every = <span class=\"number\">0</span>;</span><br><span class=\"line\">        result.add(emptyCoupon);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;Booking&gt; <span class=\"title\">initBooking</span><span class=\"params\">(List&lt;Booking&gt; bookings)</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Booking&gt; result = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bookings.size() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            result.addAll(bookings);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        Booking emptyBooking = <span class=\"keyword\">new</span> Booking();</span><br><span class=\"line\">        emptyBooking.amount = <span class=\"number\">0</span>;</span><br><span class=\"line\">        emptyBooking.id = <span class=\"string\">\"-1\"</span>;</span><br><span class=\"line\">        result.add(emptyBooking);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> totalPrice </span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> coupons    </span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> bookings   </span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> BestCombination <span class=\"title\">calculatorBestCombination</span><span class=\"params\">(<span class=\"keyword\">double</span> totalPrice, List&lt;Coupon&gt; coupons, List&lt;Booking&gt; bookings)</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//TreeMapkey,,key</span></span><br><span class=\"line\">      SortedMap&lt;Double, BestCombination&gt; map = <span class=\"keyword\">new</span> TreeMap&lt;&gt;();</span><br><span class=\"line\">      <span class=\"keyword\">double</span> couponPrice;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Coupon c : coupons) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">for</span> (Booking b : bookings) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">double</span> tempPrice = totalPrice;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (c.every == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                  <span class=\"comment\">// *</span></span><br><span class=\"line\">                  couponPrice = Math.floor(tempPrice / c.spending) * c.discount;</span><br><span class=\"line\">              &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                  couponPrice = c.discount;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              <span class=\"comment\">//-</span></span><br><span class=\"line\">              tempPrice = tempPrice - couponPrice;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"comment\">//</span></span><br><span class=\"line\">              tempPrice = tempPrice - b.amount;</span><br><span class=\"line\">              <span class=\"comment\">//</span></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (!(tempPrice &lt; <span class=\"number\">0</span> &amp;&amp; b.amount &gt; <span class=\"number\">0</span>)) &#123;</span><br><span class=\"line\">                  <span class=\"keyword\">if</span> (map.containsKey(tempPrice)) &#123;</span><br><span class=\"line\">                      <span class=\"comment\">//,()</span></span><br><span class=\"line\">                      BestCombination best = map.get(tempPrice);</span><br><span class=\"line\">                      <span class=\"keyword\">if</span> (best.bookingAmount &gt;= b.amount) &#123;</span><br><span class=\"line\">                          map.put(tempPrice, <span class=\"keyword\">new</span> BestCombination(b, c, b.amount, couponPrice));</span><br><span class=\"line\">                      &#125;</span><br><span class=\"line\">                  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                      map.put(tempPrice, <span class=\"keyword\">new</span> BestCombination(b, c, b.amount, couponPrice));</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      BestCombination bestCombination;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (map.size() &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//</span></span><br><span class=\"line\">          bestCombination = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (map.firstKey() &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">              <span class=\"comment\">//</span></span><br><span class=\"line\">              bestCombination = map.get(map.firstKey());</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              <span class=\"keyword\">double</span> key = <span class=\"number\">0</span>;</span><br><span class=\"line\">              <span class=\"keyword\">for</span> (Map.Entry&lt;Double, BestCombination&gt; e : map.entrySet()) &#123;</span><br><span class=\"line\">                  System.out.println(e.getKey() + <span class=\"string\">\" \"</span> + e.getValue().toString());</span><br><span class=\"line\">                  <span class=\"keyword\">if</span> (e.getValue().booking.amount &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                      <span class=\"keyword\">if</span> (e.getKey() &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                          <span class=\"comment\">//1020 </span></span><br><span class=\"line\">                          key = e.getKey();</span><br><span class=\"line\">                      &#125;</span><br><span class=\"line\">                  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                      <span class=\"keyword\">if</span> (e.getKey() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                          <span class=\"comment\">//0 </span></span><br><span class=\"line\">                          key = e.getKey();</span><br><span class=\"line\">                      &#125;</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              bestCombination = map.get(key);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> bestCombination;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>\n<p>,.<strong><em><a href=\"https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/BestOfferTest.java\"></a></em></strong>.</p>\n","site":{"data":{}},"excerpt":"<p>,.,,.,,,.,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>205,2010,205,2021(,),20,30,60,200,,,..</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>,,,=-(,)-.,for,.,,,105,108,108,58,58,.</p>","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Coupon</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String id;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> spending;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *  0</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">int</span> every;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> discount;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Booking</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String id;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> amount;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BestCombination</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> bookingAmount;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> couponAmount;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Booking booking;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Coupon coupon;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">BestCombination</span><span class=\"params\">(Booking booking, Coupon coupon, <span class=\"keyword\">double</span> bookingAmount, <span class=\"keyword\">double</span> couponAmount)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.booking = booking;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.coupon = coupon;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.bookingAmount = bookingAmount;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.couponAmount = couponAmount;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> List&lt;Coupon&gt; <span class=\"title\">initCoupon</span><span class=\"params\">(<span class=\"keyword\">double</span> totalPrice, List&lt;Coupon&gt; coupons)</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Coupon&gt; result = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (coupons.size() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Coupon b : coupons) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (b.spending &lt;= totalPrice) &#123;</span><br><span class=\"line\">                    result.add(b);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        Collections.sort(result, <span class=\"keyword\">new</span> Comparator&lt;Coupon&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">compare</span><span class=\"params\">(Coupon o1, Coupon o2)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">int</span> compareEvery = Integer.compare(o2.every, o1.every);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (compareEvery == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//,</span></span><br><span class=\"line\">                    <span class=\"keyword\">int</span> compareSpending = Double.compare(o1.spending, o2.spending);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (compareSpending == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> Double.compare(o1.discount, o2.discount);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> compareSpending;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> compareEvery;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        Coupon emptyCoupon = <span class=\"keyword\">new</span> Coupon();</span><br><span class=\"line\">        emptyCoupon.discount = <span class=\"number\">0</span>;</span><br><span class=\"line\">        emptyCoupon.spending = <span class=\"number\">0</span>;</span><br><span class=\"line\">        emptyCoupon.id = <span class=\"string\">\"-1\"</span>;</span><br><span class=\"line\">        emptyCoupon.every = <span class=\"number\">0</span>;</span><br><span class=\"line\">        result.add(emptyCoupon);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;Booking&gt; <span class=\"title\">initBooking</span><span class=\"params\">(List&lt;Booking&gt; bookings)</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Booking&gt; result = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bookings.size() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            result.addAll(bookings);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        Booking emptyBooking = <span class=\"keyword\">new</span> Booking();</span><br><span class=\"line\">        emptyBooking.amount = <span class=\"number\">0</span>;</span><br><span class=\"line\">        emptyBooking.id = <span class=\"string\">\"-1\"</span>;</span><br><span class=\"line\">        result.add(emptyBooking);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * </span></span><br><span class=\"line\"><span class=\"comment\">   *</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> totalPrice </span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> coupons    </span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> bookings   </span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> BestCombination <span class=\"title\">calculatorBestCombination</span><span class=\"params\">(<span class=\"keyword\">double</span> totalPrice, List&lt;Coupon&gt; coupons, List&lt;Booking&gt; bookings)</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//TreeMapkey,,key</span></span><br><span class=\"line\">      SortedMap&lt;Double, BestCombination&gt; map = <span class=\"keyword\">new</span> TreeMap&lt;&gt;();</span><br><span class=\"line\">      <span class=\"keyword\">double</span> couponPrice;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Coupon c : coupons) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">for</span> (Booking b : bookings) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">double</span> tempPrice = totalPrice;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (c.every == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                  <span class=\"comment\">// *</span></span><br><span class=\"line\">                  couponPrice = Math.floor(tempPrice / c.spending) * c.discount;</span><br><span class=\"line\">              &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                  couponPrice = c.discount;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              <span class=\"comment\">//-</span></span><br><span class=\"line\">              tempPrice = tempPrice - couponPrice;</span><br><span class=\"line\"></span><br><span class=\"line\">              <span class=\"comment\">//</span></span><br><span class=\"line\">              tempPrice = tempPrice - b.amount;</span><br><span class=\"line\">              <span class=\"comment\">//</span></span><br><span class=\"line\">              <span class=\"keyword\">if</span> (!(tempPrice &lt; <span class=\"number\">0</span> &amp;&amp; b.amount &gt; <span class=\"number\">0</span>)) &#123;</span><br><span class=\"line\">                  <span class=\"keyword\">if</span> (map.containsKey(tempPrice)) &#123;</span><br><span class=\"line\">                      <span class=\"comment\">//,()</span></span><br><span class=\"line\">                      BestCombination best = map.get(tempPrice);</span><br><span class=\"line\">                      <span class=\"keyword\">if</span> (best.bookingAmount &gt;= b.amount) &#123;</span><br><span class=\"line\">                          map.put(tempPrice, <span class=\"keyword\">new</span> BestCombination(b, c, b.amount, couponPrice));</span><br><span class=\"line\">                      &#125;</span><br><span class=\"line\">                  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                      map.put(tempPrice, <span class=\"keyword\">new</span> BestCombination(b, c, b.amount, couponPrice));</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      BestCombination bestCombination;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (map.size() &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          <span class=\"comment\">//</span></span><br><span class=\"line\">          bestCombination = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (map.firstKey() &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">              <span class=\"comment\">//</span></span><br><span class=\"line\">              bestCombination = map.get(map.firstKey());</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              <span class=\"keyword\">double</span> key = <span class=\"number\">0</span>;</span><br><span class=\"line\">              <span class=\"keyword\">for</span> (Map.Entry&lt;Double, BestCombination&gt; e : map.entrySet()) &#123;</span><br><span class=\"line\">                  System.out.println(e.getKey() + <span class=\"string\">\" \"</span> + e.getValue().toString());</span><br><span class=\"line\">                  <span class=\"keyword\">if</span> (e.getValue().booking.amount &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                      <span class=\"keyword\">if</span> (e.getKey() &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                          <span class=\"comment\">//1020 </span></span><br><span class=\"line\">                          key = e.getKey();</span><br><span class=\"line\">                      &#125;</span><br><span class=\"line\">                  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                      <span class=\"keyword\">if</span> (e.getKey() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                          <span class=\"comment\">//0 </span></span><br><span class=\"line\">                          key = e.getKey();</span><br><span class=\"line\">                      &#125;</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              bestCombination = map.get(key);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> bestCombination;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>\n<p>,.<strong><em><a href=\"https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/BestOfferTest.java\"></a></em></strong>.</p>"},{"title":" Camera Api ","date":"2019-02-27T02:38:12.000Z","_content":", OCR ,.,.\n 4.0  Camera  Camera2 , Camera2  5.0  api.\n<!-- more -->\n### \n`<uses-permission android:name=\"android.permission.CAMERA\" />`,,.\n### \n sample  cache ,,,.\n### \n1.  SurfaceView , TextureView,,,\n,`camera.setDisplayOrientation(90);`,.\n2. **** \n,,,,,.\n:\n``` java\n@NonNull\n    private Point machBestSize(Camera.Parameters parameters, Point screenResolution, List<Camera.Size> supportedSizes) {\n        //\n        List<Camera.Size> supportedPreviewSizes = new ArrayList<Camera.Size>(supportedSizes);\n        Collections.sort(supportedPreviewSizes, new Comparator<Camera.Size>() {\n            @Override\n            public int compare(Camera.Size a, Camera.Size b) {\n                int aPixels = a.height * a.width;\n                int bPixels = b.height * b.width;\n                if (bPixels < aPixels) {\n                    return -1;\n                }\n                if (bPixels > aPixels) {\n                    return 1;\n                }\n                return 0;\n            }\n        });\n        //\n        if (Log.isLoggable(TAG, Log.INFO)) {\n            StringBuilder previewSizesString = new StringBuilder();\n            for (Camera.Size supportedPreviewSize : supportedPreviewSizes) {\n                previewSizesString.append(supportedPreviewSize.width).append('x').append(supportedPreviewSize.height).append(' ');\n            }\n            Log.i(TAG, \"Supported preview sizes: \" + previewSizesString);\n        }\n\n        double screenAspectRatio = (double) screenResolution.x / (double) screenResolution.y;\n\n        Iterator<Camera.Size> it = supportedPreviewSizes.iterator();\n        while (it.hasNext()) {\n            Camera.Size supportedPreviewSize = it.next();\n            int realWidth = supportedPreviewSize.width;\n            int realHeight = supportedPreviewSize.height;\n            //MIN_PREVIEW_PIXELS = 480 * 320 \n            if (realWidth * realHeight < MIN_PREVIEW_PIXELS) {\n                it.remove();\n                continue;\n            }\n\n            boolean isCandidatePortrait = realWidth < realHeight;\n            int maybeFlippedWidth = isCandidatePortrait ? realHeight : realWidth;\n            int maybeFlippedHeight = isCandidatePortrait ? realWidth : realHeight;\n\n            double aspectRatio = (double) maybeFlippedWidth / (double) maybeFlippedHeight;\n            double distortion = Math.abs(aspectRatio - screenAspectRatio);\n            // MAX_ASPECT_DISTORTION = 1.5 \n            if (distortion > MAX_ASPECT_DISTORTION) {\n                it.remove();\n                continue;\n            }\n\n            if (maybeFlippedWidth == screenResolution.x && maybeFlippedHeight == screenResolution.y) {\n                Point exactPoint = new Point(realWidth, realHeight);\n                Log.i(TAG, \"Found preview size exactly matching screen size: \" + exactPoint);\n                return exactPoint;\n            }\n        }\n\n        //\n        if (!supportedPreviewSizes.isEmpty()) {\n            Camera.Size largestPreview = supportedPreviewSizes.get(0);\n            Point largestSize = new Point(largestPreview.width, largestPreview.height);\n            Log.i(TAG, \"Using largest suitable preview size: \" + largestSize);\n            return largestSize;\n        }\n\n        //\n        Camera.Size defaultPreview = parameters.getPictureSize();\n        Point defaultSize = new Point(defaultPreview.width, defaultPreview.height);\n        Log.i(TAG, \"No suitable preview sizes, using default: \" + defaultSize);\n\n        return defaultSize;\n    }\n```\n,,,,,.\n``` java\n    Point pictureSize = findBestPictureSizeValue(parameters, cameraResolution);\n    //\n    parameters.setPictureSize(pictureSize.x, pictureSize.y);\n    camera.setParameters(parameters);\n```\n\n### \nOCR,,,.\n``` java \n//\nprivate fun takePhoto() {\n    val camera = cameraManager.camera\n    // jpeg \n    camera.takePicture(null, null, Camera.PictureCallback { data, _ ->\n        var resource = BitmapFactory.decodeByteArray(data, 0, data.size)\n        if (resource == null) {\n            Toast.makeText(this@CameraActivity, \"\",Toast.LENGTH_SHORT).show()\n        } else {\n            if (canCrop) {\n                //\n                resource = cropImage(resource)\n            }\n            //\n            val path = saveBitmap(resource)\n            if (path.isNotEmpty()) {\n                Log.e(\"photo saved in path:\", path)\n            } else {\n                Toast.makeText(this@CameraActivity, \"\",Toast.LENGTH_SHORT).show()\n            }\n            val intent = Intent()\n            intent.putExtra(\"imagePath\", path)\n            setResult(Activity.RESULT_OK, intent)\n            finish()\n        }\n    })\n}\n\n//   \nprivate fun cropImage(resource: Bitmap): Bitmap {\n    val ratio = resource.width / (height * 1.0)\n    val pictureWidth = dp2px(450) * ratio\n    val pictureHeight = dp2px(282) * ratio\n    val x = (resource.width - pictureWidth) / 2\n    val y = (resource.height - pictureHeight) / 2\n    val bitmap = Bitmap.createBitmap(resource, x.toInt(), y.toInt(),pictureWidth.toInt(), pictureHeight.toInt())\n    if (pictureWidth > maxWidth) {\n        val originRatio = (pictureWidth / (pictureHeight * 1.0)).toFloat()\n        val matrix = Matrix()\n        matrix.postScale(originRatio, originRatio)\n        return Bitmap.createScaledBitmap(bitmap, maxWidth, (maxWidth /originRatio).toInt(), true)\n    }\n    return bitmap\n}\n//,\nprivate fun saveBitmap(resource: Bitmap): String {\n    val picturePathName = cacheDir.absolutePath + File.separator +System.currentTimeMillis() + \".jpg\"\n    val file = File(picturePathName)\n    var result = \"\"\n    var isSuccess = false\n    try {\n        val fos = FileOutputStream(file)\n        isSuccess = resource.compress(Bitmap.CompressFormat.JPEG, 100, fos)\n        fos.flush()\n        fos.close()\n        result = file.absolutePath\n    } catch (e: Exception) {\n        e.printStackTrace()\n    }\n    return if (isSuccess) result else \"\"\n}\n```\n### \n,,.,.\n### \n(sample )  ** **\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/camera_id_card_front.png)\n###  \n,.\n,`setOneShotPreviewCallback`, Bitmap .\n `onPreviewFrame``YUV420SP `,`BitmapFactory`,`YuvImage`.\n``` java  Bitmap\nprivate fun generateBitmap(camera: Camera, data: ByteArray): Bitmap? {\n        val size = camera.parameters.previewSize\n        val w = size.width \n        val h = size.height\n        val image = YuvImage(data, ImageFormat.NV21,\n                w, h, null)\n        val os = ByteArrayOutputStream()\n        if (!image.compressToJpeg(Rect(0, 0, w, h), 100, os)) {\n            return null\n        }\n        val tmp = os.toByteArray()\n        return BitmapFactory.decodeByteArray(tmp, 0, tmp.size, BitmapFactory.Options())\n    }\n```\n,,.\n### \n[GitHub camera module sample](https://github.com/Thewhitelight/Tinder/tree/master/camera)\n### \n[Android 5.0(Lollipop)SurfaceTextureTextureView, SurfaceViewGLSurfaceView](https://blog.csdn.net/jinzhuojun/article/details/44062175)","source":"_posts/camera-id-card.md","raw":"---\ntitle:  Camera Api \ndate: 2019-02-27 10:38:12\ntags:\n    - Android\n    - Camera\ncategories: \n    - \n---\n, OCR ,.,.\n 4.0  Camera  Camera2 , Camera2  5.0  api.\n<!-- more -->\n### \n`<uses-permission android:name=\"android.permission.CAMERA\" />`,,.\n### \n sample  cache ,,,.\n### \n1.  SurfaceView , TextureView,,,\n,`camera.setDisplayOrientation(90);`,.\n2. **** \n,,,,,.\n:\n``` java\n@NonNull\n    private Point machBestSize(Camera.Parameters parameters, Point screenResolution, List<Camera.Size> supportedSizes) {\n        //\n        List<Camera.Size> supportedPreviewSizes = new ArrayList<Camera.Size>(supportedSizes);\n        Collections.sort(supportedPreviewSizes, new Comparator<Camera.Size>() {\n            @Override\n            public int compare(Camera.Size a, Camera.Size b) {\n                int aPixels = a.height * a.width;\n                int bPixels = b.height * b.width;\n                if (bPixels < aPixels) {\n                    return -1;\n                }\n                if (bPixels > aPixels) {\n                    return 1;\n                }\n                return 0;\n            }\n        });\n        //\n        if (Log.isLoggable(TAG, Log.INFO)) {\n            StringBuilder previewSizesString = new StringBuilder();\n            for (Camera.Size supportedPreviewSize : supportedPreviewSizes) {\n                previewSizesString.append(supportedPreviewSize.width).append('x').append(supportedPreviewSize.height).append(' ');\n            }\n            Log.i(TAG, \"Supported preview sizes: \" + previewSizesString);\n        }\n\n        double screenAspectRatio = (double) screenResolution.x / (double) screenResolution.y;\n\n        Iterator<Camera.Size> it = supportedPreviewSizes.iterator();\n        while (it.hasNext()) {\n            Camera.Size supportedPreviewSize = it.next();\n            int realWidth = supportedPreviewSize.width;\n            int realHeight = supportedPreviewSize.height;\n            //MIN_PREVIEW_PIXELS = 480 * 320 \n            if (realWidth * realHeight < MIN_PREVIEW_PIXELS) {\n                it.remove();\n                continue;\n            }\n\n            boolean isCandidatePortrait = realWidth < realHeight;\n            int maybeFlippedWidth = isCandidatePortrait ? realHeight : realWidth;\n            int maybeFlippedHeight = isCandidatePortrait ? realWidth : realHeight;\n\n            double aspectRatio = (double) maybeFlippedWidth / (double) maybeFlippedHeight;\n            double distortion = Math.abs(aspectRatio - screenAspectRatio);\n            // MAX_ASPECT_DISTORTION = 1.5 \n            if (distortion > MAX_ASPECT_DISTORTION) {\n                it.remove();\n                continue;\n            }\n\n            if (maybeFlippedWidth == screenResolution.x && maybeFlippedHeight == screenResolution.y) {\n                Point exactPoint = new Point(realWidth, realHeight);\n                Log.i(TAG, \"Found preview size exactly matching screen size: \" + exactPoint);\n                return exactPoint;\n            }\n        }\n\n        //\n        if (!supportedPreviewSizes.isEmpty()) {\n            Camera.Size largestPreview = supportedPreviewSizes.get(0);\n            Point largestSize = new Point(largestPreview.width, largestPreview.height);\n            Log.i(TAG, \"Using largest suitable preview size: \" + largestSize);\n            return largestSize;\n        }\n\n        //\n        Camera.Size defaultPreview = parameters.getPictureSize();\n        Point defaultSize = new Point(defaultPreview.width, defaultPreview.height);\n        Log.i(TAG, \"No suitable preview sizes, using default: \" + defaultSize);\n\n        return defaultSize;\n    }\n```\n,,,,,.\n``` java\n    Point pictureSize = findBestPictureSizeValue(parameters, cameraResolution);\n    //\n    parameters.setPictureSize(pictureSize.x, pictureSize.y);\n    camera.setParameters(parameters);\n```\n\n### \nOCR,,,.\n``` java \n//\nprivate fun takePhoto() {\n    val camera = cameraManager.camera\n    // jpeg \n    camera.takePicture(null, null, Camera.PictureCallback { data, _ ->\n        var resource = BitmapFactory.decodeByteArray(data, 0, data.size)\n        if (resource == null) {\n            Toast.makeText(this@CameraActivity, \"\",Toast.LENGTH_SHORT).show()\n        } else {\n            if (canCrop) {\n                //\n                resource = cropImage(resource)\n            }\n            //\n            val path = saveBitmap(resource)\n            if (path.isNotEmpty()) {\n                Log.e(\"photo saved in path:\", path)\n            } else {\n                Toast.makeText(this@CameraActivity, \"\",Toast.LENGTH_SHORT).show()\n            }\n            val intent = Intent()\n            intent.putExtra(\"imagePath\", path)\n            setResult(Activity.RESULT_OK, intent)\n            finish()\n        }\n    })\n}\n\n//   \nprivate fun cropImage(resource: Bitmap): Bitmap {\n    val ratio = resource.width / (height * 1.0)\n    val pictureWidth = dp2px(450) * ratio\n    val pictureHeight = dp2px(282) * ratio\n    val x = (resource.width - pictureWidth) / 2\n    val y = (resource.height - pictureHeight) / 2\n    val bitmap = Bitmap.createBitmap(resource, x.toInt(), y.toInt(),pictureWidth.toInt(), pictureHeight.toInt())\n    if (pictureWidth > maxWidth) {\n        val originRatio = (pictureWidth / (pictureHeight * 1.0)).toFloat()\n        val matrix = Matrix()\n        matrix.postScale(originRatio, originRatio)\n        return Bitmap.createScaledBitmap(bitmap, maxWidth, (maxWidth /originRatio).toInt(), true)\n    }\n    return bitmap\n}\n//,\nprivate fun saveBitmap(resource: Bitmap): String {\n    val picturePathName = cacheDir.absolutePath + File.separator +System.currentTimeMillis() + \".jpg\"\n    val file = File(picturePathName)\n    var result = \"\"\n    var isSuccess = false\n    try {\n        val fos = FileOutputStream(file)\n        isSuccess = resource.compress(Bitmap.CompressFormat.JPEG, 100, fos)\n        fos.flush()\n        fos.close()\n        result = file.absolutePath\n    } catch (e: Exception) {\n        e.printStackTrace()\n    }\n    return if (isSuccess) result else \"\"\n}\n```\n### \n,,.,.\n### \n(sample )  ** **\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/camera_id_card_front.png)\n###  \n,.\n,`setOneShotPreviewCallback`, Bitmap .\n `onPreviewFrame``YUV420SP `,`BitmapFactory`,`YuvImage`.\n``` java  Bitmap\nprivate fun generateBitmap(camera: Camera, data: ByteArray): Bitmap? {\n        val size = camera.parameters.previewSize\n        val w = size.width \n        val h = size.height\n        val image = YuvImage(data, ImageFormat.NV21,\n                w, h, null)\n        val os = ByteArrayOutputStream()\n        if (!image.compressToJpeg(Rect(0, 0, w, h), 100, os)) {\n            return null\n        }\n        val tmp = os.toByteArray()\n        return BitmapFactory.decodeByteArray(tmp, 0, tmp.size, BitmapFactory.Options())\n    }\n```\n,,.\n### \n[GitHub camera module sample](https://github.com/Thewhitelight/Tinder/tree/master/camera)\n### \n[Android 5.0(Lollipop)SurfaceTextureTextureView, SurfaceViewGLSurfaceView](https://blog.csdn.net/jinzhuojun/article/details/44062175)","slug":"camera-id-card","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsa6000pndf2c18pcknr","content":"<p>, OCR ,.,.<br> 4.0  Camera  Camera2 , Camera2  5.0  api.<br><a id=\"more\"></a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot; /&gt;</code>,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> sample  cache ,,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> SurfaceView , TextureView,,,<br>,<code>camera.setDisplayOrientation(90);</code>,.</li>\n<li><strong></strong> <br>,,,,,.<br>:<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NonNull</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Point <span class=\"title\">machBestSize</span><span class=\"params\">(Camera.Parameters parameters, Point screenResolution, List&lt;Camera.Size&gt; supportedSizes)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        List&lt;Camera.Size&gt; supportedPreviewSizes = <span class=\"keyword\">new</span> ArrayList&lt;Camera.Size&gt;(supportedSizes);</span><br><span class=\"line\">        Collections.sort(supportedPreviewSizes, <span class=\"keyword\">new</span> Comparator&lt;Camera.Size&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">compare</span><span class=\"params\">(Camera.Size a, Camera.Size b)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">int</span> aPixels = a.height * a.width;</span><br><span class=\"line\">                <span class=\"keyword\">int</span> bPixels = b.height * b.width;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (bPixels &lt; aPixels) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (bPixels &gt; aPixels) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Log.isLoggable(TAG, Log.INFO)) &#123;</span><br><span class=\"line\">            StringBuilder previewSizesString = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Camera.Size supportedPreviewSize : supportedPreviewSizes) &#123;</span><br><span class=\"line\">                previewSizesString.append(supportedPreviewSize.width).append(<span class=\"string\">'x'</span>).append(supportedPreviewSize.height).append(<span class=\"string\">' '</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            Log.i(TAG, <span class=\"string\">\"Supported preview sizes: \"</span> + previewSizesString);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">double</span> screenAspectRatio = (<span class=\"keyword\">double</span>) screenResolution.x / (<span class=\"keyword\">double</span>) screenResolution.y;</span><br><span class=\"line\"></span><br><span class=\"line\">        Iterator&lt;Camera.Size&gt; it = supportedPreviewSizes.iterator();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (it.hasNext()) &#123;</span><br><span class=\"line\">            Camera.Size supportedPreviewSize = it.next();</span><br><span class=\"line\">            <span class=\"keyword\">int</span> realWidth = supportedPreviewSize.width;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> realHeight = supportedPreviewSize.height;</span><br><span class=\"line\">            <span class=\"comment\">//MIN_PREVIEW_PIXELS = 480 * 320 </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (realWidth * realHeight &lt; MIN_PREVIEW_PIXELS) &#123;</span><br><span class=\"line\">                it.remove();</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">boolean</span> isCandidatePortrait = realWidth &lt; realHeight;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> maybeFlippedWidth = isCandidatePortrait ? realHeight : realWidth;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> maybeFlippedHeight = isCandidatePortrait ? realWidth : realHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">double</span> aspectRatio = (<span class=\"keyword\">double</span>) maybeFlippedWidth / (<span class=\"keyword\">double</span>) maybeFlippedHeight;</span><br><span class=\"line\">            <span class=\"keyword\">double</span> distortion = Math.abs(aspectRatio - screenAspectRatio);</span><br><span class=\"line\">            <span class=\"comment\">// MAX_ASPECT_DISTORTION = 1.5 </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (distortion &gt; MAX_ASPECT_DISTORTION) &#123;</span><br><span class=\"line\">                it.remove();</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (maybeFlippedWidth == screenResolution.x &amp;&amp; maybeFlippedHeight == screenResolution.y) &#123;</span><br><span class=\"line\">                Point exactPoint = <span class=\"keyword\">new</span> Point(realWidth, realHeight);</span><br><span class=\"line\">                Log.i(TAG, <span class=\"string\">\"Found preview size exactly matching screen size: \"</span> + exactPoint);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> exactPoint;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!supportedPreviewSizes.isEmpty()) &#123;</span><br><span class=\"line\">            Camera.Size largestPreview = supportedPreviewSizes.get(<span class=\"number\">0</span>);</span><br><span class=\"line\">            Point largestSize = <span class=\"keyword\">new</span> Point(largestPreview.width, largestPreview.height);</span><br><span class=\"line\">            Log.i(TAG, <span class=\"string\">\"Using largest suitable preview size: \"</span> + largestSize);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> largestSize;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        Camera.Size defaultPreview = parameters.getPictureSize();</span><br><span class=\"line\">        Point defaultSize = <span class=\"keyword\">new</span> Point(defaultPreview.width, defaultPreview.height);</span><br><span class=\"line\">        Log.i(TAG, <span class=\"string\">\"No suitable preview sizes, using default: \"</span> + defaultSize);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> defaultSize;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>,,,,,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Point pictureSize = findBestPictureSizeValue(parameters, cameraResolution);</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">parameters.setPictureSize(pictureSize.x, pictureSize.y);</span><br><span class=\"line\">camera.setParameters(parameters);</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>OCR,,,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> fun <span class=\"title\">takePhoto</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    val camera = cameraManager.camera</span><br><span class=\"line\">    <span class=\"comment\">// jpeg </span></span><br><span class=\"line\">    camera.takePicture(<span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, Camera.PictureCallback &#123; data, _ -&gt;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> resource = BitmapFactory.decodeByteArray(data, <span class=\"number\">0</span>, data.size)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (resource == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            Toast.makeText(<span class=\"keyword\">this</span><span class=\"meta\">@CameraActivity</span>, <span class=\"string\">\"\"</span>,Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (canCrop) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                resource = cropImage(resource)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            val path = saveBitmap(resource)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (path.isNotEmpty()) &#123;</span><br><span class=\"line\">                Log.e(<span class=\"string\">\"photo saved in path:\"</span>, path)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                Toast.makeText(<span class=\"keyword\">this</span><span class=\"meta\">@CameraActivity</span>, <span class=\"string\">\"\"</span>,Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            val intent = Intent()</span><br><span class=\"line\">            intent.putExtra(<span class=\"string\">\"imagePath\"</span>, path)</span><br><span class=\"line\">            setResult(Activity.RESULT_OK, intent)</span><br><span class=\"line\">            finish()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//   </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> fun <span class=\"title\">cropImage</span><span class=\"params\">(resource: Bitmap)</span>: Bitmap </span>&#123;</span><br><span class=\"line\">    val ratio = resource.width / (height * <span class=\"number\">1.0</span>)</span><br><span class=\"line\">    val pictureWidth = dp2px(<span class=\"number\">450</span>) * ratio</span><br><span class=\"line\">    val pictureHeight = dp2px(<span class=\"number\">282</span>) * ratio</span><br><span class=\"line\">    val x = (resource.width - pictureWidth) / <span class=\"number\">2</span></span><br><span class=\"line\">    val y = (resource.height - pictureHeight) / <span class=\"number\">2</span></span><br><span class=\"line\">    val bitmap = Bitmap.createBitmap(resource, x.toInt(), y.toInt(),pictureWidth.toInt(), pictureHeight.toInt())</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pictureWidth &gt; maxWidth) &#123;</span><br><span class=\"line\">        val originRatio = (pictureWidth / (pictureHeight * <span class=\"number\">1.0</span>)).toFloat()</span><br><span class=\"line\">        val matrix = Matrix()</span><br><span class=\"line\">        matrix.postScale(originRatio, originRatio)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Bitmap.createScaledBitmap(bitmap, maxWidth, (maxWidth /originRatio).toInt(), <span class=\"keyword\">true</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> bitmap</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//,</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> fun <span class=\"title\">saveBitmap</span><span class=\"params\">(resource: Bitmap)</span>: String </span>&#123;</span><br><span class=\"line\">    val picturePathName = cacheDir.absolutePath + File.separator +System.currentTimeMillis() + <span class=\"string\">\".jpg\"</span></span><br><span class=\"line\">    val file = File(picturePathName)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = <span class=\"string\">\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> isSuccess = <span class=\"keyword\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        val fos = FileOutputStream(file)</span><br><span class=\"line\">        isSuccess = resource.compress(Bitmap.CompressFormat.JPEG, <span class=\"number\">100</span>, fos)</span><br><span class=\"line\">        fos.flush()</span><br><span class=\"line\">        fos.close()</span><br><span class=\"line\">        result = file.absolutePath</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e: Exception) &#123;</span><br><span class=\"line\">        e.printStackTrace()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">if</span> (isSuccess) result <span class=\"keyword\">else</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>,,.,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>(sample )  <strong> </strong><br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/camera_id_card_front.png\" alt></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>,.<br>,<code>setOneShotPreviewCallback</code>, Bitmap .<br> <code>onPreviewFrame</code><code>YUV420SP </code>,<code>BitmapFactory</code>,<code>YuvImage</code>.<br><figure class=\"highlight java\"><figcaption><span> Bitmap</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> fun <span class=\"title\">generateBitmap</span><span class=\"params\">(camera: Camera, data: ByteArray)</span>: Bitmap? </span>&#123;</span><br><span class=\"line\">        val size = camera.parameters.previewSize</span><br><span class=\"line\">        val w = size.width </span><br><span class=\"line\">        val h = size.height</span><br><span class=\"line\">        val image = YuvImage(data, ImageFormat.NV21,</span><br><span class=\"line\">                w, h, <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        val os = ByteArrayOutputStream()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!image.compressToJpeg(Rect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, w, h), <span class=\"number\">100</span>, os)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        val tmp = os.toByteArray()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> BitmapFactory.decodeByteArray(tmp, <span class=\"number\">0</span>, tmp.size, BitmapFactory.Options())</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://github.com/Thewhitelight/Tinder/tree/master/camera\">GitHub camera module sample</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://blog.csdn.net/jinzhuojun/article/details/44062175\" target=\"_blank\" rel=\"noopener\">Android 5.0(Lollipop)SurfaceTextureTextureView, SurfaceViewGLSurfaceView</a></p>\n","site":{"data":{}},"excerpt":"<p>, OCR ,.,.<br> 4.0  Camera  Camera2 , Camera2  5.0  api.<br>","more":"</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot; /&gt;</code>,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> sample  cache ,,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li> SurfaceView , TextureView,,,<br>,<code>camera.setDisplayOrientation(90);</code>,.</li>\n<li><strong></strong> <br>,,,,,.<br>:<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NonNull</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Point <span class=\"title\">machBestSize</span><span class=\"params\">(Camera.Parameters parameters, Point screenResolution, List&lt;Camera.Size&gt; supportedSizes)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        List&lt;Camera.Size&gt; supportedPreviewSizes = <span class=\"keyword\">new</span> ArrayList&lt;Camera.Size&gt;(supportedSizes);</span><br><span class=\"line\">        Collections.sort(supportedPreviewSizes, <span class=\"keyword\">new</span> Comparator&lt;Camera.Size&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">compare</span><span class=\"params\">(Camera.Size a, Camera.Size b)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">int</span> aPixels = a.height * a.width;</span><br><span class=\"line\">                <span class=\"keyword\">int</span> bPixels = b.height * b.width;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (bPixels &lt; aPixels) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (bPixels &gt; aPixels) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Log.isLoggable(TAG, Log.INFO)) &#123;</span><br><span class=\"line\">            StringBuilder previewSizesString = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Camera.Size supportedPreviewSize : supportedPreviewSizes) &#123;</span><br><span class=\"line\">                previewSizesString.append(supportedPreviewSize.width).append(<span class=\"string\">'x'</span>).append(supportedPreviewSize.height).append(<span class=\"string\">' '</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            Log.i(TAG, <span class=\"string\">\"Supported preview sizes: \"</span> + previewSizesString);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">double</span> screenAspectRatio = (<span class=\"keyword\">double</span>) screenResolution.x / (<span class=\"keyword\">double</span>) screenResolution.y;</span><br><span class=\"line\"></span><br><span class=\"line\">        Iterator&lt;Camera.Size&gt; it = supportedPreviewSizes.iterator();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (it.hasNext()) &#123;</span><br><span class=\"line\">            Camera.Size supportedPreviewSize = it.next();</span><br><span class=\"line\">            <span class=\"keyword\">int</span> realWidth = supportedPreviewSize.width;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> realHeight = supportedPreviewSize.height;</span><br><span class=\"line\">            <span class=\"comment\">//MIN_PREVIEW_PIXELS = 480 * 320 </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (realWidth * realHeight &lt; MIN_PREVIEW_PIXELS) &#123;</span><br><span class=\"line\">                it.remove();</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">boolean</span> isCandidatePortrait = realWidth &lt; realHeight;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> maybeFlippedWidth = isCandidatePortrait ? realHeight : realWidth;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> maybeFlippedHeight = isCandidatePortrait ? realWidth : realHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">double</span> aspectRatio = (<span class=\"keyword\">double</span>) maybeFlippedWidth / (<span class=\"keyword\">double</span>) maybeFlippedHeight;</span><br><span class=\"line\">            <span class=\"keyword\">double</span> distortion = Math.abs(aspectRatio - screenAspectRatio);</span><br><span class=\"line\">            <span class=\"comment\">// MAX_ASPECT_DISTORTION = 1.5 </span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (distortion &gt; MAX_ASPECT_DISTORTION) &#123;</span><br><span class=\"line\">                it.remove();</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (maybeFlippedWidth == screenResolution.x &amp;&amp; maybeFlippedHeight == screenResolution.y) &#123;</span><br><span class=\"line\">                Point exactPoint = <span class=\"keyword\">new</span> Point(realWidth, realHeight);</span><br><span class=\"line\">                Log.i(TAG, <span class=\"string\">\"Found preview size exactly matching screen size: \"</span> + exactPoint);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> exactPoint;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!supportedPreviewSizes.isEmpty()) &#123;</span><br><span class=\"line\">            Camera.Size largestPreview = supportedPreviewSizes.get(<span class=\"number\">0</span>);</span><br><span class=\"line\">            Point largestSize = <span class=\"keyword\">new</span> Point(largestPreview.width, largestPreview.height);</span><br><span class=\"line\">            Log.i(TAG, <span class=\"string\">\"Using largest suitable preview size: \"</span> + largestSize);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> largestSize;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        Camera.Size defaultPreview = parameters.getPictureSize();</span><br><span class=\"line\">        Point defaultSize = <span class=\"keyword\">new</span> Point(defaultPreview.width, defaultPreview.height);</span><br><span class=\"line\">        Log.i(TAG, <span class=\"string\">\"No suitable preview sizes, using default: \"</span> + defaultSize);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> defaultSize;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>,,,,,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Point pictureSize = findBestPictureSizeValue(parameters, cameraResolution);</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\">parameters.setPictureSize(pictureSize.x, pictureSize.y);</span><br><span class=\"line\">camera.setParameters(parameters);</span><br></pre></td></tr></table></figure></p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>OCR,,,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> fun <span class=\"title\">takePhoto</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    val camera = cameraManager.camera</span><br><span class=\"line\">    <span class=\"comment\">// jpeg </span></span><br><span class=\"line\">    camera.takePicture(<span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, Camera.PictureCallback &#123; data, _ -&gt;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> resource = BitmapFactory.decodeByteArray(data, <span class=\"number\">0</span>, data.size)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (resource == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            Toast.makeText(<span class=\"keyword\">this</span><span class=\"meta\">@CameraActivity</span>, <span class=\"string\">\"\"</span>,Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (canCrop) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                resource = cropImage(resource)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            val path = saveBitmap(resource)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (path.isNotEmpty()) &#123;</span><br><span class=\"line\">                Log.e(<span class=\"string\">\"photo saved in path:\"</span>, path)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                Toast.makeText(<span class=\"keyword\">this</span><span class=\"meta\">@CameraActivity</span>, <span class=\"string\">\"\"</span>,Toast.LENGTH_SHORT).show()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            val intent = Intent()</span><br><span class=\"line\">            intent.putExtra(<span class=\"string\">\"imagePath\"</span>, path)</span><br><span class=\"line\">            setResult(Activity.RESULT_OK, intent)</span><br><span class=\"line\">            finish()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//   </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> fun <span class=\"title\">cropImage</span><span class=\"params\">(resource: Bitmap)</span>: Bitmap </span>&#123;</span><br><span class=\"line\">    val ratio = resource.width / (height * <span class=\"number\">1.0</span>)</span><br><span class=\"line\">    val pictureWidth = dp2px(<span class=\"number\">450</span>) * ratio</span><br><span class=\"line\">    val pictureHeight = dp2px(<span class=\"number\">282</span>) * ratio</span><br><span class=\"line\">    val x = (resource.width - pictureWidth) / <span class=\"number\">2</span></span><br><span class=\"line\">    val y = (resource.height - pictureHeight) / <span class=\"number\">2</span></span><br><span class=\"line\">    val bitmap = Bitmap.createBitmap(resource, x.toInt(), y.toInt(),pictureWidth.toInt(), pictureHeight.toInt())</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pictureWidth &gt; maxWidth) &#123;</span><br><span class=\"line\">        val originRatio = (pictureWidth / (pictureHeight * <span class=\"number\">1.0</span>)).toFloat()</span><br><span class=\"line\">        val matrix = Matrix()</span><br><span class=\"line\">        matrix.postScale(originRatio, originRatio)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Bitmap.createScaledBitmap(bitmap, maxWidth, (maxWidth /originRatio).toInt(), <span class=\"keyword\">true</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> bitmap</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//,</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> fun <span class=\"title\">saveBitmap</span><span class=\"params\">(resource: Bitmap)</span>: String </span>&#123;</span><br><span class=\"line\">    val picturePathName = cacheDir.absolutePath + File.separator +System.currentTimeMillis() + <span class=\"string\">\".jpg\"</span></span><br><span class=\"line\">    val file = File(picturePathName)</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = <span class=\"string\">\"\"</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> isSuccess = <span class=\"keyword\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        val fos = FileOutputStream(file)</span><br><span class=\"line\">        isSuccess = resource.compress(Bitmap.CompressFormat.JPEG, <span class=\"number\">100</span>, fos)</span><br><span class=\"line\">        fos.flush()</span><br><span class=\"line\">        fos.close()</span><br><span class=\"line\">        result = file.absolutePath</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e: Exception) &#123;</span><br><span class=\"line\">        e.printStackTrace()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">if</span> (isSuccess) result <span class=\"keyword\">else</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>,,.,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>(sample )  <strong> </strong><br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/camera_id_card_front.png\" alt></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>,.<br>,<code>setOneShotPreviewCallback</code>, Bitmap .<br> <code>onPreviewFrame</code><code>YUV420SP </code>,<code>BitmapFactory</code>,<code>YuvImage</code>.<br><figure class=\"highlight java\"><figcaption><span> Bitmap</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> fun <span class=\"title\">generateBitmap</span><span class=\"params\">(camera: Camera, data: ByteArray)</span>: Bitmap? </span>&#123;</span><br><span class=\"line\">        val size = camera.parameters.previewSize</span><br><span class=\"line\">        val w = size.width </span><br><span class=\"line\">        val h = size.height</span><br><span class=\"line\">        val image = YuvImage(data, ImageFormat.NV21,</span><br><span class=\"line\">                w, h, <span class=\"keyword\">null</span>)</span><br><span class=\"line\">        val os = ByteArrayOutputStream()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!image.compressToJpeg(Rect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, w, h), <span class=\"number\">100</span>, os)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        val tmp = os.toByteArray()</span><br><span class=\"line\">        <span class=\"keyword\">return</span> BitmapFactory.decodeByteArray(tmp, <span class=\"number\">0</span>, tmp.size, BitmapFactory.Options())</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://github.com/Thewhitelight/Tinder/tree/master/camera\">GitHub camera module sample</a></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"https://blog.csdn.net/jinzhuojun/article/details/44062175\" target=\"_blank\" rel=\"noopener\">Android 5.0(Lollipop)SurfaceTextureTextureView, SurfaceViewGLSurfaceView</a></p>"},{"title":"Android P ","date":"2019-03-17T13:45:19.000Z","_content":"** Aandroid **\n [Pandora 1.3.2 ](https://github.com/whataa/pandora) ,. Aandroid 9.0 .,,.\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/android_p_invoke.jpg)\n targetSdkVersion  27,compileSdkVersion  28\nPandora 2.0 ,.\n<!-- more -->\n## \n Pandora , Logcat ` Accessing hidden field Landroid/view/ViewRootImpl;->mWindowAttributes:Landroid/view/WindowManager$LayoutParams; (dark greylist, reflection)`,,.\n AS , Activity  performStart \n``` java Activity.java\n\n    final void performStart(String reason) {\n        //\n        //,\n        boolean isApiWarningEnabled = SystemProperties.getInt(\"ro.art.hiddenapi.warning\", 0) == 1;\n        if (isAppDebuggable || isApiWarningEnabled) {\n            if (!mMainThread.mHiddenApiWarningShown && VMRuntime.getRuntime().hasUsedHiddenApi()) {\n                // \n                mMainThread.mHiddenApiWarningShown = true;\n\n                String appName = getApplicationInfo().loadLabel(getPackageManager())\n                        .toString();\n                String warning = \"Detected problems with API compatibility\\n\"\n                                 + \"(visit g.co/dev/appcompat for more info)\";\n                if (isAppDebuggable) {\n                    //\n                    new AlertDialog.Builder(this)\n                        .setTitle(appName)\n                        .setMessage(warning)\n                        .setPositiveButton(android.R.string.ok, null)\n                        //,\n                        .setCancelable(false)\n                        .show();\n                } else {\n                    // debug  Toast \n                    Toast.makeText(this, appName + \"\\n\" + warning, Toast.LENGTH_LONG).show();\n                }\n            }\n        }\n\n    }\n```\n,.\n## \n### targetSdkVersion 27\n* VMRuntime.getRuntime().hasUsedHiddenApi() AS, Androidxref  Natvie , \n* mMainThread.mHiddenApiWarningShown ,,\n ActivityThread .\n``` java\n   try {\n            Class cls = Class.forName(\"android.app.ActivityThread\");\n            Method declaredMethod = cls.getDeclaredMethod(\"currentActivityThread\");\n            declaredMethod.setAccessible(true);\n            Object activityThread = declaredMethod.invoke(null);\n            Field mHiddenApiWarningShown = cls.getDeclaredField(\"mHiddenApiWarningShown\");\n            mHiddenApiWarningShown.setAccessible(true);\n            mHiddenApiWarningShown.setBoolean(activityThread, true);\n            Log.e(\"reflection dark greylist is\",\"success\");\n        } catch (Exception e) {\n            e.printStackTrace();\n            Log.e(\"reflection dark greylist is\",\"fail\");\n        }\n```\n Application ..\n### targetSdkVersion 28\n targetSdkVersion 28, API,`java.lang.NoSuchFieldException: No field mWindowAttributes in class Landroid/view/ViewRootImpl; (declaration of 'android.view.ViewRootImpl' appears in /system/framework/framework.jar!classes2.dex)`, ActivityThread ,.Google Play  2019/5/1  APP  28 , hook .\n![hidden-api](http://gityuan.com/images/hidden-api/hidden-api-exp.png)\n#### \n,,,.**** API , API,.[ Android PAPI](http://weishu.me/2019/03/16/another-free-reflection-above-android-p/),,, GitHub . Android P ,,. Android Q beta 1 .\n#### \nPandora 2.0 ,, Class  classloader , BootCalssLoader ,,,.[Reflect28Util](https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java),.\n\n## \n[Pandora ](https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java)\n[FreeReflection](https://github.com/tiann/FreeReflection)\n[ Android PAPI](http://weishu.me/2019/03/16/another-free-reflection-above-android-p/)\n[Android PSDK](http://weishu.me/2018/06/07/free-reflection-above-android-p/)\n[Android PAPI](http://gityuan.com/2019/01/26/hidden_api/)","source":"_posts/android-p-invoke.md","raw":"---\ntitle: Android P \ndate: 2019-03-17 21:45:19\ntags:\n    - Android\n    - \ncategories: \n    - \n---\n** Aandroid **\n [Pandora 1.3.2 ](https://github.com/whataa/pandora) ,. Aandroid 9.0 .,,.\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/android_p_invoke.jpg)\n targetSdkVersion  27,compileSdkVersion  28\nPandora 2.0 ,.\n<!-- more -->\n## \n Pandora , Logcat ` Accessing hidden field Landroid/view/ViewRootImpl;->mWindowAttributes:Landroid/view/WindowManager$LayoutParams; (dark greylist, reflection)`,,.\n AS , Activity  performStart \n``` java Activity.java\n\n    final void performStart(String reason) {\n        //\n        //,\n        boolean isApiWarningEnabled = SystemProperties.getInt(\"ro.art.hiddenapi.warning\", 0) == 1;\n        if (isAppDebuggable || isApiWarningEnabled) {\n            if (!mMainThread.mHiddenApiWarningShown && VMRuntime.getRuntime().hasUsedHiddenApi()) {\n                // \n                mMainThread.mHiddenApiWarningShown = true;\n\n                String appName = getApplicationInfo().loadLabel(getPackageManager())\n                        .toString();\n                String warning = \"Detected problems with API compatibility\\n\"\n                                 + \"(visit g.co/dev/appcompat for more info)\";\n                if (isAppDebuggable) {\n                    //\n                    new AlertDialog.Builder(this)\n                        .setTitle(appName)\n                        .setMessage(warning)\n                        .setPositiveButton(android.R.string.ok, null)\n                        //,\n                        .setCancelable(false)\n                        .show();\n                } else {\n                    // debug  Toast \n                    Toast.makeText(this, appName + \"\\n\" + warning, Toast.LENGTH_LONG).show();\n                }\n            }\n        }\n\n    }\n```\n,.\n## \n### targetSdkVersion 27\n* VMRuntime.getRuntime().hasUsedHiddenApi() AS, Androidxref  Natvie , \n* mMainThread.mHiddenApiWarningShown ,,\n ActivityThread .\n``` java\n   try {\n            Class cls = Class.forName(\"android.app.ActivityThread\");\n            Method declaredMethod = cls.getDeclaredMethod(\"currentActivityThread\");\n            declaredMethod.setAccessible(true);\n            Object activityThread = declaredMethod.invoke(null);\n            Field mHiddenApiWarningShown = cls.getDeclaredField(\"mHiddenApiWarningShown\");\n            mHiddenApiWarningShown.setAccessible(true);\n            mHiddenApiWarningShown.setBoolean(activityThread, true);\n            Log.e(\"reflection dark greylist is\",\"success\");\n        } catch (Exception e) {\n            e.printStackTrace();\n            Log.e(\"reflection dark greylist is\",\"fail\");\n        }\n```\n Application ..\n### targetSdkVersion 28\n targetSdkVersion 28, API,`java.lang.NoSuchFieldException: No field mWindowAttributes in class Landroid/view/ViewRootImpl; (declaration of 'android.view.ViewRootImpl' appears in /system/framework/framework.jar!classes2.dex)`, ActivityThread ,.Google Play  2019/5/1  APP  28 , hook .\n![hidden-api](http://gityuan.com/images/hidden-api/hidden-api-exp.png)\n#### \n,,,.**** API , API,.[ Android PAPI](http://weishu.me/2019/03/16/another-free-reflection-above-android-p/),,, GitHub . Android P ,,. Android Q beta 1 .\n#### \nPandora 2.0 ,, Class  classloader , BootCalssLoader ,,,.[Reflect28Util](https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java),.\n\n## \n[Pandora ](https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java)\n[FreeReflection](https://github.com/tiann/FreeReflection)\n[ Android PAPI](http://weishu.me/2019/03/16/another-free-reflection-above-android-p/)\n[Android PSDK](http://weishu.me/2018/06/07/free-reflection-above-android-p/)\n[Android PAPI](http://gityuan.com/2019/01/26/hidden_api/)","slug":"android-p-invoke","published":1,"updated":"2019-11-24T11:46:47.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsa7000sndf2gzbum208","content":"<p><strong> Aandroid </strong><br> <a href=\"https://github.com/whataa/pandora\">Pandora 1.3.2 </a> ,. Aandroid 9.0 .,,.<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/android_p_invoke.jpg\" alt><br> targetSdkVersion  27,compileSdkVersion  28<br>Pandora 2.0 ,.<br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Pandora , Logcat <code>Accessing hidden field Landroid/view/ViewRootImpl;-&gt;mWindowAttributes:Landroid/view/WindowManager$LayoutParams; (dark greylist, reflection)</code>,,.<br> AS , Activity  performStart <br><figure class=\"highlight java\"><figcaption><span>Activity.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">performStart</span><span class=\"params\">(String reason)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">//,</span></span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> isApiWarningEnabled = SystemProperties.getInt(<span class=\"string\">\"ro.art.hiddenapi.warning\"</span>, <span class=\"number\">0</span>) == <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isAppDebuggable || isApiWarningEnabled) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!mMainThread.mHiddenApiWarningShown &amp;&amp; VMRuntime.getRuntime().hasUsedHiddenApi()) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            mMainThread.mHiddenApiWarningShown = <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            String appName = getApplicationInfo().loadLabel(getPackageManager())</span><br><span class=\"line\">                    .toString();</span><br><span class=\"line\">            String warning = <span class=\"string\">\"Detected problems with API compatibility\\n\"</span></span><br><span class=\"line\">                             + <span class=\"string\">\"(visit g.co/dev/appcompat for more info)\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isAppDebuggable) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">new</span> AlertDialog.Builder(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">                    .setTitle(appName)</span><br><span class=\"line\">                    .setMessage(warning)</span><br><span class=\"line\">                    .setPositiveButton(android.R.string.ok, <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                    <span class=\"comment\">//,</span></span><br><span class=\"line\">                    .setCancelable(<span class=\"keyword\">false</span>)</span><br><span class=\"line\">                    .show();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// debug  Toast </span></span><br><span class=\"line\">                Toast.makeText(<span class=\"keyword\">this</span>, appName + <span class=\"string\">\"\\n\"</span> + warning, Toast.LENGTH_LONG).show();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"targetSdkVersion-27\"><a href=\"#targetSdkVersion-27\" class=\"headerlink\" title=\"targetSdkVersion 27\"></a>targetSdkVersion 27</h3><ul>\n<li>VMRuntime.getRuntime().hasUsedHiddenApi() AS, Androidxref  Natvie , </li>\n<li>mMainThread.mHiddenApiWarningShown ,,<br> ActivityThread .<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">         Class cls = Class.forName(<span class=\"string\">\"android.app.ActivityThread\"</span>);</span><br><span class=\"line\">         Method declaredMethod = cls.getDeclaredMethod(<span class=\"string\">\"currentActivityThread\"</span>);</span><br><span class=\"line\">         declaredMethod.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">         Object activityThread = declaredMethod.invoke(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">         Field mHiddenApiWarningShown = cls.getDeclaredField(<span class=\"string\">\"mHiddenApiWarningShown\"</span>);</span><br><span class=\"line\">         mHiddenApiWarningShown.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">         mHiddenApiWarningShown.setBoolean(activityThread, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">         Log.e(<span class=\"string\">\"reflection dark greylist is\"</span>,<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">     &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">         e.printStackTrace();</span><br><span class=\"line\">         Log.e(<span class=\"string\">\"reflection dark greylist is\"</span>,<span class=\"string\">\"fail\"</span>);</span><br><span class=\"line\">     &#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p> Application ..</p>\n<h3 id=\"targetSdkVersion-28\"><a href=\"#targetSdkVersion-28\" class=\"headerlink\" title=\"targetSdkVersion 28\"></a>targetSdkVersion 28</h3><p> targetSdkVersion 28, API,<code>java.lang.NoSuchFieldException: No field mWindowAttributes in class Landroid/view/ViewRootImpl; (declaration of &#39;android.view.ViewRootImpl&#39; appears in /system/framework/framework.jar!classes2.dex)</code>, ActivityThread ,.Google Play  2019/5/1  APP  28 , hook .<br><img src=\"http://gityuan.com/images/hidden-api/hidden-api-exp.png\" alt=\"hidden-api\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>,,,.<strong></strong> API , API,.<a href=\"http://weishu.me/2019/03/16/another-free-reflection-above-android-p/\" target=\"_blank\" rel=\"noopener\"> Android PAPI</a>,,, GitHub . Android P ,,. Android Q beta 1 .</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Pandora 2.0 ,, Class  classloader , BootCalssLoader ,,,.<a href=\"https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java\">Reflect28Util</a>,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java\">Pandora </a><br><a href=\"https://github.com/tiann/FreeReflection\">FreeReflection</a><br><a href=\"http://weishu.me/2019/03/16/another-free-reflection-above-android-p/\" target=\"_blank\" rel=\"noopener\"> Android PAPI</a><br><a href=\"http://weishu.me/2018/06/07/free-reflection-above-android-p/\" target=\"_blank\" rel=\"noopener\">Android PSDK</a><br><a href=\"http://gityuan.com/2019/01/26/hidden_api/\" target=\"_blank\" rel=\"noopener\">Android PAPI</a></p>\n","site":{"data":{}},"excerpt":"<p><strong> Aandroid </strong><br> <a href=\"https://github.com/whataa/pandora\">Pandora 1.3.2 </a> ,. Aandroid 9.0 .,,.<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/android_p_invoke.jpg\" alt><br> targetSdkVersion  27,compileSdkVersion  28<br>Pandora 2.0 ,.<br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> Pandora , Logcat <code>Accessing hidden field Landroid/view/ViewRootImpl;-&gt;mWindowAttributes:Landroid/view/WindowManager$LayoutParams; (dark greylist, reflection)</code>,,.<br> AS , Activity  performStart <br><figure class=\"highlight java\"><figcaption><span>Activity.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">performStart</span><span class=\"params\">(String reason)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">//,</span></span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> isApiWarningEnabled = SystemProperties.getInt(<span class=\"string\">\"ro.art.hiddenapi.warning\"</span>, <span class=\"number\">0</span>) == <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isAppDebuggable || isApiWarningEnabled) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!mMainThread.mHiddenApiWarningShown &amp;&amp; VMRuntime.getRuntime().hasUsedHiddenApi()) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// </span></span><br><span class=\"line\">            mMainThread.mHiddenApiWarningShown = <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            String appName = getApplicationInfo().loadLabel(getPackageManager())</span><br><span class=\"line\">                    .toString();</span><br><span class=\"line\">            String warning = <span class=\"string\">\"Detected problems with API compatibility\\n\"</span></span><br><span class=\"line\">                             + <span class=\"string\">\"(visit g.co/dev/appcompat for more info)\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isAppDebuggable) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                <span class=\"keyword\">new</span> AlertDialog.Builder(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">                    .setTitle(appName)</span><br><span class=\"line\">                    .setMessage(warning)</span><br><span class=\"line\">                    .setPositiveButton(android.R.string.ok, <span class=\"keyword\">null</span>)</span><br><span class=\"line\">                    <span class=\"comment\">//,</span></span><br><span class=\"line\">                    .setCancelable(<span class=\"keyword\">false</span>)</span><br><span class=\"line\">                    .show();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// debug  Toast </span></span><br><span class=\"line\">                Toast.makeText(<span class=\"keyword\">this</span>, appName + <span class=\"string\">\"\\n\"</span> + warning, Toast.LENGTH_LONG).show();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"targetSdkVersion-27\"><a href=\"#targetSdkVersion-27\" class=\"headerlink\" title=\"targetSdkVersion 27\"></a>targetSdkVersion 27</h3><ul>\n<li>VMRuntime.getRuntime().hasUsedHiddenApi() AS, Androidxref  Natvie , </li>\n<li>mMainThread.mHiddenApiWarningShown ,,<br> ActivityThread .<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">         Class cls = Class.forName(<span class=\"string\">\"android.app.ActivityThread\"</span>);</span><br><span class=\"line\">         Method declaredMethod = cls.getDeclaredMethod(<span class=\"string\">\"currentActivityThread\"</span>);</span><br><span class=\"line\">         declaredMethod.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">         Object activityThread = declaredMethod.invoke(<span class=\"keyword\">null</span>);</span><br><span class=\"line\">         Field mHiddenApiWarningShown = cls.getDeclaredField(<span class=\"string\">\"mHiddenApiWarningShown\"</span>);</span><br><span class=\"line\">         mHiddenApiWarningShown.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">         mHiddenApiWarningShown.setBoolean(activityThread, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">         Log.e(<span class=\"string\">\"reflection dark greylist is\"</span>,<span class=\"string\">\"success\"</span>);</span><br><span class=\"line\">     &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">         e.printStackTrace();</span><br><span class=\"line\">         Log.e(<span class=\"string\">\"reflection dark greylist is\"</span>,<span class=\"string\">\"fail\"</span>);</span><br><span class=\"line\">     &#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p> Application ..</p>\n<h3 id=\"targetSdkVersion-28\"><a href=\"#targetSdkVersion-28\" class=\"headerlink\" title=\"targetSdkVersion 28\"></a>targetSdkVersion 28</h3><p> targetSdkVersion 28, API,<code>java.lang.NoSuchFieldException: No field mWindowAttributes in class Landroid/view/ViewRootImpl; (declaration of &#39;android.view.ViewRootImpl&#39; appears in /system/framework/framework.jar!classes2.dex)</code>, ActivityThread ,.Google Play  2019/5/1  APP  28 , hook .<br><img src=\"http://gityuan.com/images/hidden-api/hidden-api-exp.png\" alt=\"hidden-api\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>,,,.<strong></strong> API , API,.<a href=\"http://weishu.me/2019/03/16/another-free-reflection-above-android-p/\" target=\"_blank\" rel=\"noopener\"> Android PAPI</a>,,, GitHub . Android P ,,. Android Q beta 1 .</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Pandora 2.0 ,, Class  classloader , BootCalssLoader ,,,.<a href=\"https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java\">Reflect28Util</a>,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java\">Pandora </a><br><a href=\"https://github.com/tiann/FreeReflection\">FreeReflection</a><br><a href=\"http://weishu.me/2019/03/16/another-free-reflection-above-android-p/\" target=\"_blank\" rel=\"noopener\"> Android PAPI</a><br><a href=\"http://weishu.me/2018/06/07/free-reflection-above-android-p/\" target=\"_blank\" rel=\"noopener\">Android PSDK</a><br><a href=\"http://gityuan.com/2019/01/26/hidden_api/\" target=\"_blank\" rel=\"noopener\">Android PAPI</a></p>"},{"title":"Android ()","date":"2018-09-13T14:35:04.000Z","_content":"# Web \n, VR ,, WebView ,,, web .,.\n\n##  Web \n,****  **** ,.\n``` xml\n <!-- :ShareUID,data  -->\n <activity\n            android:name=\".WebActivity\"\n            android:process=\":web\"/>\n<!-- :ShareUID -->\n <activity\n            android:name=\".WebActivity\"\n            android:process=\".web\"/>\n```\n,,.\n<!-- more -->\n## \n:\n1. Bundle\n2. \n3. AIDL\n4. Messager\n5. ContentProvider\n6. Socket\n\n,,SharePreference,,,,,ContentProvider,.\n``` java\n/**\n *  web ,web,, query , SharePreference .\n */\npublic class UserProvider extends ContentProvider {\n\n    private static String sAuthoriry = BuildConfig.APPLICATION_ID + \".UserProvider\";\n\n    @Override\n    public boolean onCreate() {\n        return true;\n    }\n\n    @Nullable\n    @Override\n    public Cursor query(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder) {\n        // name  xml , uri  path \n        if (!sAuthoriry.equals(uri.getAuthority())) {\n            return null;\n        }\n        Bundle bundle = new Bundle();\n        if (getContext() != null) {\n            bundle.putString(\"user\", SharedPreferUtil.get(getContext(), Constants.EXTRA_USER_CACHE, \"\"));\n        }\n        return new BundleCursor(bundle);\n    }\n\n    private static final class BundleCursor extends MatrixCursor {\n        private Bundle mBundle;\n\n        public BundleCursor(Bundle extras) {\n            super(new String[]{}, 0);\n            mBundle = extras;\n        }\n\n        @Override\n        public Bundle getExtras() {\n            return mBundle;\n        }\n\n        @Override\n        public Bundle respond(Bundle extras) {\n            mBundle = extras;\n            return mBundle;\n        }\n    }\n\n    @Nullable\n    @Override\n    public String getType(@NonNull Uri uri) {\n        throw new UnsupportedOperationException(\"No external call\");\n    }\n\n    @Nullable\n    @Override\n    public Uri insert(@NonNull Uri uri, @Nullable ContentValues values) {\n        throw new UnsupportedOperationException(\"No external call\");\n    }\n\n    @Override\n    public int delete(@NonNull Uri uri, @Nullable String selection, @Nullable String[] selectionArgs) {\n        throw new UnsupportedOperationException(\"No external call\");\n    }\n\n    @Override\n    public int update(@NonNull Uri uri, @Nullable ContentValues values, @Nullable String selection, @Nullable String[] selectionArgs) {\n        throw new UnsupportedOperationException(\"No external call\");\n    }\n}\n\n```\nAndroidManifest.xml \n``` xml\n<!--  -->\n <provider\n            android:name=\".provider.UserProvider\"\n            android:authorities=\"${applicationId}.UserProvider\"\n            android:exported=\"true\" />\n\n```\n SharePreference  ContentProvider,\n``` java\n    @Nullable\n    public static User getUser() {\n        String authority = \"content://\" + BuildConfig.APPLICATION_ID + \".UserProvider\";\n        Uri uri = Uri.parse(authority);\n        //, Application ,MyApplication.getInstance() ,,NPE\n        Cursor cursor = MyApplication.getInstance().getContentResolver().query(uri, null, null, null, null);\n        if (cursor != null) {\n            Bundle args = cursor.getExtras();\n            cursor.close();\n            if (args != null) {\n                return User.stringToUser(args.getString(\"user\"));\n            }\n        }\n        return null;\n    }\n```\n,User.\n,,,, js,,BroadcastReceiver js .\n## \n1. \n2. \n3. SharePreference , ContentProvider ,\n4. Application ,\n web  Context ,.\n# \n, MB  Note3 , MB,,,,,.\n,,. Service, ID  Service, Service,, oom_adj ,.\n``` java \npublic class KeepLiveService extends Service {\n    public static final int NOTIFICATION_ID = 0x11;\n\n    public KeepLiveService() {\n    }\n\n    @Override\n    public IBinder onBind(Intent intent) {\n        throw new UnsupportedOperationException(\"Not yet implemented\");\n    }\n\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN_MR2) {\n            //API 18  Notification \n            startForeground(NOTIFICATION_ID, new Notification());\n        } else {\n            //API 18  Notification  InnerService\n            Notification.Builder builder = new Notification.Builder(this);\n            builder.setSmallIcon(R.drawable.push);\n            startForeground(NOTIFICATION_ID, builder.build());\n            ContextCompat.startForegroundService(getApplicationContext(), new Intent(this, InnerService.class));\n        }\n    }\n\n    public static class InnerService extends Service {\n\n        public InnerService() {\n        }\n\n        @Override\n        public IBinder onBind(Intent intent) {\n            return null;\n        }\n\n        @Override\n        public void onCreate() {\n            super.onCreate();\n            // KeepLiveService I D  Notification\n            Notification.Builder builder = new Notification.Builder(this);\n            builder.setSmallIcon(R.drawable.push);\n            startForeground(NOTIFICATION_ID, builder.build());\n            stopSelf();\n        }\n\n    }\n}\n```\n Service  AndroidManifest .\n## \n1. compleVerison 27 targetVersion 26 ,\n2. , Application  onTrimMemory, level  TRIM_MEMORY_MODERATE  Web , web .","source":"_posts/android-memory-optimization-3.md","raw":"---\ntitle: Android ()\ndate: 2018-09-13 22:35:04\ntags:\n    - Android\n    - \ncategories: \n    - \n---\n# Web \n, VR ,, WebView ,,, web .,.\n\n##  Web \n,****  **** ,.\n``` xml\n <!-- :ShareUID,data  -->\n <activity\n            android:name=\".WebActivity\"\n            android:process=\":web\"/>\n<!-- :ShareUID -->\n <activity\n            android:name=\".WebActivity\"\n            android:process=\".web\"/>\n```\n,,.\n<!-- more -->\n## \n:\n1. Bundle\n2. \n3. AIDL\n4. Messager\n5. ContentProvider\n6. Socket\n\n,,SharePreference,,,,,ContentProvider,.\n``` java\n/**\n *  web ,web,, query , SharePreference .\n */\npublic class UserProvider extends ContentProvider {\n\n    private static String sAuthoriry = BuildConfig.APPLICATION_ID + \".UserProvider\";\n\n    @Override\n    public boolean onCreate() {\n        return true;\n    }\n\n    @Nullable\n    @Override\n    public Cursor query(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder) {\n        // name  xml , uri  path \n        if (!sAuthoriry.equals(uri.getAuthority())) {\n            return null;\n        }\n        Bundle bundle = new Bundle();\n        if (getContext() != null) {\n            bundle.putString(\"user\", SharedPreferUtil.get(getContext(), Constants.EXTRA_USER_CACHE, \"\"));\n        }\n        return new BundleCursor(bundle);\n    }\n\n    private static final class BundleCursor extends MatrixCursor {\n        private Bundle mBundle;\n\n        public BundleCursor(Bundle extras) {\n            super(new String[]{}, 0);\n            mBundle = extras;\n        }\n\n        @Override\n        public Bundle getExtras() {\n            return mBundle;\n        }\n\n        @Override\n        public Bundle respond(Bundle extras) {\n            mBundle = extras;\n            return mBundle;\n        }\n    }\n\n    @Nullable\n    @Override\n    public String getType(@NonNull Uri uri) {\n        throw new UnsupportedOperationException(\"No external call\");\n    }\n\n    @Nullable\n    @Override\n    public Uri insert(@NonNull Uri uri, @Nullable ContentValues values) {\n        throw new UnsupportedOperationException(\"No external call\");\n    }\n\n    @Override\n    public int delete(@NonNull Uri uri, @Nullable String selection, @Nullable String[] selectionArgs) {\n        throw new UnsupportedOperationException(\"No external call\");\n    }\n\n    @Override\n    public int update(@NonNull Uri uri, @Nullable ContentValues values, @Nullable String selection, @Nullable String[] selectionArgs) {\n        throw new UnsupportedOperationException(\"No external call\");\n    }\n}\n\n```\nAndroidManifest.xml \n``` xml\n<!--  -->\n <provider\n            android:name=\".provider.UserProvider\"\n            android:authorities=\"${applicationId}.UserProvider\"\n            android:exported=\"true\" />\n\n```\n SharePreference  ContentProvider,\n``` java\n    @Nullable\n    public static User getUser() {\n        String authority = \"content://\" + BuildConfig.APPLICATION_ID + \".UserProvider\";\n        Uri uri = Uri.parse(authority);\n        //, Application ,MyApplication.getInstance() ,,NPE\n        Cursor cursor = MyApplication.getInstance().getContentResolver().query(uri, null, null, null, null);\n        if (cursor != null) {\n            Bundle args = cursor.getExtras();\n            cursor.close();\n            if (args != null) {\n                return User.stringToUser(args.getString(\"user\"));\n            }\n        }\n        return null;\n    }\n```\n,User.\n,,,, js,,BroadcastReceiver js .\n## \n1. \n2. \n3. SharePreference , ContentProvider ,\n4. Application ,\n web  Context ,.\n# \n, MB  Note3 , MB,,,,,.\n,,. Service, ID  Service, Service,, oom_adj ,.\n``` java \npublic class KeepLiveService extends Service {\n    public static final int NOTIFICATION_ID = 0x11;\n\n    public KeepLiveService() {\n    }\n\n    @Override\n    public IBinder onBind(Intent intent) {\n        throw new UnsupportedOperationException(\"Not yet implemented\");\n    }\n\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN_MR2) {\n            //API 18  Notification \n            startForeground(NOTIFICATION_ID, new Notification());\n        } else {\n            //API 18  Notification  InnerService\n            Notification.Builder builder = new Notification.Builder(this);\n            builder.setSmallIcon(R.drawable.push);\n            startForeground(NOTIFICATION_ID, builder.build());\n            ContextCompat.startForegroundService(getApplicationContext(), new Intent(this, InnerService.class));\n        }\n    }\n\n    public static class InnerService extends Service {\n\n        public InnerService() {\n        }\n\n        @Override\n        public IBinder onBind(Intent intent) {\n            return null;\n        }\n\n        @Override\n        public void onCreate() {\n            super.onCreate();\n            // KeepLiveService I D  Notification\n            Notification.Builder builder = new Notification.Builder(this);\n            builder.setSmallIcon(R.drawable.push);\n            startForeground(NOTIFICATION_ID, builder.build());\n            stopSelf();\n        }\n\n    }\n}\n```\n Service  AndroidManifest .\n## \n1. compleVerison 27 targetVersion 26 ,\n2. , Application  onTrimMemory, level  TRIM_MEMORY_MODERATE  Web , web .","slug":"android-memory-optimization-3","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsa9000vndf2b8krzj3t","content":"<h1 id=\"Web-\"><a href=\"#Web-\" class=\"headerlink\" title=\"Web \"></a>Web </h1><p>, VR ,, WebView ,,, web .,.</p>\n<h2 id=\"-Web-\"><a href=\"#-Web-\" class=\"headerlink\" title=\" Web \"></a> Web </h2><p>,<strong></strong>  <strong></strong> ,.<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">&lt;!-- :ShareUID,data  --&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">activity</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:name</span>=<span class=\"string\">\".WebActivity\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:process</span>=<span class=\"string\">\":web\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- :ShareUID --&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">activity</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:name</span>=<span class=\"string\">\".WebActivity\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:process</span>=<span class=\"string\">\".web\"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>,,.<br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<ol>\n<li>Bundle</li>\n<li></li>\n<li>AIDL</li>\n<li>Messager</li>\n<li>ContentProvider</li>\n<li>Socket</li>\n</ol>\n<p>,,SharePreference,,,,,ContentProvider,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  web ,web,, query , SharePreference .</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserProvider</span> <span class=\"keyword\">extends</span> <span class=\"title\">ContentProvider</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String sAuthoriry = BuildConfig.APPLICATION_ID + <span class=\"string\">\".UserProvider\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Cursor <span class=\"title\">query</span><span class=\"params\">(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// name  xml , uri  path </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!sAuthoriry.equals(uri.getAuthority())) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Bundle bundle = <span class=\"keyword\">new</span> Bundle();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (getContext() != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            bundle.putString(<span class=\"string\">\"user\"</span>, SharedPreferUtil.get(getContext(), Constants.EXTRA_USER_CACHE, <span class=\"string\">\"\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> BundleCursor(bundle);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BundleCursor</span> <span class=\"keyword\">extends</span> <span class=\"title\">MatrixCursor</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> Bundle mBundle;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">BundleCursor</span><span class=\"params\">(Bundle extras)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>(<span class=\"keyword\">new</span> String[]&#123;&#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\">            mBundle = extras;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> Bundle <span class=\"title\">getExtras</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> mBundle;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> Bundle <span class=\"title\">respond</span><span class=\"params\">(Bundle extras)</span> </span>&#123;</span><br><span class=\"line\">            mBundle = extras;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> mBundle;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getType</span><span class=\"params\">(@NonNull Uri uri)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"No external call\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Uri <span class=\"title\">insert</span><span class=\"params\">(@NonNull Uri uri, @Nullable ContentValues values)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"No external call\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">delete</span><span class=\"params\">(@NonNull Uri uri, @Nullable String selection, @Nullable String[] selectionArgs)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"No external call\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">update</span><span class=\"params\">(@NonNull Uri uri, @Nullable ContentValues values, @Nullable String selection, @Nullable String[] selectionArgs)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"No external call\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>AndroidManifest.xml <br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">provider</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:name</span>=<span class=\"string\">\".provider.UserProvider\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:authorities</span>=<span class=\"string\">\"$&#123;applicationId&#125;.UserProvider\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:exported</span>=<span class=\"string\">\"true\"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p> SharePreference  ContentProvider,<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Nullable</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> User <span class=\"title\">getUser</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    String authority = <span class=\"string\">\"content://\"</span> + BuildConfig.APPLICATION_ID + <span class=\"string\">\".UserProvider\"</span>;</span><br><span class=\"line\">    Uri uri = Uri.parse(authority);</span><br><span class=\"line\">    <span class=\"comment\">//, Application ,MyApplication.getInstance() ,,NPE</span></span><br><span class=\"line\">    Cursor cursor = MyApplication.getInstance().getContentResolver().query(uri, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cursor != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        Bundle args = cursor.getExtras();</span><br><span class=\"line\">        cursor.close();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (args != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> User.stringToUser(args.getString(<span class=\"string\">\"user\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>,User.<br>,,,, js,,BroadcastReceiver js .</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li></li>\n<li></li>\n<li>SharePreference , ContentProvider ,</li>\n<li>Application ,<br> web  Context ,.<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1>, MB  Note3 , MB,,,,,.<br>,,. Service, ID  Service, Service,, oom_adj ,.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">KeepLiveService</span> <span class=\"keyword\">extends</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NOTIFICATION_ID = <span class=\"number\">0x11</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">KeepLiveService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IBinder <span class=\"title\">onBind</span><span class=\"params\">(Intent intent)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"Not yet implemented\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.JELLY_BEAN_MR2) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//API 18  Notification </span></span><br><span class=\"line\">            startForeground(NOTIFICATION_ID, <span class=\"keyword\">new</span> Notification());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//API 18  Notification  InnerService</span></span><br><span class=\"line\">            Notification.Builder builder = <span class=\"keyword\">new</span> Notification.Builder(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">            builder.setSmallIcon(R.drawable.push);</span><br><span class=\"line\">            startForeground(NOTIFICATION_ID, builder.build());</span><br><span class=\"line\">            ContextCompat.startForegroundService(getApplicationContext(), <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>, InnerService<span class=\"class\">.<span class=\"keyword\">class</span>))</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InnerService</span> <span class=\"keyword\">extends</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">InnerService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> IBinder <span class=\"title\">onBind</span><span class=\"params\">(Intent intent)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>.onCreate();</span><br><span class=\"line\">            <span class=\"comment\">// KeepLiveService I D  Notification</span></span><br><span class=\"line\">            Notification.Builder builder = <span class=\"keyword\">new</span> Notification.Builder(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">            builder.setSmallIcon(R.drawable.push);</span><br><span class=\"line\">            startForeground(NOTIFICATION_ID, builder.build());</span><br><span class=\"line\">            stopSelf();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p> Service  AndroidManifest .</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li>compleVerison 27 targetVersion 26 ,</li>\n<li>, Application  onTrimMemory, level  TRIM_MEMORY_MODERATE  Web , web .</li>\n</ol>\n","site":{"data":{}},"excerpt":"<h1 id=\"Web-\"><a href=\"#Web-\" class=\"headerlink\" title=\"Web \"></a>Web </h1><p>, VR ,, WebView ,,, web .,.</p>\n<h2 id=\"-Web-\"><a href=\"#-Web-\" class=\"headerlink\" title=\" Web \"></a> Web </h2><p>,<strong></strong>  <strong></strong> ,.<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">&lt;!-- :ShareUID,data  --&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">activity</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:name</span>=<span class=\"string\">\".WebActivity\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:process</span>=<span class=\"string\">\":web\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- :ShareUID --&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">activity</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:name</span>=<span class=\"string\">\".WebActivity\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:process</span>=<span class=\"string\">\".web\"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>,,.<br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>:</p>\n<ol>\n<li>Bundle</li>\n<li></li>\n<li>AIDL</li>\n<li>Messager</li>\n<li>ContentProvider</li>\n<li>Socket</li>\n</ol>\n<p>,,SharePreference,,,,,ContentProvider,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  web ,web,, query , SharePreference .</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserProvider</span> <span class=\"keyword\">extends</span> <span class=\"title\">ContentProvider</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String sAuthoriry = BuildConfig.APPLICATION_ID + <span class=\"string\">\".UserProvider\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Cursor <span class=\"title\">query</span><span class=\"params\">(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// name  xml , uri  path </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!sAuthoriry.equals(uri.getAuthority())) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Bundle bundle = <span class=\"keyword\">new</span> Bundle();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (getContext() != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            bundle.putString(<span class=\"string\">\"user\"</span>, SharedPreferUtil.get(getContext(), Constants.EXTRA_USER_CACHE, <span class=\"string\">\"\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> BundleCursor(bundle);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BundleCursor</span> <span class=\"keyword\">extends</span> <span class=\"title\">MatrixCursor</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> Bundle mBundle;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">BundleCursor</span><span class=\"params\">(Bundle extras)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>(<span class=\"keyword\">new</span> String[]&#123;&#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\">            mBundle = extras;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> Bundle <span class=\"title\">getExtras</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> mBundle;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> Bundle <span class=\"title\">respond</span><span class=\"params\">(Bundle extras)</span> </span>&#123;</span><br><span class=\"line\">            mBundle = extras;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> mBundle;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getType</span><span class=\"params\">(@NonNull Uri uri)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"No external call\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Uri <span class=\"title\">insert</span><span class=\"params\">(@NonNull Uri uri, @Nullable ContentValues values)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"No external call\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">delete</span><span class=\"params\">(@NonNull Uri uri, @Nullable String selection, @Nullable String[] selectionArgs)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"No external call\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">update</span><span class=\"params\">(@NonNull Uri uri, @Nullable ContentValues values, @Nullable String selection, @Nullable String[] selectionArgs)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"No external call\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>AndroidManifest.xml <br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">provider</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:name</span>=<span class=\"string\">\".provider.UserProvider\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:authorities</span>=<span class=\"string\">\"$&#123;applicationId&#125;.UserProvider\"</span></span></span><br><span class=\"line\"><span class=\"tag\">            <span class=\"attr\">android:exported</span>=<span class=\"string\">\"true\"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p> SharePreference  ContentProvider,<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Nullable</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> User <span class=\"title\">getUser</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    String authority = <span class=\"string\">\"content://\"</span> + BuildConfig.APPLICATION_ID + <span class=\"string\">\".UserProvider\"</span>;</span><br><span class=\"line\">    Uri uri = Uri.parse(authority);</span><br><span class=\"line\">    <span class=\"comment\">//, Application ,MyApplication.getInstance() ,,NPE</span></span><br><span class=\"line\">    Cursor cursor = MyApplication.getInstance().getContentResolver().query(uri, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cursor != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        Bundle args = cursor.getExtras();</span><br><span class=\"line\">        cursor.close();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (args != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> User.stringToUser(args.getString(<span class=\"string\">\"user\"</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>,User.<br>,,,, js,,BroadcastReceiver js .</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li></li>\n<li></li>\n<li>SharePreference , ContentProvider ,</li>\n<li>Application ,<br> web  Context ,.<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1>, MB  Note3 , MB,,,,,.<br>,,. Service, ID  Service, Service,, oom_adj ,.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">KeepLiveService</span> <span class=\"keyword\">extends</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NOTIFICATION_ID = <span class=\"number\">0x11</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">KeepLiveService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> IBinder <span class=\"title\">onBind</span><span class=\"params\">(Intent intent)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> UnsupportedOperationException(<span class=\"string\">\"Not yet implemented\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.onCreate();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.JELLY_BEAN_MR2) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//API 18  Notification </span></span><br><span class=\"line\">            startForeground(NOTIFICATION_ID, <span class=\"keyword\">new</span> Notification());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//API 18  Notification  InnerService</span></span><br><span class=\"line\">            Notification.Builder builder = <span class=\"keyword\">new</span> Notification.Builder(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">            builder.setSmallIcon(R.drawable.push);</span><br><span class=\"line\">            startForeground(NOTIFICATION_ID, builder.build());</span><br><span class=\"line\">            ContextCompat.startForegroundService(getApplicationContext(), <span class=\"keyword\">new</span> Intent(<span class=\"keyword\">this</span>, InnerService<span class=\"class\">.<span class=\"keyword\">class</span>))</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InnerService</span> <span class=\"keyword\">extends</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">InnerService</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> IBinder <span class=\"title\">onBind</span><span class=\"params\">(Intent intent)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onCreate</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>.onCreate();</span><br><span class=\"line\">            <span class=\"comment\">// KeepLiveService I D  Notification</span></span><br><span class=\"line\">            Notification.Builder builder = <span class=\"keyword\">new</span> Notification.Builder(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">            builder.setSmallIcon(R.drawable.push);</span><br><span class=\"line\">            startForeground(NOTIFICATION_ID, builder.build());</span><br><span class=\"line\">            stopSelf();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p> Service  AndroidManifest .</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li>compleVerison 27 targetVersion 26 ,</li>\n<li>, Application  onTrimMemory, level  TRIM_MEMORY_MODERATE  Web , web .</li>\n</ol>"},{"title":"Android ","date":"2018-12-07T01:24:46.000Z","_content":",.\n# \n## Android 8.1 apk  android.permission.ACCESS_ALL_DOWNLOADS\ntargetVersion 28  apk flag, 8.1.0(27) , 8.0(26) ,.\n```\n    Writing exception to parceljava.lang.SecurityException: Permission Denial: reading com.android.providers.downloads.DownloadProvider uri content://downloads/all_downloads/7 from pid=3633, uid=10037 requires android.permission.ACCESS_ALL_DOWNLOADS, or grantUriPermission()\n        at android.content.ContentProvider.enforceReadPermissionInner(ContentProvider.java:631)\n        at android.content.ContentProvider$Transport.enforceReadPermission(ContentProvider.java:501)\n        at android.content.ContentProvider$Transport.enforceFilePermission(ContentProvider.java:492)\n        at android.content.ContentProvider$Transport.openTypedAssetFile(ContentProvider.java:420)\n        at android.content.ContentProviderNative.onTransact(ContentProviderNative.java:302)\n        at android.os.Binder.execTransact(Binder.java:698)\n```\n: `intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);`\n\n```  java \n Intent intent = new Intent(Intent.ACTION_VIEW);\n        intent.setDataAndType(downloadFileUri, \"application/vnd.android.package-archive\");\n        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n        intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);\n        mContext.startActivity(intent);\n```\n<!-- more -->\n## TimeoutException\n bugly \n![](https://def-201655.cos.ap-shanghai.myqcloud.com/exception_timeout.png),.\n,[finalizerTimedOut()](http://androidxref.com/9.0.0_r3/xref/libcore/libart/src/main/java/java/lang/Daemons.java#396), Finalizer .120s , oppo 120s, oppo .\n:\n1.   finalize  GC,,\n2. \n3.  FinalizerWatchdogDaemon  thread ,,(https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin),\n[Finalizer--App](https://yq.aliyun.com/articles/225755) , Finalizer ,.\n\n## java.lang.IllegalStateException: Only fullscreen opaque activities can request orientation\n bugly  WXEntryActivity  bug,8.0\n 8.0 [](https://github.com/aosp-mirror/platform_frameworks_base/blob/39791594560b2326625b663ed6796882900c220f/core/java/android/app/Activity.java#L984), 9.0 ,,.\n`ActivityInfo.isTranslucentOrFloating`, Activity  theme  `android:windowIsFloating  android:windowSwipeToDismiss  android:windowIsTranslucent`,.\n AndroidManifest , WXEntryActivity `android:screenOrientation=\"portrait\"\n            android:theme=\"@android:style/Theme.Translucent.NoTitleBar\"`\n Activity ,`android:screenOrientation=\"portrait\"`.\n,.\n\n##  RuntimeException: takePicture failed\n bug ,, native , jni ,,.,.,.\n,,.\n\n## RemoteException:Remote stack trace: at com.android.server.am.ActivityManagerService.enforcePermission()\n App ,, bugly  9.0 , Leakcanary .\n 9.0  AMS `enforcePermission``android.permission.FOREGROUND_SERVICE`, AndroidManifest ,. 9.0 [](https://developer.android.com/reference/android/app/Service.html#startForeground(int,%20android.app.Notification)).\n targetSdkVersion  Android [](https://developer.android.com/about/versions/pie/android-9.0-migration).\n\n*  9.0  WebView ,[](https://developer.android.com/about/versions/pie/android-9.0-changes-28#web-data-dirs)\n\n## , FileNotFoundException\n xhdpi ,,`<item name=\"test\"  type=\"drawable\"/>`, xhdpi ,,,`java.io.FileNotFoundException`.\n\n# \n## SSL\n\n,AS,SSL\n:,AS( command+q AS)\n## app:transformNativeLibsWithStripDebugSymbolForProduceRelease, not found mips64el-linux-android-strip\n AS 3.2.1, Gradle 3.0.1, NDK 17,  NDK ![](https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_exception_ndk.png), 17 .\n:\n1. Gradle , 3.2.1,,.\n2.  NDK 16, ndk-bundle/ \n3.  NDK 16, mips64el-linux-android-strip \n\n## PKIX path building failed\n\n `sun.security.validator.ValidatorException: PKIX path building failed:\nsun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target`\n:\n, File->invalidate Caches/Restart  AS\n\nError occurred while communicating with CMake server. Check log /Users/libery_tuya/Company/react-native/ReactAndroid/.externalNativeBuild/cmake/debug/armeabi/cmake_server_log.txt for additional information.\n\n## ,`a.a.a`\n\n```\n    buildTypes {\n        release {\n            minifyEnabled true\n            // Android proguard-android.txt \n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n```","source":"_posts/android-exception-summary.md","raw":"---\ntitle: Android \ndate: 2018-12-07 09:24:46\ntags:\n    - Android\n    - \n    - \n    - \ncategories: \n    - \n---\n,.\n# \n## Android 8.1 apk  android.permission.ACCESS_ALL_DOWNLOADS\ntargetVersion 28  apk flag, 8.1.0(27) , 8.0(26) ,.\n```\n    Writing exception to parceljava.lang.SecurityException: Permission Denial: reading com.android.providers.downloads.DownloadProvider uri content://downloads/all_downloads/7 from pid=3633, uid=10037 requires android.permission.ACCESS_ALL_DOWNLOADS, or grantUriPermission()\n        at android.content.ContentProvider.enforceReadPermissionInner(ContentProvider.java:631)\n        at android.content.ContentProvider$Transport.enforceReadPermission(ContentProvider.java:501)\n        at android.content.ContentProvider$Transport.enforceFilePermission(ContentProvider.java:492)\n        at android.content.ContentProvider$Transport.openTypedAssetFile(ContentProvider.java:420)\n        at android.content.ContentProviderNative.onTransact(ContentProviderNative.java:302)\n        at android.os.Binder.execTransact(Binder.java:698)\n```\n: `intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);`\n\n```  java \n Intent intent = new Intent(Intent.ACTION_VIEW);\n        intent.setDataAndType(downloadFileUri, \"application/vnd.android.package-archive\");\n        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n        intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);\n        mContext.startActivity(intent);\n```\n<!-- more -->\n## TimeoutException\n bugly \n![](https://def-201655.cos.ap-shanghai.myqcloud.com/exception_timeout.png),.\n,[finalizerTimedOut()](http://androidxref.com/9.0.0_r3/xref/libcore/libart/src/main/java/java/lang/Daemons.java#396), Finalizer .120s , oppo 120s, oppo .\n:\n1.   finalize  GC,,\n2. \n3.  FinalizerWatchdogDaemon  thread ,,(https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin),\n[Finalizer--App](https://yq.aliyun.com/articles/225755) , Finalizer ,.\n\n## java.lang.IllegalStateException: Only fullscreen opaque activities can request orientation\n bugly  WXEntryActivity  bug,8.0\n 8.0 [](https://github.com/aosp-mirror/platform_frameworks_base/blob/39791594560b2326625b663ed6796882900c220f/core/java/android/app/Activity.java#L984), 9.0 ,,.\n`ActivityInfo.isTranslucentOrFloating`, Activity  theme  `android:windowIsFloating  android:windowSwipeToDismiss  android:windowIsTranslucent`,.\n AndroidManifest , WXEntryActivity `android:screenOrientation=\"portrait\"\n            android:theme=\"@android:style/Theme.Translucent.NoTitleBar\"`\n Activity ,`android:screenOrientation=\"portrait\"`.\n,.\n\n##  RuntimeException: takePicture failed\n bug ,, native , jni ,,.,.,.\n,,.\n\n## RemoteException:Remote stack trace: at com.android.server.am.ActivityManagerService.enforcePermission()\n App ,, bugly  9.0 , Leakcanary .\n 9.0  AMS `enforcePermission``android.permission.FOREGROUND_SERVICE`, AndroidManifest ,. 9.0 [](https://developer.android.com/reference/android/app/Service.html#startForeground(int,%20android.app.Notification)).\n targetSdkVersion  Android [](https://developer.android.com/about/versions/pie/android-9.0-migration).\n\n*  9.0  WebView ,[](https://developer.android.com/about/versions/pie/android-9.0-changes-28#web-data-dirs)\n\n## , FileNotFoundException\n xhdpi ,,`<item name=\"test\"  type=\"drawable\"/>`, xhdpi ,,,`java.io.FileNotFoundException`.\n\n# \n## SSL\n\n,AS,SSL\n:,AS( command+q AS)\n## app:transformNativeLibsWithStripDebugSymbolForProduceRelease, not found mips64el-linux-android-strip\n AS 3.2.1, Gradle 3.0.1, NDK 17,  NDK ![](https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_exception_ndk.png), 17 .\n:\n1. Gradle , 3.2.1,,.\n2.  NDK 16, ndk-bundle/ \n3.  NDK 16, mips64el-linux-android-strip \n\n## PKIX path building failed\n\n `sun.security.validator.ValidatorException: PKIX path building failed:\nsun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target`\n:\n, File->invalidate Caches/Restart  AS\n\nError occurred while communicating with CMake server. Check log /Users/libery_tuya/Company/react-native/ReactAndroid/.externalNativeBuild/cmake/debug/armeabi/cmake_server_log.txt for additional information.\n\n## ,`a.a.a`\n\n```\n    buildTypes {\n        release {\n            minifyEnabled true\n            // Android proguard-android.txt \n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n```","slug":"android-exception-summary","published":1,"updated":"2019-12-18T13:05:56.650Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsaa000yndf2dx9wc2mm","content":"<p>,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"Android-8-1-apk--android-permission-ACCESS-ALL-DOWNLOADS\"><a href=\"#Android-8-1-apk--android-permission-ACCESS-ALL-DOWNLOADS\" class=\"headerlink\" title=\"Android 8.1 apk  android.permission.ACCESS_ALL_DOWNLOADS\"></a>Android 8.1 apk  android.permission.ACCESS_ALL_DOWNLOADS</h2><p>targetVersion 28  apk flag, 8.1.0(27) , 8.0(26) ,.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Writing exception to parceljava.lang.SecurityException: Permission Denial: reading com.android.providers.downloads.DownloadProvider uri content://downloads/all_downloads/7 from pid=3633, uid=10037 requires android.permission.ACCESS_ALL_DOWNLOADS, or grantUriPermission()</span><br><span class=\"line\">    at android.content.ContentProvider.enforceReadPermissionInner(ContentProvider.java:631)</span><br><span class=\"line\">    at android.content.ContentProvider$Transport.enforceReadPermission(ContentProvider.java:501)</span><br><span class=\"line\">    at android.content.ContentProvider$Transport.enforceFilePermission(ContentProvider.java:492)</span><br><span class=\"line\">    at android.content.ContentProvider$Transport.openTypedAssetFile(ContentProvider.java:420)</span><br><span class=\"line\">    at android.content.ContentProviderNative.onTransact(ContentProviderNative.java:302)</span><br><span class=\"line\">    at android.os.Binder.execTransact(Binder.java:698)</span><br></pre></td></tr></table></figure></p>\n<p>: <code>intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</code><br><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Intent intent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class=\"line\">       intent.setDataAndType(downloadFileUri, <span class=\"string\">\"application/vnd.android.package-archive\"</span>);</span><br><span class=\"line\">       intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class=\"line\">       intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class=\"line\">       mContext.startActivity(intent);</span><br></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<h2 id=\"TimeoutException\"><a href=\"#TimeoutException\" class=\"headerlink\" title=\"TimeoutException\"></a>TimeoutException</h2><p> bugly <br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/exception_timeout.png\" alt>,.<br>,<a href=\"http://androidxref.com/9.0.0_r3/xref/libcore/libart/src/main/java/java/lang/Daemons.java#396\" target=\"_blank\" rel=\"noopener\">finalizerTimedOut()</a>, Finalizer .120s , oppo 120s, oppo .<br>:</p>\n<ol>\n<li>  finalize  GC,,</li>\n<li></li>\n<li> FinalizerWatchdogDaemon  thread ,,(<a href=\"https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin),\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin),</a><br><a href=\"https://yq.aliyun.com/articles/225755\" target=\"_blank\" rel=\"noopener\">FinalizerApp</a> , Finalizer ,.</li>\n</ol>\n<h2 id=\"java-lang-IllegalStateException-Only-fullscreen-opaque-activities-can-request-orientation\"><a href=\"#java-lang-IllegalStateException-Only-fullscreen-opaque-activities-can-request-orientation\" class=\"headerlink\" title=\"java.lang.IllegalStateException: Only fullscreen opaque activities can request orientation\"></a>java.lang.IllegalStateException: Only fullscreen opaque activities can request orientation</h2><p> bugly  WXEntryActivity  bug,8.0<br> 8.0 <a href=\"https://github.com/aosp-mirror/platform_frameworks_base/blob/39791594560b2326625b663ed6796882900c220f/core/java/android/app/Activity.java#L984\"></a>, 9.0 ,,.<br><code>ActivityInfo.isTranslucentOrFloating</code>, Activity  theme  <code>android:windowIsFloating  android:windowSwipeToDismiss  android:windowIsTranslucent</code>,.<br> AndroidManifest , WXEntryActivity <code>android:screenOrientation=&quot;portrait&quot;\n            android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar&quot;</code><br> Activity ,<code>android:screenOrientation=&quot;portrait&quot;</code>.<br>,.</p>\n<h2 id=\"-RuntimeException-takePicture-failed\"><a href=\"#-RuntimeException-takePicture-failed\" class=\"headerlink\" title=\" RuntimeException: takePicture failed\"></a> RuntimeException: takePicture failed</h2><p> bug ,, native , jni ,,.,.,.<br>,,.</p>\n<h2 id=\"RemoteException-Remote-stack-trace-at-com-android-server-am-ActivityManagerService-enforcePermission\"><a href=\"#RemoteException-Remote-stack-trace-at-com-android-server-am-ActivityManagerService-enforcePermission\" class=\"headerlink\" title=\"RemoteException:Remote stack trace: at com.android.server.am.ActivityManagerService.enforcePermission()\"></a>RemoteException:Remote stack trace: at com.android.server.am.ActivityManagerService.enforcePermission()</h2><p> App ,, bugly  9.0 , Leakcanary .<br> 9.0  AMS <code>enforcePermission</code><code>android.permission.FOREGROUND_SERVICE</code>, AndroidManifest ,. 9.0 <a href=\"https://developer.android.com/reference/android/app/Service.html#startForeground(int,%20android.app.Notification\" target=\"_blank\" rel=\"noopener\"></a>).<br> targetSdkVersion  Android <a href=\"https://developer.android.com/about/versions/pie/android-9.0-migration\" target=\"_blank\" rel=\"noopener\"></a>.</p>\n<ul>\n<li> 9.0  WebView ,<a href=\"https://developer.android.com/about/versions/pie/android-9.0-changes-28#web-data-dirs\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n<h2 id=\"--FileNotFoundException\"><a href=\"#--FileNotFoundException\" class=\"headerlink\" title=\", FileNotFoundException\"></a>, FileNotFoundException</h2><p> xhdpi ,,<code>&lt;item name=&quot;test&quot;  type=&quot;drawable&quot;/&gt;</code>, xhdpi ,,,<code>java.io.FileNotFoundException</code>.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"SSL\"><a href=\"#SSL\" class=\"headerlink\" title=\"SSL\"></a>SSL</h2><p>,AS,SSL<br>:,AS( command+q AS)</p>\n<h2 id=\"app-transformNativeLibsWithStripDebugSymbolForProduceRelease-not-found-mips64el-linux-android-strip\"><a href=\"#app-transformNativeLibsWithStripDebugSymbolForProduceRelease-not-found-mips64el-linux-android-strip\" class=\"headerlink\" title=\"app:transformNativeLibsWithStripDebugSymbolForProduceRelease, not found mips64el-linux-android-strip\"></a>app:transformNativeLibsWithStripDebugSymbolForProduceRelease, not found mips64el-linux-android-strip</h2><p> AS 3.2.1, Gradle 3.0.1, NDK 17,  NDK <img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_exception_ndk.png\" alt>, 17 .<br>:</p>\n<ol>\n<li>Gradle , 3.2.1,,.</li>\n<li> NDK 16, ndk-bundle/ </li>\n<li> NDK 16, mips64el-linux-android-strip </li>\n</ol>\n<h2 id=\"PKIX-path-building-failed\"><a href=\"#PKIX-path-building-failed\" class=\"headerlink\" title=\"PKIX path building failed\"></a>PKIX path building failed</h2><p> <code>sun.security.validator.ValidatorException: PKIX path building failed:\nsun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</code><br>:<br>, File-&gt;invalidate Caches/Restart  AS</p>\n<p>Error occurred while communicating with CMake server. Check log /Users/libery_tuya/Company/react-native/ReactAndroid/.externalNativeBuild/cmake/debug/armeabi/cmake_server_log.txt for additional information.</p>\n<h2 id=\"-a-a-a\"><a href=\"#-a-a-a\" class=\"headerlink\" title=\",a.a.a\"></a>,<code>a.a.a</code></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildTypes &#123;</span><br><span class=\"line\">    release &#123;</span><br><span class=\"line\">        minifyEnabled true</span><br><span class=\"line\">        // Android proguard-android.txt </span><br><span class=\"line\">        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"Android-8-1-apk--android-permission-ACCESS-ALL-DOWNLOADS\"><a href=\"#Android-8-1-apk--android-permission-ACCESS-ALL-DOWNLOADS\" class=\"headerlink\" title=\"Android 8.1 apk  android.permission.ACCESS_ALL_DOWNLOADS\"></a>Android 8.1 apk  android.permission.ACCESS_ALL_DOWNLOADS</h2><p>targetVersion 28  apk flag, 8.1.0(27) , 8.0(26) ,.<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Writing exception to parceljava.lang.SecurityException: Permission Denial: reading com.android.providers.downloads.DownloadProvider uri content://downloads/all_downloads/7 from pid=3633, uid=10037 requires android.permission.ACCESS_ALL_DOWNLOADS, or grantUriPermission()</span><br><span class=\"line\">    at android.content.ContentProvider.enforceReadPermissionInner(ContentProvider.java:631)</span><br><span class=\"line\">    at android.content.ContentProvider$Transport.enforceReadPermission(ContentProvider.java:501)</span><br><span class=\"line\">    at android.content.ContentProvider$Transport.enforceFilePermission(ContentProvider.java:492)</span><br><span class=\"line\">    at android.content.ContentProvider$Transport.openTypedAssetFile(ContentProvider.java:420)</span><br><span class=\"line\">    at android.content.ContentProviderNative.onTransact(ContentProviderNative.java:302)</span><br><span class=\"line\">    at android.os.Binder.execTransact(Binder.java:698)</span><br></pre></td></tr></table></figure></p>\n<p>: <code>intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</code><br><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Intent intent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class=\"line\">       intent.setDataAndType(downloadFileUri, <span class=\"string\">\"application/vnd.android.package-archive\"</span>);</span><br><span class=\"line\">       intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class=\"line\">       intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class=\"line\">       mContext.startActivity(intent);</span><br></pre></td></tr></table></figure></p>","more":"<h2 id=\"TimeoutException\"><a href=\"#TimeoutException\" class=\"headerlink\" title=\"TimeoutException\"></a>TimeoutException</h2><p> bugly <br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/exception_timeout.png\" alt>,.<br>,<a href=\"http://androidxref.com/9.0.0_r3/xref/libcore/libart/src/main/java/java/lang/Daemons.java#396\" target=\"_blank\" rel=\"noopener\">finalizerTimedOut()</a>, Finalizer .120s , oppo 120s, oppo .<br>:</p>\n<ol>\n<li>  finalize  GC,,</li>\n<li></li>\n<li> FinalizerWatchdogDaemon  thread ,,(<a href=\"https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin),\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin),</a><br><a href=\"https://yq.aliyun.com/articles/225755\" target=\"_blank\" rel=\"noopener\">FinalizerApp</a> , Finalizer ,.</li>\n</ol>\n<h2 id=\"java-lang-IllegalStateException-Only-fullscreen-opaque-activities-can-request-orientation\"><a href=\"#java-lang-IllegalStateException-Only-fullscreen-opaque-activities-can-request-orientation\" class=\"headerlink\" title=\"java.lang.IllegalStateException: Only fullscreen opaque activities can request orientation\"></a>java.lang.IllegalStateException: Only fullscreen opaque activities can request orientation</h2><p> bugly  WXEntryActivity  bug,8.0<br> 8.0 <a href=\"https://github.com/aosp-mirror/platform_frameworks_base/blob/39791594560b2326625b663ed6796882900c220f/core/java/android/app/Activity.java#L984\"></a>, 9.0 ,,.<br><code>ActivityInfo.isTranslucentOrFloating</code>, Activity  theme  <code>android:windowIsFloating  android:windowSwipeToDismiss  android:windowIsTranslucent</code>,.<br> AndroidManifest , WXEntryActivity <code>android:screenOrientation=&quot;portrait&quot;\n            android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar&quot;</code><br> Activity ,<code>android:screenOrientation=&quot;portrait&quot;</code>.<br>,.</p>\n<h2 id=\"-RuntimeException-takePicture-failed\"><a href=\"#-RuntimeException-takePicture-failed\" class=\"headerlink\" title=\" RuntimeException: takePicture failed\"></a> RuntimeException: takePicture failed</h2><p> bug ,, native , jni ,,.,.,.<br>,,.</p>\n<h2 id=\"RemoteException-Remote-stack-trace-at-com-android-server-am-ActivityManagerService-enforcePermission\"><a href=\"#RemoteException-Remote-stack-trace-at-com-android-server-am-ActivityManagerService-enforcePermission\" class=\"headerlink\" title=\"RemoteException:Remote stack trace: at com.android.server.am.ActivityManagerService.enforcePermission()\"></a>RemoteException:Remote stack trace: at com.android.server.am.ActivityManagerService.enforcePermission()</h2><p> App ,, bugly  9.0 , Leakcanary .<br> 9.0  AMS <code>enforcePermission</code><code>android.permission.FOREGROUND_SERVICE</code>, AndroidManifest ,. 9.0 <a href=\"https://developer.android.com/reference/android/app/Service.html#startForeground(int,%20android.app.Notification\" target=\"_blank\" rel=\"noopener\"></a>).<br> targetSdkVersion  Android <a href=\"https://developer.android.com/about/versions/pie/android-9.0-migration\" target=\"_blank\" rel=\"noopener\"></a>.</p>\n<ul>\n<li> 9.0  WebView ,<a href=\"https://developer.android.com/about/versions/pie/android-9.0-changes-28#web-data-dirs\" target=\"_blank\" rel=\"noopener\"></a></li>\n</ul>\n<h2 id=\"--FileNotFoundException\"><a href=\"#--FileNotFoundException\" class=\"headerlink\" title=\", FileNotFoundException\"></a>, FileNotFoundException</h2><p> xhdpi ,,<code>&lt;item name=&quot;test&quot;  type=&quot;drawable&quot;/&gt;</code>, xhdpi ,,,<code>java.io.FileNotFoundException</code>.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"SSL\"><a href=\"#SSL\" class=\"headerlink\" title=\"SSL\"></a>SSL</h2><p>,AS,SSL<br>:,AS( command+q AS)</p>\n<h2 id=\"app-transformNativeLibsWithStripDebugSymbolForProduceRelease-not-found-mips64el-linux-android-strip\"><a href=\"#app-transformNativeLibsWithStripDebugSymbolForProduceRelease-not-found-mips64el-linux-android-strip\" class=\"headerlink\" title=\"app:transformNativeLibsWithStripDebugSymbolForProduceRelease, not found mips64el-linux-android-strip\"></a>app:transformNativeLibsWithStripDebugSymbolForProduceRelease, not found mips64el-linux-android-strip</h2><p> AS 3.2.1, Gradle 3.0.1, NDK 17,  NDK <img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_exception_ndk.png\" alt>, 17 .<br>:</p>\n<ol>\n<li>Gradle , 3.2.1,,.</li>\n<li> NDK 16, ndk-bundle/ </li>\n<li> NDK 16, mips64el-linux-android-strip </li>\n</ol>\n<h2 id=\"PKIX-path-building-failed\"><a href=\"#PKIX-path-building-failed\" class=\"headerlink\" title=\"PKIX path building failed\"></a>PKIX path building failed</h2><p> <code>sun.security.validator.ValidatorException: PKIX path building failed:\nsun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</code><br>:<br>, File-&gt;invalidate Caches/Restart  AS</p>\n<p>Error occurred while communicating with CMake server. Check log /Users/libery_tuya/Company/react-native/ReactAndroid/.externalNativeBuild/cmake/debug/armeabi/cmake_server_log.txt for additional information.</p>\n<h2 id=\"-a-a-a\"><a href=\"#-a-a-a\" class=\"headerlink\" title=\",a.a.a\"></a>,<code>a.a.a</code></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildTypes &#123;</span><br><span class=\"line\">    release &#123;</span><br><span class=\"line\">        minifyEnabled true</span><br><span class=\"line\">        // Android proguard-android.txt </span><br><span class=\"line\">        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Android 9.0 Choreographer ","date":"2019-03-15T01:39:26.000Z","_content":"## \n APP , Choreographer  ActivityLifecycleCallbacks ,,,,,dump  db . 4.1 , Choreographer .\n<!-- more -->\n## Choreographer\n### getInstance\n``` java\n    public static Choreographer getInstance() {\n        return sThreadInstance.get();\n    }\n    private static final ThreadLocal<Choreographer> sThreadInstance =\n            new ThreadLocal<Choreographer>() {\n        @Override\n        protected Choreographer initialValue() {\n            Looper looper = Looper.myLooper();\n            if (looper == null) {\n                throw new IllegalStateException(\"The current thread must have a looper!\");\n            }\n            Choreographer choreographer = new Choreographer(looper, VSYNC_SOURCE_APP);\n            if (looper == Looper.getMainLooper()) {\n                mMainInstance = choreographer;\n            }\n            return choreographer;\n        }\n    };\n```\n Looper, Choreographer ,, doFrame  Log .\n### \n``` java\n    private Choreographer(Looper looper, int vsyncSource) {\n        //\n        //FrameHandler \n        mHandler = new FrameHandler(looper);\n        // Native  VSYNC \n        mDisplayEventReceiver = USE_VSYNC\n                ? new FrameDisplayEventReceiver(looper, vsyncSource)\n                : null;\n        mLastFrameTimeNanos = Long.MIN_VALUE;\n        // 16.67ms  getRefreshRate() VirtualDisplayDevice  60,\n        mFrameIntervalNanos = (long)(1000000000 / getRefreshRate());\n        //   size  4\n        mCallbackQueues = new CallbackQueue[CALLBACK_LAST + 1];\n        for (int i = 0; i <= CALLBACK_LAST; i++) {\n            mCallbackQueues[i] = new CallbackQueue();\n        }\n    }\n```\n### FrameHandler\n``` java\n    private final class FrameHandler extends Handler {\n        public FrameHandler(Looper looper) {\n            super(looper);\n        }\n\n        @Override\n        public void handleMessage(Message msg) {\n            switch (msg.what) {\n                //\n                case MSG_DO_FRAME:\n                    doFrame(System.nanoTime(), 0);\n                    break;\n                // VSYNC\n                case MSG_DO_SCHEDULE_VSYNC:\n                    doScheduleVsync();\n                    break;\n                //\n                case MSG_DO_SCHEDULE_CALLBACK:\n                    doScheduleCallback(msg.arg1);\n                    break;\n            }\n        }\n    }\n```\n### FrameDisplayEventReceiver\n``` java\nprivate final class FrameDisplayEventReceiver extends DisplayEventReceiver\n            implements Runnable {\n        private boolean mHavePendingVsync;\n        private long mTimestampNanos;\n        private int mFrame;\n\n        //looper \n        public FrameDisplayEventReceiver(Looper looper, int vsyncSource) {\n            super(looper, vsyncSource);\n        }\n\n        // native \n        @Override\n        public void onVsync(long timestampNanos, int builtInDisplayId, int frame) {\n            //\n            if (builtInDisplayId != SurfaceControl.BUILT_IN_DISPLAY_ID_MAIN) {\n                Log.d(TAG, \"Received vsync from secondary display, but we don't support \"\n                        + \"this case yet.  Choreographer needs a way to explicitly request \"\n                        + \"vsync for a specific display to ensure it doesn't lose track \"\n                        + \"of its scheduled vsync.\");\n                scheduleVsync();\n                return;\n            }\n            //\n            long now = System.nanoTime();\n            if (timestampNanos > now) {\n                Log.w(TAG, \"Frame time is \" + ((timestampNanos - now) * 0.000001f)\n                        + \" ms in the future!  Check that graphics HAL is generating vsync \"\n                        + \"timestamps using the correct timebase.\");\n                timestampNanos = now;\n            }\n\n            if (mHavePendingVsync) {\n                Log.w(TAG, \"Already have a pending vsync event.  There should only be \"\n                        + \"one at a time.\");\n            } else {\n                mHavePendingVsync = true;\n            }\n\n            mTimestampNanos = timestampNanos;\n            mFrame = frame;\n            //  run()\n            Message msg = Message.obtain(mHandler, this);\n            msg.setAsynchronous(true);\n            mHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);\n        }\n\n        @Override\n        public void run() {\n            mHavePendingVsync = false;\n            doFrame(mTimestampNanos, mFrame);\n        }\n    }\n```\nonVsync **** FrameDisplayEventReceiver  Runnable  run \n### doFrame\n``` java\n    //\n    void doFrame(long frameTimeNanos, int frame) {\n        final long startNanos;\n        synchronized (mLock) {\n            if (!mFrameScheduled) {\n                return; //,,\n            }\n            //\n            long intendedFrameTimeNanos = frameTimeNanos;\n            startNanos = System.nanoTime();\n            final long jitterNanos = startNanos - frameTimeNanos;\n            if (jitterNanos >= mFrameIntervalNanos) {\n                final long skippedFrames = jitterNanos / mFrameIntervalNanos;\n                //SKIPPED_FRAME_WARNING_LIMIT=30 , Log ,=30,\n                if (skippedFrames >= SKIPPED_FRAME_WARNING_LIMIT) {\n                    Log.i(TAG, \"Skipped \" + skippedFrames + \" frames!  \"\n                            + \"The application may be doing too much work on its main thread.\");\n                }\n                final long lastFrameOffset = jitterNanos % mFrameIntervalNanos;\n                if (DEBUG_JANK) {\n                    Log.d(TAG, \"Missed vsync by \" + (jitterNanos * 0.000001f) + \" ms \"\n                            + \"which is more than the frame interval of \"\n                            + (mFrameIntervalNanos * 0.000001f) + \" ms!  \"\n                            + \"Skipping \" + skippedFrames + \" frames and setting frame \"\n                            + \"time to \" + (lastFrameOffset * 0.000001f) + \" ms in the past.\");\n                }\n                frameTimeNanos = startNanos - lastFrameOffset;\n            }\n\n            if (frameTimeNanos < mLastFrameTimeNanos) {\n                if (DEBUG_JANK) {\n                    Log.d(TAG, \"Frame time appears to be going backwards.  May be due to a \"\n                            + \"previously skipped frame.  Waiting for next vsync.\");\n                }\n                // VSYNC\n                scheduleVsyncLocked();\n                return;\n            }\n\n            mFrameInfo.setVsync(intendedFrameTimeNanos, frameTimeNanos);\n            mFrameScheduled = false;\n            mLastFrameTimeNanos = frameTimeNanos;\n        }\n\n        try {\n            Trace.traceBegin(Trace.TRACE_TAG_VIEW, \"Choreographer#doFrame\");\n            AnimationUtils.lockAnimationClock(frameTimeNanos / TimeUtils.NANOS_PER_MS);\n            //\n            mFrameInfo.markInputHandlingStart();\n            doCallbacks(Choreographer.CALLBACK_INPUT, frameTimeNanos);\n\n            mFrameInfo.markAnimationsStart();\n            doCallbacks(Choreographer.CALLBACK_ANIMATION, frameTimeNanos);\n\n            mFrameInfo.markPerformTraversalsStart();\n            doCallbacks(Choreographer.CALLBACK_TRAVERSAL, frameTimeNanos);\n\n            doCallbacks(Choreographer.CALLBACK_COMMIT, frameTimeNanos);\n        } finally {\n            AnimationUtils.unlockAnimationClock();\n            Trace.traceEnd(Trace.TRACE_TAG_VIEW);\n        }\n\n        if (DEBUG_FRAMES) {\n            final long endNanos = System.nanoTime();\n            Log.d(TAG, \"Frame \" + frame + \": Finished, took \"\n                    + (endNanos - startNanos) * 0.000001f + \" ms, latency \"\n                    + (startNanos - frameTimeNanos) * 0.000001f + \" ms.\");\n        }\n    }\n```\n### scheduleVsync\n``` java scheduleVsyncLocked.java\n    private void scheduleVsyncLocked() {\n        // FrameDisplayEventReceiver  DisplayEventReceiver\n        mDisplayEventReceiver.scheduleVsync();\n    }\n```\n``` java DisplayEventReceiver.java\n      public void scheduleVsync() {\n        if (mReceiverPtr == 0) {\n            Log.w(TAG, \"Attempted to schedule a vertical sync pulse but the display event \"\n                    + \"receiver has already been disposed.\");\n        } else {\n            // Native \n            nativeScheduleVsync(mReceiverPtr);\n        }\n    }\n```\n VSYNC  Native ,,, onVsync .\n### scheduleFrameLocked\n FrameHandler  MSG_DO_SCHEDULE_CALLBACK  doScheduleCallback , scheduleFrameLocked;\n``` java\n    private void scheduleFrameLocked(long now) {\n        if (!mFrameScheduled) {\n            mFrameScheduled = true;\n            if (USE_VSYNC) {\n                if (DEBUG_FRAMES) {\n                    Log.d(TAG, \"Scheduling next frame on vsync.\");\n                }\n                if (isRunningOnLooperThreadLocked()) {\n                    //Looper VSYNC\n                    scheduleVsyncLocked();\n                } else {\n                    //\n                    Message msg = mHandler.obtainMessage(MSG_DO_SCHEDULE_VSYNC);\n                    msg.setAsynchronous(true);\n                    mHandler.sendMessageAtFrontOfQueue(msg);\n                }\n            } else {\n               // VSYNC \n            }\n        }\n    }\n```\n### doScheduleCallback\n FrameHandler  MSG_DO_SCHEDULE_CALLBACK  doScheduleCallback(callbackType) ,, scheduleFrameLocked ;\n### doCallbacks\ndoFrame  callback\n``` java\n    //\n    public static final int CALLBACK_INPUT = 0;\n    //\n    @TestApi\n    public static final int CALLBACK_ANIMATION = 1;\n    // , layout  draw\n    public static final int CALLBACK_TRAVERSAL = 2;\n    //  traversal  post-draw \n    public static final int CALLBACK_COMMIT = 3;\n\n    void doCallbacks(int callbackType, long frameTimeNanos) {\n        CallbackRecord callbacks;\n        synchronized (mLock) {\n            final long now = System.nanoTime();\n            callbacks = mCallbackQueues[callbackType].extractDueCallbacksLocked(\n                    now / TimeUtils.NANOS_PER_MS);\n            if (callbacks == null) {\n                return;\n            }\n            mCallbacksRunning = true;\n\n            if (callbackType == Choreographer.CALLBACK_COMMIT) {\n                final long jitterNanos = now - frameTimeNanos;\n                Trace.traceCounter(Trace.TRACE_TAG_VIEW, \"jitterNanos\", (int) jitterNanos);\n                if (jitterNanos >= 2 * mFrameIntervalNanos) {\n                    final long lastFrameOffset = jitterNanos % mFrameIntervalNanos\n                            + mFrameIntervalNanos;\n                    if (DEBUG_JANK) {\n                        Log.d(TAG, \"Commit callback delayed by \" + (jitterNanos * 0.000001f)\n                                + \" ms which is more than twice the frame interval of \"\n                                + (mFrameIntervalNanos * 0.000001f) + \" ms!  \"\n                                + \"Setting frame time to \" + (lastFrameOffset * 0.000001f)\n                                + \" ms in the past.\");\n                        mDebugPrintNextFrameTimeDelta = true;\n                    }\n                    frameTimeNanos = now - lastFrameOffset;\n                    mLastFrameTimeNanos = frameTimeNanos;\n                }\n            }\n        }\n        try {\n            Trace.traceBegin(Trace.TRACE_TAG_VIEW, CALLBACK_TRACE_TITLES[callbackType]);\n            for (CallbackRecord c = callbacks; c != null; c = c.next) {\n                if (DEBUG_FRAMES) {\n                    Log.d(TAG, \"RunCallback: type=\" + callbackType\n                            + \", action=\" + c.action + \", token=\" + c.token\n                            + \", latencyMillis=\" + (SystemClock.uptimeMillis() - c.dueTime));\n                }\n                //token=FRAME_CALLBACK_TOKEN, doFrame  run\n                c.run(frameTimeNanos);\n            }\n        } finally {\n            synchronized (mLock) {\n                mCallbacksRunning = false;\n                do {\n                    final CallbackRecord next = callbacks.next;\n                    recycleCallbackLocked(callbacks);\n                    callbacks = next;\n                } while (callbacks != null);\n            }\n            Trace.traceEnd(Trace.TRACE_TAG_VIEW);\n        }\n    }\n```\n### CallbackRecord\n``` java\n    private static final class CallbackRecord {\n        public CallbackRecord next;\n        public long dueTime;\n        //Runnable   FrameCallback\n        public Object action;\n        public Object token;\n\n        public void run(long frameTimeNanos) {\n            if (token == FRAME_CALLBACK_TOKEN) {\n                ((FrameCallback)action).doFrame(frameTimeNanos);\n            } else {\n                // Runnalbe 2.8\n                ((Runnable)action).run();\n            }\n        }\n    }\n```\n### CallbackQueue\n``` java CallbackQueue.addCallbackLocked\n public void addCallbackLocked(long dueTime, Object action, Object token) {\n            CallbackRecord callback = obtainCallbackLocked(dueTime, action, token);\n            CallbackRecord entry = mHead;\n            if (entry == null) {\n                mHead = callback;\n                return;\n            }\n            //\n            if (dueTime < entry.dueTime) {\n                callback.next = entry;\n                mHead = callback;\n                return;\n            }\n            while (entry.next != null) {\n                if (dueTime < entry.next.dueTime) {\n                    callback.next = entry.next;\n                    break;\n                }\n                entry = entry.next;\n            }\n            entry.next = callback;\n        }\n```\nCallbackQueue  CallbackRecord , CallbackRecord , doFrame  input ,,`ViewRootImpl``ConsumeBatchedInputRunnable InvalidateOnAnimationRunnable TraversalRunnable` Runnalbe.\n``` java\n    @TestApi\n    public void postCallback(int callbackType, Runnable action, Object token) {\n        postCallbackDelayed(callbackType, action, token, 0);\n    }\n```\nViewRootImpl  Choreographer ,.\n## \n, Log `The application may be doing too much work on its main thread`. requestLayout  ViewRootImpl  TraversalRunnable,.\n## \n[Android8.1 Choreographer](https://www.jianshu.com/p/c2d93861095a)\n[Choreographer](http://gityuan.com/2017/02/25/choreographer/)","source":"_posts/choreographer.md","raw":"---\ntitle: Android 9.0 Choreographer \ndate: 2019-03-15 09:39:26\ntags:\n    - Android\n    - \ncategories: \n    - \n---\n## \n APP , Choreographer  ActivityLifecycleCallbacks ,,,,,dump  db . 4.1 , Choreographer .\n<!-- more -->\n## Choreographer\n### getInstance\n``` java\n    public static Choreographer getInstance() {\n        return sThreadInstance.get();\n    }\n    private static final ThreadLocal<Choreographer> sThreadInstance =\n            new ThreadLocal<Choreographer>() {\n        @Override\n        protected Choreographer initialValue() {\n            Looper looper = Looper.myLooper();\n            if (looper == null) {\n                throw new IllegalStateException(\"The current thread must have a looper!\");\n            }\n            Choreographer choreographer = new Choreographer(looper, VSYNC_SOURCE_APP);\n            if (looper == Looper.getMainLooper()) {\n                mMainInstance = choreographer;\n            }\n            return choreographer;\n        }\n    };\n```\n Looper, Choreographer ,, doFrame  Log .\n### \n``` java\n    private Choreographer(Looper looper, int vsyncSource) {\n        //\n        //FrameHandler \n        mHandler = new FrameHandler(looper);\n        // Native  VSYNC \n        mDisplayEventReceiver = USE_VSYNC\n                ? new FrameDisplayEventReceiver(looper, vsyncSource)\n                : null;\n        mLastFrameTimeNanos = Long.MIN_VALUE;\n        // 16.67ms  getRefreshRate() VirtualDisplayDevice  60,\n        mFrameIntervalNanos = (long)(1000000000 / getRefreshRate());\n        //   size  4\n        mCallbackQueues = new CallbackQueue[CALLBACK_LAST + 1];\n        for (int i = 0; i <= CALLBACK_LAST; i++) {\n            mCallbackQueues[i] = new CallbackQueue();\n        }\n    }\n```\n### FrameHandler\n``` java\n    private final class FrameHandler extends Handler {\n        public FrameHandler(Looper looper) {\n            super(looper);\n        }\n\n        @Override\n        public void handleMessage(Message msg) {\n            switch (msg.what) {\n                //\n                case MSG_DO_FRAME:\n                    doFrame(System.nanoTime(), 0);\n                    break;\n                // VSYNC\n                case MSG_DO_SCHEDULE_VSYNC:\n                    doScheduleVsync();\n                    break;\n                //\n                case MSG_DO_SCHEDULE_CALLBACK:\n                    doScheduleCallback(msg.arg1);\n                    break;\n            }\n        }\n    }\n```\n### FrameDisplayEventReceiver\n``` java\nprivate final class FrameDisplayEventReceiver extends DisplayEventReceiver\n            implements Runnable {\n        private boolean mHavePendingVsync;\n        private long mTimestampNanos;\n        private int mFrame;\n\n        //looper \n        public FrameDisplayEventReceiver(Looper looper, int vsyncSource) {\n            super(looper, vsyncSource);\n        }\n\n        // native \n        @Override\n        public void onVsync(long timestampNanos, int builtInDisplayId, int frame) {\n            //\n            if (builtInDisplayId != SurfaceControl.BUILT_IN_DISPLAY_ID_MAIN) {\n                Log.d(TAG, \"Received vsync from secondary display, but we don't support \"\n                        + \"this case yet.  Choreographer needs a way to explicitly request \"\n                        + \"vsync for a specific display to ensure it doesn't lose track \"\n                        + \"of its scheduled vsync.\");\n                scheduleVsync();\n                return;\n            }\n            //\n            long now = System.nanoTime();\n            if (timestampNanos > now) {\n                Log.w(TAG, \"Frame time is \" + ((timestampNanos - now) * 0.000001f)\n                        + \" ms in the future!  Check that graphics HAL is generating vsync \"\n                        + \"timestamps using the correct timebase.\");\n                timestampNanos = now;\n            }\n\n            if (mHavePendingVsync) {\n                Log.w(TAG, \"Already have a pending vsync event.  There should only be \"\n                        + \"one at a time.\");\n            } else {\n                mHavePendingVsync = true;\n            }\n\n            mTimestampNanos = timestampNanos;\n            mFrame = frame;\n            //  run()\n            Message msg = Message.obtain(mHandler, this);\n            msg.setAsynchronous(true);\n            mHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);\n        }\n\n        @Override\n        public void run() {\n            mHavePendingVsync = false;\n            doFrame(mTimestampNanos, mFrame);\n        }\n    }\n```\nonVsync **** FrameDisplayEventReceiver  Runnable  run \n### doFrame\n``` java\n    //\n    void doFrame(long frameTimeNanos, int frame) {\n        final long startNanos;\n        synchronized (mLock) {\n            if (!mFrameScheduled) {\n                return; //,,\n            }\n            //\n            long intendedFrameTimeNanos = frameTimeNanos;\n            startNanos = System.nanoTime();\n            final long jitterNanos = startNanos - frameTimeNanos;\n            if (jitterNanos >= mFrameIntervalNanos) {\n                final long skippedFrames = jitterNanos / mFrameIntervalNanos;\n                //SKIPPED_FRAME_WARNING_LIMIT=30 , Log ,=30,\n                if (skippedFrames >= SKIPPED_FRAME_WARNING_LIMIT) {\n                    Log.i(TAG, \"Skipped \" + skippedFrames + \" frames!  \"\n                            + \"The application may be doing too much work on its main thread.\");\n                }\n                final long lastFrameOffset = jitterNanos % mFrameIntervalNanos;\n                if (DEBUG_JANK) {\n                    Log.d(TAG, \"Missed vsync by \" + (jitterNanos * 0.000001f) + \" ms \"\n                            + \"which is more than the frame interval of \"\n                            + (mFrameIntervalNanos * 0.000001f) + \" ms!  \"\n                            + \"Skipping \" + skippedFrames + \" frames and setting frame \"\n                            + \"time to \" + (lastFrameOffset * 0.000001f) + \" ms in the past.\");\n                }\n                frameTimeNanos = startNanos - lastFrameOffset;\n            }\n\n            if (frameTimeNanos < mLastFrameTimeNanos) {\n                if (DEBUG_JANK) {\n                    Log.d(TAG, \"Frame time appears to be going backwards.  May be due to a \"\n                            + \"previously skipped frame.  Waiting for next vsync.\");\n                }\n                // VSYNC\n                scheduleVsyncLocked();\n                return;\n            }\n\n            mFrameInfo.setVsync(intendedFrameTimeNanos, frameTimeNanos);\n            mFrameScheduled = false;\n            mLastFrameTimeNanos = frameTimeNanos;\n        }\n\n        try {\n            Trace.traceBegin(Trace.TRACE_TAG_VIEW, \"Choreographer#doFrame\");\n            AnimationUtils.lockAnimationClock(frameTimeNanos / TimeUtils.NANOS_PER_MS);\n            //\n            mFrameInfo.markInputHandlingStart();\n            doCallbacks(Choreographer.CALLBACK_INPUT, frameTimeNanos);\n\n            mFrameInfo.markAnimationsStart();\n            doCallbacks(Choreographer.CALLBACK_ANIMATION, frameTimeNanos);\n\n            mFrameInfo.markPerformTraversalsStart();\n            doCallbacks(Choreographer.CALLBACK_TRAVERSAL, frameTimeNanos);\n\n            doCallbacks(Choreographer.CALLBACK_COMMIT, frameTimeNanos);\n        } finally {\n            AnimationUtils.unlockAnimationClock();\n            Trace.traceEnd(Trace.TRACE_TAG_VIEW);\n        }\n\n        if (DEBUG_FRAMES) {\n            final long endNanos = System.nanoTime();\n            Log.d(TAG, \"Frame \" + frame + \": Finished, took \"\n                    + (endNanos - startNanos) * 0.000001f + \" ms, latency \"\n                    + (startNanos - frameTimeNanos) * 0.000001f + \" ms.\");\n        }\n    }\n```\n### scheduleVsync\n``` java scheduleVsyncLocked.java\n    private void scheduleVsyncLocked() {\n        // FrameDisplayEventReceiver  DisplayEventReceiver\n        mDisplayEventReceiver.scheduleVsync();\n    }\n```\n``` java DisplayEventReceiver.java\n      public void scheduleVsync() {\n        if (mReceiverPtr == 0) {\n            Log.w(TAG, \"Attempted to schedule a vertical sync pulse but the display event \"\n                    + \"receiver has already been disposed.\");\n        } else {\n            // Native \n            nativeScheduleVsync(mReceiverPtr);\n        }\n    }\n```\n VSYNC  Native ,,, onVsync .\n### scheduleFrameLocked\n FrameHandler  MSG_DO_SCHEDULE_CALLBACK  doScheduleCallback , scheduleFrameLocked;\n``` java\n    private void scheduleFrameLocked(long now) {\n        if (!mFrameScheduled) {\n            mFrameScheduled = true;\n            if (USE_VSYNC) {\n                if (DEBUG_FRAMES) {\n                    Log.d(TAG, \"Scheduling next frame on vsync.\");\n                }\n                if (isRunningOnLooperThreadLocked()) {\n                    //Looper VSYNC\n                    scheduleVsyncLocked();\n                } else {\n                    //\n                    Message msg = mHandler.obtainMessage(MSG_DO_SCHEDULE_VSYNC);\n                    msg.setAsynchronous(true);\n                    mHandler.sendMessageAtFrontOfQueue(msg);\n                }\n            } else {\n               // VSYNC \n            }\n        }\n    }\n```\n### doScheduleCallback\n FrameHandler  MSG_DO_SCHEDULE_CALLBACK  doScheduleCallback(callbackType) ,, scheduleFrameLocked ;\n### doCallbacks\ndoFrame  callback\n``` java\n    //\n    public static final int CALLBACK_INPUT = 0;\n    //\n    @TestApi\n    public static final int CALLBACK_ANIMATION = 1;\n    // , layout  draw\n    public static final int CALLBACK_TRAVERSAL = 2;\n    //  traversal  post-draw \n    public static final int CALLBACK_COMMIT = 3;\n\n    void doCallbacks(int callbackType, long frameTimeNanos) {\n        CallbackRecord callbacks;\n        synchronized (mLock) {\n            final long now = System.nanoTime();\n            callbacks = mCallbackQueues[callbackType].extractDueCallbacksLocked(\n                    now / TimeUtils.NANOS_PER_MS);\n            if (callbacks == null) {\n                return;\n            }\n            mCallbacksRunning = true;\n\n            if (callbackType == Choreographer.CALLBACK_COMMIT) {\n                final long jitterNanos = now - frameTimeNanos;\n                Trace.traceCounter(Trace.TRACE_TAG_VIEW, \"jitterNanos\", (int) jitterNanos);\n                if (jitterNanos >= 2 * mFrameIntervalNanos) {\n                    final long lastFrameOffset = jitterNanos % mFrameIntervalNanos\n                            + mFrameIntervalNanos;\n                    if (DEBUG_JANK) {\n                        Log.d(TAG, \"Commit callback delayed by \" + (jitterNanos * 0.000001f)\n                                + \" ms which is more than twice the frame interval of \"\n                                + (mFrameIntervalNanos * 0.000001f) + \" ms!  \"\n                                + \"Setting frame time to \" + (lastFrameOffset * 0.000001f)\n                                + \" ms in the past.\");\n                        mDebugPrintNextFrameTimeDelta = true;\n                    }\n                    frameTimeNanos = now - lastFrameOffset;\n                    mLastFrameTimeNanos = frameTimeNanos;\n                }\n            }\n        }\n        try {\n            Trace.traceBegin(Trace.TRACE_TAG_VIEW, CALLBACK_TRACE_TITLES[callbackType]);\n            for (CallbackRecord c = callbacks; c != null; c = c.next) {\n                if (DEBUG_FRAMES) {\n                    Log.d(TAG, \"RunCallback: type=\" + callbackType\n                            + \", action=\" + c.action + \", token=\" + c.token\n                            + \", latencyMillis=\" + (SystemClock.uptimeMillis() - c.dueTime));\n                }\n                //token=FRAME_CALLBACK_TOKEN, doFrame  run\n                c.run(frameTimeNanos);\n            }\n        } finally {\n            synchronized (mLock) {\n                mCallbacksRunning = false;\n                do {\n                    final CallbackRecord next = callbacks.next;\n                    recycleCallbackLocked(callbacks);\n                    callbacks = next;\n                } while (callbacks != null);\n            }\n            Trace.traceEnd(Trace.TRACE_TAG_VIEW);\n        }\n    }\n```\n### CallbackRecord\n``` java\n    private static final class CallbackRecord {\n        public CallbackRecord next;\n        public long dueTime;\n        //Runnable   FrameCallback\n        public Object action;\n        public Object token;\n\n        public void run(long frameTimeNanos) {\n            if (token == FRAME_CALLBACK_TOKEN) {\n                ((FrameCallback)action).doFrame(frameTimeNanos);\n            } else {\n                // Runnalbe 2.8\n                ((Runnable)action).run();\n            }\n        }\n    }\n```\n### CallbackQueue\n``` java CallbackQueue.addCallbackLocked\n public void addCallbackLocked(long dueTime, Object action, Object token) {\n            CallbackRecord callback = obtainCallbackLocked(dueTime, action, token);\n            CallbackRecord entry = mHead;\n            if (entry == null) {\n                mHead = callback;\n                return;\n            }\n            //\n            if (dueTime < entry.dueTime) {\n                callback.next = entry;\n                mHead = callback;\n                return;\n            }\n            while (entry.next != null) {\n                if (dueTime < entry.next.dueTime) {\n                    callback.next = entry.next;\n                    break;\n                }\n                entry = entry.next;\n            }\n            entry.next = callback;\n        }\n```\nCallbackQueue  CallbackRecord , CallbackRecord , doFrame  input ,,`ViewRootImpl``ConsumeBatchedInputRunnable InvalidateOnAnimationRunnable TraversalRunnable` Runnalbe.\n``` java\n    @TestApi\n    public void postCallback(int callbackType, Runnable action, Object token) {\n        postCallbackDelayed(callbackType, action, token, 0);\n    }\n```\nViewRootImpl  Choreographer ,.\n## \n, Log `The application may be doing too much work on its main thread`. requestLayout  ViewRootImpl  TraversalRunnable,.\n## \n[Android8.1 Choreographer](https://www.jianshu.com/p/c2d93861095a)\n[Choreographer](http://gityuan.com/2017/02/25/choreographer/)","slug":"choreographer","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsab0012ndf2metvv6s4","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> APP , Choreographer  ActivityLifecycleCallbacks ,,,,,dump  db . 4.1 , Choreographer .<br><a id=\"more\"></a></p>\n<h2 id=\"Choreographer\"><a href=\"#Choreographer\" class=\"headerlink\" title=\"Choreographer\"></a>Choreographer</h2><h3 id=\"getInstance\"><a href=\"#getInstance\" class=\"headerlink\" title=\"getInstance\"></a>getInstance</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Choreographer <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sThreadInstance.get();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ThreadLocal&lt;Choreographer&gt; sThreadInstance =</span><br><span class=\"line\">        <span class=\"keyword\">new</span> ThreadLocal&lt;Choreographer&gt;() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> Choreographer <span class=\"title\">initialValue</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Looper looper = Looper.myLooper();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (looper == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">\"The current thread must have a looper!\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Choreographer choreographer = <span class=\"keyword\">new</span> Choreographer(looper, VSYNC_SOURCE_APP);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (looper == Looper.getMainLooper()) &#123;</span><br><span class=\"line\">            mMainInstance = choreographer;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> choreographer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p> Looper, Choreographer ,, doFrame  Log .</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Choreographer</span><span class=\"params\">(Looper looper, <span class=\"keyword\">int</span> vsyncSource)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">//FrameHandler </span></span><br><span class=\"line\">    mHandler = <span class=\"keyword\">new</span> FrameHandler(looper);</span><br><span class=\"line\">    <span class=\"comment\">// Native  VSYNC </span></span><br><span class=\"line\">    mDisplayEventReceiver = USE_VSYNC</span><br><span class=\"line\">            ? <span class=\"keyword\">new</span> FrameDisplayEventReceiver(looper, vsyncSource)</span><br><span class=\"line\">            : <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    mLastFrameTimeNanos = Long.MIN_VALUE;</span><br><span class=\"line\">    <span class=\"comment\">// 16.67ms  getRefreshRate() VirtualDisplayDevice  60,</span></span><br><span class=\"line\">    mFrameIntervalNanos = (<span class=\"keyword\">long</span>)(<span class=\"number\">1000000000</span> / getRefreshRate());</span><br><span class=\"line\">    <span class=\"comment\">//   size  4</span></span><br><span class=\"line\">    mCallbackQueues = <span class=\"keyword\">new</span> CallbackQueue[CALLBACK_LAST + <span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt;= CALLBACK_LAST; i++) &#123;</span><br><span class=\"line\">        mCallbackQueues[i] = <span class=\"keyword\">new</span> CallbackQueue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"FrameHandler\"><a href=\"#FrameHandler\" class=\"headerlink\" title=\"FrameHandler\"></a>FrameHandler</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FrameHandler</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FrameHandler</span><span class=\"params\">(Looper looper)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(looper);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleMessage</span><span class=\"params\">(Message msg)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (msg.what) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">case</span> MSG_DO_FRAME:</span><br><span class=\"line\">                doFrame(System.nanoTime(), <span class=\"number\">0</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"comment\">// VSYNC</span></span><br><span class=\"line\">            <span class=\"keyword\">case</span> MSG_DO_SCHEDULE_VSYNC:</span><br><span class=\"line\">                doScheduleVsync();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">case</span> MSG_DO_SCHEDULE_CALLBACK:</span><br><span class=\"line\">                doScheduleCallback(msg.arg1);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"FrameDisplayEventReceiver\"><a href=\"#FrameDisplayEventReceiver\" class=\"headerlink\" title=\"FrameDisplayEventReceiver\"></a>FrameDisplayEventReceiver</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FrameDisplayEventReceiver</span> <span class=\"keyword\">extends</span> <span class=\"title\">DisplayEventReceiver</span></span></span><br><span class=\"line\"><span class=\"class\">            <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> mHavePendingVsync;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> mTimestampNanos;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> mFrame;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//looper </span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FrameDisplayEventReceiver</span><span class=\"params\">(Looper looper, <span class=\"keyword\">int</span> vsyncSource)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>(looper, vsyncSource);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// native </span></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onVsync</span><span class=\"params\">(<span class=\"keyword\">long</span> timestampNanos, <span class=\"keyword\">int</span> builtInDisplayId, <span class=\"keyword\">int</span> frame)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (builtInDisplayId != SurfaceControl.BUILT_IN_DISPLAY_ID_MAIN) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"Received vsync from secondary display, but we don't support \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"this case yet.  Choreographer needs a way to explicitly request \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"vsync for a specific display to ensure it doesn't lose track \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"of its scheduled vsync.\"</span>);</span><br><span class=\"line\">                scheduleVsync();</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">long</span> now = System.nanoTime();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (timestampNanos &gt; now) &#123;</span><br><span class=\"line\">                Log.w(TAG, <span class=\"string\">\"Frame time is \"</span> + ((timestampNanos - now) * <span class=\"number\">0.000001f</span>)</span><br><span class=\"line\">                        + <span class=\"string\">\" ms in the future!  Check that graphics HAL is generating vsync \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"timestamps using the correct timebase.\"</span>);</span><br><span class=\"line\">                timestampNanos = now;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (mHavePendingVsync) &#123;</span><br><span class=\"line\">                Log.w(TAG, <span class=\"string\">\"Already have a pending vsync event.  There should only be \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"one at a time.\"</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                mHavePendingVsync = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            mTimestampNanos = timestampNanos;</span><br><span class=\"line\">            mFrame = frame;</span><br><span class=\"line\">            <span class=\"comment\">//  run()</span></span><br><span class=\"line\">            Message msg = Message.obtain(mHandler, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">            msg.setAsynchronous(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            mHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            mHavePendingVsync = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            doFrame(mTimestampNanos, mFrame);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>onVsync <strong></strong> FrameDisplayEventReceiver  Runnable  run </p>\n<h3 id=\"doFrame\"><a href=\"#doFrame\" class=\"headerlink\" title=\"doFrame\"></a>doFrame</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">doFrame</span><span class=\"params\">(<span class=\"keyword\">long</span> frameTimeNanos, <span class=\"keyword\">int</span> frame)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> startNanos;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (mLock) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!mFrameScheduled) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>; <span class=\"comment\">//,,</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">long</span> intendedFrameTimeNanos = frameTimeNanos;</span><br><span class=\"line\">        startNanos = System.nanoTime();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> jitterNanos = startNanos - frameTimeNanos;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (jitterNanos &gt;= mFrameIntervalNanos) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> skippedFrames = jitterNanos / mFrameIntervalNanos;</span><br><span class=\"line\">            <span class=\"comment\">//SKIPPED_FRAME_WARNING_LIMIT=30 , Log ,=30,</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (skippedFrames &gt;= SKIPPED_FRAME_WARNING_LIMIT) &#123;</span><br><span class=\"line\">                Log.i(TAG, <span class=\"string\">\"Skipped \"</span> + skippedFrames + <span class=\"string\">\" frames!  \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"The application may be doing too much work on its main thread.\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> lastFrameOffset = jitterNanos % mFrameIntervalNanos;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DEBUG_JANK) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"Missed vsync by \"</span> + (jitterNanos * <span class=\"number\">0.000001f</span>) + <span class=\"string\">\" ms \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"which is more than the frame interval of \"</span></span><br><span class=\"line\">                        + (mFrameIntervalNanos * <span class=\"number\">0.000001f</span>) + <span class=\"string\">\" ms!  \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"Skipping \"</span> + skippedFrames + <span class=\"string\">\" frames and setting frame \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"time to \"</span> + (lastFrameOffset * <span class=\"number\">0.000001f</span>) + <span class=\"string\">\" ms in the past.\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            frameTimeNanos = startNanos - lastFrameOffset;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (frameTimeNanos &lt; mLastFrameTimeNanos) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DEBUG_JANK) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"Frame time appears to be going backwards.  May be due to a \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"previously skipped frame.  Waiting for next vsync.\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// VSYNC</span></span><br><span class=\"line\">            scheduleVsyncLocked();</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        mFrameInfo.setVsync(intendedFrameTimeNanos, frameTimeNanos);</span><br><span class=\"line\">        mFrameScheduled = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        mLastFrameTimeNanos = frameTimeNanos;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        Trace.traceBegin(Trace.TRACE_TAG_VIEW, <span class=\"string\">\"Choreographer#doFrame\"</span>);</span><br><span class=\"line\">        AnimationUtils.lockAnimationClock(frameTimeNanos / TimeUtils.NANOS_PER_MS);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        mFrameInfo.markInputHandlingStart();</span><br><span class=\"line\">        doCallbacks(Choreographer.CALLBACK_INPUT, frameTimeNanos);</span><br><span class=\"line\"></span><br><span class=\"line\">        mFrameInfo.markAnimationsStart();</span><br><span class=\"line\">        doCallbacks(Choreographer.CALLBACK_ANIMATION, frameTimeNanos);</span><br><span class=\"line\"></span><br><span class=\"line\">        mFrameInfo.markPerformTraversalsStart();</span><br><span class=\"line\">        doCallbacks(Choreographer.CALLBACK_TRAVERSAL, frameTimeNanos);</span><br><span class=\"line\"></span><br><span class=\"line\">        doCallbacks(Choreographer.CALLBACK_COMMIT, frameTimeNanos);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        AnimationUtils.unlockAnimationClock();</span><br><span class=\"line\">        Trace.traceEnd(Trace.TRACE_TAG_VIEW);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (DEBUG_FRAMES) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> endNanos = System.nanoTime();</span><br><span class=\"line\">        Log.d(TAG, <span class=\"string\">\"Frame \"</span> + frame + <span class=\"string\">\": Finished, took \"</span></span><br><span class=\"line\">                + (endNanos - startNanos) * <span class=\"number\">0.000001f</span> + <span class=\"string\">\" ms, latency \"</span></span><br><span class=\"line\">                + (startNanos - frameTimeNanos) * <span class=\"number\">0.000001f</span> + <span class=\"string\">\" ms.\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"scheduleVsync\"><a href=\"#scheduleVsync\" class=\"headerlink\" title=\"scheduleVsync\"></a>scheduleVsync</h3><figure class=\"highlight java\"><figcaption><span>scheduleVsyncLocked.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">scheduleVsyncLocked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// FrameDisplayEventReceiver  DisplayEventReceiver</span></span><br><span class=\"line\">    mDisplayEventReceiver.scheduleVsync();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><figcaption><span>DisplayEventReceiver.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">scheduleVsync</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mReceiverPtr == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        Log.w(TAG, <span class=\"string\">\"Attempted to schedule a vertical sync pulse but the display event \"</span></span><br><span class=\"line\">                + <span class=\"string\">\"receiver has already been disposed.\"</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Native </span></span><br><span class=\"line\">        nativeScheduleVsync(mReceiverPtr);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> VSYNC  Native ,,, onVsync .</p>\n<h3 id=\"scheduleFrameLocked\"><a href=\"#scheduleFrameLocked\" class=\"headerlink\" title=\"scheduleFrameLocked\"></a>scheduleFrameLocked</h3><p> FrameHandler  MSG_DO_SCHEDULE_CALLBACK  doScheduleCallback , scheduleFrameLocked;<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">scheduleFrameLocked</span><span class=\"params\">(<span class=\"keyword\">long</span> now)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!mFrameScheduled) &#123;</span><br><span class=\"line\">        mFrameScheduled = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (USE_VSYNC) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DEBUG_FRAMES) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"Scheduling next frame on vsync.\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isRunningOnLooperThreadLocked()) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//Looper VSYNC</span></span><br><span class=\"line\">                scheduleVsyncLocked();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                Message msg = mHandler.obtainMessage(MSG_DO_SCHEDULE_VSYNC);</span><br><span class=\"line\">                msg.setAsynchronous(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">                mHandler.sendMessageAtFrontOfQueue(msg);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">           <span class=\"comment\">// VSYNC </span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"doScheduleCallback\"><a href=\"#doScheduleCallback\" class=\"headerlink\" title=\"doScheduleCallback\"></a>doScheduleCallback</h3><p> FrameHandler  MSG_DO_SCHEDULE_CALLBACK  doScheduleCallback(callbackType) ,, scheduleFrameLocked ;</p>\n<h3 id=\"doCallbacks\"><a href=\"#doCallbacks\" class=\"headerlink\" title=\"doCallbacks\"></a>doCallbacks</h3><p>doFrame  callback<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CALLBACK_INPUT = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@TestApi</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CALLBACK_ANIMATION = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"comment\">// , layout  draw</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CALLBACK_TRAVERSAL = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"comment\">//  traversal  post-draw </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CALLBACK_COMMIT = <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">doCallbacks</span><span class=\"params\">(<span class=\"keyword\">int</span> callbackType, <span class=\"keyword\">long</span> frameTimeNanos)</span> </span>&#123;</span><br><span class=\"line\">    CallbackRecord callbacks;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (mLock) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> now = System.nanoTime();</span><br><span class=\"line\">        callbacks = mCallbackQueues[callbackType].extractDueCallbacksLocked(</span><br><span class=\"line\">                now / TimeUtils.NANOS_PER_MS);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callbacks == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mCallbacksRunning = <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callbackType == Choreographer.CALLBACK_COMMIT) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> jitterNanos = now - frameTimeNanos;</span><br><span class=\"line\">            Trace.traceCounter(Trace.TRACE_TAG_VIEW, <span class=\"string\">\"jitterNanos\"</span>, (<span class=\"keyword\">int</span>) jitterNanos);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (jitterNanos &gt;= <span class=\"number\">2</span> * mFrameIntervalNanos) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> lastFrameOffset = jitterNanos % mFrameIntervalNanos</span><br><span class=\"line\">                        + mFrameIntervalNanos;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (DEBUG_JANK) &#123;</span><br><span class=\"line\">                    Log.d(TAG, <span class=\"string\">\"Commit callback delayed by \"</span> + (jitterNanos * <span class=\"number\">0.000001f</span>)</span><br><span class=\"line\">                            + <span class=\"string\">\" ms which is more than twice the frame interval of \"</span></span><br><span class=\"line\">                            + (mFrameIntervalNanos * <span class=\"number\">0.000001f</span>) + <span class=\"string\">\" ms!  \"</span></span><br><span class=\"line\">                            + <span class=\"string\">\"Setting frame time to \"</span> + (lastFrameOffset * <span class=\"number\">0.000001f</span>)</span><br><span class=\"line\">                            + <span class=\"string\">\" ms in the past.\"</span>);</span><br><span class=\"line\">                    mDebugPrintNextFrameTimeDelta = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                frameTimeNanos = now - lastFrameOffset;</span><br><span class=\"line\">                mLastFrameTimeNanos = frameTimeNanos;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        Trace.traceBegin(Trace.TRACE_TAG_VIEW, CALLBACK_TRACE_TITLES[callbackType]);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (CallbackRecord c = callbacks; c != <span class=\"keyword\">null</span>; c = c.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DEBUG_FRAMES) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"RunCallback: type=\"</span> + callbackType</span><br><span class=\"line\">                        + <span class=\"string\">\", action=\"</span> + c.action + <span class=\"string\">\", token=\"</span> + c.token</span><br><span class=\"line\">                        + <span class=\"string\">\", latencyMillis=\"</span> + (SystemClock.uptimeMillis() - c.dueTime));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//token=FRAME_CALLBACK_TOKEN, doFrame  run</span></span><br><span class=\"line\">            c.run(frameTimeNanos);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (mLock) &#123;</span><br><span class=\"line\">            mCallbacksRunning = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> CallbackRecord next = callbacks.next;</span><br><span class=\"line\">                recycleCallbackLocked(callbacks);</span><br><span class=\"line\">                callbacks = next;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">while</span> (callbacks != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Trace.traceEnd(Trace.TRACE_TAG_VIEW);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"CallbackRecord\"><a href=\"#CallbackRecord\" class=\"headerlink\" title=\"CallbackRecord\"></a>CallbackRecord</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallbackRecord</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> CallbackRecord next;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">long</span> dueTime;</span><br><span class=\"line\">    <span class=\"comment\">//Runnable   FrameCallback</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object action;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object token;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">(<span class=\"keyword\">long</span> frameTimeNanos)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token == FRAME_CALLBACK_TOKEN) &#123;</span><br><span class=\"line\">            ((FrameCallback)action).doFrame(frameTimeNanos);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Runnalbe 2.8</span></span><br><span class=\"line\">            ((Runnable)action).run();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"CallbackQueue\"><a href=\"#CallbackQueue\" class=\"headerlink\" title=\"CallbackQueue\"></a>CallbackQueue</h3><figure class=\"highlight java\"><figcaption><span>CallbackQueue.addCallbackLocked</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addCallbackLocked</span><span class=\"params\">(<span class=\"keyword\">long</span> dueTime, Object action, Object token)</span> </span>&#123;</span><br><span class=\"line\">           CallbackRecord callback = obtainCallbackLocked(dueTime, action, token);</span><br><span class=\"line\">           CallbackRecord entry = mHead;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (entry == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">               mHead = callback;</span><br><span class=\"line\">               <span class=\"keyword\">return</span>;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"comment\">//</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> (dueTime &lt; entry.dueTime) &#123;</span><br><span class=\"line\">               callback.next = entry;</span><br><span class=\"line\">               mHead = callback;</span><br><span class=\"line\">               <span class=\"keyword\">return</span>;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"keyword\">while</span> (entry.next != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (dueTime &lt; entry.next.dueTime) &#123;</span><br><span class=\"line\">                   callback.next = entry.next;</span><br><span class=\"line\">                   <span class=\"keyword\">break</span>;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               entry = entry.next;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           entry.next = callback;</span><br><span class=\"line\">       &#125;</span><br></pre></td></tr></table></figure>\n<p>CallbackQueue  CallbackRecord , CallbackRecord , doFrame  input ,,<code>ViewRootImpl</code><code>ConsumeBatchedInputRunnable InvalidateOnAnimationRunnable TraversalRunnable</code> Runnalbe.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@TestApi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">postCallback</span><span class=\"params\">(<span class=\"keyword\">int</span> callbackType, Runnable action, Object token)</span> </span>&#123;</span><br><span class=\"line\">    postCallbackDelayed(callbackType, action, token, <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>ViewRootImpl  Choreographer ,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>, Log <code>The application may be doing too much work on its main thread</code>. requestLayout  ViewRootImpl  TraversalRunnable,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://www.jianshu.com/p/c2d93861095a\" target=\"_blank\" rel=\"noopener\">Android8.1 Choreographer</a><br><a href=\"http://gityuan.com/2017/02/25/choreographer/\" target=\"_blank\" rel=\"noopener\">Choreographer</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> APP , Choreographer  ActivityLifecycleCallbacks ,,,,,dump  db . 4.1 , Choreographer .<br>","more":"</p>\n<h2 id=\"Choreographer\"><a href=\"#Choreographer\" class=\"headerlink\" title=\"Choreographer\"></a>Choreographer</h2><h3 id=\"getInstance\"><a href=\"#getInstance\" class=\"headerlink\" title=\"getInstance\"></a>getInstance</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Choreographer <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sThreadInstance.get();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ThreadLocal&lt;Choreographer&gt; sThreadInstance =</span><br><span class=\"line\">        <span class=\"keyword\">new</span> ThreadLocal&lt;Choreographer&gt;() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> Choreographer <span class=\"title\">initialValue</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        Looper looper = Looper.myLooper();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (looper == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> IllegalStateException(<span class=\"string\">\"The current thread must have a looper!\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Choreographer choreographer = <span class=\"keyword\">new</span> Choreographer(looper, VSYNC_SOURCE_APP);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (looper == Looper.getMainLooper()) &#123;</span><br><span class=\"line\">            mMainInstance = choreographer;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> choreographer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p> Looper, Choreographer ,, doFrame  Log .</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Choreographer</span><span class=\"params\">(Looper looper, <span class=\"keyword\">int</span> vsyncSource)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">//FrameHandler </span></span><br><span class=\"line\">    mHandler = <span class=\"keyword\">new</span> FrameHandler(looper);</span><br><span class=\"line\">    <span class=\"comment\">// Native  VSYNC </span></span><br><span class=\"line\">    mDisplayEventReceiver = USE_VSYNC</span><br><span class=\"line\">            ? <span class=\"keyword\">new</span> FrameDisplayEventReceiver(looper, vsyncSource)</span><br><span class=\"line\">            : <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    mLastFrameTimeNanos = Long.MIN_VALUE;</span><br><span class=\"line\">    <span class=\"comment\">// 16.67ms  getRefreshRate() VirtualDisplayDevice  60,</span></span><br><span class=\"line\">    mFrameIntervalNanos = (<span class=\"keyword\">long</span>)(<span class=\"number\">1000000000</span> / getRefreshRate());</span><br><span class=\"line\">    <span class=\"comment\">//   size  4</span></span><br><span class=\"line\">    mCallbackQueues = <span class=\"keyword\">new</span> CallbackQueue[CALLBACK_LAST + <span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt;= CALLBACK_LAST; i++) &#123;</span><br><span class=\"line\">        mCallbackQueues[i] = <span class=\"keyword\">new</span> CallbackQueue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"FrameHandler\"><a href=\"#FrameHandler\" class=\"headerlink\" title=\"FrameHandler\"></a>FrameHandler</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FrameHandler</span> <span class=\"keyword\">extends</span> <span class=\"title\">Handler</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FrameHandler</span><span class=\"params\">(Looper looper)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(looper);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleMessage</span><span class=\"params\">(Message msg)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (msg.what) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">case</span> MSG_DO_FRAME:</span><br><span class=\"line\">                doFrame(System.nanoTime(), <span class=\"number\">0</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"comment\">// VSYNC</span></span><br><span class=\"line\">            <span class=\"keyword\">case</span> MSG_DO_SCHEDULE_VSYNC:</span><br><span class=\"line\">                doScheduleVsync();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">case</span> MSG_DO_SCHEDULE_CALLBACK:</span><br><span class=\"line\">                doScheduleCallback(msg.arg1);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"FrameDisplayEventReceiver\"><a href=\"#FrameDisplayEventReceiver\" class=\"headerlink\" title=\"FrameDisplayEventReceiver\"></a>FrameDisplayEventReceiver</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FrameDisplayEventReceiver</span> <span class=\"keyword\">extends</span> <span class=\"title\">DisplayEventReceiver</span></span></span><br><span class=\"line\"><span class=\"class\">            <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> mHavePendingVsync;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> mTimestampNanos;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> mFrame;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//looper </span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FrameDisplayEventReceiver</span><span class=\"params\">(Looper looper, <span class=\"keyword\">int</span> vsyncSource)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">super</span>(looper, vsyncSource);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// native </span></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onVsync</span><span class=\"params\">(<span class=\"keyword\">long</span> timestampNanos, <span class=\"keyword\">int</span> builtInDisplayId, <span class=\"keyword\">int</span> frame)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (builtInDisplayId != SurfaceControl.BUILT_IN_DISPLAY_ID_MAIN) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"Received vsync from secondary display, but we don't support \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"this case yet.  Choreographer needs a way to explicitly request \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"vsync for a specific display to ensure it doesn't lose track \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"of its scheduled vsync.\"</span>);</span><br><span class=\"line\">                scheduleVsync();</span><br><span class=\"line\">                <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">long</span> now = System.nanoTime();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (timestampNanos &gt; now) &#123;</span><br><span class=\"line\">                Log.w(TAG, <span class=\"string\">\"Frame time is \"</span> + ((timestampNanos - now) * <span class=\"number\">0.000001f</span>)</span><br><span class=\"line\">                        + <span class=\"string\">\" ms in the future!  Check that graphics HAL is generating vsync \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"timestamps using the correct timebase.\"</span>);</span><br><span class=\"line\">                timestampNanos = now;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (mHavePendingVsync) &#123;</span><br><span class=\"line\">                Log.w(TAG, <span class=\"string\">\"Already have a pending vsync event.  There should only be \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"one at a time.\"</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                mHavePendingVsync = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            mTimestampNanos = timestampNanos;</span><br><span class=\"line\">            mFrame = frame;</span><br><span class=\"line\">            <span class=\"comment\">//  run()</span></span><br><span class=\"line\">            Message msg = Message.obtain(mHandler, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">            msg.setAsynchronous(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            mHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            mHavePendingVsync = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            doFrame(mTimestampNanos, mFrame);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p>onVsync <strong></strong> FrameDisplayEventReceiver  Runnable  run </p>\n<h3 id=\"doFrame\"><a href=\"#doFrame\" class=\"headerlink\" title=\"doFrame\"></a>doFrame</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">doFrame</span><span class=\"params\">(<span class=\"keyword\">long</span> frameTimeNanos, <span class=\"keyword\">int</span> frame)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> startNanos;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (mLock) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!mFrameScheduled) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>; <span class=\"comment\">//,,</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">long</span> intendedFrameTimeNanos = frameTimeNanos;</span><br><span class=\"line\">        startNanos = System.nanoTime();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> jitterNanos = startNanos - frameTimeNanos;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (jitterNanos &gt;= mFrameIntervalNanos) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> skippedFrames = jitterNanos / mFrameIntervalNanos;</span><br><span class=\"line\">            <span class=\"comment\">//SKIPPED_FRAME_WARNING_LIMIT=30 , Log ,=30,</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (skippedFrames &gt;= SKIPPED_FRAME_WARNING_LIMIT) &#123;</span><br><span class=\"line\">                Log.i(TAG, <span class=\"string\">\"Skipped \"</span> + skippedFrames + <span class=\"string\">\" frames!  \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"The application may be doing too much work on its main thread.\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> lastFrameOffset = jitterNanos % mFrameIntervalNanos;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DEBUG_JANK) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"Missed vsync by \"</span> + (jitterNanos * <span class=\"number\">0.000001f</span>) + <span class=\"string\">\" ms \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"which is more than the frame interval of \"</span></span><br><span class=\"line\">                        + (mFrameIntervalNanos * <span class=\"number\">0.000001f</span>) + <span class=\"string\">\" ms!  \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"Skipping \"</span> + skippedFrames + <span class=\"string\">\" frames and setting frame \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"time to \"</span> + (lastFrameOffset * <span class=\"number\">0.000001f</span>) + <span class=\"string\">\" ms in the past.\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            frameTimeNanos = startNanos - lastFrameOffset;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (frameTimeNanos &lt; mLastFrameTimeNanos) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DEBUG_JANK) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"Frame time appears to be going backwards.  May be due to a \"</span></span><br><span class=\"line\">                        + <span class=\"string\">\"previously skipped frame.  Waiting for next vsync.\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// VSYNC</span></span><br><span class=\"line\">            scheduleVsyncLocked();</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        mFrameInfo.setVsync(intendedFrameTimeNanos, frameTimeNanos);</span><br><span class=\"line\">        mFrameScheduled = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        mLastFrameTimeNanos = frameTimeNanos;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        Trace.traceBegin(Trace.TRACE_TAG_VIEW, <span class=\"string\">\"Choreographer#doFrame\"</span>);</span><br><span class=\"line\">        AnimationUtils.lockAnimationClock(frameTimeNanos / TimeUtils.NANOS_PER_MS);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        mFrameInfo.markInputHandlingStart();</span><br><span class=\"line\">        doCallbacks(Choreographer.CALLBACK_INPUT, frameTimeNanos);</span><br><span class=\"line\"></span><br><span class=\"line\">        mFrameInfo.markAnimationsStart();</span><br><span class=\"line\">        doCallbacks(Choreographer.CALLBACK_ANIMATION, frameTimeNanos);</span><br><span class=\"line\"></span><br><span class=\"line\">        mFrameInfo.markPerformTraversalsStart();</span><br><span class=\"line\">        doCallbacks(Choreographer.CALLBACK_TRAVERSAL, frameTimeNanos);</span><br><span class=\"line\"></span><br><span class=\"line\">        doCallbacks(Choreographer.CALLBACK_COMMIT, frameTimeNanos);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        AnimationUtils.unlockAnimationClock();</span><br><span class=\"line\">        Trace.traceEnd(Trace.TRACE_TAG_VIEW);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (DEBUG_FRAMES) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> endNanos = System.nanoTime();</span><br><span class=\"line\">        Log.d(TAG, <span class=\"string\">\"Frame \"</span> + frame + <span class=\"string\">\": Finished, took \"</span></span><br><span class=\"line\">                + (endNanos - startNanos) * <span class=\"number\">0.000001f</span> + <span class=\"string\">\" ms, latency \"</span></span><br><span class=\"line\">                + (startNanos - frameTimeNanos) * <span class=\"number\">0.000001f</span> + <span class=\"string\">\" ms.\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"scheduleVsync\"><a href=\"#scheduleVsync\" class=\"headerlink\" title=\"scheduleVsync\"></a>scheduleVsync</h3><figure class=\"highlight java\"><figcaption><span>scheduleVsyncLocked.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">scheduleVsyncLocked</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// FrameDisplayEventReceiver  DisplayEventReceiver</span></span><br><span class=\"line\">    mDisplayEventReceiver.scheduleVsync();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><figcaption><span>DisplayEventReceiver.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">scheduleVsync</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mReceiverPtr == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        Log.w(TAG, <span class=\"string\">\"Attempted to schedule a vertical sync pulse but the display event \"</span></span><br><span class=\"line\">                + <span class=\"string\">\"receiver has already been disposed.\"</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Native </span></span><br><span class=\"line\">        nativeScheduleVsync(mReceiverPtr);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> VSYNC  Native ,,, onVsync .</p>\n<h3 id=\"scheduleFrameLocked\"><a href=\"#scheduleFrameLocked\" class=\"headerlink\" title=\"scheduleFrameLocked\"></a>scheduleFrameLocked</h3><p> FrameHandler  MSG_DO_SCHEDULE_CALLBACK  doScheduleCallback , scheduleFrameLocked;<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">scheduleFrameLocked</span><span class=\"params\">(<span class=\"keyword\">long</span> now)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!mFrameScheduled) &#123;</span><br><span class=\"line\">        mFrameScheduled = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (USE_VSYNC) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DEBUG_FRAMES) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"Scheduling next frame on vsync.\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (isRunningOnLooperThreadLocked()) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//Looper VSYNC</span></span><br><span class=\"line\">                scheduleVsyncLocked();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                Message msg = mHandler.obtainMessage(MSG_DO_SCHEDULE_VSYNC);</span><br><span class=\"line\">                msg.setAsynchronous(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">                mHandler.sendMessageAtFrontOfQueue(msg);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">           <span class=\"comment\">// VSYNC </span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"doScheduleCallback\"><a href=\"#doScheduleCallback\" class=\"headerlink\" title=\"doScheduleCallback\"></a>doScheduleCallback</h3><p> FrameHandler  MSG_DO_SCHEDULE_CALLBACK  doScheduleCallback(callbackType) ,, scheduleFrameLocked ;</p>\n<h3 id=\"doCallbacks\"><a href=\"#doCallbacks\" class=\"headerlink\" title=\"doCallbacks\"></a>doCallbacks</h3><p>doFrame  callback<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CALLBACK_INPUT = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@TestApi</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CALLBACK_ANIMATION = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"comment\">// , layout  draw</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CALLBACK_TRAVERSAL = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"comment\">//  traversal  post-draw </span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CALLBACK_COMMIT = <span class=\"number\">3</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">doCallbacks</span><span class=\"params\">(<span class=\"keyword\">int</span> callbackType, <span class=\"keyword\">long</span> frameTimeNanos)</span> </span>&#123;</span><br><span class=\"line\">    CallbackRecord callbacks;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (mLock) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> now = System.nanoTime();</span><br><span class=\"line\">        callbacks = mCallbackQueues[callbackType].extractDueCallbacksLocked(</span><br><span class=\"line\">                now / TimeUtils.NANOS_PER_MS);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callbacks == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        mCallbacksRunning = <span class=\"keyword\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (callbackType == Choreographer.CALLBACK_COMMIT) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> jitterNanos = now - frameTimeNanos;</span><br><span class=\"line\">            Trace.traceCounter(Trace.TRACE_TAG_VIEW, <span class=\"string\">\"jitterNanos\"</span>, (<span class=\"keyword\">int</span>) jitterNanos);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (jitterNanos &gt;= <span class=\"number\">2</span> * mFrameIntervalNanos) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> lastFrameOffset = jitterNanos % mFrameIntervalNanos</span><br><span class=\"line\">                        + mFrameIntervalNanos;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (DEBUG_JANK) &#123;</span><br><span class=\"line\">                    Log.d(TAG, <span class=\"string\">\"Commit callback delayed by \"</span> + (jitterNanos * <span class=\"number\">0.000001f</span>)</span><br><span class=\"line\">                            + <span class=\"string\">\" ms which is more than twice the frame interval of \"</span></span><br><span class=\"line\">                            + (mFrameIntervalNanos * <span class=\"number\">0.000001f</span>) + <span class=\"string\">\" ms!  \"</span></span><br><span class=\"line\">                            + <span class=\"string\">\"Setting frame time to \"</span> + (lastFrameOffset * <span class=\"number\">0.000001f</span>)</span><br><span class=\"line\">                            + <span class=\"string\">\" ms in the past.\"</span>);</span><br><span class=\"line\">                    mDebugPrintNextFrameTimeDelta = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                frameTimeNanos = now - lastFrameOffset;</span><br><span class=\"line\">                mLastFrameTimeNanos = frameTimeNanos;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        Trace.traceBegin(Trace.TRACE_TAG_VIEW, CALLBACK_TRACE_TITLES[callbackType]);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (CallbackRecord c = callbacks; c != <span class=\"keyword\">null</span>; c = c.next) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (DEBUG_FRAMES) &#123;</span><br><span class=\"line\">                Log.d(TAG, <span class=\"string\">\"RunCallback: type=\"</span> + callbackType</span><br><span class=\"line\">                        + <span class=\"string\">\", action=\"</span> + c.action + <span class=\"string\">\", token=\"</span> + c.token</span><br><span class=\"line\">                        + <span class=\"string\">\", latencyMillis=\"</span> + (SystemClock.uptimeMillis() - c.dueTime));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//token=FRAME_CALLBACK_TOKEN, doFrame  run</span></span><br><span class=\"line\">            c.run(frameTimeNanos);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (mLock) &#123;</span><br><span class=\"line\">            mCallbacksRunning = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> CallbackRecord next = callbacks.next;</span><br><span class=\"line\">                recycleCallbackLocked(callbacks);</span><br><span class=\"line\">                callbacks = next;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">while</span> (callbacks != <span class=\"keyword\">null</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Trace.traceEnd(Trace.TRACE_TAG_VIEW);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"CallbackRecord\"><a href=\"#CallbackRecord\" class=\"headerlink\" title=\"CallbackRecord\"></a>CallbackRecord</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallbackRecord</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> CallbackRecord next;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">long</span> dueTime;</span><br><span class=\"line\">    <span class=\"comment\">//Runnable   FrameCallback</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object action;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object token;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">(<span class=\"keyword\">long</span> frameTimeNanos)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (token == FRAME_CALLBACK_TOKEN) &#123;</span><br><span class=\"line\">            ((FrameCallback)action).doFrame(frameTimeNanos);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Runnalbe 2.8</span></span><br><span class=\"line\">            ((Runnable)action).run();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"CallbackQueue\"><a href=\"#CallbackQueue\" class=\"headerlink\" title=\"CallbackQueue\"></a>CallbackQueue</h3><figure class=\"highlight java\"><figcaption><span>CallbackQueue.addCallbackLocked</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addCallbackLocked</span><span class=\"params\">(<span class=\"keyword\">long</span> dueTime, Object action, Object token)</span> </span>&#123;</span><br><span class=\"line\">           CallbackRecord callback = obtainCallbackLocked(dueTime, action, token);</span><br><span class=\"line\">           CallbackRecord entry = mHead;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (entry == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">               mHead = callback;</span><br><span class=\"line\">               <span class=\"keyword\">return</span>;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"comment\">//</span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> (dueTime &lt; entry.dueTime) &#123;</span><br><span class=\"line\">               callback.next = entry;</span><br><span class=\"line\">               mHead = callback;</span><br><span class=\"line\">               <span class=\"keyword\">return</span>;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"keyword\">while</span> (entry.next != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (dueTime &lt; entry.next.dueTime) &#123;</span><br><span class=\"line\">                   callback.next = entry.next;</span><br><span class=\"line\">                   <span class=\"keyword\">break</span>;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               entry = entry.next;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           entry.next = callback;</span><br><span class=\"line\">       &#125;</span><br></pre></td></tr></table></figure>\n<p>CallbackQueue  CallbackRecord , CallbackRecord , doFrame  input ,,<code>ViewRootImpl</code><code>ConsumeBatchedInputRunnable InvalidateOnAnimationRunnable TraversalRunnable</code> Runnalbe.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@TestApi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">postCallback</span><span class=\"params\">(<span class=\"keyword\">int</span> callbackType, Runnable action, Object token)</span> </span>&#123;</span><br><span class=\"line\">    postCallbackDelayed(callbackType, action, token, <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>ViewRootImpl  Choreographer ,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>, Log <code>The application may be doing too much work on its main thread</code>. requestLayout  ViewRootImpl  TraversalRunnable,.</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://www.jianshu.com/p/c2d93861095a\" target=\"_blank\" rel=\"noopener\">Android8.1 Choreographer</a><br><a href=\"http://gityuan.com/2017/02/25/choreographer/\" target=\"_blank\" rel=\"noopener\">Choreographer</a></p>"},{"title":"","date":"2018-08-10T12:26:30.000Z","_content":"\n,,,..\n\n#### \n\n,,.=-,,.10,10,45,50,100,75,10,10,50.\n\n<!-- more -->\n#### \n\n##### \n\n,,,,,,,,.24, fullCombination 15s, PC .\n``` java\n    public List<List<Coin>> fullCombination(List<Coin> lstSource) {\n        int n = lstSource.size();\n        int max = 1 << n;//2n\n        List<List<Coin>> lstResult = new ArrayList<>();\n        for (int i = 0; i < max; i++) {\n            List<Coin> lstTemp = new ArrayList<>();\n            for (int j = 0; j < n; j++) {\n                //i2j\n                if ((i >> j & 1) > 0) {\n                    lstTemp.add(lstSource.get(j));\n                }\n            }\n            lstResult.add(lstTemp);\n        }\n        lstResult.remove(0);\n        return lstResult;\n    }\n```\n##### \n\n: candidates  target  candidates  target .candidates . LeetCode II,,,O(n!),.,20ms.\n\n``` java \npublic class Coin {\n    public String id;\n    /**\n     * \n     */\n    public double denomination;\n}\n    /**\n     * \n     *\n     * @param target \n     * @param coins  \n     * @return \n     */\n    private List<Coin> getBestCombination(double target, List<Coin> coins) {\n        List<Coin> result = new ArrayList<>(5);\n        List<ArrayList<Coin>> combinations = new ArrayList<>(10);\n        //\n        combinations = combinationSum(coins, target, combinations);\n\n        TreeMap<Integer, List<Coin>> lastResult = new TreeMap<>();\n        // \n        for (List<Coin> arrays : combinations) {\n            int temp = 0;\n            for (Coin c : arrays) {\n                temp += c.denomination;\n            }\n            lastResult.put(temp, arrays);\n        }\n        //\n        result.addAll(lastResult.lastEntry().getValue());\n        return result;\n    }\n\n    private List<ArrayList<Coin>> combinationSum(List<Coin> coins,\n                                                 double target,\n                                                 List<ArrayList<Coin>> result) {\n        List<ArrayList<Coin>> res = new ArrayList<>(10);\n        if (coins == null || coins.size() == 0) return new ArrayList<>(1);\n        List<Coin> realCoins = new ArrayList<>(coins.size());\n        for (Coin c : coins) {\n            if (c.denomination <= target) {\n                realCoins.add(c);\n            }\n        }\n        Collections.sort(realCoins, new Comparator<Coin>() {\n            @Override\n            public int compare(Coin c1, Coin c2) {\n                return Double.compare(c1.denomination, c2.denomination);\n            }\n        });\n        return dfs(realCoins, 0, target, new ArrayList<Coin>(10), res, result);\n    }\n\n    private List<ArrayList<Coin>> dfs(List<Coin> candidates,\n                                      int startIndex,\n                                      double target,\n                                      List<Coin> combination,\n                                      List<ArrayList<Coin>> res, List<ArrayList<Coin>> result) {\n        //\n        result.add(new ArrayList<>(combination));\n\n        if (target == 0) {\n            res.add(new ArrayList<>(combination));\n            return result;\n        }\n\n        for (int i = startIndex, size = candidates.size(); i < size; i++) {\n            if (i != startIndex && candidates.get(i).denomination == candidates.get(i - 1).denomination) {\n                continue;\n            }\n            if (target < candidates.get(i).denomination) {\n                break;\n            }\n            combination.add(candidates.get(i));\n            dfs(candidates, i + 1, target - candidates.get(i).denomination, combination, res, result);\n            combination.remove(combination.size() - 1);\n        }\n        return result;\n    }\n```\n[](https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/CoinTest.java) .\n\n#### \n[ II LeetCode](https://leetcode-cn.com/problems/combination-sum-ii/description/)\n[](https://blog.csdn.net/James_T_Kirk/article/details/76895209)\n[ II ](https://www.jiuzhang.com/solution/combination-sum-ii/)\n\n\n\n","source":"_posts/coin-best-combination.md","raw":"---\ntitle: \ndate: 2018-08-10 20:26:30\ntags:\n    - \ncategories: \n---\n\n,,,..\n\n#### \n\n,,.=-,,.10,10,45,50,100,75,10,10,50.\n\n<!-- more -->\n#### \n\n##### \n\n,,,,,,,,.24, fullCombination 15s, PC .\n``` java\n    public List<List<Coin>> fullCombination(List<Coin> lstSource) {\n        int n = lstSource.size();\n        int max = 1 << n;//2n\n        List<List<Coin>> lstResult = new ArrayList<>();\n        for (int i = 0; i < max; i++) {\n            List<Coin> lstTemp = new ArrayList<>();\n            for (int j = 0; j < n; j++) {\n                //i2j\n                if ((i >> j & 1) > 0) {\n                    lstTemp.add(lstSource.get(j));\n                }\n            }\n            lstResult.add(lstTemp);\n        }\n        lstResult.remove(0);\n        return lstResult;\n    }\n```\n##### \n\n: candidates  target  candidates  target .candidates . LeetCode II,,,O(n!),.,20ms.\n\n``` java \npublic class Coin {\n    public String id;\n    /**\n     * \n     */\n    public double denomination;\n}\n    /**\n     * \n     *\n     * @param target \n     * @param coins  \n     * @return \n     */\n    private List<Coin> getBestCombination(double target, List<Coin> coins) {\n        List<Coin> result = new ArrayList<>(5);\n        List<ArrayList<Coin>> combinations = new ArrayList<>(10);\n        //\n        combinations = combinationSum(coins, target, combinations);\n\n        TreeMap<Integer, List<Coin>> lastResult = new TreeMap<>();\n        // \n        for (List<Coin> arrays : combinations) {\n            int temp = 0;\n            for (Coin c : arrays) {\n                temp += c.denomination;\n            }\n            lastResult.put(temp, arrays);\n        }\n        //\n        result.addAll(lastResult.lastEntry().getValue());\n        return result;\n    }\n\n    private List<ArrayList<Coin>> combinationSum(List<Coin> coins,\n                                                 double target,\n                                                 List<ArrayList<Coin>> result) {\n        List<ArrayList<Coin>> res = new ArrayList<>(10);\n        if (coins == null || coins.size() == 0) return new ArrayList<>(1);\n        List<Coin> realCoins = new ArrayList<>(coins.size());\n        for (Coin c : coins) {\n            if (c.denomination <= target) {\n                realCoins.add(c);\n            }\n        }\n        Collections.sort(realCoins, new Comparator<Coin>() {\n            @Override\n            public int compare(Coin c1, Coin c2) {\n                return Double.compare(c1.denomination, c2.denomination);\n            }\n        });\n        return dfs(realCoins, 0, target, new ArrayList<Coin>(10), res, result);\n    }\n\n    private List<ArrayList<Coin>> dfs(List<Coin> candidates,\n                                      int startIndex,\n                                      double target,\n                                      List<Coin> combination,\n                                      List<ArrayList<Coin>> res, List<ArrayList<Coin>> result) {\n        //\n        result.add(new ArrayList<>(combination));\n\n        if (target == 0) {\n            res.add(new ArrayList<>(combination));\n            return result;\n        }\n\n        for (int i = startIndex, size = candidates.size(); i < size; i++) {\n            if (i != startIndex && candidates.get(i).denomination == candidates.get(i - 1).denomination) {\n                continue;\n            }\n            if (target < candidates.get(i).denomination) {\n                break;\n            }\n            combination.add(candidates.get(i));\n            dfs(candidates, i + 1, target - candidates.get(i).denomination, combination, res, result);\n            combination.remove(combination.size() - 1);\n        }\n        return result;\n    }\n```\n[](https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/CoinTest.java) .\n\n#### \n[ II LeetCode](https://leetcode-cn.com/problems/combination-sum-ii/description/)\n[](https://blog.csdn.net/James_T_Kirk/article/details/76895209)\n[ II ](https://www.jiuzhang.com/solution/combination-sum-ii/)\n\n\n\n","slug":"coin-best-combination","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsac0015ndf2wkhzn62k","content":"<p>,,,..</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>,,.=-,,.10,10,45,50,100,75,10,10,50.</p>\n<a id=\"more\"></a>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>,,,,,,,,.24, fullCombination 15s, PC .<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> List&lt;List&lt;Coin&gt;&gt; fullCombination(List&lt;Coin&gt; lstSource) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = lstSource.size();</span><br><span class=\"line\">    <span class=\"keyword\">int</span> max = <span class=\"number\">1</span> &lt;&lt; n;<span class=\"comment\">//2n</span></span><br><span class=\"line\">    List&lt;List&lt;Coin&gt;&gt; lstResult = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; max; i++) &#123;</span><br><span class=\"line\">        List&lt;Coin&gt; lstTemp = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; n; j++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//i2j</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((i &gt;&gt; j &amp; <span class=\"number\">1</span>) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                lstTemp.add(lstSource.get(j));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        lstResult.add(lstTemp);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    lstResult.remove(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> lstResult;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>: candidates  target  candidates  target .candidates . LeetCode II,,,O(n!),.,20ms.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Coin</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String id;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> denomination;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> target </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> coins  </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;Coin&gt; <span class=\"title\">getBestCombination</span><span class=\"params\">(<span class=\"keyword\">double</span> target, List&lt;Coin&gt; coins)</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Coin&gt; result = <span class=\"keyword\">new</span> ArrayList&lt;&gt;(<span class=\"number\">5</span>);</span><br><span class=\"line\">        List&lt;ArrayList&lt;Coin&gt;&gt; combinations = <span class=\"keyword\">new</span> ArrayList&lt;&gt;(<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        combinations = combinationSum(coins, target, combinations);</span><br><span class=\"line\"></span><br><span class=\"line\">        TreeMap&lt;Integer, List&lt;Coin&gt;&gt; lastResult = <span class=\"keyword\">new</span> TreeMap&lt;&gt;();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (List&lt;Coin&gt; arrays : combinations) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> temp = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Coin c : arrays) &#123;</span><br><span class=\"line\">                temp += c.denomination;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            lastResult.put(temp, arrays);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        result.addAll(lastResult.lastEntry().getValue());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;ArrayList&lt;Coin&gt;&gt; combinationSum(List&lt;Coin&gt; coins,</span><br><span class=\"line\">                                                 <span class=\"keyword\">double</span> target,</span><br><span class=\"line\">                                                 List&lt;ArrayList&lt;Coin&gt;&gt; result) &#123;</span><br><span class=\"line\">        List&lt;ArrayList&lt;Coin&gt;&gt; res = <span class=\"keyword\">new</span> ArrayList&lt;&gt;(<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (coins == <span class=\"keyword\">null</span> || coins.size() == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ArrayList&lt;&gt;(<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Coin&gt; realCoins = <span class=\"keyword\">new</span> ArrayList&lt;&gt;(coins.size());</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Coin c : coins) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (c.denomination &lt;= target) &#123;</span><br><span class=\"line\">                realCoins.add(c);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Collections.sort(realCoins, <span class=\"keyword\">new</span> Comparator&lt;Coin&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">compare</span><span class=\"params\">(Coin c1, Coin c2)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> Double.compare(c1.denomination, c2.denomination);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dfs(realCoins, <span class=\"number\">0</span>, target, <span class=\"keyword\">new</span> ArrayList&lt;Coin&gt;(<span class=\"number\">10</span>), res, result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;ArrayList&lt;Coin&gt;&gt; dfs(List&lt;Coin&gt; candidates,</span><br><span class=\"line\">                                      <span class=\"keyword\">int</span> startIndex,</span><br><span class=\"line\">                                      <span class=\"keyword\">double</span> target,</span><br><span class=\"line\">                                      List&lt;Coin&gt; combination,</span><br><span class=\"line\">                                      List&lt;ArrayList&lt;Coin&gt;&gt; res, List&lt;ArrayList&lt;Coin&gt;&gt; result) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        result.add(<span class=\"keyword\">new</span> ArrayList&lt;&gt;(combination));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            res.add(<span class=\"keyword\">new</span> ArrayList&lt;&gt;(combination));</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = startIndex, size = candidates.size(); i &lt; size; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i != startIndex &amp;&amp; candidates.get(i).denomination == candidates.get(i - <span class=\"number\">1</span>).denomination) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (target &lt; candidates.get(i).denomination) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            combination.add(candidates.get(i));</span><br><span class=\"line\">            dfs(candidates, i + <span class=\"number\">1</span>, target - candidates.get(i).denomination, combination, res, result);</span><br><span class=\"line\">            combination.remove(combination.size() - <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/CoinTest.java\"></a> .</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://leetcode-cn.com/problems/combination-sum-ii/description/\" target=\"_blank\" rel=\"noopener\"> II LeetCode</a><br><a href=\"https://blog.csdn.net/James_T_Kirk/article/details/76895209\" target=\"_blank\" rel=\"noopener\"></a><br><a href=\"https://www.jiuzhang.com/solution/combination-sum-ii/\" target=\"_blank\" rel=\"noopener\"> II </a></p>\n","site":{"data":{}},"excerpt":"<p>,,,..</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>,,.=-,,.10,10,45,50,100,75,10,10,50.</p>","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>,,,,,,,,.24, fullCombination 15s, PC .<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> List&lt;List&lt;Coin&gt;&gt; fullCombination(List&lt;Coin&gt; lstSource) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = lstSource.size();</span><br><span class=\"line\">    <span class=\"keyword\">int</span> max = <span class=\"number\">1</span> &lt;&lt; n;<span class=\"comment\">//2n</span></span><br><span class=\"line\">    List&lt;List&lt;Coin&gt;&gt; lstResult = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; max; i++) &#123;</span><br><span class=\"line\">        List&lt;Coin&gt; lstTemp = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; n; j++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//i2j</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> ((i &gt;&gt; j &amp; <span class=\"number\">1</span>) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                lstTemp.add(lstSource.get(j));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        lstResult.add(lstTemp);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    lstResult.remove(<span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> lstResult;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>: candidates  target  candidates  target .candidates . LeetCode II,,,O(n!),.,20ms.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Coin</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String id;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">double</span> denomination;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> target </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> coins  </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> List&lt;Coin&gt; <span class=\"title\">getBestCombination</span><span class=\"params\">(<span class=\"keyword\">double</span> target, List&lt;Coin&gt; coins)</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Coin&gt; result = <span class=\"keyword\">new</span> ArrayList&lt;&gt;(<span class=\"number\">5</span>);</span><br><span class=\"line\">        List&lt;ArrayList&lt;Coin&gt;&gt; combinations = <span class=\"keyword\">new</span> ArrayList&lt;&gt;(<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        combinations = combinationSum(coins, target, combinations);</span><br><span class=\"line\"></span><br><span class=\"line\">        TreeMap&lt;Integer, List&lt;Coin&gt;&gt; lastResult = <span class=\"keyword\">new</span> TreeMap&lt;&gt;();</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (List&lt;Coin&gt; arrays : combinations) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> temp = <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Coin c : arrays) &#123;</span><br><span class=\"line\">                temp += c.denomination;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            lastResult.put(temp, arrays);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        result.addAll(lastResult.lastEntry().getValue());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;ArrayList&lt;Coin&gt;&gt; combinationSum(List&lt;Coin&gt; coins,</span><br><span class=\"line\">                                                 <span class=\"keyword\">double</span> target,</span><br><span class=\"line\">                                                 List&lt;ArrayList&lt;Coin&gt;&gt; result) &#123;</span><br><span class=\"line\">        List&lt;ArrayList&lt;Coin&gt;&gt; res = <span class=\"keyword\">new</span> ArrayList&lt;&gt;(<span class=\"number\">10</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (coins == <span class=\"keyword\">null</span> || coins.size() == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ArrayList&lt;&gt;(<span class=\"number\">1</span>);</span><br><span class=\"line\">        List&lt;Coin&gt; realCoins = <span class=\"keyword\">new</span> ArrayList&lt;&gt;(coins.size());</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Coin c : coins) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (c.denomination &lt;= target) &#123;</span><br><span class=\"line\">                realCoins.add(c);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Collections.sort(realCoins, <span class=\"keyword\">new</span> Comparator&lt;Coin&gt;() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">compare</span><span class=\"params\">(Coin c1, Coin c2)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> Double.compare(c1.denomination, c2.denomination);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dfs(realCoins, <span class=\"number\">0</span>, target, <span class=\"keyword\">new</span> ArrayList&lt;Coin&gt;(<span class=\"number\">10</span>), res, result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;ArrayList&lt;Coin&gt;&gt; dfs(List&lt;Coin&gt; candidates,</span><br><span class=\"line\">                                      <span class=\"keyword\">int</span> startIndex,</span><br><span class=\"line\">                                      <span class=\"keyword\">double</span> target,</span><br><span class=\"line\">                                      List&lt;Coin&gt; combination,</span><br><span class=\"line\">                                      List&lt;ArrayList&lt;Coin&gt;&gt; res, List&lt;ArrayList&lt;Coin&gt;&gt; result) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        result.add(<span class=\"keyword\">new</span> ArrayList&lt;&gt;(combination));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            res.add(<span class=\"keyword\">new</span> ArrayList&lt;&gt;(combination));</span><br><span class=\"line\">            <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = startIndex, size = candidates.size(); i &lt; size; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i != startIndex &amp;&amp; candidates.get(i).denomination == candidates.get(i - <span class=\"number\">1</span>).denomination) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (target &lt; candidates.get(i).denomination) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            combination.add(candidates.get(i));</span><br><span class=\"line\">            dfs(candidates, i + <span class=\"number\">1</span>, target - candidates.get(i).denomination, combination, res, result);</span><br><span class=\"line\">            combination.remove(combination.size() - <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/CoinTest.java\"></a> .</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://leetcode-cn.com/problems/combination-sum-ii/description/\" target=\"_blank\" rel=\"noopener\"> II LeetCode</a><br><a href=\"https://blog.csdn.net/James_T_Kirk/article/details/76895209\" target=\"_blank\" rel=\"noopener\"></a><br><a href=\"https://www.jiuzhang.com/solution/combination-sum-ii/\" target=\"_blank\" rel=\"noopener\"> II </a></p>"},{"title":"Clean Code (1)","date":"2018-07-20T07:03:54.000Z","_content":"\n\n# \n\n --Bjarne Stroustrup\n\n  --Ward Cunningham\n\n,****\n\n<!--more-->\n\n## \n\n* \n* \n* UserInfoUser\n* \n* \n* \n* \n* \n* \n\n\n\n## \n\n* \n* \n* \n* Switch:switch\n* OC\n* Builder\n\n\n\n## \n\n* \n* \n* \n\nCommit\n\n## \n\n* () \n* \n\nTabSpaceCheckStyle\n\n## \n\n* \n\n``` java\n//\npublic class Point{\n\tpublic double x;\n\tpublic double y;\n}\n//\npublic interface Point{\n\tdouble getX();\n\tdouble getY();\n\tvoid setCartesian(double x,double y);\n\tdouble getR();\n\tdouble getTheta();\n\tviod setPolar(double r,double theta);\n}\n```\n\n* ()\n* ORMsavefind\n\n\n\n## \n\n* \n* Try-Catch-Finally\n* \n* null\n* null\n\nnullNPE,\n\n## \n\nTestCaseapi\n\n## \n\n* --\n* FIRST:\n\nAndroid\n\n## \n\n* \n* \n* (SRP)\n* \n* (DIP)\n\nSRPDIP","source":"_posts/clean-code-1.md","raw":"---\ntitle: Clean Code (1)\ndate: 2018-07-20 15:03:54\ntags:\n    - \ncategories: \n---\n\n\n# \n\n --Bjarne Stroustrup\n\n  --Ward Cunningham\n\n,****\n\n<!--more-->\n\n## \n\n* \n* \n* UserInfoUser\n* \n* \n* \n* \n* \n* \n\n\n\n## \n\n* \n* \n* \n* Switch:switch\n* OC\n* Builder\n\n\n\n## \n\n* \n* \n* \n\nCommit\n\n## \n\n* () \n* \n\nTabSpaceCheckStyle\n\n## \n\n* \n\n``` java\n//\npublic class Point{\n\tpublic double x;\n\tpublic double y;\n}\n//\npublic interface Point{\n\tdouble getX();\n\tdouble getY();\n\tvoid setCartesian(double x,double y);\n\tdouble getR();\n\tdouble getTheta();\n\tviod setPolar(double r,double theta);\n}\n```\n\n* ()\n* ORMsavefind\n\n\n\n## \n\n* \n* Try-Catch-Finally\n* \n* null\n* null\n\nnullNPE,\n\n## \n\nTestCaseapi\n\n## \n\n* --\n* FIRST:\n\nAndroid\n\n## \n\n* \n* \n* (SRP)\n* \n* (DIP)\n\nSRPDIP","slug":"clean-code-1","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsae0019ndf2y2xn03qq","content":"<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> Bjarne Stroustrup</p>\n<p>  Ward Cunningham</p>\n<p>,<strong></strong></p>\n<a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>UserInfoUser</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li></li>\n<li>Switch:switch</li>\n<li>OC</li>\n<li>Builder</li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Commit</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>() </li>\n<li></li>\n</ul>\n<p>TabSpaceCheckStyle</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Point</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">double</span> x;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">double</span> y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Point</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getX</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getY</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setCartesian</span><span class=\"params\">(<span class=\"keyword\">double</span> x,<span class=\"keyword\">double</span> y)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getR</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getTheta</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">viod <span class=\"title\">setPolar</span><span class=\"params\">(<span class=\"keyword\">double</span> r,<span class=\"keyword\">double</span> theta)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>()</li>\n<li>ORMsavefind</li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li>Try-Catch-Finally</li>\n<li></li>\n<li>null</li>\n<li>null</li>\n</ul>\n<p>nullNPE,</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>TestCaseapi</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>--</li>\n<li>FIRST:</li>\n</ul>\n<p>Android</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>(SRP)</li>\n<li></li>\n<li>(DIP)</li>\n</ul>\n<p>SRPDIP</p>\n","site":{"data":{}},"excerpt":"<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> Bjarne Stroustrup</p>\n<p>  Ward Cunningham</p>\n<p>,<strong></strong></p>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>UserInfoUser</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li></li>\n<li>Switch:switch</li>\n<li>OC</li>\n<li>Builder</li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p>Commit</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>() </li>\n<li></li>\n</ul>\n<p>TabSpaceCheckStyle</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Point</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">double</span> x;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">double</span> y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Point</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getX</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getY</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setCartesian</span><span class=\"params\">(<span class=\"keyword\">double</span> x,<span class=\"keyword\">double</span> y)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getR</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">getTheta</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">viod <span class=\"title\">setPolar</span><span class=\"params\">(<span class=\"keyword\">double</span> r,<span class=\"keyword\">double</span> theta)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>()</li>\n<li>ORMsavefind</li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li>Try-Catch-Finally</li>\n<li></li>\n<li>null</li>\n<li>null</li>\n</ul>\n<p>nullNPE,</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>TestCaseapi</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>--</li>\n<li>FIRST:</li>\n</ul>\n<p>Android</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li>(SRP)</li>\n<li></li>\n<li>(DIP)</li>\n</ul>\n<p>SRPDIP</p>"},{"title":"Clean Code (2)","date":"2018-07-20T07:19:54.000Z","_content":"## \n\n* (DI)(IoC)\n* (AOP)\n\n\n\n<!-- more -->\n## \n\n* \n* \n* \n* \n\n\n\n## \n\n* \n  *  \n  *  \n  *  \n  *  \n  *  \n* \n  * \n  * \n  * boolean\n  * \n* \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * if/elseswitch/case\n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n\n\n","source":"_posts/clean-code-2.md","raw":"---\ntitle:  Clean Code (2)\ndate: 2018-07-20 15:19:54\ntags:\n    - \ncategories: \n---\n## \n\n* (DI)(IoC)\n* (AOP)\n\n\n\n<!-- more -->\n## \n\n* \n* \n* \n* \n\n\n\n## \n\n* \n  *  \n  *  \n  *  \n  *  \n  *  \n* \n  * \n  * \n  * boolean\n  * \n* \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * if/elseswitch/case\n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n  * \n\n\n","slug":"clean-code-2","published":1,"updated":"2019-11-24T11:46:47.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsag001cndf2lyjm9ych","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>(DI)(IoC)</li>\n<li>(AOP)</li>\n</ul>\n<p></p>\n<a id=\"more\"></a>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li></li>\n<li>boolean</li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li>if/elseswitch/case</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<p></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li>(DI)(IoC)</li>\n<li>(AOP)</li>\n</ul>\n<p></p>","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<p></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li></li>\n<li>boolean</li>\n<li></li>\n</ul>\n</li>\n<li><ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li>if/elseswitch/case</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n</ul>\n<p></p>"},{"title":" HTTPS","date":"2018-08-30T03:45:46.000Z","_content":"\n Jekyll ,,, Hexo ,. GihHub  https ,.\n<!-- more -->\n#### GitHub\n, Enforce HTTPS ,,```http://``````https://```, save ,., CNAME ,```libery.cn```.\n![githubhttps](http://7qndg9.com1.z0.glb.clouddn.com/github_add_https.png)\n\n#### \n,, A  ip , HTTPS ,, CNAME,,. HTTPS . Chrome ,.\n![](http://7qndg9.com1.z0.glb.clouddn.com/github_https_cname.png)\n\n#### Tip\n,,,.\n![](http://7qndg9.com1.z0.glb.clouddn.com/github_https_tip.png)\n\n#### \n, http, https , https,,.,,,,,.","source":"_posts/github-page-https.md","raw":"---\ntitle:  HTTPS\ndate: 2018-08-30 11:45:46\ntags:\n    - GitHub\ncategories:\n    - \n---\n\n Jekyll ,,, Hexo ,. GihHub  https ,.\n<!-- more -->\n#### GitHub\n, Enforce HTTPS ,,```http://``````https://```, save ,., CNAME ,```libery.cn```.\n![githubhttps](http://7qndg9.com1.z0.glb.clouddn.com/github_add_https.png)\n\n#### \n,, A  ip , HTTPS ,, CNAME,,. HTTPS . Chrome ,.\n![](http://7qndg9.com1.z0.glb.clouddn.com/github_https_cname.png)\n\n#### Tip\n,,,.\n![](http://7qndg9.com1.z0.glb.clouddn.com/github_https_tip.png)\n\n#### \n, http, https , https,,.,,,,,.","slug":"github-page-https","published":1,"updated":"2019-11-24T11:46:47.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsah001gndf21pb04o2o","content":"<p> Jekyll ,,, Hexo ,. GihHub  https ,.<br><a id=\"more\"></a></p>\n<h4 id=\"GitHub\"><a href=\"#GitHub\" class=\"headerlink\" title=\"GitHub\"></a>GitHub</h4><p>, Enforce HTTPS ,,<code>http://</code><code>https://</code>, save ,., CNAME ,<code>libery.cn</code>.<br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/github_add_https.png\" alt=\"githubhttps\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>,, A  ip , HTTPS ,, CNAME,,. HTTPS . Chrome ,.<br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/github_https_cname.png\" alt=\"\"></p>\n<h4 id=\"Tip\"><a href=\"#Tip\" class=\"headerlink\" title=\"Tip\"></a>Tip</h4><p>,,,.<br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/github_https_tip.png\" alt=\"\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>, http, https , https,,.,,,,,.</p>\n","site":{"data":{}},"excerpt":"<p> Jekyll ,,, Hexo ,. GihHub  https ,.<br>","more":"</p>\n<h4 id=\"GitHub\"><a href=\"#GitHub\" class=\"headerlink\" title=\"GitHub\"></a>GitHub</h4><p>, Enforce HTTPS ,,<code>http://</code><code>https://</code>, save ,., CNAME ,<code>libery.cn</code>.<br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/github_add_https.png\" alt=\"githubhttps\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>,, A  ip , HTTPS ,, CNAME,,. HTTPS . Chrome ,.<br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/github_https_cname.png\" alt=\"\"></p>\n<h4 id=\"Tip\"><a href=\"#Tip\" class=\"headerlink\" title=\"Tip\"></a>Tip</h4><p>,,,.<br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/github_https_tip.png\" alt=\"\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>, http, https , https,,.,,,,,.</p>"},{"title":" Git Messages  ChangeLog","date":"2019-11-18T10:25:00.000Z","_content":"# \n, ChangeLog,,,.Module  ChangeLog  App ,..\n<!-- more -->\n# \n,,, Git  Shell . git tag  commit message, messge, message  ChangeLog, Modlue  ChangeLog, ChangeLog , App  ChangeLog. commit message , git hook  commit  message .\n## commit message \n ChangeLog  message,[Angular Commit ](https://github.com/angular/angular/commits/master),.\ncommit message :\n```\ntype: subject\n\nbody\n\nfooter\n```\n### header\nHeader type subject\n\n#### type  commit 3\n* feat feature\n* fix bug\n* other\n\n type  feat  fix commit  Change log \n** type  feat  fix commit  Change log **\n\n#### subject  commit 50\n change changed  changes\n\n\n### body , , \n\n### footer  Breaking Changes  Closed Issues\n\n## Git Commit \nMessage,,\n###  git \n1. gitlinx/mac `.gitconfig`\n```\n$ vi ~/.gitconfig\n```\n2. [commit] template\n```\n[commit]\n        template = /Users/<name>/.myCommitMsg\n```\n3. \n```\n$ vi /Users/<name>/.myCommitMsg\n```\n\n, Header \n\n```\ntype: subject\n\nbody\n\nfooter\n\n# - type: \n#    feat(), \n#    fix(), \n#    other(), \n# - subject\n#   \n# - body:\n#    , , \n# - footer:\n#     Breaking Changes  Closed Issues\n```\n4.  terminal `git commit`\n\n sourcetree  git \n### Sourcetree\n->->,,.,.\n### git cz\n[git cz](https://github.com/commitizen/cz-cli)\n``` \nnpm install -g commitizen cz-conventional-changelog\necho '{ \"path\": \"cz-conventional-changelog\" }' > ~/.czrc\n```\n`git cz``git commit`,,,\n\n![](https://raw.githubusercontent.com/commitizen/cz-cli/master/meta/screenshots/add-commit.png)\n\n,\n``` shell\n  sh git:(master)  git cz\ncz-cli@4.0.3, cz-conventional-changelog@3.0.1\n\n? Select the type of change that you're committing: feat:        A new feature\n? What is the scope of this change (e.g. component or file name): (press enter t\no skip)\n? Write a short, imperative tense description of the change (max 94 chars):\n (4) test\n? Provide a longer description of the change: (press enter to skip)\n\n? Are there any breaking changes? Yes\n? A BREAKING CHANGE commit requires a body. Please enter a longer description of the commit\nitself:\n -\n? Describe the breaking changes:\n\n? Does this change affect any open issues? No\n```\n,.\n### Android Studio Commit Message \n[Commit Message Template](https://plugins.jetbrains.com/plugin/9364-commit-message-template)`Settings > Tools > Commit Message Template `.\n### git cz\n[git cz](https://github.com/commitizen/cz-cli)\n``` \nnpm install -g commitizen cz-conventional-changelog\necho '{ \"path\": \"cz-conventional-changelog\" }' > ~/.czrc\n```\n,.\n### Android Studio Commit Message \n[Commit Message Template](https://plugins.jetbrains.com/plugin/9364-commit-message-template)`Settings > Tools > Commit Message Template `.\n### git cz\n[git cz](https://github.com/commitizen/cz-cli)\n``` \nnpm install -g commitizen cz-conventional-changelog\necho '{ \"path\": \"cz-conventional-changelog\" }' > ~/.czrc\n```\n`git cz``git commit`,,,\n,.\n### Android Studio Commit Message \n[Commit Message Template](https://plugins.jetbrains.com/plugin/9364-commit-message-template)`Settings > Tools > Commit Message Template `.\n,.\n\n##  Module  ChangeLog\n:\n1. git tag tag\n2. tagcommit message\n3.  log, message\n4. changelog.md\n shell ,.\n\n###  tag\n tag, tag\n``` shell\n#  tag\nfunction getAutoTag(){\n# tag\ncurrent_git_tags=$(git tag --sort=taggerdate)\nfor word in ${current_git_tags}\ndo\n    tags[temp]=${word}\n    ((++temp))\ndone\n#  tag\ntag1=${tags[temp-2]}\ntag2=${tags[temp-1]}\n}\n```\n###   tag  commitId  message\n``` shell\n#  commitId  message\nfunction getInputCommitId(){\ntag2=${input2}\ntag1=${input1}\n#  message [)\ngit log --pretty=format:\"%s\" ${tag2}...${tag1} >commits.txt\n# \necho  >>commits.txt\n#  commitId  message\ngit log --pretty=format:\"%s\" ${tag1} -1 >>commits.txt\n}\n\n# tag message\nfunction getTagMessages(){\ngetAutoTag\necho $tag2  $tag1\nif [[ \"\" = ${tag1} ]]\n    then\n#  tag, tag  message, commits.txt\n    git log --pretty=format:\"%s\" ${tag2} >commits.txt\nelse\ngit log --pretty=format:\"%s\" ${tag2}...${tag1} >commits.txt\nfi\n# tagcommit messagecommits.txt\n}\n```\n messagecommits.txt,\n###  message\n message  commits ,, message\n``` shell\n#  commits.txt ,feat.txtfix.txt\nfunction generateDoc(){\n    # $1  ,\n    if [[ \"$1\" =~ ^feat.*:$ ]]\n        then\n        # msg  feat: \n        msg=\"${@:2}\"\n        echo ${msg} >> feat.txt\n    elif [[ \"$1\" =~ ^fix.*:$ ]]\n        then\n        # msg  fix: \n        msg=\"${@:2}\"\n        echo $msg >> fix.txt\n    fi\n}\n\n#  commits.txt \nwhile read line || [[ -n ${line} ]]\ndo\n    message=${line}\n    generateDoc ${message}\ndone < commits.txt\n#  commits.txt\n$(rm -rf commits.txt)\n```\n###  ChangeLog\n feat.txt  fix.txt  ChangeLog\n``` shell\n# tag\n# inputType=2  commitId  log\nif [[ ${inputType} = \"2\" ]]\n    then\n    branch=$(git symbolic-ref --short -q HEAD)\n    time=$(git log --pretty=format:\"%ai\" ${tag2} -1)\n    echo \"## $tag2 - $tag1 $branch ($time)\" >>CHANGELOG.md\nelse\n#  tag  log\n    time=$(git log -1 --format=%ai ${tag2})\n    echo  \"## $tag2 ($time)\">>CHANGELOG.md\nfi\n\n# Features\necho \"### Features\" >>CHANGELOG.md\nwhile read line\ndo\n    echo \"* \"${line} >> CHANGELOG.md\ndone < feat.txt\n$(rm -rf feat.txt)\n\n# Fixs\necho \"### Fixs\" >>CHANGELOG.md\nwhile read line\ndo\n\n\n# \nif [[ -f \"./CHANGELOG.md\" ]]\nthen\n    echo CHANGELOG.md is exsit\nelse\n    echo '# ChangeLog' >CHANGELOG.md\nfi\n\n#  ChangeLog ,,\nwhile read text\ndo\n    ((++i))\n    if [[ ${text} =~ \"## $tag2\" ]]\n        then\n        start=$i\n    elif [[ $tag1 != \"\" && ${text} =~ \"## $tag1\" ]]\n        then\n        end=$i\n    fi\ndone < CHANGELOG.md\n\n# ${start} \n# ${end} \n\nif [[ \"\" = \"$end\" ]]\n    then\n    if [[ \"\" != \"$start\" ]]\n        then\n        # ,\n        $(sed -i \"\" \"$start,\\$d\" CHANGELOG.md)\n    fi\nelse\n    ((--end))\n    # \n    if [[ \"$start\" -gt \"$end\" ]]\n        then\n        $(sed -i \"\" \"$start,\\$d\" CHANGELOG.md)\n    else\n    #  \n        $(sed -i \"\" \"$start,${end}d\" CHANGELOG.md)\n    fi\nfi\n\n```\n\n# \n git template git message  CHANGELOG,,. curl  wget ,,.\n\n# \n shell ,,shell ,,. androidx, AS ,, shell.\n Module  ChangeLog , App ,\n* , module , App  ChangeLog\n*  App , git , git  module  ChangeLog, App  ChangeLog \n,,.\n\n# \nhttps://ruby-china.org/topics/15737\n\nhttps://juejin.im/post/5afc5242f265da0b7f44bee4\n\n[git message lint ](https://commitlint.js.org/)\n","source":"_posts/git-commit-message-generate-changelog.md","raw":"title:  Git Messages  ChangeLog\ntags:\n  - Git\n  - Shell\ncategories:\n  - \ndate: 2019-11-18 18:25:00\n---\n# \n, ChangeLog,,,.Module  ChangeLog  App ,..\n<!-- more -->\n# \n,,, Git  Shell . git tag  commit message, messge, message  ChangeLog, Modlue  ChangeLog, ChangeLog , App  ChangeLog. commit message , git hook  commit  message .\n## commit message \n ChangeLog  message,[Angular Commit ](https://github.com/angular/angular/commits/master),.\ncommit message :\n```\ntype: subject\n\nbody\n\nfooter\n```\n### header\nHeader type subject\n\n#### type  commit 3\n* feat feature\n* fix bug\n* other\n\n type  feat  fix commit  Change log \n** type  feat  fix commit  Change log **\n\n#### subject  commit 50\n change changed  changes\n\n\n### body , , \n\n### footer  Breaking Changes  Closed Issues\n\n## Git Commit \nMessage,,\n###  git \n1. gitlinx/mac `.gitconfig`\n```\n$ vi ~/.gitconfig\n```\n2. [commit] template\n```\n[commit]\n        template = /Users/<name>/.myCommitMsg\n```\n3. \n```\n$ vi /Users/<name>/.myCommitMsg\n```\n\n, Header \n\n```\ntype: subject\n\nbody\n\nfooter\n\n# - type: \n#    feat(), \n#    fix(), \n#    other(), \n# - subject\n#   \n# - body:\n#    , , \n# - footer:\n#     Breaking Changes  Closed Issues\n```\n4.  terminal `git commit`\n\n sourcetree  git \n### Sourcetree\n->->,,.,.\n### git cz\n[git cz](https://github.com/commitizen/cz-cli)\n``` \nnpm install -g commitizen cz-conventional-changelog\necho '{ \"path\": \"cz-conventional-changelog\" }' > ~/.czrc\n```\n`git cz``git commit`,,,\n\n![](https://raw.githubusercontent.com/commitizen/cz-cli/master/meta/screenshots/add-commit.png)\n\n,\n``` shell\n  sh git:(master)  git cz\ncz-cli@4.0.3, cz-conventional-changelog@3.0.1\n\n? Select the type of change that you're committing: feat:        A new feature\n? What is the scope of this change (e.g. component or file name): (press enter t\no skip)\n? Write a short, imperative tense description of the change (max 94 chars):\n (4) test\n? Provide a longer description of the change: (press enter to skip)\n\n? Are there any breaking changes? Yes\n? A BREAKING CHANGE commit requires a body. Please enter a longer description of the commit\nitself:\n -\n? Describe the breaking changes:\n\n? Does this change affect any open issues? No\n```\n,.\n### Android Studio Commit Message \n[Commit Message Template](https://plugins.jetbrains.com/plugin/9364-commit-message-template)`Settings > Tools > Commit Message Template `.\n### git cz\n[git cz](https://github.com/commitizen/cz-cli)\n``` \nnpm install -g commitizen cz-conventional-changelog\necho '{ \"path\": \"cz-conventional-changelog\" }' > ~/.czrc\n```\n,.\n### Android Studio Commit Message \n[Commit Message Template](https://plugins.jetbrains.com/plugin/9364-commit-message-template)`Settings > Tools > Commit Message Template `.\n### git cz\n[git cz](https://github.com/commitizen/cz-cli)\n``` \nnpm install -g commitizen cz-conventional-changelog\necho '{ \"path\": \"cz-conventional-changelog\" }' > ~/.czrc\n```\n`git cz``git commit`,,,\n,.\n### Android Studio Commit Message \n[Commit Message Template](https://plugins.jetbrains.com/plugin/9364-commit-message-template)`Settings > Tools > Commit Message Template `.\n,.\n\n##  Module  ChangeLog\n:\n1. git tag tag\n2. tagcommit message\n3.  log, message\n4. changelog.md\n shell ,.\n\n###  tag\n tag, tag\n``` shell\n#  tag\nfunction getAutoTag(){\n# tag\ncurrent_git_tags=$(git tag --sort=taggerdate)\nfor word in ${current_git_tags}\ndo\n    tags[temp]=${word}\n    ((++temp))\ndone\n#  tag\ntag1=${tags[temp-2]}\ntag2=${tags[temp-1]}\n}\n```\n###   tag  commitId  message\n``` shell\n#  commitId  message\nfunction getInputCommitId(){\ntag2=${input2}\ntag1=${input1}\n#  message [)\ngit log --pretty=format:\"%s\" ${tag2}...${tag1} >commits.txt\n# \necho  >>commits.txt\n#  commitId  message\ngit log --pretty=format:\"%s\" ${tag1} -1 >>commits.txt\n}\n\n# tag message\nfunction getTagMessages(){\ngetAutoTag\necho $tag2  $tag1\nif [[ \"\" = ${tag1} ]]\n    then\n#  tag, tag  message, commits.txt\n    git log --pretty=format:\"%s\" ${tag2} >commits.txt\nelse\ngit log --pretty=format:\"%s\" ${tag2}...${tag1} >commits.txt\nfi\n# tagcommit messagecommits.txt\n}\n```\n messagecommits.txt,\n###  message\n message  commits ,, message\n``` shell\n#  commits.txt ,feat.txtfix.txt\nfunction generateDoc(){\n    # $1  ,\n    if [[ \"$1\" =~ ^feat.*:$ ]]\n        then\n        # msg  feat: \n        msg=\"${@:2}\"\n        echo ${msg} >> feat.txt\n    elif [[ \"$1\" =~ ^fix.*:$ ]]\n        then\n        # msg  fix: \n        msg=\"${@:2}\"\n        echo $msg >> fix.txt\n    fi\n}\n\n#  commits.txt \nwhile read line || [[ -n ${line} ]]\ndo\n    message=${line}\n    generateDoc ${message}\ndone < commits.txt\n#  commits.txt\n$(rm -rf commits.txt)\n```\n###  ChangeLog\n feat.txt  fix.txt  ChangeLog\n``` shell\n# tag\n# inputType=2  commitId  log\nif [[ ${inputType} = \"2\" ]]\n    then\n    branch=$(git symbolic-ref --short -q HEAD)\n    time=$(git log --pretty=format:\"%ai\" ${tag2} -1)\n    echo \"## $tag2 - $tag1 $branch ($time)\" >>CHANGELOG.md\nelse\n#  tag  log\n    time=$(git log -1 --format=%ai ${tag2})\n    echo  \"## $tag2 ($time)\">>CHANGELOG.md\nfi\n\n# Features\necho \"### Features\" >>CHANGELOG.md\nwhile read line\ndo\n    echo \"* \"${line} >> CHANGELOG.md\ndone < feat.txt\n$(rm -rf feat.txt)\n\n# Fixs\necho \"### Fixs\" >>CHANGELOG.md\nwhile read line\ndo\n\n\n# \nif [[ -f \"./CHANGELOG.md\" ]]\nthen\n    echo CHANGELOG.md is exsit\nelse\n    echo '# ChangeLog' >CHANGELOG.md\nfi\n\n#  ChangeLog ,,\nwhile read text\ndo\n    ((++i))\n    if [[ ${text} =~ \"## $tag2\" ]]\n        then\n        start=$i\n    elif [[ $tag1 != \"\" && ${text} =~ \"## $tag1\" ]]\n        then\n        end=$i\n    fi\ndone < CHANGELOG.md\n\n# ${start} \n# ${end} \n\nif [[ \"\" = \"$end\" ]]\n    then\n    if [[ \"\" != \"$start\" ]]\n        then\n        # ,\n        $(sed -i \"\" \"$start,\\$d\" CHANGELOG.md)\n    fi\nelse\n    ((--end))\n    # \n    if [[ \"$start\" -gt \"$end\" ]]\n        then\n        $(sed -i \"\" \"$start,\\$d\" CHANGELOG.md)\n    else\n    #  \n        $(sed -i \"\" \"$start,${end}d\" CHANGELOG.md)\n    fi\nfi\n\n```\n\n# \n git template git message  CHANGELOG,,. curl  wget ,,.\n\n# \n shell ,,shell ,,. androidx, AS ,, shell.\n Module  ChangeLog , App ,\n* , module , App  ChangeLog\n*  App , git , git  module  ChangeLog, App  ChangeLog \n,,.\n\n# \nhttps://ruby-china.org/topics/15737\n\nhttps://juejin.im/post/5afc5242f265da0b7f44bee4\n\n[git message lint ](https://commitlint.js.org/)\n","slug":"git-commit-message-generate-changelog","published":1,"updated":"2019-11-27T12:12:23.830Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsaj001jndf2vi8q4ra5","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>, ChangeLog,,,.Module  ChangeLog  App ,..<br><a id=\"more\"></a></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>,,, Git  Shell . git tag  commit message, messge, message  ChangeLog, Modlue  ChangeLog, ChangeLog , App  ChangeLog. commit message , git hook  commit  message .</p>\n<h2 id=\"commit-message-\"><a href=\"#commit-message-\" class=\"headerlink\" title=\"commit message \"></a>commit message </h2><p> ChangeLog  message,<a href=\"https://github.com/angular/angular/commits/master\">Angular Commit </a>,.<br>commit message :<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type: subject</span><br><span class=\"line\"></span><br><span class=\"line\">body</span><br><span class=\"line\"></span><br><span class=\"line\">footer</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"header\"><a href=\"#header\" class=\"headerlink\" title=\"header\"></a>header</h3><p>Header type subject</p>\n<h4 id=\"type--commit-3\"><a href=\"#type--commit-3\" class=\"headerlink\" title=\"type  commit 3\"></a>type  commit 3</h4><ul>\n<li>feat feature</li>\n<li>fix bug</li>\n<li>other</li>\n</ul>\n<p> type  feat  fix commit  Change log <br><strong> type  feat  fix commit  Change log </strong></p>\n<h4 id=\"subject--commit-50\"><a href=\"#subject--commit-50\" class=\"headerlink\" title=\"subject  commit 50\"></a>subject  commit 50</h4><p> change changed  changes<br><br></p>\n<h3 id=\"body---\"><a href=\"#body---\" class=\"headerlink\" title=\"body , , \"></a>body , , </h3><h3 id=\"footer--Breaking-Changes--Closed-Issues\"><a href=\"#footer--Breaking-Changes--Closed-Issues\" class=\"headerlink\" title=\"footer  Breaking Changes  Closed Issues\"></a>footer  Breaking Changes  Closed Issues</h3><h2 id=\"Git-Commit-\"><a href=\"#Git-Commit-\" class=\"headerlink\" title=\"Git Commit \"></a>Git Commit </h2><p>Message,,</p>\n<h3 id=\"-git-\"><a href=\"#-git-\" class=\"headerlink\" title=\" git \"></a> git </h3><ol>\n<li><p>gitlinx/mac <code>.gitconfig</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vi ~/.gitconfig</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>[commit] template</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[commit]</span><br><span class=\"line\">        template = /Users/&lt;name&gt;/.myCommitMsg</span><br></pre></td></tr></table></figure>\n</li>\n<li><p></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vi /Users/&lt;name&gt;/.myCommitMsg</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><br>, Header <br><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type: subject</span><br><span class=\"line\"></span><br><span class=\"line\">body</span><br><span class=\"line\"></span><br><span class=\"line\">footer</span><br><span class=\"line\"></span><br><span class=\"line\"># - type: </span><br><span class=\"line\">#    feat(), </span><br><span class=\"line\">#    fix(), </span><br><span class=\"line\">#    other(), </span><br><span class=\"line\"># - subject</span><br><span class=\"line\">#   </span><br><span class=\"line\"># - body:</span><br><span class=\"line\">#    , , </span><br><span class=\"line\"># - footer:</span><br><span class=\"line\">#     Breaking Changes  Closed Issues</span><br></pre></td></tr></table></figure></p>\n<ol start=\"4\">\n<li> terminal <code>git commit</code></li>\n</ol>\n<p> sourcetree  git </p>\n<h3 id=\"Sourcetree\"><a href=\"#Sourcetree\" class=\"headerlink\" title=\"Sourcetree\"></a>Sourcetree</h3><p>-&gt;-&gt;,,.,.</p>\n<h3 id=\"git-cz\"><a href=\"#git-cz\" class=\"headerlink\" title=\"git cz\"></a>git cz</h3><p><a href=\"https://github.com/commitizen/cz-cli\">git cz</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g commitizen cz-conventional-changelog</span><br><span class=\"line\">echo &apos;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&apos; &gt; ~/.czrc</span><br></pre></td></tr></table></figure></p>\n<p><code>git cz</code><code>git commit</code>,,,</p>\n<p><img src=\"https://raw.githubusercontent.com/commitizen/cz-cli/master/meta/screenshots/add-commit.png\" alt></p>\n<p>,<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  sh git:(master)  git cz</span><br><span class=\"line\">cz-cli@4.0.3, cz-conventional-changelog@3.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">? Select the type of change that you're committing: feat:        A new feature</span><br><span class=\"line\">? What is the scope of this change (e.g. component or file name): (press enter t</span><br><span class=\"line\">o skip)</span><br><span class=\"line\">? Write a short, imperative tense description of the change (max 94 chars):</span><br><span class=\"line\"> (4) test</span><br><span class=\"line\">? Provide a longer description of the change: (press enter to skip)</span><br><span class=\"line\"></span><br><span class=\"line\">? Are there any breaking changes? Yes</span><br><span class=\"line\">? A BREAKING CHANGE commit requires a body. Please enter a longer description of the commit</span><br><span class=\"line\">itself:</span><br><span class=\"line\"> -</span><br><span class=\"line\">? Describe the breaking changes:</span><br><span class=\"line\"></span><br><span class=\"line\">? Does this change affect any open issues? No</span><br></pre></td></tr></table></figure></p>\n<p>,.</p>\n<h3 id=\"Android-Studio-Commit-Message-\"><a href=\"#Android-Studio-Commit-Message-\" class=\"headerlink\" title=\"Android Studio Commit Message \"></a>Android Studio Commit Message </h3><p><a href=\"https://plugins.jetbrains.com/plugin/9364-commit-message-template\" target=\"_blank\" rel=\"noopener\">Commit Message Template</a><code>Settings &gt; Tools &gt; Commit Message Template</code>.</p>\n<h3 id=\"git-cz-1\"><a href=\"#git-cz-1\" class=\"headerlink\" title=\"git cz\"></a>git cz</h3><p><a href=\"https://github.com/commitizen/cz-cli\">git cz</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g commitizen cz-conventional-changelog</span><br><span class=\"line\">echo &apos;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&apos; &gt; ~/.czrc</span><br></pre></td></tr></table></figure></p>\n<p>,.</p>\n<h3 id=\"Android-Studio-Commit-Message--1\"><a href=\"#Android-Studio-Commit-Message--1\" class=\"headerlink\" title=\"Android Studio Commit Message \"></a>Android Studio Commit Message </h3><p><a href=\"https://plugins.jetbrains.com/plugin/9364-commit-message-template\" target=\"_blank\" rel=\"noopener\">Commit Message Template</a><code>Settings &gt; Tools &gt; Commit Message Template</code>.</p>\n<h3 id=\"git-cz-2\"><a href=\"#git-cz-2\" class=\"headerlink\" title=\"git cz\"></a>git cz</h3><p><a href=\"https://github.com/commitizen/cz-cli\">git cz</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g commitizen cz-conventional-changelog</span><br><span class=\"line\">echo &apos;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&apos; &gt; ~/.czrc</span><br></pre></td></tr></table></figure></p>\n<p><code>git cz</code><code>git commit</code>,,,<br>,.</p>\n<h3 id=\"Android-Studio-Commit-Message--2\"><a href=\"#Android-Studio-Commit-Message--2\" class=\"headerlink\" title=\"Android Studio Commit Message \"></a>Android Studio Commit Message </h3><p><a href=\"https://plugins.jetbrains.com/plugin/9364-commit-message-template\" target=\"_blank\" rel=\"noopener\">Commit Message Template</a><code>Settings &gt; Tools &gt; Commit Message Template</code>.<br>,.</p>\n<h2 id=\"-Module--ChangeLog\"><a href=\"#-Module--ChangeLog\" class=\"headerlink\" title=\" Module  ChangeLog\"></a> Module  ChangeLog</h2><p>:</p>\n<ol>\n<li>git tag tag</li>\n<li>tagcommit message</li>\n<li> log, message</li>\n<li>changelog.md<br> shell ,.</li>\n</ol>\n<h3 id=\"-tag\"><a href=\"#-tag\" class=\"headerlink\" title=\" tag\"></a> tag</h3><p> tag, tag<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>  tag</span><br><span class=\"line\">function getAutoTag()&#123;</span><br><span class=\"line\"><span class=\"meta\">#</span> tag</span><br><span class=\"line\">current_git_tags=$(git tag --sort=taggerdate)</span><br><span class=\"line\">for word in $&#123;current_git_tags&#125;</span><br><span class=\"line\">do</span><br><span class=\"line\">    tags[temp]=$&#123;word&#125;</span><br><span class=\"line\">    ((++temp))</span><br><span class=\"line\">done</span><br><span class=\"line\"><span class=\"meta\">#</span>  tag</span><br><span class=\"line\">tag1=$&#123;tags[temp-2]&#125;</span><br><span class=\"line\">tag2=$&#123;tags[temp-1]&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"-tag--commitId--message\"><a href=\"#-tag--commitId--message\" class=\"headerlink\" title=\" tag  commitId  message\"></a> tag  commitId  message</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>  commitId  message</span><br><span class=\"line\">function getInputCommitId()&#123;</span><br><span class=\"line\">tag2=$&#123;input2&#125;</span><br><span class=\"line\">tag1=$&#123;input1&#125;</span><br><span class=\"line\"><span class=\"meta\">#</span>  message [)</span><br><span class=\"line\">git log --pretty=format:\"%s\" $&#123;tag2&#125;...$&#123;tag1&#125; &gt;commits.txt</span><br><span class=\"line\"><span class=\"meta\">#</span> </span><br><span class=\"line\">echo  &gt;&gt;commits.txt</span><br><span class=\"line\"><span class=\"meta\">#</span>  commitId  message</span><br><span class=\"line\">git log --pretty=format:\"%s\" $&#123;tag1&#125; -1 &gt;&gt;commits.txt</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> tag message</span><br><span class=\"line\">function getTagMessages()&#123;</span><br><span class=\"line\">getAutoTag</span><br><span class=\"line\">echo $tag2  $tag1</span><br><span class=\"line\">if [[ \"\" = $&#123;tag1&#125; ]]</span><br><span class=\"line\">    then</span><br><span class=\"line\"><span class=\"meta\">#</span>  tag, tag  message, commits.txt</span><br><span class=\"line\">    git log --pretty=format:\"%s\" $&#123;tag2&#125; &gt;commits.txt</span><br><span class=\"line\">else</span><br><span class=\"line\">git log --pretty=format:\"%s\" $&#123;tag2&#125;...$&#123;tag1&#125; &gt;commits.txt</span><br><span class=\"line\">fi</span><br><span class=\"line\"><span class=\"meta\">#</span> tagcommit messagecommits.txt</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> messagecommits.txt,</p>\n<h3 id=\"-message\"><a href=\"#-message\" class=\"headerlink\" title=\" message\"></a> message</h3><p> message  commits ,, message<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>  commits.txt ,feat.txtfix.txt</span><br><span class=\"line\">function generateDoc()&#123;</span><br><span class=\"line\">    # $1  ,</span><br><span class=\"line\">    if [[ \"$1\" =~ ^feat.*:$ ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        # msg  feat: </span><br><span class=\"line\">        msg=\"$&#123;@:2&#125;\"</span><br><span class=\"line\">        echo $&#123;msg&#125; &gt;&gt; feat.txt</span><br><span class=\"line\">    elif [[ \"$1\" =~ ^fix.*:$ ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        # msg  fix: </span><br><span class=\"line\">        msg=\"$&#123;@:2&#125;\"</span><br><span class=\"line\">        echo $msg &gt;&gt; fix.txt</span><br><span class=\"line\">    fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span>  commits.txt </span><br><span class=\"line\">while read line || [[ -n $&#123;line&#125; ]]</span><br><span class=\"line\">do</span><br><span class=\"line\">    message=$&#123;line&#125;</span><br><span class=\"line\">    generateDoc $&#123;message&#125;</span><br><span class=\"line\">done &lt; commits.txt</span><br><span class=\"line\"><span class=\"meta\">#</span>  commits.txt</span><br><span class=\"line\"><span class=\"meta\">$</span>(rm -rf commits.txt)</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"-ChangeLog\"><a href=\"#-ChangeLog\" class=\"headerlink\" title=\" ChangeLog\"></a> ChangeLog</h3><p> feat.txt  fix.txt  ChangeLog<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span> tag</span><br><span class=\"line\"><span class=\"meta\">#</span> inputType=2  commitId  log</span><br><span class=\"line\">if [[ $&#123;inputType&#125; = \"2\" ]]</span><br><span class=\"line\">    then</span><br><span class=\"line\">    branch=$(git symbolic-ref --short -q HEAD)</span><br><span class=\"line\">    time=$(git log --pretty=format:\"%ai\" $&#123;tag2&#125; -1)</span><br><span class=\"line\">    echo \"## $tag2 - $tag1 $branch ($time)\" &gt;&gt;CHANGELOG.md</span><br><span class=\"line\">else</span><br><span class=\"line\"><span class=\"meta\">#</span>  tag  log</span><br><span class=\"line\">    time=$(git log -1 --format=%ai $&#123;tag2&#125;)</span><br><span class=\"line\">    echo  \"## $tag2 ($time)\"&gt;&gt;CHANGELOG.md</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> Features</span><br><span class=\"line\">echo \"### Features\" &gt;&gt;CHANGELOG.md</span><br><span class=\"line\">while read line</span><br><span class=\"line\">do</span><br><span class=\"line\">    echo \"* \"$&#123;line&#125; &gt;&gt; CHANGELOG.md</span><br><span class=\"line\">done &lt; feat.txt</span><br><span class=\"line\"><span class=\"meta\">$</span>(rm -rf feat.txt)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> Fixs</span><br><span class=\"line\">echo \"### Fixs\" &gt;&gt;CHANGELOG.md</span><br><span class=\"line\">while read line</span><br><span class=\"line\">do</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> </span><br><span class=\"line\">if [[ -f \"./CHANGELOG.md\" ]]</span><br><span class=\"line\">then</span><br><span class=\"line\">    echo CHANGELOG.md is exsit</span><br><span class=\"line\">else</span><br><span class=\"line\">    echo '# ChangeLog' &gt;CHANGELOG.md</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span>  ChangeLog ,,</span><br><span class=\"line\">while read text</span><br><span class=\"line\">do</span><br><span class=\"line\">    ((++i))</span><br><span class=\"line\">    if [[ $&#123;text&#125; =~ \"## $tag2\" ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        start=$i</span><br><span class=\"line\">    elif [[ $tag1 != \"\" &amp;&amp; $&#123;text&#125; =~ \"## $tag1\" ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        end=$i</span><br><span class=\"line\">    fi</span><br><span class=\"line\">done &lt; CHANGELOG.md</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> $&#123;start&#125; </span><br><span class=\"line\"><span class=\"meta\">#</span> $&#123;end&#125; </span><br><span class=\"line\"></span><br><span class=\"line\">if [[ \"\" = \"$end\" ]]</span><br><span class=\"line\">    then</span><br><span class=\"line\">    if [[ \"\" != \"$start\" ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        # ,</span><br><span class=\"line\">        $(sed -i \"\" \"$start,\\$d\" CHANGELOG.md)</span><br><span class=\"line\">    fi</span><br><span class=\"line\">else</span><br><span class=\"line\">    ((--end))</span><br><span class=\"line\">    # </span><br><span class=\"line\">    if [[ \"$start\" -gt \"$end\" ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        $(sed -i \"\" \"$start,\\$d\" CHANGELOG.md)</span><br><span class=\"line\">    else</span><br><span class=\"line\">    #  </span><br><span class=\"line\">        $(sed -i \"\" \"$start,$&#123;end&#125;d\" CHANGELOG.md)</span><br><span class=\"line\">    fi</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> git template git message  CHANGELOG,,. curl  wget ,,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> shell ,,shell ,,. androidx, AS ,, shell.<br> Module  ChangeLog , App ,</p>\n<ul>\n<li>, module , App  ChangeLog</li>\n<li> App , git , git  module  ChangeLog, App  ChangeLog<br>,,.</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://ruby-china.org/topics/15737\" target=\"_blank\" rel=\"noopener\">https://ruby-china.org/topics/15737</a></p>\n<p><a href=\"https://juejin.im/post/5afc5242f265da0b7f44bee4\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5afc5242f265da0b7f44bee4</a></p>\n<p><a href=\"https://commitlint.js.org/\" target=\"_blank\" rel=\"noopener\">git message lint </a></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>, ChangeLog,,,.Module  ChangeLog  App ,..<br>","more":"</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>,,, Git  Shell . git tag  commit message, messge, message  ChangeLog, Modlue  ChangeLog, ChangeLog , App  ChangeLog. commit message , git hook  commit  message .</p>\n<h2 id=\"commit-message-\"><a href=\"#commit-message-\" class=\"headerlink\" title=\"commit message \"></a>commit message </h2><p> ChangeLog  message,<a href=\"https://github.com/angular/angular/commits/master\">Angular Commit </a>,.<br>commit message :<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type: subject</span><br><span class=\"line\"></span><br><span class=\"line\">body</span><br><span class=\"line\"></span><br><span class=\"line\">footer</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"header\"><a href=\"#header\" class=\"headerlink\" title=\"header\"></a>header</h3><p>Header type subject</p>\n<h4 id=\"type--commit-3\"><a href=\"#type--commit-3\" class=\"headerlink\" title=\"type  commit 3\"></a>type  commit 3</h4><ul>\n<li>feat feature</li>\n<li>fix bug</li>\n<li>other</li>\n</ul>\n<p> type  feat  fix commit  Change log <br><strong> type  feat  fix commit  Change log </strong></p>\n<h4 id=\"subject--commit-50\"><a href=\"#subject--commit-50\" class=\"headerlink\" title=\"subject  commit 50\"></a>subject  commit 50</h4><p> change changed  changes<br><br></p>\n<h3 id=\"body---\"><a href=\"#body---\" class=\"headerlink\" title=\"body , , \"></a>body , , </h3><h3 id=\"footer--Breaking-Changes--Closed-Issues\"><a href=\"#footer--Breaking-Changes--Closed-Issues\" class=\"headerlink\" title=\"footer  Breaking Changes  Closed Issues\"></a>footer  Breaking Changes  Closed Issues</h3><h2 id=\"Git-Commit-\"><a href=\"#Git-Commit-\" class=\"headerlink\" title=\"Git Commit \"></a>Git Commit </h2><p>Message,,</p>\n<h3 id=\"-git-\"><a href=\"#-git-\" class=\"headerlink\" title=\" git \"></a> git </h3><ol>\n<li><p>gitlinx/mac <code>.gitconfig</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vi ~/.gitconfig</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>[commit] template</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[commit]</span><br><span class=\"line\">        template = /Users/&lt;name&gt;/.myCommitMsg</span><br></pre></td></tr></table></figure>\n</li>\n<li><p></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vi /Users/&lt;name&gt;/.myCommitMsg</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><br>, Header <br><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type: subject</span><br><span class=\"line\"></span><br><span class=\"line\">body</span><br><span class=\"line\"></span><br><span class=\"line\">footer</span><br><span class=\"line\"></span><br><span class=\"line\"># - type: </span><br><span class=\"line\">#    feat(), </span><br><span class=\"line\">#    fix(), </span><br><span class=\"line\">#    other(), </span><br><span class=\"line\"># - subject</span><br><span class=\"line\">#   </span><br><span class=\"line\"># - body:</span><br><span class=\"line\">#    , , </span><br><span class=\"line\"># - footer:</span><br><span class=\"line\">#     Breaking Changes  Closed Issues</span><br></pre></td></tr></table></figure></p>\n<ol start=\"4\">\n<li> terminal <code>git commit</code></li>\n</ol>\n<p> sourcetree  git </p>\n<h3 id=\"Sourcetree\"><a href=\"#Sourcetree\" class=\"headerlink\" title=\"Sourcetree\"></a>Sourcetree</h3><p>-&gt;-&gt;,,.,.</p>\n<h3 id=\"git-cz\"><a href=\"#git-cz\" class=\"headerlink\" title=\"git cz\"></a>git cz</h3><p><a href=\"https://github.com/commitizen/cz-cli\">git cz</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g commitizen cz-conventional-changelog</span><br><span class=\"line\">echo &apos;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&apos; &gt; ~/.czrc</span><br></pre></td></tr></table></figure></p>\n<p><code>git cz</code><code>git commit</code>,,,</p>\n<p><img src=\"https://raw.githubusercontent.com/commitizen/cz-cli/master/meta/screenshots/add-commit.png\" alt></p>\n<p>,<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  sh git:(master)  git cz</span><br><span class=\"line\">cz-cli@4.0.3, cz-conventional-changelog@3.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">? Select the type of change that you're committing: feat:        A new feature</span><br><span class=\"line\">? What is the scope of this change (e.g. component or file name): (press enter t</span><br><span class=\"line\">o skip)</span><br><span class=\"line\">? Write a short, imperative tense description of the change (max 94 chars):</span><br><span class=\"line\"> (4) test</span><br><span class=\"line\">? Provide a longer description of the change: (press enter to skip)</span><br><span class=\"line\"></span><br><span class=\"line\">? Are there any breaking changes? Yes</span><br><span class=\"line\">? A BREAKING CHANGE commit requires a body. Please enter a longer description of the commit</span><br><span class=\"line\">itself:</span><br><span class=\"line\"> -</span><br><span class=\"line\">? Describe the breaking changes:</span><br><span class=\"line\"></span><br><span class=\"line\">? Does this change affect any open issues? No</span><br></pre></td></tr></table></figure></p>\n<p>,.</p>\n<h3 id=\"Android-Studio-Commit-Message-\"><a href=\"#Android-Studio-Commit-Message-\" class=\"headerlink\" title=\"Android Studio Commit Message \"></a>Android Studio Commit Message </h3><p><a href=\"https://plugins.jetbrains.com/plugin/9364-commit-message-template\" target=\"_blank\" rel=\"noopener\">Commit Message Template</a><code>Settings &gt; Tools &gt; Commit Message Template</code>.</p>\n<h3 id=\"git-cz-1\"><a href=\"#git-cz-1\" class=\"headerlink\" title=\"git cz\"></a>git cz</h3><p><a href=\"https://github.com/commitizen/cz-cli\">git cz</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g commitizen cz-conventional-changelog</span><br><span class=\"line\">echo &apos;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&apos; &gt; ~/.czrc</span><br></pre></td></tr></table></figure></p>\n<p>,.</p>\n<h3 id=\"Android-Studio-Commit-Message--1\"><a href=\"#Android-Studio-Commit-Message--1\" class=\"headerlink\" title=\"Android Studio Commit Message \"></a>Android Studio Commit Message </h3><p><a href=\"https://plugins.jetbrains.com/plugin/9364-commit-message-template\" target=\"_blank\" rel=\"noopener\">Commit Message Template</a><code>Settings &gt; Tools &gt; Commit Message Template</code>.</p>\n<h3 id=\"git-cz-2\"><a href=\"#git-cz-2\" class=\"headerlink\" title=\"git cz\"></a>git cz</h3><p><a href=\"https://github.com/commitizen/cz-cli\">git cz</a><br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g commitizen cz-conventional-changelog</span><br><span class=\"line\">echo &apos;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&apos; &gt; ~/.czrc</span><br></pre></td></tr></table></figure></p>\n<p><code>git cz</code><code>git commit</code>,,,<br>,.</p>\n<h3 id=\"Android-Studio-Commit-Message--2\"><a href=\"#Android-Studio-Commit-Message--2\" class=\"headerlink\" title=\"Android Studio Commit Message \"></a>Android Studio Commit Message </h3><p><a href=\"https://plugins.jetbrains.com/plugin/9364-commit-message-template\" target=\"_blank\" rel=\"noopener\">Commit Message Template</a><code>Settings &gt; Tools &gt; Commit Message Template</code>.<br>,.</p>\n<h2 id=\"-Module--ChangeLog\"><a href=\"#-Module--ChangeLog\" class=\"headerlink\" title=\" Module  ChangeLog\"></a> Module  ChangeLog</h2><p>:</p>\n<ol>\n<li>git tag tag</li>\n<li>tagcommit message</li>\n<li> log, message</li>\n<li>changelog.md<br> shell ,.</li>\n</ol>\n<h3 id=\"-tag\"><a href=\"#-tag\" class=\"headerlink\" title=\" tag\"></a> tag</h3><p> tag, tag<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>  tag</span><br><span class=\"line\">function getAutoTag()&#123;</span><br><span class=\"line\"><span class=\"meta\">#</span> tag</span><br><span class=\"line\">current_git_tags=$(git tag --sort=taggerdate)</span><br><span class=\"line\">for word in $&#123;current_git_tags&#125;</span><br><span class=\"line\">do</span><br><span class=\"line\">    tags[temp]=$&#123;word&#125;</span><br><span class=\"line\">    ((++temp))</span><br><span class=\"line\">done</span><br><span class=\"line\"><span class=\"meta\">#</span>  tag</span><br><span class=\"line\">tag1=$&#123;tags[temp-2]&#125;</span><br><span class=\"line\">tag2=$&#123;tags[temp-1]&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"-tag--commitId--message\"><a href=\"#-tag--commitId--message\" class=\"headerlink\" title=\" tag  commitId  message\"></a> tag  commitId  message</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>  commitId  message</span><br><span class=\"line\">function getInputCommitId()&#123;</span><br><span class=\"line\">tag2=$&#123;input2&#125;</span><br><span class=\"line\">tag1=$&#123;input1&#125;</span><br><span class=\"line\"><span class=\"meta\">#</span>  message [)</span><br><span class=\"line\">git log --pretty=format:\"%s\" $&#123;tag2&#125;...$&#123;tag1&#125; &gt;commits.txt</span><br><span class=\"line\"><span class=\"meta\">#</span> </span><br><span class=\"line\">echo  &gt;&gt;commits.txt</span><br><span class=\"line\"><span class=\"meta\">#</span>  commitId  message</span><br><span class=\"line\">git log --pretty=format:\"%s\" $&#123;tag1&#125; -1 &gt;&gt;commits.txt</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> tag message</span><br><span class=\"line\">function getTagMessages()&#123;</span><br><span class=\"line\">getAutoTag</span><br><span class=\"line\">echo $tag2  $tag1</span><br><span class=\"line\">if [[ \"\" = $&#123;tag1&#125; ]]</span><br><span class=\"line\">    then</span><br><span class=\"line\"><span class=\"meta\">#</span>  tag, tag  message, commits.txt</span><br><span class=\"line\">    git log --pretty=format:\"%s\" $&#123;tag2&#125; &gt;commits.txt</span><br><span class=\"line\">else</span><br><span class=\"line\">git log --pretty=format:\"%s\" $&#123;tag2&#125;...$&#123;tag1&#125; &gt;commits.txt</span><br><span class=\"line\">fi</span><br><span class=\"line\"><span class=\"meta\">#</span> tagcommit messagecommits.txt</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> messagecommits.txt,</p>\n<h3 id=\"-message\"><a href=\"#-message\" class=\"headerlink\" title=\" message\"></a> message</h3><p> message  commits ,, message<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span>  commits.txt ,feat.txtfix.txt</span><br><span class=\"line\">function generateDoc()&#123;</span><br><span class=\"line\">    # $1  ,</span><br><span class=\"line\">    if [[ \"$1\" =~ ^feat.*:$ ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        # msg  feat: </span><br><span class=\"line\">        msg=\"$&#123;@:2&#125;\"</span><br><span class=\"line\">        echo $&#123;msg&#125; &gt;&gt; feat.txt</span><br><span class=\"line\">    elif [[ \"$1\" =~ ^fix.*:$ ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        # msg  fix: </span><br><span class=\"line\">        msg=\"$&#123;@:2&#125;\"</span><br><span class=\"line\">        echo $msg &gt;&gt; fix.txt</span><br><span class=\"line\">    fi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span>  commits.txt </span><br><span class=\"line\">while read line || [[ -n $&#123;line&#125; ]]</span><br><span class=\"line\">do</span><br><span class=\"line\">    message=$&#123;line&#125;</span><br><span class=\"line\">    generateDoc $&#123;message&#125;</span><br><span class=\"line\">done &lt; commits.txt</span><br><span class=\"line\"><span class=\"meta\">#</span>  commits.txt</span><br><span class=\"line\"><span class=\"meta\">$</span>(rm -rf commits.txt)</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"-ChangeLog\"><a href=\"#-ChangeLog\" class=\"headerlink\" title=\" ChangeLog\"></a> ChangeLog</h3><p> feat.txt  fix.txt  ChangeLog<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span> tag</span><br><span class=\"line\"><span class=\"meta\">#</span> inputType=2  commitId  log</span><br><span class=\"line\">if [[ $&#123;inputType&#125; = \"2\" ]]</span><br><span class=\"line\">    then</span><br><span class=\"line\">    branch=$(git symbolic-ref --short -q HEAD)</span><br><span class=\"line\">    time=$(git log --pretty=format:\"%ai\" $&#123;tag2&#125; -1)</span><br><span class=\"line\">    echo \"## $tag2 - $tag1 $branch ($time)\" &gt;&gt;CHANGELOG.md</span><br><span class=\"line\">else</span><br><span class=\"line\"><span class=\"meta\">#</span>  tag  log</span><br><span class=\"line\">    time=$(git log -1 --format=%ai $&#123;tag2&#125;)</span><br><span class=\"line\">    echo  \"## $tag2 ($time)\"&gt;&gt;CHANGELOG.md</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> Features</span><br><span class=\"line\">echo \"### Features\" &gt;&gt;CHANGELOG.md</span><br><span class=\"line\">while read line</span><br><span class=\"line\">do</span><br><span class=\"line\">    echo \"* \"$&#123;line&#125; &gt;&gt; CHANGELOG.md</span><br><span class=\"line\">done &lt; feat.txt</span><br><span class=\"line\"><span class=\"meta\">$</span>(rm -rf feat.txt)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> Fixs</span><br><span class=\"line\">echo \"### Fixs\" &gt;&gt;CHANGELOG.md</span><br><span class=\"line\">while read line</span><br><span class=\"line\">do</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> </span><br><span class=\"line\">if [[ -f \"./CHANGELOG.md\" ]]</span><br><span class=\"line\">then</span><br><span class=\"line\">    echo CHANGELOG.md is exsit</span><br><span class=\"line\">else</span><br><span class=\"line\">    echo '# ChangeLog' &gt;CHANGELOG.md</span><br><span class=\"line\">fi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span>  ChangeLog ,,</span><br><span class=\"line\">while read text</span><br><span class=\"line\">do</span><br><span class=\"line\">    ((++i))</span><br><span class=\"line\">    if [[ $&#123;text&#125; =~ \"## $tag2\" ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        start=$i</span><br><span class=\"line\">    elif [[ $tag1 != \"\" &amp;&amp; $&#123;text&#125; =~ \"## $tag1\" ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        end=$i</span><br><span class=\"line\">    fi</span><br><span class=\"line\">done &lt; CHANGELOG.md</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span> $&#123;start&#125; </span><br><span class=\"line\"><span class=\"meta\">#</span> $&#123;end&#125; </span><br><span class=\"line\"></span><br><span class=\"line\">if [[ \"\" = \"$end\" ]]</span><br><span class=\"line\">    then</span><br><span class=\"line\">    if [[ \"\" != \"$start\" ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        # ,</span><br><span class=\"line\">        $(sed -i \"\" \"$start,\\$d\" CHANGELOG.md)</span><br><span class=\"line\">    fi</span><br><span class=\"line\">else</span><br><span class=\"line\">    ((--end))</span><br><span class=\"line\">    # </span><br><span class=\"line\">    if [[ \"$start\" -gt \"$end\" ]]</span><br><span class=\"line\">        then</span><br><span class=\"line\">        $(sed -i \"\" \"$start,\\$d\" CHANGELOG.md)</span><br><span class=\"line\">    else</span><br><span class=\"line\">    #  </span><br><span class=\"line\">        $(sed -i \"\" \"$start,$&#123;end&#125;d\" CHANGELOG.md)</span><br><span class=\"line\">    fi</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> git template git message  CHANGELOG,,. curl  wget ,,.</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> shell ,,shell ,,. androidx, AS ,, shell.<br> Module  ChangeLog , App ,</p>\n<ul>\n<li>, module , App  ChangeLog</li>\n<li> App , git , git  module  ChangeLog, App  ChangeLog<br>,,.</li>\n</ul>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://ruby-china.org/topics/15737\" target=\"_blank\" rel=\"noopener\">https://ruby-china.org/topics/15737</a></p>\n<p><a href=\"https://juejin.im/post/5afc5242f265da0b7f44bee4\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5afc5242f265da0b7f44bee4</a></p>\n<p><a href=\"https://commitlint.js.org/\" target=\"_blank\" rel=\"noopener\">git message lint </a></p>"},{"title":"Fultter ( Api )","date":"2018-08-26T12:03:23.000Z","_content":"\n#### Flutter\n\nFlutter  Google UI iOSAndroid  Fuchsia , Flutter ,, CordovaReactNativeWeex ,Flutter.Flutter  Dart , iOSAndroid  UI ,,. Google  Dart  Sky , Demo ,, Sky  Flutter .\n\n<!-- more -->\n\nDart  Java , Demo  Api ,,.Dart  ReactNative  State .,Material Design ,,.Dart  Hot Reload ,,,,,,,,.\n\n#### Flutter \n\nFlutter ,,Android Studio , Flutter  Dart .\n api,top250 App![Flutter ](http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_yaml.png), flutter_toast  Flutter package  Toast, iOS,iOS.Dio , header intercept .cached_network_image ,.\n![](http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_dir.png),main.dart.\n``` dart\n//\nimport 'package:dou_ban_movie/douban/douban_hot_movies.dart';\nimport 'package:dou_ban_movie/douban/douban_top_movies.dart';\nimport 'package:flutter/material.dart';\n\n//\nvoid main() => runApp(new MyApp());\n\nclass MyApp extends StatelessWidget {\n  @override\n  Widget build(BuildContext context) {\n      // Material , Material Design  app\n    return new MaterialApp(\n      title: 'Welcome to Flutter',\n      //Android style.xml\n      theme: new ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: new MyHomePage(),\n    );\n  }\n}\n\nclass MyHomePage extends StatefulWidget {\n  @override\n  _MyHomePageState createState() => new _MyHomePageState();\n}\n\nclass _MyHomePageState extends State<MyHomePage> {\n  int mCurrentIndex = 0;\n\n  @override\n  Widget build(BuildContext context) {\n    return new Scaffold(\n      appBar: AppBar(\n        title: Text(\"Douban Movies\"),\n      ),\n      bottomNavigationBar: new BottomNavigationBar(\n        items: [\n          new BottomNavigationBarItem(\n              icon: new Icon(Icons.all_inclusive), title: new Text('HOT')),\n          new BottomNavigationBarItem(\n              icon: new Icon(Icons.favorite), title: new Text('TOP'))\n        ],\n        currentIndex: mCurrentIndex,\n        onTap: (index) {\n            //tab\n          setState(() {\n            mCurrentIndex = index;\n          });\n        },\n      ),\n      body: _setupCurrentPage(mCurrentIndex),\n    );\n  }\n\n  Widget _setupCurrentPage(int mCurrentIndex) {\n    switch (mCurrentIndex) {\n      case 0:\n        return new HotMoviesPage();\n      case 1:\n        return new TopMoviesPage();\n      default:\n        return new HotMoviesPage();\n    }\n  }\n}\n\n```\n Dart , Android ,,...\n\n#### \n\nFlutter, Google ,,,,,.,, mvp ,,,,. Flutter  module ,.ReactNative,,,.\n\n#### \n![](http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225527.jpg)\n![](http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225535.jpg)\n![](http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225548.jpg)\n\n\n#### \n[Github ](https://github.com/Thewhitelight/DouBanMovie)\n#### \n[Flutter ](https://flutter-io.cn/)\n[Flutter ](https://flutterchina.club/)\n[Flutter ](https://mp.weixin.qq.com/s/cJjKZCqc8UuzvEtxK1BJCw)","source":"_posts/flutter-douban.md","raw":"---\ntitle: Fultter ( Api )\ndate: 2018-08-26 20:03:23\ntags:\n    - Flutter\ncategories: \n---\n\n#### Flutter\n\nFlutter  Google UI iOSAndroid  Fuchsia , Flutter ,, CordovaReactNativeWeex ,Flutter.Flutter  Dart , iOSAndroid  UI ,,. Google  Dart  Sky , Demo ,, Sky  Flutter .\n\n<!-- more -->\n\nDart  Java , Demo  Api ,,.Dart  ReactNative  State .,Material Design ,,.Dart  Hot Reload ,,,,,,,,.\n\n#### Flutter \n\nFlutter ,,Android Studio , Flutter  Dart .\n api,top250 App![Flutter ](http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_yaml.png), flutter_toast  Flutter package  Toast, iOS,iOS.Dio , header intercept .cached_network_image ,.\n![](http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_dir.png),main.dart.\n``` dart\n//\nimport 'package:dou_ban_movie/douban/douban_hot_movies.dart';\nimport 'package:dou_ban_movie/douban/douban_top_movies.dart';\nimport 'package:flutter/material.dart';\n\n//\nvoid main() => runApp(new MyApp());\n\nclass MyApp extends StatelessWidget {\n  @override\n  Widget build(BuildContext context) {\n      // Material , Material Design  app\n    return new MaterialApp(\n      title: 'Welcome to Flutter',\n      //Android style.xml\n      theme: new ThemeData(\n        primarySwatch: Colors.blue,\n      ),\n      home: new MyHomePage(),\n    );\n  }\n}\n\nclass MyHomePage extends StatefulWidget {\n  @override\n  _MyHomePageState createState() => new _MyHomePageState();\n}\n\nclass _MyHomePageState extends State<MyHomePage> {\n  int mCurrentIndex = 0;\n\n  @override\n  Widget build(BuildContext context) {\n    return new Scaffold(\n      appBar: AppBar(\n        title: Text(\"Douban Movies\"),\n      ),\n      bottomNavigationBar: new BottomNavigationBar(\n        items: [\n          new BottomNavigationBarItem(\n              icon: new Icon(Icons.all_inclusive), title: new Text('HOT')),\n          new BottomNavigationBarItem(\n              icon: new Icon(Icons.favorite), title: new Text('TOP'))\n        ],\n        currentIndex: mCurrentIndex,\n        onTap: (index) {\n            //tab\n          setState(() {\n            mCurrentIndex = index;\n          });\n        },\n      ),\n      body: _setupCurrentPage(mCurrentIndex),\n    );\n  }\n\n  Widget _setupCurrentPage(int mCurrentIndex) {\n    switch (mCurrentIndex) {\n      case 0:\n        return new HotMoviesPage();\n      case 1:\n        return new TopMoviesPage();\n      default:\n        return new HotMoviesPage();\n    }\n  }\n}\n\n```\n Dart , Android ,,...\n\n#### \n\nFlutter, Google ,,,,,.,, mvp ,,,,. Flutter  module ,.ReactNative,,,.\n\n#### \n![](http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225527.jpg)\n![](http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225535.jpg)\n![](http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225548.jpg)\n\n\n#### \n[Github ](https://github.com/Thewhitelight/DouBanMovie)\n#### \n[Flutter ](https://flutter-io.cn/)\n[Flutter ](https://flutterchina.club/)\n[Flutter ](https://mp.weixin.qq.com/s/cJjKZCqc8UuzvEtxK1BJCw)","slug":"flutter-douban","published":1,"updated":"2019-11-24T11:46:47.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsal001mndf23xg65emp","content":"<h4 id=\"Flutter\"><a href=\"#Flutter\" class=\"headerlink\" title=\"Flutter\"></a>Flutter</h4><p>Flutter  Google UI iOSAndroid  Fuchsia , Flutter ,, CordovaReactNativeWeex ,Flutter.Flutter  Dart , iOSAndroid  UI ,,. Google  Dart  Sky , Demo ,, Sky  Flutter .</p>\n<a id=\"more\"></a>\n<p>Dart  Java , Demo  Api ,,.Dart  ReactNative  State .,Material Design ,,.Dart  Hot Reload ,,,,,,,,.</p>\n<h4 id=\"Flutter-\"><a href=\"#Flutter-\" class=\"headerlink\" title=\"Flutter \"></a>Flutter </h4><p>Flutter ,,Android Studio , Flutter  Dart .<br> api,top250 App<img src=\"http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_yaml.png\" alt=\"Flutter \">, flutter_toast  Flutter package  Toast, iOS,iOS.Dio , header intercept .cached_network_image ,.<br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_dir.png\" alt=\"\">,main.dart.<br><figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:dou_ban_movie/douban/douban_hot_movies.dart'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:dou_ban_movie/douban/douban_top_movies.dart'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter/material.dart'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(<span class=\"keyword\">new</span> MyApp());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Material , Material Design  app</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> MaterialApp(</span><br><span class=\"line\">      title: <span class=\"string\">'Welcome to Flutter'</span>,</span><br><span class=\"line\">      <span class=\"comment\">//Android style.xml</span></span><br><span class=\"line\">      theme: <span class=\"keyword\">new</span> ThemeData(</span><br><span class=\"line\">        primarySwatch: Colors.blue,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      home: <span class=\"keyword\">new</span> MyHomePage(),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyHomePage</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  _MyHomePageState createState() =&gt; <span class=\"keyword\">new</span> _MyHomePageState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_MyHomePageState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">MyHomePage</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">int</span> mCurrentIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(<span class=\"string\">\"Douban Movies\"</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      bottomNavigationBar: <span class=\"keyword\">new</span> BottomNavigationBar(</span><br><span class=\"line\">        items: [</span><br><span class=\"line\">          <span class=\"keyword\">new</span> BottomNavigationBarItem(</span><br><span class=\"line\">              icon: <span class=\"keyword\">new</span> Icon(Icons.all_inclusive), title: <span class=\"keyword\">new</span> Text(<span class=\"string\">'HOT'</span>)),</span><br><span class=\"line\">          <span class=\"keyword\">new</span> BottomNavigationBarItem(</span><br><span class=\"line\">              icon: <span class=\"keyword\">new</span> Icon(Icons.favorite), title: <span class=\"keyword\">new</span> Text(<span class=\"string\">'TOP'</span>))</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        currentIndex: mCurrentIndex,</span><br><span class=\"line\">        onTap: (index) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//tab</span></span><br><span class=\"line\">          setState(() &#123;</span><br><span class=\"line\">            mCurrentIndex = index;</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: _setupCurrentPage(mCurrentIndex),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  Widget _setupCurrentPage(<span class=\"built_in\">int</span> mCurrentIndex) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (mCurrentIndex) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> HotMoviesPage();</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> TopMoviesPage();</span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> HotMoviesPage();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> Dart , Android ,,...</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Flutter, Google ,,,,,.,, mvp ,,,,. Flutter  module ,.ReactNative,,,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225527.jpg\" alt=\"\"><br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225535.jpg\" alt=\"\"><br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225548.jpg\" alt=\"\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://github.com/Thewhitelight/DouBanMovie\">Github </a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://flutter-io.cn/\" target=\"_blank\" rel=\"noopener\">Flutter </a><br><a href=\"https://flutterchina.club/\" target=\"_blank\" rel=\"noopener\">Flutter </a><br><a href=\"https://mp.weixin.qq.com/s/cJjKZCqc8UuzvEtxK1BJCw\" target=\"_blank\" rel=\"noopener\">Flutter </a></p>\n","site":{"data":{}},"excerpt":"<h4 id=\"Flutter\"><a href=\"#Flutter\" class=\"headerlink\" title=\"Flutter\"></a>Flutter</h4><p>Flutter  Google UI iOSAndroid  Fuchsia , Flutter ,, CordovaReactNativeWeex ,Flutter.Flutter  Dart , iOSAndroid  UI ,,. Google  Dart  Sky , Demo ,, Sky  Flutter .</p>","more":"<p>Dart  Java , Demo  Api ,,.Dart  ReactNative  State .,Material Design ,,.Dart  Hot Reload ,,,,,,,,.</p>\n<h4 id=\"Flutter-\"><a href=\"#Flutter-\" class=\"headerlink\" title=\"Flutter \"></a>Flutter </h4><p>Flutter ,,Android Studio , Flutter  Dart .<br> api,top250 App<img src=\"http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_yaml.png\" alt=\"Flutter \">, flutter_toast  Flutter package  Toast, iOS,iOS.Dio , header intercept .cached_network_image ,.<br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_dir.png\" alt=\"\">,main.dart.<br><figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:dou_ban_movie/douban/douban_hot_movies.dart'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:dou_ban_movie/douban/douban_top_movies.dart'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter/material.dart'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(<span class=\"keyword\">new</span> MyApp());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Material , Material Design  app</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> MaterialApp(</span><br><span class=\"line\">      title: <span class=\"string\">'Welcome to Flutter'</span>,</span><br><span class=\"line\">      <span class=\"comment\">//Android style.xml</span></span><br><span class=\"line\">      theme: <span class=\"keyword\">new</span> ThemeData(</span><br><span class=\"line\">        primarySwatch: Colors.blue,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      home: <span class=\"keyword\">new</span> MyHomePage(),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyHomePage</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  _MyHomePageState createState() =&gt; <span class=\"keyword\">new</span> _MyHomePageState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_MyHomePageState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">MyHomePage</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">int</span> mCurrentIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(<span class=\"string\">\"Douban Movies\"</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      bottomNavigationBar: <span class=\"keyword\">new</span> BottomNavigationBar(</span><br><span class=\"line\">        items: [</span><br><span class=\"line\">          <span class=\"keyword\">new</span> BottomNavigationBarItem(</span><br><span class=\"line\">              icon: <span class=\"keyword\">new</span> Icon(Icons.all_inclusive), title: <span class=\"keyword\">new</span> Text(<span class=\"string\">'HOT'</span>)),</span><br><span class=\"line\">          <span class=\"keyword\">new</span> BottomNavigationBarItem(</span><br><span class=\"line\">              icon: <span class=\"keyword\">new</span> Icon(Icons.favorite), title: <span class=\"keyword\">new</span> Text(<span class=\"string\">'TOP'</span>))</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        currentIndex: mCurrentIndex,</span><br><span class=\"line\">        onTap: (index) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//tab</span></span><br><span class=\"line\">          setState(() &#123;</span><br><span class=\"line\">            mCurrentIndex = index;</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: _setupCurrentPage(mCurrentIndex),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  Widget _setupCurrentPage(<span class=\"built_in\">int</span> mCurrentIndex) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (mCurrentIndex) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> HotMoviesPage();</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> TopMoviesPage();</span><br><span class=\"line\">      <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> HotMoviesPage();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> Dart , Android ,,...</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Flutter, Google ,,,,,.,, mvp ,,,,. Flutter  module ,.ReactNative,,,.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225527.jpg\" alt=\"\"><br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225535.jpg\" alt=\"\"><br><img src=\"http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225548.jpg\" alt=\"\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://github.com/Thewhitelight/DouBanMovie\">Github </a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://flutter-io.cn/\" target=\"_blank\" rel=\"noopener\">Flutter </a><br><a href=\"https://flutterchina.club/\" target=\"_blank\" rel=\"noopener\">Flutter </a><br><a href=\"https://mp.weixin.qq.com/s/cJjKZCqc8UuzvEtxK1BJCw\" target=\"_blank\" rel=\"noopener\">Flutter </a></p>"},{"title":"Flutter (package)","date":"2018-08-31T06:06:20.000Z","_content":"Flutter  UI , package, package ,. package. iOS, Android Toast.iOS UIAlertView.\n<!-- more -->\n\n#####  package\n Android Studio,new->module-> Fullter package, next,![Flutter ](https://def-201655.cos.ap-shanghai.myqcloud.com/fultter_2_new_package.png), Flutter SDK , finish. package . VSCode  package.\npackage![](https://def-201655.cos.ap-shanghai.myqcloud.com/flutter_2_package_module.png)\n\n##### Android ,\n``` java\npublic class FlutterToastPlugin implements MethodCallHandler {\n    private static final String TAG = \"FlutterToastPlugin\";\n\n    private static Context context;\n\n    /**\n     * Plugin registration.\n     */\n    public static void registerWith(Registrar registrar) {\n        context = registrar.context();\n        final MethodChannel channel = new MethodChannel(registrar.messenger(), \"flutter_toast\");//  flutter_toast ,iOS.\n        channel.setMethodCallHandler(new FlutterToastPlugin());\n    }\n\n    @Override\n    public void onMethodCall(MethodCall call, Result result) {\n        String message = call.argument(\"message\");// flutter  \n        //,\n        switch (call.method) {\n            case \"showToast\":\n                Toast.makeText(context, message, Toast.LENGTH_SHORT).show();\n                break;\n            case \"showLongToast\":\n                Toast.makeText(context, message, Toast.LENGTH_LONG).show();\n                break;\n            case \"getPlatformVersion\":\n                //\n                result.success(\"Android \" + android.os.Build.VERSION.RELEASE);\n                break;\n            default:\n                result.notImplemented();\n        }\n    }\n```\n\n##### package ,, run \n``` dart\nimport 'dart:async';\n\nimport 'package:flutter/material.dart';\nimport 'package:flutter/services.dart';\nimport 'package:flutter_toast/flutter_toast.dart';\n\nvoid main() => runApp(new MyApp());\n\nclass MyApp extends StatefulWidget {\n  @override\n  _MyAppState createState() => new _MyAppState();\n}\n\nclass _MyAppState extends State<MyApp> {\n  String _platformVersion = 'Unknown';\n\n  @override\n  void initState() {\n    super.initState();\n    initPlatformState();\n  }\n\n  Future<void> initPlatformState() async {\n    String platformVersion;\n    try {\n        //\n      platformVersion = await FlutterToast.platformVersion;\n    } on PlatformException {\n      platformVersion = 'Failed to get platform version.';\n    }\n\n    if (!mounted) return;\n    setState(() {\n      _platformVersion = platformVersion;\n    });\n    //.showToast  call.method, test toast call.argument(\"message\")\n    FlutterToast.showToast(\"test toast\");\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return new MaterialApp(\n      home: new Scaffold(\n        appBar: new AppBar(\n          title: const Text('Plugin example app'),\n        ),\n        body: new Center(\n          child: new Text('Running on: $_platformVersion\\n'),\n        ),\n      ),\n    );\n  }\n}\n```\n\n##### iOS   Object-C ,\n&#123;% codeblock lang:objc %&#125;\n#import \"FlutterToastPlugin.h\"\n\n@implementation FlutterToastPlugin\n+ (void)registerWithRegistrar:(NSObject<FlutterPluginRegistrar>*)registrar {\n  FlutterMethodChannel* channel = [FlutterMethodChannel\n      methodChannelWithName:@\"flutter_toast\"\n            binaryMessenger:[registrar messenger]];\n  FlutterToastPlugin* instance = [[FlutterToastPlugin alloc] init];\n  [registrar addMethodCallDelegate:instance channel:channel];\n}\n\n- (void)handleMethodCall:(FlutterMethodCall*)call result:(FlutterResult)result {\n  if ([@\"getPlatformVersion\" isEqualToString:call.method]) {\n    //\n    result([@\"iOS \" stringByAppendingString:[[UIDevice currentDevice] systemVersion]]);\n  }else if([@\"showToast\" isEqualToString:call.method]) {//\n    //\n    NSString *msg = call.arguments[@\"message\"];\n    UIAlertView *alert = [[UIAlertView alloc]\n                                 initWithTitle:nil\n                                       message:msg\n                                      delegate:nil\n                             cancelButtonTitle:nil\n                             otherButtonTitles:nil, nil];\n    [alert show];\n    double duration = 0.5;\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [alert dismissWithClickedButtonIndex:0 animated:YES];\n    });\n  }else if([@\"showLongToast\" isEqualToString:call.method]) {\n    NSString *msg = call.arguments[@\"message\"];\n    UIAlertView *alert = [[UIAlertView alloc]\n                                 initWithTitle:nil\n                                       message:msg\n                                      delegate:nil\n                             cancelButtonTitle:nil\n                             otherButtonTitles:nil, nil];\n    [alert show];\n    double duration = 1;\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [alert dismissWithClickedButtonIndex:0 animated:YES];\n    });\n  }else {\n       result(FlutterMethodNotImplemented);\n  }\n}\n\n@end\n&#123;% endcodeblock %&#125;\n package  iOS , `brew install cocoapods`  `pod setup` ,,.\n\n##### Flutter \n ``` dart\n import 'dart:async';\n\nimport 'package:flutter/services.dart';\n\nclass FlutterToast {\n  static const MethodChannel _channel = const MethodChannel('flutter_toast');\n  //\n  static Future<String> get platformVersion async {\n    final String version = await _channel.invokeMethod('getPlatformVersion');\n    return version;\n  }\n  //\n  static void showToast(String message) {\n      //showToast , message ,\n    _channel.invokeMethod(\"showToast\", {\n      \"message\": message,\n    });\n  }\n\n  static void showLongToast(String message) {\n    _channel.invokeMethod(\"showLongToast\", {\n      \"message\": message,\n    });\n  }\n}\n\n ```\n\n#### \nFlutter ,,,. demo,, Flutter ,WebView.\n[GitHub](https://github.com/Thewhitelight/DouBanMovie)\n[Flutter](https://flutterstudio.app/)","source":"_posts/flutter-douban-2.md","raw":"---\ntitle: Flutter (package)\ndate: 2018-08-31 14:06:20\ntags:\n    - Flutter\ncategories: \n---\nFlutter  UI , package, package ,. package. iOS, Android Toast.iOS UIAlertView.\n<!-- more -->\n\n#####  package\n Android Studio,new->module-> Fullter package, next,![Flutter ](https://def-201655.cos.ap-shanghai.myqcloud.com/fultter_2_new_package.png), Flutter SDK , finish. package . VSCode  package.\npackage![](https://def-201655.cos.ap-shanghai.myqcloud.com/flutter_2_package_module.png)\n\n##### Android ,\n``` java\npublic class FlutterToastPlugin implements MethodCallHandler {\n    private static final String TAG = \"FlutterToastPlugin\";\n\n    private static Context context;\n\n    /**\n     * Plugin registration.\n     */\n    public static void registerWith(Registrar registrar) {\n        context = registrar.context();\n        final MethodChannel channel = new MethodChannel(registrar.messenger(), \"flutter_toast\");//  flutter_toast ,iOS.\n        channel.setMethodCallHandler(new FlutterToastPlugin());\n    }\n\n    @Override\n    public void onMethodCall(MethodCall call, Result result) {\n        String message = call.argument(\"message\");// flutter  \n        //,\n        switch (call.method) {\n            case \"showToast\":\n                Toast.makeText(context, message, Toast.LENGTH_SHORT).show();\n                break;\n            case \"showLongToast\":\n                Toast.makeText(context, message, Toast.LENGTH_LONG).show();\n                break;\n            case \"getPlatformVersion\":\n                //\n                result.success(\"Android \" + android.os.Build.VERSION.RELEASE);\n                break;\n            default:\n                result.notImplemented();\n        }\n    }\n```\n\n##### package ,, run \n``` dart\nimport 'dart:async';\n\nimport 'package:flutter/material.dart';\nimport 'package:flutter/services.dart';\nimport 'package:flutter_toast/flutter_toast.dart';\n\nvoid main() => runApp(new MyApp());\n\nclass MyApp extends StatefulWidget {\n  @override\n  _MyAppState createState() => new _MyAppState();\n}\n\nclass _MyAppState extends State<MyApp> {\n  String _platformVersion = 'Unknown';\n\n  @override\n  void initState() {\n    super.initState();\n    initPlatformState();\n  }\n\n  Future<void> initPlatformState() async {\n    String platformVersion;\n    try {\n        //\n      platformVersion = await FlutterToast.platformVersion;\n    } on PlatformException {\n      platformVersion = 'Failed to get platform version.';\n    }\n\n    if (!mounted) return;\n    setState(() {\n      _platformVersion = platformVersion;\n    });\n    //.showToast  call.method, test toast call.argument(\"message\")\n    FlutterToast.showToast(\"test toast\");\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return new MaterialApp(\n      home: new Scaffold(\n        appBar: new AppBar(\n          title: const Text('Plugin example app'),\n        ),\n        body: new Center(\n          child: new Text('Running on: $_platformVersion\\n'),\n        ),\n      ),\n    );\n  }\n}\n```\n\n##### iOS   Object-C ,\n&#123;% codeblock lang:objc %&#125;\n#import \"FlutterToastPlugin.h\"\n\n@implementation FlutterToastPlugin\n+ (void)registerWithRegistrar:(NSObject<FlutterPluginRegistrar>*)registrar {\n  FlutterMethodChannel* channel = [FlutterMethodChannel\n      methodChannelWithName:@\"flutter_toast\"\n            binaryMessenger:[registrar messenger]];\n  FlutterToastPlugin* instance = [[FlutterToastPlugin alloc] init];\n  [registrar addMethodCallDelegate:instance channel:channel];\n}\n\n- (void)handleMethodCall:(FlutterMethodCall*)call result:(FlutterResult)result {\n  if ([@\"getPlatformVersion\" isEqualToString:call.method]) {\n    //\n    result([@\"iOS \" stringByAppendingString:[[UIDevice currentDevice] systemVersion]]);\n  }else if([@\"showToast\" isEqualToString:call.method]) {//\n    //\n    NSString *msg = call.arguments[@\"message\"];\n    UIAlertView *alert = [[UIAlertView alloc]\n                                 initWithTitle:nil\n                                       message:msg\n                                      delegate:nil\n                             cancelButtonTitle:nil\n                             otherButtonTitles:nil, nil];\n    [alert show];\n    double duration = 0.5;\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [alert dismissWithClickedButtonIndex:0 animated:YES];\n    });\n  }else if([@\"showLongToast\" isEqualToString:call.method]) {\n    NSString *msg = call.arguments[@\"message\"];\n    UIAlertView *alert = [[UIAlertView alloc]\n                                 initWithTitle:nil\n                                       message:msg\n                                      delegate:nil\n                             cancelButtonTitle:nil\n                             otherButtonTitles:nil, nil];\n    [alert show];\n    double duration = 1;\n    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{\n            [alert dismissWithClickedButtonIndex:0 animated:YES];\n    });\n  }else {\n       result(FlutterMethodNotImplemented);\n  }\n}\n\n@end\n&#123;% endcodeblock %&#125;\n package  iOS , `brew install cocoapods`  `pod setup` ,,.\n\n##### Flutter \n ``` dart\n import 'dart:async';\n\nimport 'package:flutter/services.dart';\n\nclass FlutterToast {\n  static const MethodChannel _channel = const MethodChannel('flutter_toast');\n  //\n  static Future<String> get platformVersion async {\n    final String version = await _channel.invokeMethod('getPlatformVersion');\n    return version;\n  }\n  //\n  static void showToast(String message) {\n      //showToast , message ,\n    _channel.invokeMethod(\"showToast\", {\n      \"message\": message,\n    });\n  }\n\n  static void showLongToast(String message) {\n    _channel.invokeMethod(\"showLongToast\", {\n      \"message\": message,\n    });\n  }\n}\n\n ```\n\n#### \nFlutter ,,,. demo,, Flutter ,WebView.\n[GitHub](https://github.com/Thewhitelight/DouBanMovie)\n[Flutter](https://flutterstudio.app/)","slug":"flutter-douban-2","published":1,"updated":"2020-06-18T12:46:50.222Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsam001pndf2rbjn5m9k","content":"<p>Flutter  UI , package, package ,. package. iOS, Android Toast.iOS UIAlertView.<br><a id=\"more\"></a></p>\n<h5 id=\"-package\"><a href=\"#-package\" class=\"headerlink\" title=\" package\"></a> package</h5><p> Android Studio,new-&gt;module-&gt; Fullter package, next,<img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/fultter_2_new_package.png\" alt=\"Flutter \">, Flutter SDK , finish. package . VSCode  package.<br>package<img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/flutter_2_package_module.png\" alt=\"\"></p>\n<h5 id=\"Android--\"><a href=\"#Android--\" class=\"headerlink\" title=\"Android ,\"></a>Android ,</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FlutterToastPlugin</span> <span class=\"keyword\">implements</span> <span class=\"title\">MethodCallHandler</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String TAG = <span class=\"string\">\"FlutterToastPlugin\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Context context;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Plugin registration.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">registerWith</span><span class=\"params\">(Registrar registrar)</span> </span>&#123;</span><br><span class=\"line\">        context = registrar.context();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> MethodChannel channel = <span class=\"keyword\">new</span> MethodChannel(registrar.messenger(), <span class=\"string\">\"flutter_toast\"</span>);<span class=\"comment\">//  flutter_toast ,iOS.</span></span><br><span class=\"line\">        channel.setMethodCallHandler(<span class=\"keyword\">new</span> FlutterToastPlugin());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onMethodCall</span><span class=\"params\">(MethodCall call, Result result)</span> </span>&#123;</span><br><span class=\"line\">        String message = call.argument(<span class=\"string\">\"message\"</span>);<span class=\"comment\">// flutter  </span></span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (call.method) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">\"showToast\"</span>:</span><br><span class=\"line\">                Toast.makeText(context, message, Toast.LENGTH_SHORT).show();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">\"showLongToast\"</span>:</span><br><span class=\"line\">                Toast.makeText(context, message, Toast.LENGTH_LONG).show();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">\"getPlatformVersion\"</span>:</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                result.success(<span class=\"string\">\"Android \"</span> + android.os.Build.VERSION.RELEASE);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                result.notImplemented();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"package----run-\"><a href=\"#package----run-\" class=\"headerlink\" title=\"package ,, run \"></a>package ,, run </h5><figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'dart:async'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter/material.dart'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter/services.dart'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter_toast/flutter_toast.dart'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(<span class=\"keyword\">new</span> MyApp());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  _MyAppState createState() =&gt; <span class=\"keyword\">new</span> _MyAppState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_MyAppState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">MyApp</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">String</span> _platformVersion = <span class=\"string\">'Unknown'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">    initPlatformState();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  Future&lt;<span class=\"keyword\">void</span>&gt; initPlatformState() <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">String</span> platformVersion;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">      platformVersion = <span class=\"keyword\">await</span> FlutterToast.platformVersion;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">on</span> PlatformException &#123;</span><br><span class=\"line\">      platformVersion = <span class=\"string\">'Failed to get platform version.'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!mounted) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    setState(() &#123;</span><br><span class=\"line\">      _platformVersion = platformVersion;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">//.showToast  call.method, test toast call.argument(\"message\")</span></span><br><span class=\"line\">    FlutterToast.showToast(<span class=\"string\">\"test toast\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> MaterialApp(</span><br><span class=\"line\">      home: <span class=\"keyword\">new</span> Scaffold(</span><br><span class=\"line\">        appBar: <span class=\"keyword\">new</span> AppBar(</span><br><span class=\"line\">          title: <span class=\"keyword\">const</span> Text(<span class=\"string\">'Plugin example app'</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        body: <span class=\"keyword\">new</span> Center(</span><br><span class=\"line\">          child: <span class=\"keyword\">new</span> Text(<span class=\"string\">'Running on: <span class=\"subst\">$_platformVersion</span>\\n'</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"iOS---Object-C--\"><a href=\"#iOS---Object-C--\" class=\"headerlink\" title=\"iOS   Object-C ,\"></a>iOS   Object-C ,</h5><p>&#123;% codeblock lang:objc %&#125;</p>\n<p>#import FlutterToastPlugin.h</p>\n<p>@implementation FlutterToastPlugin</p>\n<ul>\n<li>(void)registerWithRegistrar:(NSObject<flutterpluginregistrar><em>)registrar {<br>FlutterMethodChannel</em> channel = [FlutterMethodChannel<pre><code>methodChannelWithName:@&quot;flutter_toast&quot;\n      binaryMessenger:[registrar messenger]];\n</code></pre>FlutterToastPlugin* instance = [[FlutterToastPlugin alloc] init];<br>[registrar addMethodCallDelegate:instance channel:channel];<br>}</flutterpluginregistrar></li>\n</ul>\n<ul>\n<li>(void)handleMethodCall:(FlutterMethodCall<em>)call result:(FlutterResult)result {<br>if ([@getPlatformVersion isEqualToString:call.method]) {<br>  //<br>  result([@iOS  stringByAppendingString:[[UIDevice currentDevice] systemVersion]]);<br>}else if([@showToast isEqualToString:call.method]) {//<br>  //<br>  NSString </em>msg = call.arguments[@message];<br>  UIAlertView *alert = [[UIAlertView alloc]<pre><code>    initWithTitle:nil\n          message:msg\n         delegate:nil\ncancelButtonTitle:nil\notherButtonTitles:nil, nil];\n</code></pre>  [alert show];<br>  double duration = 0.5;<br>  dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{<pre><code>[alert dismissWithClickedButtonIndex:0 animated:YES];\n</code></pre>  });<br>}else if([@showLongToast isEqualToString:call.method]) {<br>  NSString <em>msg = call.arguments[@message];<br>  UIAlertView </em>alert = [[UIAlertView alloc]<pre><code>    initWithTitle:nil\n          message:msg\n         delegate:nil\ncancelButtonTitle:nil\notherButtonTitles:nil, nil];\n</code></pre>  [alert show];<br>  double duration = 1;<br>  dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{<pre><code>[alert dismissWithClickedButtonIndex:0 animated:YES];\n</code></pre>  });<br>}else {<pre><code>result(FlutterMethodNotImplemented);\n</code></pre>}<br>}</li>\n</ul>\n<p>@end<br>&#123;% endcodeblock %&#125;<br> package  iOS , <code>brew install cocoapods</code>  <code>pod setup</code> ,,.</p>\n<h5 id=\"Flutter-\"><a href=\"#Flutter-\" class=\"headerlink\" title=\"Flutter \"></a>Flutter </h5> <figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">import</span> <span class=\"string\">'dart:async'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter/services.dart'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FlutterToast</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">const</span> MethodChannel _channel = <span class=\"keyword\">const</span> MethodChannel(<span class=\"string\">'flutter_toast'</span>);</span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> Future&lt;<span class=\"built_in\">String</span>&gt; <span class=\"keyword\">get</span> platformVersion <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"built_in\">String</span> version = <span class=\"keyword\">await</span> _channel.invokeMethod(<span class=\"string\">'getPlatformVersion'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> version;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> showToast(<span class=\"built_in\">String</span> message) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//showToast , message ,</span></span><br><span class=\"line\">    _channel.invokeMethod(<span class=\"string\">\"showToast\"</span>, &#123;</span><br><span class=\"line\">      <span class=\"string\">\"message\"</span>: message,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> showLongToast(<span class=\"built_in\">String</span> message) &#123;</span><br><span class=\"line\">    _channel.invokeMethod(<span class=\"string\">\"showLongToast\"</span>, &#123;</span><br><span class=\"line\">      <span class=\"string\">\"message\"</span>: message,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Flutter ,,,. demo,, Flutter ,WebView.<br><a href=\"https://github.com/Thewhitelight/DouBanMovie\">GitHub</a><br><a href=\"https://flutterstudio.app/\" target=\"_blank\" rel=\"noopener\">Flutter</a></p>\n","site":{"data":{}},"excerpt":"<p>Flutter  UI , package, package ,. package. iOS, Android Toast.iOS UIAlertView.<br>","more":"</p>\n<h5 id=\"-package\"><a href=\"#-package\" class=\"headerlink\" title=\" package\"></a> package</h5><p> Android Studio,new-&gt;module-&gt; Fullter package, next,<img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/fultter_2_new_package.png\" alt=\"Flutter \">, Flutter SDK , finish. package . VSCode  package.<br>package<img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/flutter_2_package_module.png\" alt=\"\"></p>\n<h5 id=\"Android--\"><a href=\"#Android--\" class=\"headerlink\" title=\"Android ,\"></a>Android ,</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FlutterToastPlugin</span> <span class=\"keyword\">implements</span> <span class=\"title\">MethodCallHandler</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String TAG = <span class=\"string\">\"FlutterToastPlugin\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Context context;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Plugin registration.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">registerWith</span><span class=\"params\">(Registrar registrar)</span> </span>&#123;</span><br><span class=\"line\">        context = registrar.context();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> MethodChannel channel = <span class=\"keyword\">new</span> MethodChannel(registrar.messenger(), <span class=\"string\">\"flutter_toast\"</span>);<span class=\"comment\">//  flutter_toast ,iOS.</span></span><br><span class=\"line\">        channel.setMethodCallHandler(<span class=\"keyword\">new</span> FlutterToastPlugin());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onMethodCall</span><span class=\"params\">(MethodCall call, Result result)</span> </span>&#123;</span><br><span class=\"line\">        String message = call.argument(<span class=\"string\">\"message\"</span>);<span class=\"comment\">// flutter  </span></span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (call.method) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">\"showToast\"</span>:</span><br><span class=\"line\">                Toast.makeText(context, message, Toast.LENGTH_SHORT).show();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">\"showLongToast\"</span>:</span><br><span class=\"line\">                Toast.makeText(context, message, Toast.LENGTH_LONG).show();</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">\"getPlatformVersion\"</span>:</span><br><span class=\"line\">                <span class=\"comment\">//</span></span><br><span class=\"line\">                result.success(<span class=\"string\">\"Android \"</span> + android.os.Build.VERSION.RELEASE);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                result.notImplemented();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"package----run-\"><a href=\"#package----run-\" class=\"headerlink\" title=\"package ,, run \"></a>package ,, run </h5><figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'dart:async'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter/material.dart'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter/services.dart'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter_toast/flutter_toast.dart'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(<span class=\"keyword\">new</span> MyApp());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  _MyAppState createState() =&gt; <span class=\"keyword\">new</span> _MyAppState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_MyAppState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">MyApp</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">String</span> _platformVersion = <span class=\"string\">'Unknown'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">    initPlatformState();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  Future&lt;<span class=\"keyword\">void</span>&gt; initPlatformState() <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">String</span> platformVersion;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">      platformVersion = <span class=\"keyword\">await</span> FlutterToast.platformVersion;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">on</span> PlatformException &#123;</span><br><span class=\"line\">      platformVersion = <span class=\"string\">'Failed to get platform version.'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!mounted) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    setState(() &#123;</span><br><span class=\"line\">      _platformVersion = platformVersion;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">//.showToast  call.method, test toast call.argument(\"message\")</span></span><br><span class=\"line\">    FlutterToast.showToast(<span class=\"string\">\"test toast\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> MaterialApp(</span><br><span class=\"line\">      home: <span class=\"keyword\">new</span> Scaffold(</span><br><span class=\"line\">        appBar: <span class=\"keyword\">new</span> AppBar(</span><br><span class=\"line\">          title: <span class=\"keyword\">const</span> Text(<span class=\"string\">'Plugin example app'</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        body: <span class=\"keyword\">new</span> Center(</span><br><span class=\"line\">          child: <span class=\"keyword\">new</span> Text(<span class=\"string\">'Running on: <span class=\"subst\">$_platformVersion</span>\\n'</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"iOS---Object-C--\"><a href=\"#iOS---Object-C--\" class=\"headerlink\" title=\"iOS   Object-C ,\"></a>iOS   Object-C ,</h5><p>&#123;% codeblock lang:objc %&#125;</p>\n<p>#import FlutterToastPlugin.h</p>\n<p>@implementation FlutterToastPlugin</p>\n<ul>\n<li>(void)registerWithRegistrar:(NSObject<flutterpluginregistrar><em>)registrar {<br>FlutterMethodChannel</em> channel = [FlutterMethodChannel<pre><code>methodChannelWithName:@&quot;flutter_toast&quot;\n      binaryMessenger:[registrar messenger]];\n</code></pre>FlutterToastPlugin* instance = [[FlutterToastPlugin alloc] init];<br>[registrar addMethodCallDelegate:instance channel:channel];<br>}</flutterpluginregistrar></li>\n</ul>\n<ul>\n<li>(void)handleMethodCall:(FlutterMethodCall<em>)call result:(FlutterResult)result {<br>if ([@getPlatformVersion isEqualToString:call.method]) {<br>  //<br>  result([@iOS  stringByAppendingString:[[UIDevice currentDevice] systemVersion]]);<br>}else if([@showToast isEqualToString:call.method]) {//<br>  //<br>  NSString </em>msg = call.arguments[@message];<br>  UIAlertView *alert = [[UIAlertView alloc]<pre><code>    initWithTitle:nil\n          message:msg\n         delegate:nil\ncancelButtonTitle:nil\notherButtonTitles:nil, nil];\n</code></pre>  [alert show];<br>  double duration = 0.5;<br>  dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{<pre><code>[alert dismissWithClickedButtonIndex:0 animated:YES];\n</code></pre>  });<br>}else if([@showLongToast isEqualToString:call.method]) {<br>  NSString <em>msg = call.arguments[@message];<br>  UIAlertView </em>alert = [[UIAlertView alloc]<pre><code>    initWithTitle:nil\n          message:msg\n         delegate:nil\ncancelButtonTitle:nil\notherButtonTitles:nil, nil];\n</code></pre>  [alert show];<br>  double duration = 1;<br>  dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{<pre><code>[alert dismissWithClickedButtonIndex:0 animated:YES];\n</code></pre>  });<br>}else {<pre><code>result(FlutterMethodNotImplemented);\n</code></pre>}<br>}</li>\n</ul>\n<p>@end<br>&#123;% endcodeblock %&#125;<br> package  iOS , <code>brew install cocoapods</code>  <code>pod setup</code> ,,.</p>\n<h5 id=\"Flutter-\"><a href=\"#Flutter-\" class=\"headerlink\" title=\"Flutter \"></a>Flutter </h5> <figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">import</span> <span class=\"string\">'dart:async'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'package:flutter/services.dart'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FlutterToast</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">const</span> MethodChannel _channel = <span class=\"keyword\">const</span> MethodChannel(<span class=\"string\">'flutter_toast'</span>);</span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> Future&lt;<span class=\"built_in\">String</span>&gt; <span class=\"keyword\">get</span> platformVersion <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"built_in\">String</span> version = <span class=\"keyword\">await</span> _channel.invokeMethod(<span class=\"string\">'getPlatformVersion'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> version;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//</span></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> showToast(<span class=\"built_in\">String</span> message) &#123;</span><br><span class=\"line\">      <span class=\"comment\">//showToast , message ,</span></span><br><span class=\"line\">    _channel.invokeMethod(<span class=\"string\">\"showToast\"</span>, &#123;</span><br><span class=\"line\">      <span class=\"string\">\"message\"</span>: message,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> showLongToast(<span class=\"built_in\">String</span> message) &#123;</span><br><span class=\"line\">    _channel.invokeMethod(<span class=\"string\">\"showLongToast\"</span>, &#123;</span><br><span class=\"line\">      <span class=\"string\">\"message\"</span>: message,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Flutter ,,,. demo,, Flutter ,WebView.<br><a href=\"https://github.com/Thewhitelight/DouBanMovie\">GitHub</a><br><a href=\"https://flutterstudio.app/\" target=\"_blank\" rel=\"noopener\">Flutter</a></p>"},{"title":" BECAUSE  Gradle  ()","date":"2020-02-20T15:39:34.000Z","_content":"# \n.\n,[API](https://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/Dependency.html#because-java.lang.String)[DOCS](https://docs.gradle.org/current/userguide/declaring_dependencies.html#sec:documenting-dependencies)\n\n&#123;% note info %&#125;\nvoid because?(@Nullable String reason)\n\nSets the reason why this dependency should be used.\nSince:\n4.6\n&#123;% endnote %&#125;\n\n<!-- more -->\n\n``` groovy\nimplementation(\"com.blundell:app-auth android:1.2.3\") {\n    because \"We use fragment auth, original AppAuth library does not support this feature.\"\n}\n```\nGradle \n`gradle -q dependencyInsight dependency app-auth android`\n\n\n git commit message \n because  //\n \n``` groovy\nimplementation(\"com.blundell:android-blog:1.2.3\") {\n    because \"If we didn't Blundell might cry.\"\n}\n```\n# \n[](https://blog.blundellapps.co.uk/tame-your-gradle-dependencies-just-because/3)","source":"_posts/gradle-dependencies-because.md","raw":"---\ntitle:  BECAUSE  Gradle  ()\ndate: 2020-02-20 23:39:34\ntags:\n    - Gradle\n    - \ncategories:\n    - \n---\n# \n.\n,[API](https://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/Dependency.html#because-java.lang.String)[DOCS](https://docs.gradle.org/current/userguide/declaring_dependencies.html#sec:documenting-dependencies)\n\n&#123;% note info %&#125;\nvoid because?(@Nullable String reason)\n\nSets the reason why this dependency should be used.\nSince:\n4.6\n&#123;% endnote %&#125;\n\n<!-- more -->\n\n``` groovy\nimplementation(\"com.blundell:app-auth android:1.2.3\") {\n    because \"We use fragment auth, original AppAuth library does not support this feature.\"\n}\n```\nGradle \n`gradle -q dependencyInsight dependency app-auth android`\n\n\n git commit message \n because  //\n \n``` groovy\nimplementation(\"com.blundell:android-blog:1.2.3\") {\n    because \"If we didn't Blundell might cry.\"\n}\n```\n# \n[](https://blog.blundellapps.co.uk/tame-your-gradle-dependencies-just-because/3)","slug":"gradle-dependencies-because","published":1,"updated":"2020-06-18T12:46:52.819Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsao001rndf208x4jl45","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>.<br>,<a href=\"https://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/Dependency.html#because-java.lang.String\" target=\"_blank\" rel=\"noopener\">API</a><a href=\"https://docs.gradle.org/current/userguide/declaring_dependencies.html#sec:documenting-dependencies\" target=\"_blank\" rel=\"noopener\">DOCS</a></p>\n<p>&#123;% note info %&#125;<br>void because?(@Nullable String reason)</p>\n<p>Sets the reason why this dependency should be used.<br>Since:<br>4.6<br>&#123;% endnote %&#125;</p>\n<a id=\"more\"></a>\n<p><br><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation(<span class=\"string\">\"com.blundell:app-auth android:1.2.3\"</span>) &#123;</span><br><span class=\"line\">    because <span class=\"string\">\"We use fragment auth, original AppAuth library does not support this feature.\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>Gradle <br><code>gradle -q dependencyInsight dependency app-auth android</code><br><br><br> git commit message <br> because  //<br> <br><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation(<span class=\"string\">\"com.blundell:android-blog:1.2.3\"</span>) &#123;</span><br><span class=\"line\">    because <span class=\"string\">\"If we didn't Blundell might cry.\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://blog.blundellapps.co.uk/tame-your-gradle-dependencies-just-because/3\" target=\"_blank\" rel=\"noopener\"></a></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>.<br>,<a href=\"https://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/Dependency.html#because-java.lang.String\" target=\"_blank\" rel=\"noopener\">API</a><a href=\"https://docs.gradle.org/current/userguide/declaring_dependencies.html#sec:documenting-dependencies\" target=\"_blank\" rel=\"noopener\">DOCS</a></p>\n<p>&#123;% note info %&#125;<br>void because?(@Nullable String reason)</p>\n<p>Sets the reason why this dependency should be used.<br>Since:<br>4.6<br>&#123;% endnote %&#125;</p>","more":"<p><br><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation(<span class=\"string\">\"com.blundell:app-auth android:1.2.3\"</span>) &#123;</span><br><span class=\"line\">    because <span class=\"string\">\"We use fragment auth, original AppAuth library does not support this feature.\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>Gradle <br><code>gradle -q dependencyInsight dependency app-auth android</code><br><br><br> git commit message <br> because  //<br> <br><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">implementation(<span class=\"string\">\"com.blundell:android-blog:1.2.3\"</span>) &#123;</span><br><span class=\"line\">    because <span class=\"string\">\"If we didn't Blundell might cry.\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://blog.blundellapps.co.uk/tame-your-gradle-dependencies-just-because/3\" target=\"_blank\" rel=\"noopener\"></a></p>"},{"title":"Maven ","date":"2020-03-09T11:33:20.000Z","_content":"Java  MavenAndroid  Gradle  Maven Maven  Maven \n<!-- more -->\n\n#  mvn\n\n##  mvn mac  `brew install mvn`\n##  mvn \n mvn `which mvn``/usr/local/apache-maven-3.6.3/bin/mvn``cd apache-maven-3.6.3/conf/``settings.xml` xml \n``` xml \n<servers>\n    <!--  server id username password  maven  -->\n      <server>\n      <id>releases</id>\n      <username>***</username>\n      <password>***</password>\n      </server>\n<servers> \n```\n\n# \n`com.android.support:appcompat-v7:28.0.0`,`appcompat-v7-28.0.0.aar`\n \n`mvn deploy:deploy-file -Dfile=appcompat-v7-28.0.0.aar -DgroupId=com.android.support -DartifactId=appcompat-v7 -Dversion=28.0.0 -Dpackaging=aar -Durl=https://www.***.com/repository/maven-releases/ -DrepositoryId=releases -DpomFile=appcompat-v7-28.0.0.pom`\n\n`-DrepositoryId``xml` id\n`-Dpackaging`\n`-Durl`\n`-DpomFile` pom \n\n# \n## mvn install\n pom   `mvn install`  pom \n## \n support `https://www.***.com/repository/maven-releases/com/android/support/appcompat-v7/28.0.0/appcompat-v7-28.0.0.pom` url `aarjarsourec.jar``curl`\n\n#  maven \n maven  maven `https://www.***.com/service/extdirect`, Head  API(https://www.***.com/service/rest/v1/search) `json``curl``unzip`\n\n# \nmvn ","source":"_posts/maven-related.md","raw":"---\ntitle: Maven \ndate: 2020-03-09 19:33:20\ntags:\n    - Maven\ncategories:\n    - \n---\nJava  MavenAndroid  Gradle  Maven Maven  Maven \n<!-- more -->\n\n#  mvn\n\n##  mvn mac  `brew install mvn`\n##  mvn \n mvn `which mvn``/usr/local/apache-maven-3.6.3/bin/mvn``cd apache-maven-3.6.3/conf/``settings.xml` xml \n``` xml \n<servers>\n    <!--  server id username password  maven  -->\n      <server>\n      <id>releases</id>\n      <username>***</username>\n      <password>***</password>\n      </server>\n<servers> \n```\n\n# \n`com.android.support:appcompat-v7:28.0.0`,`appcompat-v7-28.0.0.aar`\n \n`mvn deploy:deploy-file -Dfile=appcompat-v7-28.0.0.aar -DgroupId=com.android.support -DartifactId=appcompat-v7 -Dversion=28.0.0 -Dpackaging=aar -Durl=https://www.***.com/repository/maven-releases/ -DrepositoryId=releases -DpomFile=appcompat-v7-28.0.0.pom`\n\n`-DrepositoryId``xml` id\n`-Dpackaging`\n`-Durl`\n`-DpomFile` pom \n\n# \n## mvn install\n pom   `mvn install`  pom \n## \n support `https://www.***.com/repository/maven-releases/com/android/support/appcompat-v7/28.0.0/appcompat-v7-28.0.0.pom` url `aarjarsourec.jar``curl`\n\n#  maven \n maven  maven `https://www.***.com/service/extdirect`, Head  API(https://www.***.com/service/rest/v1/search) `json``curl``unzip`\n\n# \nmvn ","slug":"maven-related","published":1,"updated":"2020-03-31T08:20:11.120Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsap001undf26hvsbplj","content":"<p>Java  MavenAndroid  Gradle  Maven Maven  Maven <br><a id=\"more\"></a></p>\n<h1 id=\"-mvn\"><a href=\"#-mvn\" class=\"headerlink\" title=\" mvn\"></a> mvn</h1><h2 id=\"-mvn-mac--brew-install-mvn\"><a href=\"#-mvn-mac--brew-install-mvn\" class=\"headerlink\" title=\" mvn mac  brew install mvn\"></a> mvn mac  <code>brew install mvn</code></h2><h2 id=\"-mvn-\"><a href=\"#-mvn-\" class=\"headerlink\" title=\" mvn \"></a> mvn </h2><p> mvn <code>which mvn</code><code>/usr/local/apache-maven-3.6.3/bin/mvn</code><code>cd apache-maven-3.6.3/conf/</code><code>settings.xml</code> xml <br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  server id username password  maven  --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>releases<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">username</span>&gt;</span>***<span class=\"tag\">&lt;/<span class=\"name\">username</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">password</span>&gt;</span>***<span class=\"tag\">&lt;/<span class=\"name\">password</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servers</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><code>com.android.support:appcompat-v7:28.0.0</code>,<code>appcompat-v7-28.0.0.aar</code><br> <br><code>mvn deploy:deploy-file -Dfile=appcompat-v7-28.0.0.aar -DgroupId=com.android.support -DartifactId=appcompat-v7 -Dversion=28.0.0 -Dpackaging=aar -Durl=https://www.***.com/repository/maven-releases/ -DrepositoryId=releases -DpomFile=appcompat-v7-28.0.0.pom</code></p>\n<p><code>-DrepositoryId</code><code>xml</code> id<br><code>-Dpackaging</code><br><code>-Durl</code><br><code>-DpomFile</code> pom </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"mvn-install\"><a href=\"#mvn-install\" class=\"headerlink\" title=\"mvn install\"></a>mvn install</h2><p> pom   <code>mvn install</code>  pom </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> support <code>https://www.***.com/repository/maven-releases/com/android/support/appcompat-v7/28.0.0/appcompat-v7-28.0.0.pom</code> url <code>aarjarsourec.jar</code><code>curl</code></p>\n<h1 id=\"-maven-\"><a href=\"#-maven-\" class=\"headerlink\" title=\" maven \"></a> maven </h1><p> maven  maven <code>https://www.***.com/service/extdirect</code>, Head  API(<a href=\"https://www.***.com/service/rest/v1/search\" target=\"_blank\" rel=\"noopener\">https://www.***.com/service/rest/v1/search</a>) <code>json</code><code>curl</code><code>unzip</code></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>mvn </p>\n","site":{"data":{}},"excerpt":"<p>Java  MavenAndroid  Gradle  Maven Maven  Maven <br>","more":"</p>\n<h1 id=\"-mvn\"><a href=\"#-mvn\" class=\"headerlink\" title=\" mvn\"></a> mvn</h1><h2 id=\"-mvn-mac--brew-install-mvn\"><a href=\"#-mvn-mac--brew-install-mvn\" class=\"headerlink\" title=\" mvn mac  brew install mvn\"></a> mvn mac  <code>brew install mvn</code></h2><h2 id=\"-mvn-\"><a href=\"#-mvn-\" class=\"headerlink\" title=\" mvn \"></a> mvn </h2><p> mvn <code>which mvn</code><code>/usr/local/apache-maven-3.6.3/bin/mvn</code><code>cd apache-maven-3.6.3/conf/</code><code>settings.xml</code> xml <br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  server id username password  maven  --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>releases<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">username</span>&gt;</span>***<span class=\"tag\">&lt;/<span class=\"name\">username</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">password</span>&gt;</span>***<span class=\"tag\">&lt;/<span class=\"name\">password</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servers</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><code>com.android.support:appcompat-v7:28.0.0</code>,<code>appcompat-v7-28.0.0.aar</code><br> <br><code>mvn deploy:deploy-file -Dfile=appcompat-v7-28.0.0.aar -DgroupId=com.android.support -DartifactId=appcompat-v7 -Dversion=28.0.0 -Dpackaging=aar -Durl=https://www.***.com/repository/maven-releases/ -DrepositoryId=releases -DpomFile=appcompat-v7-28.0.0.pom</code></p>\n<p><code>-DrepositoryId</code><code>xml</code> id<br><code>-Dpackaging</code><br><code>-Durl</code><br><code>-DpomFile</code> pom </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h2 id=\"mvn-install\"><a href=\"#mvn-install\" class=\"headerlink\" title=\"mvn install\"></a>mvn install</h2><p> pom   <code>mvn install</code>  pom </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> support <code>https://www.***.com/repository/maven-releases/com/android/support/appcompat-v7/28.0.0/appcompat-v7-28.0.0.pom</code> url <code>aarjarsourec.jar</code><code>curl</code></p>\n<h1 id=\"-maven-\"><a href=\"#-maven-\" class=\"headerlink\" title=\" maven \"></a> maven </h1><p> maven  maven <code>https://www.***.com/service/extdirect</code>, Head  API(<a href=\"https://www.***.com/service/rest/v1/search\" target=\"_blank\" rel=\"noopener\">https://www.***.com/service/rest/v1/search</a>) <code>json</code><code>curl</code><code>unzip</code></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>mvn </p>"},{"title":"Android 8.0 ","date":"2018-12-04T06:10:16.000Z","_content":"## \nAndroid , targetVersion  25 ,,,,, targetVersion  28 . ,.\n 8.0  8.1 ,5.0.2 .` channel.setSound(notificationUri, Notification.AUDIO_ATTRIBUTES_DEFAULT); `,`channel.setImportance()`,. NotificationCompat.Builder  setSound() ,.\n<!-- more -->\n## \n api ![](https://def-201655.cos.ap-shanghai.myqcloud.com/notification_8.0_setSound.png), createNotificationChannel() ...,.**(,),(channelId )**,.\n\n``` java \n\n    @TargetApi(Build.VERSION_CODES.O)\n    private static void createNotificationChannel(String channel_id, Uri voiceUri) {\n        NotificationChannel channel = new NotificationChannel(channel_id, CHANNEL_NAME, NotificationManager.IMPORTANCE_HIGH);\n        channel.setBypassDnd(true);//\n        channel.enableLights(true);//\n        channel.setLockscreenVisibility(VISIBILITY_PUBLIC);//\n        channel.setLightColor(Color.RED);//\n        channel.setShowBadge(true);//launcher\n        channel.enableVibration(true);//\n        channel.setVibrationPattern(new long[]{100, 100, 200});//\n        if (voiceUri == null) {\n            //,\n            Uri uri = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);\n            channel.setSound(uri, Notification.AUDIO_ATTRIBUTES_DEFAULT);\n        } else {\n            channel.setSound(voiceUri, Notification.AUDIO_ATTRIBUTES_DEFAULT);\n        }\n        getManager().createNotificationChannel(channel);\n    }\n\n\n    private static NotificationManager getManager() {\n        if (mManager == null) {\n            mManager = (NotificationManager) MyApp.getInstance().getSystemService(Context.NOTIFICATION_SERVICE);\n        }\n        return mManager;\n    }\n\n    /**\n     * @param intent        Activity  Intent\n     * @param title        \n     * @param content      \n     * @param pushId       pushId \n     * @param soundCommand \n     */\n    public static void sendNotify(Context context, Intent intent, String title, String content, int pushId, String soundCommand) {\n        NotificationCompat.Builder builder;\n        PendingIntent contentIntent = PendingIntent.getActivity(context, pushId, intent,\n                PendingIntent.FLAG_UPDATE_CURRENT);\n        Uri uri = notifyVoice(soundCommand);\n        // hashCode  channelId \n        String id = uri == null ? String.valueOf(\"channelId\".hashCode()) : String.valueOf(uri.hashCode());\n        builder = new NotificationCompat.Builder(MyApp.getInstance(), id);\n        builder.setSmallIcon(R.drawable.ic_notify)\n                .setLargeIcon(BitmapFactory.decodeResource(context.getResources(), R.mipmap.ic_launcher))\n                .setContentTitle(title)\n                .setContentText(content)\n                .setFullScreenIntent(null, true)\n                .setContentIntent(contentIntent)\n                .setPriority(NotificationCompat.PRIORITY_DEFAULT)\n                .setTicker(content)\n                .setDefaults(DEFAULT_LIGHTS)\n                .setVisibility(VISIBILITY_PUBLIC)\n                .setDefaults(DEFAULT_VIBRATE)\n                .setWhen(System.currentTimeMillis())\n                .setAutoCancel(true)\n                .setOnlyAlertOnce(true)\n                .setOngoing(false);\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            createNotificationChannel(id, uri);\n        }\n        getManager().notify(pushId, builder.build());\n    }\n\n    private static Uri notifyVoice(String soundCommand) {\n        Logger.e(soundCommand);\n        int notifyVoice;\n        switch (soundCommand) {\n            case \"N\":\n                notifyVoice = R.raw.notify_new_customer;\n                break;\n            case \"O\":\n                notifyVoice = R.raw.notify_new_order;\n                break;\n            default:\n                notifyVoice = 0;\n        }\n        return notifyVoice == 0 ? null : Uri.parse(\"android.resource://\" + BuildConfig.APPLICATION_ID + \"/\" + notifyVoice);\n    }\n\n```\n## \n,( 8.0 ,),, Ringtone ,.\n``` java \n        Uri uri = notifyVoice(soundCommand);\n        Ringtone ringtone = RingtoneManager.getRingtone(MyApp.getInstance(), uri);\n        if (ringtone != null) {\n            ringtone.play();\n        }\n```\n stop .``` builder.setDeleteIntent()``` BroadcastReceiver .\n\n## \n[Android notification setSound is not working](https://stackoverflow.com/questions/48986856/android-notification-setsound-is-not-working)\n[Notification](https://www.jianshu.com/p/4b9fb73762df)","source":"_posts/notification-8-0-sound.md","raw":"---\ntitle: Android 8.0 \ndate: 2018-12-04 14:10:16\ntags:\n    - Android\n    - \ncategories: \n    - \n---\n## \nAndroid , targetVersion  25 ,,,,, targetVersion  28 . ,.\n 8.0  8.1 ,5.0.2 .` channel.setSound(notificationUri, Notification.AUDIO_ATTRIBUTES_DEFAULT); `,`channel.setImportance()`,. NotificationCompat.Builder  setSound() ,.\n<!-- more -->\n## \n api ![](https://def-201655.cos.ap-shanghai.myqcloud.com/notification_8.0_setSound.png), createNotificationChannel() ...,.**(,),(channelId )**,.\n\n``` java \n\n    @TargetApi(Build.VERSION_CODES.O)\n    private static void createNotificationChannel(String channel_id, Uri voiceUri) {\n        NotificationChannel channel = new NotificationChannel(channel_id, CHANNEL_NAME, NotificationManager.IMPORTANCE_HIGH);\n        channel.setBypassDnd(true);//\n        channel.enableLights(true);//\n        channel.setLockscreenVisibility(VISIBILITY_PUBLIC);//\n        channel.setLightColor(Color.RED);//\n        channel.setShowBadge(true);//launcher\n        channel.enableVibration(true);//\n        channel.setVibrationPattern(new long[]{100, 100, 200});//\n        if (voiceUri == null) {\n            //,\n            Uri uri = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);\n            channel.setSound(uri, Notification.AUDIO_ATTRIBUTES_DEFAULT);\n        } else {\n            channel.setSound(voiceUri, Notification.AUDIO_ATTRIBUTES_DEFAULT);\n        }\n        getManager().createNotificationChannel(channel);\n    }\n\n\n    private static NotificationManager getManager() {\n        if (mManager == null) {\n            mManager = (NotificationManager) MyApp.getInstance().getSystemService(Context.NOTIFICATION_SERVICE);\n        }\n        return mManager;\n    }\n\n    /**\n     * @param intent        Activity  Intent\n     * @param title        \n     * @param content      \n     * @param pushId       pushId \n     * @param soundCommand \n     */\n    public static void sendNotify(Context context, Intent intent, String title, String content, int pushId, String soundCommand) {\n        NotificationCompat.Builder builder;\n        PendingIntent contentIntent = PendingIntent.getActivity(context, pushId, intent,\n                PendingIntent.FLAG_UPDATE_CURRENT);\n        Uri uri = notifyVoice(soundCommand);\n        // hashCode  channelId \n        String id = uri == null ? String.valueOf(\"channelId\".hashCode()) : String.valueOf(uri.hashCode());\n        builder = new NotificationCompat.Builder(MyApp.getInstance(), id);\n        builder.setSmallIcon(R.drawable.ic_notify)\n                .setLargeIcon(BitmapFactory.decodeResource(context.getResources(), R.mipmap.ic_launcher))\n                .setContentTitle(title)\n                .setContentText(content)\n                .setFullScreenIntent(null, true)\n                .setContentIntent(contentIntent)\n                .setPriority(NotificationCompat.PRIORITY_DEFAULT)\n                .setTicker(content)\n                .setDefaults(DEFAULT_LIGHTS)\n                .setVisibility(VISIBILITY_PUBLIC)\n                .setDefaults(DEFAULT_VIBRATE)\n                .setWhen(System.currentTimeMillis())\n                .setAutoCancel(true)\n                .setOnlyAlertOnce(true)\n                .setOngoing(false);\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            createNotificationChannel(id, uri);\n        }\n        getManager().notify(pushId, builder.build());\n    }\n\n    private static Uri notifyVoice(String soundCommand) {\n        Logger.e(soundCommand);\n        int notifyVoice;\n        switch (soundCommand) {\n            case \"N\":\n                notifyVoice = R.raw.notify_new_customer;\n                break;\n            case \"O\":\n                notifyVoice = R.raw.notify_new_order;\n                break;\n            default:\n                notifyVoice = 0;\n        }\n        return notifyVoice == 0 ? null : Uri.parse(\"android.resource://\" + BuildConfig.APPLICATION_ID + \"/\" + notifyVoice);\n    }\n\n```\n## \n,( 8.0 ,),, Ringtone ,.\n``` java \n        Uri uri = notifyVoice(soundCommand);\n        Ringtone ringtone = RingtoneManager.getRingtone(MyApp.getInstance(), uri);\n        if (ringtone != null) {\n            ringtone.play();\n        }\n```\n stop .``` builder.setDeleteIntent()``` BroadcastReceiver .\n\n## \n[Android notification setSound is not working](https://stackoverflow.com/questions/48986856/android-notification-setsound-is-not-working)\n[Notification](https://www.jianshu.com/p/4b9fb73762df)","slug":"notification-8-0-sound","published":1,"updated":"2019-11-24T11:46:47.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsaq001xndf2gs0r98i1","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Android , targetVersion  25 ,,,,, targetVersion  28 . ,.<br> 8.0  8.1 ,5.0.2 .<code>channel.setSound(notificationUri, Notification.AUDIO_ATTRIBUTES_DEFAULT);</code>,<code>channel.setImportance()</code>,. NotificationCompat.Builder  setSound() ,.<br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> api <img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/notification_8.0_setSound.png\" alt>, createNotificationChannel() ...,.<strong>(,),(channelId )</strong>,.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@TargetApi</span>(Build.VERSION_CODES.O)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">createNotificationChannel</span><span class=\"params\">(String channel_id, Uri voiceUri)</span> </span>&#123;</span><br><span class=\"line\">    NotificationChannel channel = <span class=\"keyword\">new</span> NotificationChannel(channel_id, CHANNEL_NAME, NotificationManager.IMPORTANCE_HIGH);</span><br><span class=\"line\">    channel.setBypassDnd(<span class=\"keyword\">true</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.enableLights(<span class=\"keyword\">true</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.setLockscreenVisibility(VISIBILITY_PUBLIC);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.setLightColor(Color.RED);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.setShowBadge(<span class=\"keyword\">true</span>);<span class=\"comment\">//launcher</span></span><br><span class=\"line\">    channel.enableVibration(<span class=\"keyword\">true</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.setVibrationPattern(<span class=\"keyword\">new</span> <span class=\"keyword\">long</span>[]&#123;<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">200</span>&#125;);<span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (voiceUri == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        Uri uri = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);</span><br><span class=\"line\">        channel.setSound(uri, Notification.AUDIO_ATTRIBUTES_DEFAULT);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        channel.setSound(voiceUri, Notification.AUDIO_ATTRIBUTES_DEFAULT);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    getManager().createNotificationChannel(channel);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> NotificationManager <span class=\"title\">getManager</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mManager == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        mManager = (NotificationManager) MyApp.getInstance().getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mManager;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> intent        Activity  Intent</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> title        </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> content      </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> pushId       pushId </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> soundCommand </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">sendNotify</span><span class=\"params\">(Context context, Intent intent, String title, String content, <span class=\"keyword\">int</span> pushId, String soundCommand)</span> </span>&#123;</span><br><span class=\"line\">    NotificationCompat.Builder builder;</span><br><span class=\"line\">    PendingIntent contentIntent = PendingIntent.getActivity(context, pushId, intent,</span><br><span class=\"line\">            PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class=\"line\">    Uri uri = notifyVoice(soundCommand);</span><br><span class=\"line\">    <span class=\"comment\">// hashCode  channelId </span></span><br><span class=\"line\">    String id = uri == <span class=\"keyword\">null</span> ? String.valueOf(<span class=\"string\">\"channelId\"</span>.hashCode()) : String.valueOf(uri.hashCode());</span><br><span class=\"line\">    builder = <span class=\"keyword\">new</span> NotificationCompat.Builder(MyApp.getInstance(), id);</span><br><span class=\"line\">    builder.setSmallIcon(R.drawable.ic_notify)</span><br><span class=\"line\">            .setLargeIcon(BitmapFactory.decodeResource(context.getResources(), R.mipmap.ic_launcher))</span><br><span class=\"line\">            .setContentTitle(title)</span><br><span class=\"line\">            .setContentText(content)</span><br><span class=\"line\">            .setFullScreenIntent(<span class=\"keyword\">null</span>, <span class=\"keyword\">true</span>)</span><br><span class=\"line\">            .setContentIntent(contentIntent)</span><br><span class=\"line\">            .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class=\"line\">            .setTicker(content)</span><br><span class=\"line\">            .setDefaults(DEFAULT_LIGHTS)</span><br><span class=\"line\">            .setVisibility(VISIBILITY_PUBLIC)</span><br><span class=\"line\">            .setDefaults(DEFAULT_VIBRATE)</span><br><span class=\"line\">            .setWhen(System.currentTimeMillis())</span><br><span class=\"line\">            .setAutoCancel(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">            .setOnlyAlertOnce(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">            .setOngoing(<span class=\"keyword\">false</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class=\"line\">        createNotificationChannel(id, uri);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    getManager().notify(pushId, builder.build());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Uri <span class=\"title\">notifyVoice</span><span class=\"params\">(String soundCommand)</span> </span>&#123;</span><br><span class=\"line\">    Logger.e(soundCommand);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> notifyVoice;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (soundCommand) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">\"N\"</span>:</span><br><span class=\"line\">            notifyVoice = R.raw.notify_new_customer;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">\"O\"</span>:</span><br><span class=\"line\">            notifyVoice = R.raw.notify_new_order;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            notifyVoice = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> notifyVoice == <span class=\"number\">0</span> ? <span class=\"keyword\">null</span> : Uri.parse(<span class=\"string\">\"android.resource://\"</span> + BuildConfig.APPLICATION_ID + <span class=\"string\">\"/\"</span> + notifyVoice);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>,( 8.0 ,),, Ringtone ,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Uri uri = notifyVoice(soundCommand);</span><br><span class=\"line\">Ringtone ringtone = RingtoneManager.getRingtone(MyApp.getInstance(), uri);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (ringtone != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    ringtone.play();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> stop .<code>builder.setDeleteIntent()</code> BroadcastReceiver .</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://stackoverflow.com/questions/48986856/android-notification-setsound-is-not-working\" target=\"_blank\" rel=\"noopener\">Android notification setSound is not working</a><br><a href=\"https://www.jianshu.com/p/4b9fb73762df\" target=\"_blank\" rel=\"noopener\">Notification</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Android , targetVersion  25 ,,,,, targetVersion  28 . ,.<br> 8.0  8.1 ,5.0.2 .<code>channel.setSound(notificationUri, Notification.AUDIO_ATTRIBUTES_DEFAULT);</code>,<code>channel.setImportance()</code>,. NotificationCompat.Builder  setSound() ,.<br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> api <img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/notification_8.0_setSound.png\" alt>, createNotificationChannel() ...,.<strong>(,),(channelId )</strong>,.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@TargetApi</span>(Build.VERSION_CODES.O)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">createNotificationChannel</span><span class=\"params\">(String channel_id, Uri voiceUri)</span> </span>&#123;</span><br><span class=\"line\">    NotificationChannel channel = <span class=\"keyword\">new</span> NotificationChannel(channel_id, CHANNEL_NAME, NotificationManager.IMPORTANCE_HIGH);</span><br><span class=\"line\">    channel.setBypassDnd(<span class=\"keyword\">true</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.enableLights(<span class=\"keyword\">true</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.setLockscreenVisibility(VISIBILITY_PUBLIC);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.setLightColor(Color.RED);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.setShowBadge(<span class=\"keyword\">true</span>);<span class=\"comment\">//launcher</span></span><br><span class=\"line\">    channel.enableVibration(<span class=\"keyword\">true</span>);<span class=\"comment\">//</span></span><br><span class=\"line\">    channel.setVibrationPattern(<span class=\"keyword\">new</span> <span class=\"keyword\">long</span>[]&#123;<span class=\"number\">100</span>, <span class=\"number\">100</span>, <span class=\"number\">200</span>&#125;);<span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (voiceUri == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//,</span></span><br><span class=\"line\">        Uri uri = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);</span><br><span class=\"line\">        channel.setSound(uri, Notification.AUDIO_ATTRIBUTES_DEFAULT);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        channel.setSound(voiceUri, Notification.AUDIO_ATTRIBUTES_DEFAULT);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    getManager().createNotificationChannel(channel);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> NotificationManager <span class=\"title\">getManager</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mManager == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        mManager = (NotificationManager) MyApp.getInstance().getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mManager;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> intent        Activity  Intent</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> title        </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> content      </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> pushId       pushId </span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> soundCommand </span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">sendNotify</span><span class=\"params\">(Context context, Intent intent, String title, String content, <span class=\"keyword\">int</span> pushId, String soundCommand)</span> </span>&#123;</span><br><span class=\"line\">    NotificationCompat.Builder builder;</span><br><span class=\"line\">    PendingIntent contentIntent = PendingIntent.getActivity(context, pushId, intent,</span><br><span class=\"line\">            PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class=\"line\">    Uri uri = notifyVoice(soundCommand);</span><br><span class=\"line\">    <span class=\"comment\">// hashCode  channelId </span></span><br><span class=\"line\">    String id = uri == <span class=\"keyword\">null</span> ? String.valueOf(<span class=\"string\">\"channelId\"</span>.hashCode()) : String.valueOf(uri.hashCode());</span><br><span class=\"line\">    builder = <span class=\"keyword\">new</span> NotificationCompat.Builder(MyApp.getInstance(), id);</span><br><span class=\"line\">    builder.setSmallIcon(R.drawable.ic_notify)</span><br><span class=\"line\">            .setLargeIcon(BitmapFactory.decodeResource(context.getResources(), R.mipmap.ic_launcher))</span><br><span class=\"line\">            .setContentTitle(title)</span><br><span class=\"line\">            .setContentText(content)</span><br><span class=\"line\">            .setFullScreenIntent(<span class=\"keyword\">null</span>, <span class=\"keyword\">true</span>)</span><br><span class=\"line\">            .setContentIntent(contentIntent)</span><br><span class=\"line\">            .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class=\"line\">            .setTicker(content)</span><br><span class=\"line\">            .setDefaults(DEFAULT_LIGHTS)</span><br><span class=\"line\">            .setVisibility(VISIBILITY_PUBLIC)</span><br><span class=\"line\">            .setDefaults(DEFAULT_VIBRATE)</span><br><span class=\"line\">            .setWhen(System.currentTimeMillis())</span><br><span class=\"line\">            .setAutoCancel(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">            .setOnlyAlertOnce(<span class=\"keyword\">true</span>)</span><br><span class=\"line\">            .setOngoing(<span class=\"keyword\">false</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class=\"line\">        createNotificationChannel(id, uri);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    getManager().notify(pushId, builder.build());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Uri <span class=\"title\">notifyVoice</span><span class=\"params\">(String soundCommand)</span> </span>&#123;</span><br><span class=\"line\">    Logger.e(soundCommand);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> notifyVoice;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (soundCommand) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">\"N\"</span>:</span><br><span class=\"line\">            notifyVoice = R.raw.notify_new_customer;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">\"O\"</span>:</span><br><span class=\"line\">            notifyVoice = R.raw.notify_new_order;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            notifyVoice = <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> notifyVoice == <span class=\"number\">0</span> ? <span class=\"keyword\">null</span> : Uri.parse(<span class=\"string\">\"android.resource://\"</span> + BuildConfig.APPLICATION_ID + <span class=\"string\">\"/\"</span> + notifyVoice);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>,( 8.0 ,),, Ringtone ,.<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Uri uri = notifyVoice(soundCommand);</span><br><span class=\"line\">Ringtone ringtone = RingtoneManager.getRingtone(MyApp.getInstance(), uri);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (ringtone != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    ringtone.play();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> stop .<code>builder.setDeleteIntent()</code> BroadcastReceiver .</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"https://stackoverflow.com/questions/48986856/android-notification-setsound-is-not-working\" target=\"_blank\" rel=\"noopener\">Android notification setSound is not working</a><br><a href=\"https://www.jianshu.com/p/4b9fb73762df\" target=\"_blank\" rel=\"noopener\">Notification</a></p>"},{"title":"OKHttpHost","date":"2018-07-20T17:54:50.000Z","_content":"\n, Host , Flavors, applicationIdSuffix  App ,, App ,, App ,,.\n\n<!-- more -->\n\n#### @urlHost\n\n@urlurl,,@url,,,App,url.\n\n``` java\npublic interface ApiService {  \n    @GET\n    public Call<ResponseBody> uploadImg(@Url String url);\n}\n```\n\n####  Host  OKHttpClient\n\n OKHttp h ost  api ,3HostOkHttpClient,,,.\n\n####  Interceptor  Host\n\n api , Cookie  Interceptor,, Host,..\n\n Intercept  Chain Request, Request  HttpUrl  Host.HttpUrl Host,URL,URL,HttpUrl,URL,Request,..\n\n``` java \npublic class DynamicInterceptor implements Interceptor {\n\n    /**\n     * ApiHost\n     */\n    private static String mHost = Api.getHost();\n    private static final String HOST = \"host\";\n\n    /**\n     * host\n     *\n     * @param host host\n     */\n    public static void setHost(String host) {\n        mHost = host;\n    }\n\n    public static String getHost() {\n        return mHost;\n    }\n\n    @Override\n    public Response intercept(Chain chain) throws IOException {\n        Request request = chain.request();\n        // host\n        if (AppUtil.canCheckoutHost() && !mHost.equals(Api.getHost())) {\n            request = replaceHost(request);\n        }\n        return chain.proceed(request);\n    }\n\n    private static Request replaceHost(Request request) {\n        HttpUrl httpUrl = request.url();\n        URL url = httpUrl.url();\n        try {\n            \n            //URLHost\n            Class<?> urlClz = url.getClass();\n            Field urlHost = urlClz.getDeclaredField(HOST);\n            urlHost.setAccessible(true);\n            urlHost.set(url, mHost);\n\n            //HttpUrlHost\n            Class<?> httpUrlClz = httpUrl.getClass();\n            Field httpUrlHost = httpUrlClz.getDeclaredField(HOST);\n            httpUrlHost.setAccessible(true);\n            httpUrlHost.set(httpUrl, mHost);\n\n            //RequestHttpUrl\n            Class<?> requestUrlClz = request.getClass();\n            Field requestUrl = requestUrlClz.getDeclaredField(\"url\");\n            requestUrl.setAccessible(true);\n            requestUrl.set(request, httpUrl);\n            \n        } catch (IllegalAccessException e) {\n            e.printStackTrace();\n        } catch (NoSuchFieldException e) {\n            e.printStackTrace();\n        }\n        //HttpUrlHttpUrl\n        request = request.newBuilder().url(httpUrl).build();\n        return request;\n    }\n\n}\n```\n\n``` java\n//OkHttpClient.Builder\nbuilder.addInterceptor(new DynamicInterceptor());\n```\n\n#### \n\n[](https://github.com/Thewhitelight/DynamicRetrofitHost.git) ,MainActivityHost.\n","source":"_posts/okhttp-host-switch.md","raw":"---\ntitle: OKHttpHost\ndate: 2018-07-21 01:54:50\ntags:\n    - Android\n    - OKHttp\ncategories: \n---\n\n, Host , Flavors, applicationIdSuffix  App ,, App ,, App ,,.\n\n<!-- more -->\n\n#### @urlHost\n\n@urlurl,,@url,,,App,url.\n\n``` java\npublic interface ApiService {  \n    @GET\n    public Call<ResponseBody> uploadImg(@Url String url);\n}\n```\n\n####  Host  OKHttpClient\n\n OKHttp h ost  api ,3HostOkHttpClient,,,.\n\n####  Interceptor  Host\n\n api , Cookie  Interceptor,, Host,..\n\n Intercept  Chain Request, Request  HttpUrl  Host.HttpUrl Host,URL,URL,HttpUrl,URL,Request,..\n\n``` java \npublic class DynamicInterceptor implements Interceptor {\n\n    /**\n     * ApiHost\n     */\n    private static String mHost = Api.getHost();\n    private static final String HOST = \"host\";\n\n    /**\n     * host\n     *\n     * @param host host\n     */\n    public static void setHost(String host) {\n        mHost = host;\n    }\n\n    public static String getHost() {\n        return mHost;\n    }\n\n    @Override\n    public Response intercept(Chain chain) throws IOException {\n        Request request = chain.request();\n        // host\n        if (AppUtil.canCheckoutHost() && !mHost.equals(Api.getHost())) {\n            request = replaceHost(request);\n        }\n        return chain.proceed(request);\n    }\n\n    private static Request replaceHost(Request request) {\n        HttpUrl httpUrl = request.url();\n        URL url = httpUrl.url();\n        try {\n            \n            //URLHost\n            Class<?> urlClz = url.getClass();\n            Field urlHost = urlClz.getDeclaredField(HOST);\n            urlHost.setAccessible(true);\n            urlHost.set(url, mHost);\n\n            //HttpUrlHost\n            Class<?> httpUrlClz = httpUrl.getClass();\n            Field httpUrlHost = httpUrlClz.getDeclaredField(HOST);\n            httpUrlHost.setAccessible(true);\n            httpUrlHost.set(httpUrl, mHost);\n\n            //RequestHttpUrl\n            Class<?> requestUrlClz = request.getClass();\n            Field requestUrl = requestUrlClz.getDeclaredField(\"url\");\n            requestUrl.setAccessible(true);\n            requestUrl.set(request, httpUrl);\n            \n        } catch (IllegalAccessException e) {\n            e.printStackTrace();\n        } catch (NoSuchFieldException e) {\n            e.printStackTrace();\n        }\n        //HttpUrlHttpUrl\n        request = request.newBuilder().url(httpUrl).build();\n        return request;\n    }\n\n}\n```\n\n``` java\n//OkHttpClient.Builder\nbuilder.addInterceptor(new DynamicInterceptor());\n```\n\n#### \n\n[](https://github.com/Thewhitelight/DynamicRetrofitHost.git) ,MainActivityHost.\n","slug":"okhttp-host-switch","published":1,"updated":"2019-11-24T11:46:47.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsas0021ndf2nwu6ca7c","content":"<p>, Host , Flavors, applicationIdSuffix  App ,, App ,, App ,,.</p>\n<a id=\"more\"></a>\n<h4 id=\"-urlHost\"><a href=\"#-urlHost\" class=\"headerlink\" title=\"@urlHost\"></a>@urlHost</h4><p>@urlurl,,@url,,,App,url.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ApiService</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"meta\">@GET</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Call&lt;ResponseBody&gt; <span class=\"title\">uploadImg</span><span class=\"params\">(@Url String url)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"-Host--OKHttpClient\"><a href=\"#-Host--OKHttpClient\" class=\"headerlink\" title=\" Host  OKHttpClient\"></a> Host  OKHttpClient</h4><p> OKHttp h ost  api ,3HostOkHttpClient,,,.</p>\n<h4 id=\"-Interceptor--Host\"><a href=\"#-Interceptor--Host\" class=\"headerlink\" title=\" Interceptor  Host\"></a> Interceptor  Host</h4><p> api , Cookie  Interceptor,, Host,..</p>\n<p> Intercept  Chain Request, Request  HttpUrl  Host.HttpUrl Host,URL,URL,HttpUrl,URL,Request,..</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DynamicInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">Interceptor</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ApiHost</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String mHost = Api.getHost();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String HOST = <span class=\"string\">\"host\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * host</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> host host</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setHost</span><span class=\"params\">(String host)</span> </span>&#123;</span><br><span class=\"line\">        mHost = host;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getHost</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mHost;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">intercept</span><span class=\"params\">(Chain chain)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">        Request request = chain.request();</span><br><span class=\"line\">        <span class=\"comment\">// host</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (AppUtil.canCheckoutHost() &amp;&amp; !mHost.equals(Api.getHost())) &#123;</span><br><span class=\"line\">            request = replaceHost(request);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chain.proceed(request);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Request <span class=\"title\">replaceHost</span><span class=\"params\">(Request request)</span> </span>&#123;</span><br><span class=\"line\">        HttpUrl httpUrl = request.url();</span><br><span class=\"line\">        URL url = httpUrl.url();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//URLHost</span></span><br><span class=\"line\">            Class&lt;?&gt; urlClz = url.getClass();</span><br><span class=\"line\">            Field urlHost = urlClz.getDeclaredField(HOST);</span><br><span class=\"line\">            urlHost.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            urlHost.set(url, mHost);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//HttpUrlHost</span></span><br><span class=\"line\">            Class&lt;?&gt; httpUrlClz = httpUrl.getClass();</span><br><span class=\"line\">            Field httpUrlHost = httpUrlClz.getDeclaredField(HOST);</span><br><span class=\"line\">            httpUrlHost.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            httpUrlHost.set(httpUrl, mHost);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//RequestHttpUrl</span></span><br><span class=\"line\">            Class&lt;?&gt; requestUrlClz = request.getClass();</span><br><span class=\"line\">            Field requestUrl = requestUrlClz.getDeclaredField(<span class=\"string\">\"url\"</span>);</span><br><span class=\"line\">            requestUrl.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            requestUrl.set(request, httpUrl);</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IllegalAccessException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (NoSuchFieldException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//HttpUrlHttpUrl</span></span><br><span class=\"line\">        request = request.newBuilder().url(httpUrl).build();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> request;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//OkHttpClient.Builder</span></span><br><span class=\"line\">builder.addInterceptor(<span class=\"keyword\">new</span> DynamicInterceptor());</span><br></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://github.com/Thewhitelight/DynamicRetrofitHost.git\"></a> ,MainActivityHost.</p>\n","site":{"data":{}},"excerpt":"<p>, Host , Flavors, applicationIdSuffix  App ,, App ,, App ,,.</p>","more":"<h4 id=\"-urlHost\"><a href=\"#-urlHost\" class=\"headerlink\" title=\"@urlHost\"></a>@urlHost</h4><p>@urlurl,,@url,,,App,url.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ApiService</span> </span>&#123;  </span><br><span class=\"line\">    <span class=\"meta\">@GET</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Call&lt;ResponseBody&gt; <span class=\"title\">uploadImg</span><span class=\"params\">(@Url String url)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"-Host--OKHttpClient\"><a href=\"#-Host--OKHttpClient\" class=\"headerlink\" title=\" Host  OKHttpClient\"></a> Host  OKHttpClient</h4><p> OKHttp h ost  api ,3HostOkHttpClient,,,.</p>\n<h4 id=\"-Interceptor--Host\"><a href=\"#-Interceptor--Host\" class=\"headerlink\" title=\" Interceptor  Host\"></a> Interceptor  Host</h4><p> api , Cookie  Interceptor,, Host,..</p>\n<p> Intercept  Chain Request, Request  HttpUrl  Host.HttpUrl Host,URL,URL,HttpUrl,URL,Request,..</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DynamicInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">Interceptor</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ApiHost</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String mHost = Api.getHost();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String HOST = <span class=\"string\">\"host\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * host</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> host host</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">setHost</span><span class=\"params\">(String host)</span> </span>&#123;</span><br><span class=\"line\">        mHost = host;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getHost</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> mHost;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Response <span class=\"title\">intercept</span><span class=\"params\">(Chain chain)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\">        Request request = chain.request();</span><br><span class=\"line\">        <span class=\"comment\">// host</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (AppUtil.canCheckoutHost() &amp;&amp; !mHost.equals(Api.getHost())) &#123;</span><br><span class=\"line\">            request = replaceHost(request);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> chain.proceed(request);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Request <span class=\"title\">replaceHost</span><span class=\"params\">(Request request)</span> </span>&#123;</span><br><span class=\"line\">        HttpUrl httpUrl = request.url();</span><br><span class=\"line\">        URL url = httpUrl.url();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"comment\">//URLHost</span></span><br><span class=\"line\">            Class&lt;?&gt; urlClz = url.getClass();</span><br><span class=\"line\">            Field urlHost = urlClz.getDeclaredField(HOST);</span><br><span class=\"line\">            urlHost.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            urlHost.set(url, mHost);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//HttpUrlHost</span></span><br><span class=\"line\">            Class&lt;?&gt; httpUrlClz = httpUrl.getClass();</span><br><span class=\"line\">            Field httpUrlHost = httpUrlClz.getDeclaredField(HOST);</span><br><span class=\"line\">            httpUrlHost.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            httpUrlHost.set(httpUrl, mHost);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//RequestHttpUrl</span></span><br><span class=\"line\">            Class&lt;?&gt; requestUrlClz = request.getClass();</span><br><span class=\"line\">            Field requestUrl = requestUrlClz.getDeclaredField(<span class=\"string\">\"url\"</span>);</span><br><span class=\"line\">            requestUrl.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            requestUrl.set(request, httpUrl);</span><br><span class=\"line\">            </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IllegalAccessException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (NoSuchFieldException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//HttpUrlHttpUrl</span></span><br><span class=\"line\">        request = request.newBuilder().url(httpUrl).build();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> request;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//OkHttpClient.Builder</span></span><br><span class=\"line\">builder.addInterceptor(<span class=\"keyword\">new</span> DynamicInterceptor());</span><br></pre></td></tr></table></figure>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://github.com/Thewhitelight/DynamicRetrofitHost.git\"></a> ,MainActivityHost.</p>"},{"title":"React Native ","date":"2020-05-11T13:02:52.000Z","_content":"# \n SDK  ReactNative , React Native  AAR React Nativ \n# \n React Native  Native \n&#123;% note danger %&#125;\nReact Native version mismatch.\nJavaScript version:0.xx.x\nNative Version:0.xx.x\n&#123;% endnote %&#125;\n# \n[Libraries/Core/ReactNativeVersionCheck.js](https://github.com/facebook/react-native/blob/aee88b6843cea63d6aa0b5879ad6ef9da4701846/Libraries/Core/ReactNativeVersionCheck.js)\n<!-- more -->\n``` js ReactNativeVersionCheck.js\nexports.checkVersions = function checkVersions(): void {\n  const nativeVersion = Platform.constants.reactNativeVersion;\n  if (\n    ReactNativeVersion.version.major !== nativeVersion.major ||\n    ReactNativeVersion.version.minor !== nativeVersion.minor\n  ) {\n    console.error(\n      `React Native version mismatch.\\n\\nJavaScript version: ${_formatVersion(\n        ReactNativeVersion.version,\n      )}\\n` +\n        `Native version: ${_formatVersion(nativeVersion)}\\n\\n` +\n        'Make sure that you have rebuilt the native code. If the problem ' +\n        'persists try clearing the Watchman and packager caches with ' +\n        '`watchman watch-del-all && react-native start --reset-cache`.',\n    );\n  }\n};\n```\n path  js \n# \n`ReactNativeVersion` js  `Platform.constants.reactNativeVersion` Native \n ReactNativeVersionCheck \n``` js ReactNativeVersionCheck.js\nimport Platform from '../Utilities/Platform';\nconst ReactNativeVersion = require('./ReactNativeVersion');\n```\n ReactNativeVersionCheck.js->Platform.android.js->NativePlatformConstantsAndroid.js(PlatformConstants)->AndroidInfoModule.java->ReactNativeVersion.java \n```java ReactNativeVersion.java\npublic class ReactNativeVersion {\n  public static final Map<String, Object> VERSION = MapBuilder.<String, Object>of(\n      \"major\", 0,\n      \"minor\", 0,\n      \"patch\", 0,\n      \"prerelease\", null);\n}\n```\n 0 ` * @generated by scripts/bump-oss-version.js\n`\n\n```js bump-oss-version.js\nfs.writeFileSync(\n  'ReactAndroid/src/main/java/com/facebook/react/modules/systeminfo/ReactNativeVersion.java',\n  cat('scripts/versiontemplates/ReactNativeVersion.java.template')\n    .replace('${major}', major)\n    .replace('${minor}', minor)\n    .replace('${patch}', patch)\n    .replace(\n      '${prerelease}',\n      prerelease !== undefined ? `\"${prerelease}\"` : 'null',\n    ),\n  'utf-8',\n);\n\nfs.writeFileSync(\n  'ReactCommon/cxxreact/ReactNativeVersion.h',\n  cat('scripts/versiontemplates/ReactNativeVersion.h.template')\n    .replace('${major}', major)\n    .replace('${minor}', minor)\n    .replace('${patch}', patch)\n    .replace(\n      '${prerelease}',\n      prerelease !== undefined ? `\"${prerelease}\"` : '\"\"',\n    ),\n  'utf-8',\n);\n\nfs.writeFileSync(\n  'Libraries/Core/ReactNativeVersion.js',\n  cat('scripts/versiontemplates/ReactNativeVersion.js.template')\n    .replace('${major}', major)\n    .replace('${minor}', minor)\n    .replace('${patch}', patch)\n    .replace(\n      '${prerelease}',\n      prerelease !== undefined ? `'${prerelease}'` : 'null',\n    ),\n  'utf-8',\n);\n```\n jsAndroidiOS  React Native \n# \n bump-oss-version.js \n``` js bump-oss-version.js\n// - check that argument version matches branch\n// e.g. 0.33.1 or 0.33.0-rc4\nlet version = argv._[0];\nif (!version || version.indexOf(versionMajor) !== 0) {\n  echo(\n    `You must pass a tag like 0.${versionMajor}.[X]-rc[Y] to bump a version`,\n  );\n  exit(1);\n}\n```","source":"_posts/react-native-check-version.md","raw":"---\ntitle: React Native \ndate: 2020-05-11 21:02:52\ntags:\n    - React Native\n    - Android\n---\n# \n SDK  ReactNative , React Native  AAR React Nativ \n# \n React Native  Native \n&#123;% note danger %&#125;\nReact Native version mismatch.\nJavaScript version:0.xx.x\nNative Version:0.xx.x\n&#123;% endnote %&#125;\n# \n[Libraries/Core/ReactNativeVersionCheck.js](https://github.com/facebook/react-native/blob/aee88b6843cea63d6aa0b5879ad6ef9da4701846/Libraries/Core/ReactNativeVersionCheck.js)\n<!-- more -->\n``` js ReactNativeVersionCheck.js\nexports.checkVersions = function checkVersions(): void {\n  const nativeVersion = Platform.constants.reactNativeVersion;\n  if (\n    ReactNativeVersion.version.major !== nativeVersion.major ||\n    ReactNativeVersion.version.minor !== nativeVersion.minor\n  ) {\n    console.error(\n      `React Native version mismatch.\\n\\nJavaScript version: ${_formatVersion(\n        ReactNativeVersion.version,\n      )}\\n` +\n        `Native version: ${_formatVersion(nativeVersion)}\\n\\n` +\n        'Make sure that you have rebuilt the native code. If the problem ' +\n        'persists try clearing the Watchman and packager caches with ' +\n        '`watchman watch-del-all && react-native start --reset-cache`.',\n    );\n  }\n};\n```\n path  js \n# \n`ReactNativeVersion` js  `Platform.constants.reactNativeVersion` Native \n ReactNativeVersionCheck \n``` js ReactNativeVersionCheck.js\nimport Platform from '../Utilities/Platform';\nconst ReactNativeVersion = require('./ReactNativeVersion');\n```\n ReactNativeVersionCheck.js->Platform.android.js->NativePlatformConstantsAndroid.js(PlatformConstants)->AndroidInfoModule.java->ReactNativeVersion.java \n```java ReactNativeVersion.java\npublic class ReactNativeVersion {\n  public static final Map<String, Object> VERSION = MapBuilder.<String, Object>of(\n      \"major\", 0,\n      \"minor\", 0,\n      \"patch\", 0,\n      \"prerelease\", null);\n}\n```\n 0 ` * @generated by scripts/bump-oss-version.js\n`\n\n```js bump-oss-version.js\nfs.writeFileSync(\n  'ReactAndroid/src/main/java/com/facebook/react/modules/systeminfo/ReactNativeVersion.java',\n  cat('scripts/versiontemplates/ReactNativeVersion.java.template')\n    .replace('${major}', major)\n    .replace('${minor}', minor)\n    .replace('${patch}', patch)\n    .replace(\n      '${prerelease}',\n      prerelease !== undefined ? `\"${prerelease}\"` : 'null',\n    ),\n  'utf-8',\n);\n\nfs.writeFileSync(\n  'ReactCommon/cxxreact/ReactNativeVersion.h',\n  cat('scripts/versiontemplates/ReactNativeVersion.h.template')\n    .replace('${major}', major)\n    .replace('${minor}', minor)\n    .replace('${patch}', patch)\n    .replace(\n      '${prerelease}',\n      prerelease !== undefined ? `\"${prerelease}\"` : '\"\"',\n    ),\n  'utf-8',\n);\n\nfs.writeFileSync(\n  'Libraries/Core/ReactNativeVersion.js',\n  cat('scripts/versiontemplates/ReactNativeVersion.js.template')\n    .replace('${major}', major)\n    .replace('${minor}', minor)\n    .replace('${patch}', patch)\n    .replace(\n      '${prerelease}',\n      prerelease !== undefined ? `'${prerelease}'` : 'null',\n    ),\n  'utf-8',\n);\n```\n jsAndroidiOS  React Native \n# \n bump-oss-version.js \n``` js bump-oss-version.js\n// - check that argument version matches branch\n// e.g. 0.33.1 or 0.33.0-rc4\nlet version = argv._[0];\nif (!version || version.indexOf(versionMajor) !== 0) {\n  echo(\n    `You must pass a tag like 0.${versionMajor}.[X]-rc[Y] to bump a version`,\n  );\n  exit(1);\n}\n```","slug":"react-native-check-version","published":1,"updated":"2020-06-18T12:46:47.673Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsas0023ndf2cyz4h0dh","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> SDK  ReactNative , React Native  AAR React Nativ </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> React Native  Native <br>&#123;% note danger %&#125;<br>React Native version mismatch.<br>JavaScript version:0.xx.x<br>Native Version:0.xx.x<br>&#123;% endnote %&#125;</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://github.com/facebook/react-native/blob/aee88b6843cea63d6aa0b5879ad6ef9da4701846/Libraries/Core/ReactNativeVersionCheck.js\">Libraries/Core/ReactNativeVersionCheck.js</a><br><a id=\"more\"></a><br><figure class=\"highlight js\"><figcaption><span>ReactNativeVersionCheck.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exports.checkVersions = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkVersions</span>(<span class=\"params\"></span>): <span class=\"title\">void</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> nativeVersion = Platform.constants.reactNativeVersion;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (</span><br><span class=\"line\">    ReactNativeVersion.version.major !== nativeVersion.major ||</span><br><span class=\"line\">    ReactNativeVersion.version.minor !== nativeVersion.minor</span><br><span class=\"line\">  ) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.error(</span><br><span class=\"line\">      <span class=\"string\">`React Native version mismatch.\\n\\nJavaScript version: <span class=\"subst\">$&#123;_formatVersion(</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">        ReactNativeVersion.version,</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">      )&#125;</span>\\n`</span> +</span><br><span class=\"line\">        <span class=\"string\">`Native version: <span class=\"subst\">$&#123;_formatVersion(nativeVersion)&#125;</span>\\n\\n`</span> +</span><br><span class=\"line\">        <span class=\"string\">'Make sure that you have rebuilt the native code. If the problem '</span> +</span><br><span class=\"line\">        <span class=\"string\">'persists try clearing the Watchman and packager caches with '</span> +</span><br><span class=\"line\">        <span class=\"string\">'`watchman watch-del-all &amp;&amp; react-native start --reset-cache`.'</span>,</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p> path  js </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><code>ReactNativeVersion</code> js  <code>Platform.constants.reactNativeVersion</code> Native <br> ReactNativeVersionCheck <br><figure class=\"highlight js\"><figcaption><span>ReactNativeVersionCheck.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Platform <span class=\"keyword\">from</span> <span class=\"string\">'../Utilities/Platform'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> ReactNativeVersion = <span class=\"built_in\">require</span>(<span class=\"string\">'./ReactNativeVersion'</span>);</span><br></pre></td></tr></table></figure></p>\n<p> ReactNativeVersionCheck.js-&gt;Platform.android.js-&gt;NativePlatformConstantsAndroid.js(PlatformConstants)-&gt;AndroidInfoModule.java-&gt;ReactNativeVersion.java <br><figure class=\"highlight java\"><figcaption><span>ReactNativeVersion.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReactNativeVersion</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Map&lt;String, Object&gt; VERSION = MapBuilder.&lt;String, Object&gt;of(</span><br><span class=\"line\">      <span class=\"string\">\"major\"</span>, <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"string\">\"minor\"</span>, <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"string\">\"patch\"</span>, <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"string\">\"prerelease\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> 0 <code>* @generated by scripts/bump-oss-version.js</code><br><br><figure class=\"highlight js\"><figcaption><span>bump-oss-version.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fs.writeFileSync(</span><br><span class=\"line\">  <span class=\"string\">'ReactAndroid/src/main/java/com/facebook/react/modules/systeminfo/ReactNativeVersion.java'</span>,</span><br><span class=\"line\">  cat(<span class=\"string\">'scripts/versiontemplates/ReactNativeVersion.java.template'</span>)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;major&#125;'</span>, major)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;minor&#125;'</span>, minor)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;patch&#125;'</span>, patch)</span><br><span class=\"line\">    .replace(</span><br><span class=\"line\">      <span class=\"string\">'$&#123;prerelease&#125;'</span>,</span><br><span class=\"line\">      prerelease !== <span class=\"literal\">undefined</span> ? <span class=\"string\">`\"<span class=\"subst\">$&#123;prerelease&#125;</span>\"`</span> : <span class=\"string\">'null'</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">  <span class=\"string\">'utf-8'</span>,</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">fs.writeFileSync(</span><br><span class=\"line\">  <span class=\"string\">'ReactCommon/cxxreact/ReactNativeVersion.h'</span>,</span><br><span class=\"line\">  cat(<span class=\"string\">'scripts/versiontemplates/ReactNativeVersion.h.template'</span>)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;major&#125;'</span>, major)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;minor&#125;'</span>, minor)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;patch&#125;'</span>, patch)</span><br><span class=\"line\">    .replace(</span><br><span class=\"line\">      <span class=\"string\">'$&#123;prerelease&#125;'</span>,</span><br><span class=\"line\">      prerelease !== <span class=\"literal\">undefined</span> ? <span class=\"string\">`\"<span class=\"subst\">$&#123;prerelease&#125;</span>\"`</span> : <span class=\"string\">'\"\"'</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">  <span class=\"string\">'utf-8'</span>,</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">fs.writeFileSync(</span><br><span class=\"line\">  <span class=\"string\">'Libraries/Core/ReactNativeVersion.js'</span>,</span><br><span class=\"line\">  cat(<span class=\"string\">'scripts/versiontemplates/ReactNativeVersion.js.template'</span>)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;major&#125;'</span>, major)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;minor&#125;'</span>, minor)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;patch&#125;'</span>, patch)</span><br><span class=\"line\">    .replace(</span><br><span class=\"line\">      <span class=\"string\">'$&#123;prerelease&#125;'</span>,</span><br><span class=\"line\">      prerelease !== <span class=\"literal\">undefined</span> ? <span class=\"string\">`'<span class=\"subst\">$&#123;prerelease&#125;</span>'`</span> : <span class=\"string\">'null'</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">  <span class=\"string\">'utf-8'</span>,</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></p>\n<p> jsAndroidiOS  React Native </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> bump-oss-version.js <br><figure class=\"highlight js\"><figcaption><span>bump-oss-version.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// - check that argument version matches branch</span></span><br><span class=\"line\"><span class=\"comment\">// e.g. 0.33.1 or 0.33.0-rc4</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> version = argv._[<span class=\"number\">0</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!version || version.indexOf(versionMajor) !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">  echo(</span><br><span class=\"line\">    <span class=\"string\">`You must pass a tag like 0.<span class=\"subst\">$&#123;versionMajor&#125;</span>.[X]-rc[Y] to bump a version`</span>,</span><br><span class=\"line\">  );</span><br><span class=\"line\">  exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> SDK  ReactNative , React Native  AAR React Nativ </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> React Native  Native <br>&#123;% note danger %&#125;<br>React Native version mismatch.<br>JavaScript version:0.xx.x<br>Native Version:0.xx.x<br>&#123;% endnote %&#125;</p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><a href=\"https://github.com/facebook/react-native/blob/aee88b6843cea63d6aa0b5879ad6ef9da4701846/Libraries/Core/ReactNativeVersionCheck.js\">Libraries/Core/ReactNativeVersionCheck.js</a><br>","more":"<br><figure class=\"highlight js\"><figcaption><span>ReactNativeVersionCheck.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exports.checkVersions = <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkVersions</span>(<span class=\"params\"></span>): <span class=\"title\">void</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> nativeVersion = Platform.constants.reactNativeVersion;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (</span><br><span class=\"line\">    ReactNativeVersion.version.major !== nativeVersion.major ||</span><br><span class=\"line\">    ReactNativeVersion.version.minor !== nativeVersion.minor</span><br><span class=\"line\">  ) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.error(</span><br><span class=\"line\">      <span class=\"string\">`React Native version mismatch.\\n\\nJavaScript version: <span class=\"subst\">$&#123;_formatVersion(</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">        ReactNativeVersion.version,</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">      )&#125;</span>\\n`</span> +</span><br><span class=\"line\">        <span class=\"string\">`Native version: <span class=\"subst\">$&#123;_formatVersion(nativeVersion)&#125;</span>\\n\\n`</span> +</span><br><span class=\"line\">        <span class=\"string\">'Make sure that you have rebuilt the native code. If the problem '</span> +</span><br><span class=\"line\">        <span class=\"string\">'persists try clearing the Watchman and packager caches with '</span> +</span><br><span class=\"line\">        <span class=\"string\">'`watchman watch-del-all &amp;&amp; react-native start --reset-cache`.'</span>,</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p> path  js </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><code>ReactNativeVersion</code> js  <code>Platform.constants.reactNativeVersion</code> Native <br> ReactNativeVersionCheck <br><figure class=\"highlight js\"><figcaption><span>ReactNativeVersionCheck.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> Platform <span class=\"keyword\">from</span> <span class=\"string\">'../Utilities/Platform'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> ReactNativeVersion = <span class=\"built_in\">require</span>(<span class=\"string\">'./ReactNativeVersion'</span>);</span><br></pre></td></tr></table></figure></p>\n<p> ReactNativeVersionCheck.js-&gt;Platform.android.js-&gt;NativePlatformConstantsAndroid.js(PlatformConstants)-&gt;AndroidInfoModule.java-&gt;ReactNativeVersion.java <br><figure class=\"highlight java\"><figcaption><span>ReactNativeVersion.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ReactNativeVersion</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Map&lt;String, Object&gt; VERSION = MapBuilder.&lt;String, Object&gt;of(</span><br><span class=\"line\">      <span class=\"string\">\"major\"</span>, <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"string\">\"minor\"</span>, <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"string\">\"patch\"</span>, <span class=\"number\">0</span>,</span><br><span class=\"line\">      <span class=\"string\">\"prerelease\"</span>, <span class=\"keyword\">null</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> 0 <code>* @generated by scripts/bump-oss-version.js</code><br><br><figure class=\"highlight js\"><figcaption><span>bump-oss-version.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fs.writeFileSync(</span><br><span class=\"line\">  <span class=\"string\">'ReactAndroid/src/main/java/com/facebook/react/modules/systeminfo/ReactNativeVersion.java'</span>,</span><br><span class=\"line\">  cat(<span class=\"string\">'scripts/versiontemplates/ReactNativeVersion.java.template'</span>)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;major&#125;'</span>, major)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;minor&#125;'</span>, minor)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;patch&#125;'</span>, patch)</span><br><span class=\"line\">    .replace(</span><br><span class=\"line\">      <span class=\"string\">'$&#123;prerelease&#125;'</span>,</span><br><span class=\"line\">      prerelease !== <span class=\"literal\">undefined</span> ? <span class=\"string\">`\"<span class=\"subst\">$&#123;prerelease&#125;</span>\"`</span> : <span class=\"string\">'null'</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">  <span class=\"string\">'utf-8'</span>,</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">fs.writeFileSync(</span><br><span class=\"line\">  <span class=\"string\">'ReactCommon/cxxreact/ReactNativeVersion.h'</span>,</span><br><span class=\"line\">  cat(<span class=\"string\">'scripts/versiontemplates/ReactNativeVersion.h.template'</span>)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;major&#125;'</span>, major)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;minor&#125;'</span>, minor)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;patch&#125;'</span>, patch)</span><br><span class=\"line\">    .replace(</span><br><span class=\"line\">      <span class=\"string\">'$&#123;prerelease&#125;'</span>,</span><br><span class=\"line\">      prerelease !== <span class=\"literal\">undefined</span> ? <span class=\"string\">`\"<span class=\"subst\">$&#123;prerelease&#125;</span>\"`</span> : <span class=\"string\">'\"\"'</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">  <span class=\"string\">'utf-8'</span>,</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">fs.writeFileSync(</span><br><span class=\"line\">  <span class=\"string\">'Libraries/Core/ReactNativeVersion.js'</span>,</span><br><span class=\"line\">  cat(<span class=\"string\">'scripts/versiontemplates/ReactNativeVersion.js.template'</span>)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;major&#125;'</span>, major)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;minor&#125;'</span>, minor)</span><br><span class=\"line\">    .replace(<span class=\"string\">'$&#123;patch&#125;'</span>, patch)</span><br><span class=\"line\">    .replace(</span><br><span class=\"line\">      <span class=\"string\">'$&#123;prerelease&#125;'</span>,</span><br><span class=\"line\">      prerelease !== <span class=\"literal\">undefined</span> ? <span class=\"string\">`'<span class=\"subst\">$&#123;prerelease&#125;</span>'`</span> : <span class=\"string\">'null'</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">  <span class=\"string\">'utf-8'</span>,</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></p>\n<p> jsAndroidiOS  React Native </p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> bump-oss-version.js <br><figure class=\"highlight js\"><figcaption><span>bump-oss-version.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// - check that argument version matches branch</span></span><br><span class=\"line\"><span class=\"comment\">// e.g. 0.33.1 or 0.33.0-rc4</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> version = argv._[<span class=\"number\">0</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!version || version.indexOf(versionMajor) !== <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">  echo(</span><br><span class=\"line\">    <span class=\"string\">`You must pass a tag like 0.<span class=\"subst\">$&#123;versionMajor&#125;</span>.[X]-rc[Y] to bump a version`</span>,</span><br><span class=\"line\">  );</span><br><span class=\"line\">  exit(<span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>"},{"title":"React Native  NativeMoudle ","date":"2020-06-15T12:47:37.000Z","_content":"# \n Native  NativeMoudle ReactContextBaseJavaModule onCatalystInstanceDestroy() api`LifecycleEventListener`listener`onHostResume() onHostPause() onHostDestroy()`\n\n# \n ReactNative  ReactNative `onResume()``onPause()`, pause  NativeMoudle `onHostResume()`\n\n# \n\n`onHostResume``Activity` Activity `ReactFragment`\n<!-- more -->\n## NativeMoudle \nReactActivity  ReactNative ReactActivity ReactActivityDelegate\n1. ReactActivityDelegate  ReactInstanceManager  ReactPackage  ReactInstanceManager\n2. ReactInstanceManager  ReactPackage   CatalystInstanceImpl\n3. CatalystInstanceImpl  ReactPackage  C++ C++js \n\n## NativeMoudle \n js  componentWillMount NativeMoudle  ReactMethod \n NativeMoudle  ReactInstanceManager ReactRootView  startReactApplication  ReactContextCatalystInstanceImpl\n``` java ReactInstanceManager.java\n  //\n  private void setupReactContext(final ReactApplicationContext reactContext) {\n    synchronized (mAttachedReactRoots) {\n      synchronized (mReactContextLock) {\n        mCurrentReactContext = Assertions.assertNotNull(reactContext);\n      }\n\n      CatalystInstance catalystInstance =\n        Assertions.assertNotNull(reactContext.getCatalystInstance());\n\n      catalystInstance.initialize();\n      // NativeMoudle \n      moveReactContextToCurrentLifecycleState();\n\n      for (ReactRoot reactRoot : mAttachedReactRoots) {\n        attachRootViewToInstance(reactRoot);\n      }\n    }\n  }\n\n  private synchronized void moveReactContextToCurrentLifecycleState() {\n    if (mLifecycleState == LifecycleState.RESUMED) {\n      moveToResumedLifecycleState(true);\n    }\n  }\n\n    // onHostResume  force=false  moveReactContextToCurrentLifecycleState force=true \n    private synchronized void moveToResumedLifecycleState(boolean force) {\n    ReactContext currentContext = getCurrentReactContext();\n    if (currentContext != null) {\n      // currentContext \n      // we currently don't have an onCreate callback so we call onResume for both transitions\n      if (force\n        || mLifecycleState == LifecycleState.BEFORE_RESUME\n        || mLifecycleState == LifecycleState.BEFORE_CREATE) {\n        currentContext.onHostResume(mCurrentActivity);\n      }\n    }\n    mLifecycleState = LifecycleState.RESUMED;\n  }\n\n```\n LifecycleState  RESUMED  ReactContext   NativeMoudle  `onHostResume()`\n Activity  ReactInstanceManager  onHostPause  `moveToBeforeResumeLifecycleState()`\n``` java ReactInstanceManager.java\n  private synchronized void moveToBeforeResumeLifecycleState() {\n    ReactContext currentContext = getCurrentReactContext();\n    if (currentContext != null) {\n      if (mLifecycleState == LifecycleState.BEFORE_CREATE) {\n        currentContext.onHostResume(mCurrentActivity);\n        currentContext.onHostPause();\n      } else if (mLifecycleState == LifecycleState.RESUMED) {\n        // CatalystInstanceImpl  mLifecycleState  RESUMED \n        currentContext.onHostPause();\n      }\n    }\n    mLifecycleState = LifecycleState.BEFORE_RESUME;\n  }\n```\n## \n ReactNative `onPause` ReactInstanceManager `moveToBeforeResumeLifecycleState()`, `mLifecycleState`  `LifecycleState.BEFORE_RESUME`\n``` java ReactInstanceManager.java\n  private synchronized void moveToBeforeResumeLifecycleState() {\n    ReactContext currentContext = getCurrentReactContext();\n    if (currentContext != null) {\n      if (mLifecycleState == LifecycleState.BEFORE_CREATE) {\n        currentContext.onHostResume(mCurrentActivity);\n        currentContext.onHostPause();\n      } else if (mLifecycleState == LifecycleState.RESUMED) {\n        currentContext.onHostPause();\n      }\n    }\n    // mLifecycleState \n    mLifecycleState = LifecycleState.BEFORE_RESUME;\n  }\n```\n`moveReactContextToCurrentLifecycleState()``mLifecycleState==LifecycleState.RESUMED` NativeMoudle `onHostResume()`,`moveToBeforeResumeLifecycleState`, NativeMoudle `onHostResume()`\n# \n`moveReactContextToCurrentLifecycleState()`\n``` java ReactInstanceManager.java\n  private synchronized void moveReactContextToCurrentLifecycleState() {\n      //    \n    //if (mLifecycleState == LifecycleState.RESUMED) {\n      moveToResumedLifecycleState(true);\n    //}\n  }\n  ```\n  `moveToResumedLifecycleState()``onHostResume()`\n","source":"_posts/react-native-moudle-lifecycle.md","raw":"---\ntitle: React Native  NativeMoudle \ndate: 2020-06-15 20:47:37\ntags:\n    - React Native\n    - Android\n---\n# \n Native  NativeMoudle ReactContextBaseJavaModule onCatalystInstanceDestroy() api`LifecycleEventListener`listener`onHostResume() onHostPause() onHostDestroy()`\n\n# \n ReactNative  ReactNative `onResume()``onPause()`, pause  NativeMoudle `onHostResume()`\n\n# \n\n`onHostResume``Activity` Activity `ReactFragment`\n<!-- more -->\n## NativeMoudle \nReactActivity  ReactNative ReactActivity ReactActivityDelegate\n1. ReactActivityDelegate  ReactInstanceManager  ReactPackage  ReactInstanceManager\n2. ReactInstanceManager  ReactPackage   CatalystInstanceImpl\n3. CatalystInstanceImpl  ReactPackage  C++ C++js \n\n## NativeMoudle \n js  componentWillMount NativeMoudle  ReactMethod \n NativeMoudle  ReactInstanceManager ReactRootView  startReactApplication  ReactContextCatalystInstanceImpl\n``` java ReactInstanceManager.java\n  //\n  private void setupReactContext(final ReactApplicationContext reactContext) {\n    synchronized (mAttachedReactRoots) {\n      synchronized (mReactContextLock) {\n        mCurrentReactContext = Assertions.assertNotNull(reactContext);\n      }\n\n      CatalystInstance catalystInstance =\n        Assertions.assertNotNull(reactContext.getCatalystInstance());\n\n      catalystInstance.initialize();\n      // NativeMoudle \n      moveReactContextToCurrentLifecycleState();\n\n      for (ReactRoot reactRoot : mAttachedReactRoots) {\n        attachRootViewToInstance(reactRoot);\n      }\n    }\n  }\n\n  private synchronized void moveReactContextToCurrentLifecycleState() {\n    if (mLifecycleState == LifecycleState.RESUMED) {\n      moveToResumedLifecycleState(true);\n    }\n  }\n\n    // onHostResume  force=false  moveReactContextToCurrentLifecycleState force=true \n    private synchronized void moveToResumedLifecycleState(boolean force) {\n    ReactContext currentContext = getCurrentReactContext();\n    if (currentContext != null) {\n      // currentContext \n      // we currently don't have an onCreate callback so we call onResume for both transitions\n      if (force\n        || mLifecycleState == LifecycleState.BEFORE_RESUME\n        || mLifecycleState == LifecycleState.BEFORE_CREATE) {\n        currentContext.onHostResume(mCurrentActivity);\n      }\n    }\n    mLifecycleState = LifecycleState.RESUMED;\n  }\n\n```\n LifecycleState  RESUMED  ReactContext   NativeMoudle  `onHostResume()`\n Activity  ReactInstanceManager  onHostPause  `moveToBeforeResumeLifecycleState()`\n``` java ReactInstanceManager.java\n  private synchronized void moveToBeforeResumeLifecycleState() {\n    ReactContext currentContext = getCurrentReactContext();\n    if (currentContext != null) {\n      if (mLifecycleState == LifecycleState.BEFORE_CREATE) {\n        currentContext.onHostResume(mCurrentActivity);\n        currentContext.onHostPause();\n      } else if (mLifecycleState == LifecycleState.RESUMED) {\n        // CatalystInstanceImpl  mLifecycleState  RESUMED \n        currentContext.onHostPause();\n      }\n    }\n    mLifecycleState = LifecycleState.BEFORE_RESUME;\n  }\n```\n## \n ReactNative `onPause` ReactInstanceManager `moveToBeforeResumeLifecycleState()`, `mLifecycleState`  `LifecycleState.BEFORE_RESUME`\n``` java ReactInstanceManager.java\n  private synchronized void moveToBeforeResumeLifecycleState() {\n    ReactContext currentContext = getCurrentReactContext();\n    if (currentContext != null) {\n      if (mLifecycleState == LifecycleState.BEFORE_CREATE) {\n        currentContext.onHostResume(mCurrentActivity);\n        currentContext.onHostPause();\n      } else if (mLifecycleState == LifecycleState.RESUMED) {\n        currentContext.onHostPause();\n      }\n    }\n    // mLifecycleState \n    mLifecycleState = LifecycleState.BEFORE_RESUME;\n  }\n```\n`moveReactContextToCurrentLifecycleState()``mLifecycleState==LifecycleState.RESUMED` NativeMoudle `onHostResume()`,`moveToBeforeResumeLifecycleState`, NativeMoudle `onHostResume()`\n# \n`moveReactContextToCurrentLifecycleState()`\n``` java ReactInstanceManager.java\n  private synchronized void moveReactContextToCurrentLifecycleState() {\n      //    \n    //if (mLifecycleState == LifecycleState.RESUMED) {\n      moveToResumedLifecycleState(true);\n    //}\n  }\n  ```\n  `moveToResumedLifecycleState()``onHostResume()`\n","slug":"react-native-moudle-lifecycle","published":1,"updated":"2020-06-17T16:22:03.099Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsat0026ndf2eigpo1wk","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> Native  NativeMoudle ReactContextBaseJavaModule onCatalystInstanceDestroy() api<code>LifecycleEventListener</code>listener<code>onHostResume() onHostPause() onHostDestroy()</code></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> ReactNative  ReactNative <code>onResume()</code><code>onPause()</code>, pause  NativeMoudle <code>onHostResume()</code></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><br><code>onHostResume</code><code>Activity</code> Activity <code>ReactFragment</code><br><a id=\"more\"></a></p>\n<h2 id=\"NativeMoudle-\"><a href=\"#NativeMoudle-\" class=\"headerlink\" title=\"NativeMoudle \"></a>NativeMoudle </h2><p>ReactActivity  ReactNative ReactActivity ReactActivityDelegate</p>\n<ol>\n<li>ReactActivityDelegate  ReactInstanceManager  ReactPackage  ReactInstanceManager</li>\n<li>ReactInstanceManager  ReactPackage   CatalystInstanceImpl</li>\n<li>CatalystInstanceImpl  ReactPackage  C++ C++js </li>\n</ol>\n<h2 id=\"NativeMoudle-\"><a href=\"#NativeMoudle-\" class=\"headerlink\" title=\"NativeMoudle \"></a>NativeMoudle </h2><p> js  componentWillMount NativeMoudle  ReactMethod <br> NativeMoudle  ReactInstanceManager ReactRootView  startReactApplication  ReactContextCatalystInstanceImpl<br><figure class=\"highlight java\"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">setupReactContext</span><span class=\"params\">(<span class=\"keyword\">final</span> ReactApplicationContext reactContext)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span> (mAttachedReactRoots) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (mReactContextLock) &#123;</span><br><span class=\"line\">      mCurrentReactContext = Assertions.assertNotNull(reactContext);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    CatalystInstance catalystInstance =</span><br><span class=\"line\">      Assertions.assertNotNull(reactContext.getCatalystInstance());</span><br><span class=\"line\"></span><br><span class=\"line\">    catalystInstance.initialize();</span><br><span class=\"line\">    <span class=\"comment\">// NativeMoudle </span></span><br><span class=\"line\">    moveReactContextToCurrentLifecycleState();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (ReactRoot reactRoot : mAttachedReactRoots) &#123;</span><br><span class=\"line\">      attachRootViewToInstance(reactRoot);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveReactContextToCurrentLifecycleState</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.RESUMED) &#123;</span><br><span class=\"line\">    moveToResumedLifecycleState(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// onHostResume  force=false  moveReactContextToCurrentLifecycleState force=true </span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveToResumedLifecycleState</span><span class=\"params\">(<span class=\"keyword\">boolean</span> force)</span> </span>&#123;</span><br><span class=\"line\">  ReactContext currentContext = getCurrentReactContext();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (currentContext != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// currentContext </span></span><br><span class=\"line\">    <span class=\"comment\">// we currently don't have an onCreate callback so we call onResume for both transitions</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (force</span><br><span class=\"line\">      || mLifecycleState == LifecycleState.BEFORE_RESUME</span><br><span class=\"line\">      || mLifecycleState == LifecycleState.BEFORE_CREATE) &#123;</span><br><span class=\"line\">      currentContext.onHostResume(mCurrentActivity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  mLifecycleState = LifecycleState.RESUMED;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> LifecycleState  RESUMED  ReactContext   NativeMoudle  <code>onHostResume()</code><br> Activity  ReactInstanceManager  onHostPause  <code>moveToBeforeResumeLifecycleState()</code><br><figure class=\"highlight java\"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveToBeforeResumeLifecycleState</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ReactContext currentContext = getCurrentReactContext();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (currentContext != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.BEFORE_CREATE) &#123;</span><br><span class=\"line\">      currentContext.onHostResume(mCurrentActivity);</span><br><span class=\"line\">      currentContext.onHostPause();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.RESUMED) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// CatalystInstanceImpl  mLifecycleState  RESUMED </span></span><br><span class=\"line\">      currentContext.onHostPause();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  mLifecycleState = LifecycleState.BEFORE_RESUME;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> ReactNative <code>onPause</code> ReactInstanceManager <code>moveToBeforeResumeLifecycleState()</code>, <code>mLifecycleState</code>  <code>LifecycleState.BEFORE_RESUME</code><br><figure class=\"highlight java\"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveToBeforeResumeLifecycleState</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ReactContext currentContext = getCurrentReactContext();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (currentContext != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.BEFORE_CREATE) &#123;</span><br><span class=\"line\">      currentContext.onHostResume(mCurrentActivity);</span><br><span class=\"line\">      currentContext.onHostPause();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.RESUMED) &#123;</span><br><span class=\"line\">      currentContext.onHostPause();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// mLifecycleState </span></span><br><span class=\"line\">  mLifecycleState = LifecycleState.BEFORE_RESUME;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>moveReactContextToCurrentLifecycleState()</code><code>mLifecycleState==LifecycleState.RESUMED</code> NativeMoudle <code>onHostResume()</code>,<code>moveToBeforeResumeLifecycleState</code>, NativeMoudle <code>onHostResume()</code></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><code>moveReactContextToCurrentLifecycleState()</code><br><figure class=\"highlight java\"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveReactContextToCurrentLifecycleState</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//    </span></span><br><span class=\"line\">  <span class=\"comment\">//if (mLifecycleState == LifecycleState.RESUMED) &#123;</span></span><br><span class=\"line\">    moveToResumedLifecycleState(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">  <span class=\"comment\">//&#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>  <code>moveToResumedLifecycleState()</code><code>onHostResume()</code></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> Native  NativeMoudle ReactContextBaseJavaModule onCatalystInstanceDestroy() api<code>LifecycleEventListener</code>listener<code>onHostResume() onHostPause() onHostDestroy()</code></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p> ReactNative  ReactNative <code>onResume()</code><code>onPause()</code>, pause  NativeMoudle <code>onHostResume()</code></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><br><code>onHostResume</code><code>Activity</code> Activity <code>ReactFragment</code><br>","more":"</p>\n<h2 id=\"NativeMoudle-\"><a href=\"#NativeMoudle-\" class=\"headerlink\" title=\"NativeMoudle \"></a>NativeMoudle </h2><p>ReactActivity  ReactNative ReactActivity ReactActivityDelegate</p>\n<ol>\n<li>ReactActivityDelegate  ReactInstanceManager  ReactPackage  ReactInstanceManager</li>\n<li>ReactInstanceManager  ReactPackage   CatalystInstanceImpl</li>\n<li>CatalystInstanceImpl  ReactPackage  C++ C++js </li>\n</ol>\n<h2 id=\"NativeMoudle-\"><a href=\"#NativeMoudle-\" class=\"headerlink\" title=\"NativeMoudle \"></a>NativeMoudle </h2><p> js  componentWillMount NativeMoudle  ReactMethod <br> NativeMoudle  ReactInstanceManager ReactRootView  startReactApplication  ReactContextCatalystInstanceImpl<br><figure class=\"highlight java\"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">setupReactContext</span><span class=\"params\">(<span class=\"keyword\">final</span> ReactApplicationContext reactContext)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">synchronized</span> (mAttachedReactRoots) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">synchronized</span> (mReactContextLock) &#123;</span><br><span class=\"line\">      mCurrentReactContext = Assertions.assertNotNull(reactContext);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    CatalystInstance catalystInstance =</span><br><span class=\"line\">      Assertions.assertNotNull(reactContext.getCatalystInstance());</span><br><span class=\"line\"></span><br><span class=\"line\">    catalystInstance.initialize();</span><br><span class=\"line\">    <span class=\"comment\">// NativeMoudle </span></span><br><span class=\"line\">    moveReactContextToCurrentLifecycleState();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (ReactRoot reactRoot : mAttachedReactRoots) &#123;</span><br><span class=\"line\">      attachRootViewToInstance(reactRoot);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveReactContextToCurrentLifecycleState</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.RESUMED) &#123;</span><br><span class=\"line\">    moveToResumedLifecycleState(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// onHostResume  force=false  moveReactContextToCurrentLifecycleState force=true </span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveToResumedLifecycleState</span><span class=\"params\">(<span class=\"keyword\">boolean</span> force)</span> </span>&#123;</span><br><span class=\"line\">  ReactContext currentContext = getCurrentReactContext();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (currentContext != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// currentContext </span></span><br><span class=\"line\">    <span class=\"comment\">// we currently don't have an onCreate callback so we call onResume for both transitions</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (force</span><br><span class=\"line\">      || mLifecycleState == LifecycleState.BEFORE_RESUME</span><br><span class=\"line\">      || mLifecycleState == LifecycleState.BEFORE_CREATE) &#123;</span><br><span class=\"line\">      currentContext.onHostResume(mCurrentActivity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  mLifecycleState = LifecycleState.RESUMED;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> LifecycleState  RESUMED  ReactContext   NativeMoudle  <code>onHostResume()</code><br> Activity  ReactInstanceManager  onHostPause  <code>moveToBeforeResumeLifecycleState()</code><br><figure class=\"highlight java\"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveToBeforeResumeLifecycleState</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ReactContext currentContext = getCurrentReactContext();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (currentContext != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.BEFORE_CREATE) &#123;</span><br><span class=\"line\">      currentContext.onHostResume(mCurrentActivity);</span><br><span class=\"line\">      currentContext.onHostPause();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.RESUMED) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// CatalystInstanceImpl  mLifecycleState  RESUMED </span></span><br><span class=\"line\">      currentContext.onHostPause();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  mLifecycleState = LifecycleState.BEFORE_RESUME;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> ReactNative <code>onPause</code> ReactInstanceManager <code>moveToBeforeResumeLifecycleState()</code>, <code>mLifecycleState</code>  <code>LifecycleState.BEFORE_RESUME</code><br><figure class=\"highlight java\"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveToBeforeResumeLifecycleState</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  ReactContext currentContext = getCurrentReactContext();</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (currentContext != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.BEFORE_CREATE) &#123;</span><br><span class=\"line\">      currentContext.onHostResume(mCurrentActivity);</span><br><span class=\"line\">      currentContext.onHostPause();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (mLifecycleState == LifecycleState.RESUMED) &#123;</span><br><span class=\"line\">      currentContext.onHostPause();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// mLifecycleState </span></span><br><span class=\"line\">  mLifecycleState = LifecycleState.BEFORE_RESUME;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>moveReactContextToCurrentLifecycleState()</code><code>mLifecycleState==LifecycleState.RESUMED</code> NativeMoudle <code>onHostResume()</code>,<code>moveToBeforeResumeLifecycleState</code>, NativeMoudle <code>onHostResume()</code></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><code>moveReactContextToCurrentLifecycleState()</code><br><figure class=\"highlight java\"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">moveReactContextToCurrentLifecycleState</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//    </span></span><br><span class=\"line\">  <span class=\"comment\">//if (mLifecycleState == LifecycleState.RESUMED) &#123;</span></span><br><span class=\"line\">    moveToResumedLifecycleState(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">  <span class=\"comment\">//&#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>  <code>moveToResumedLifecycleState()</code><code>onHostResume()</code></p>"},{"title":"ReactNative  @ReactMethod  @ReactProp ","date":"2019-10-14T07:43:46.000Z","_content":"#### \n React Native ,, A  B  ReactContextBaseJavaModule  ReactMethod ,,, ReactMethod ,,,.\n<!-- more -->\n#### \n#####  ReactMethod\n,.\n#####  ReactModuleWithSpec\n,,,:\n``` java JavaModuleWrapper.java\n@DoNotStrip\n  private void findMethods() {\n    Systrace.beginSection(TRACE_TAG_REACT_JAVA_BRIDGE, \"findMethods\");\n    Set<String> methodNames = new HashSet<>();\n\n    Class<? extends NativeModule> classForMethods = mModuleClass;\n    //\n    Class<? extends NativeModule> superClass =\n        (Class<? extends NativeModule>) mModuleClass.getSuperclass();\n    if (ReactModuleWithSpec.class.isAssignableFrom(superClass)) {\n        // ReactModuleWithSpec,\n      classForMethods = superClass;\n    }\n    // ReactModuleWithSpec,, ReactMethod ,,.\n    Method[] targetMethods = classForMethods.getDeclaredMethods();\n\n    for (Method targetMethod : targetMethods) {\n      ReactMethod annotation = targetMethod.getAnnotation(ReactMethod.class);\n      if (annotation != null) {\n        // \n      }\n    }\n    Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);\n  }\n```\n,.**, ReactMethod ,,**.\n\n#### ReactProp \n\n ReactProp ,,.,,.\n``` java ViewManagersPropertyCache.java\nstatic Map<String, PropSetter> getNativePropSettersForViewManagerClass(\n      Class<? extends ViewManager> cls) {\n    if (cls == ViewManager.class) {\n      return EMPTY_PROPS_MAP;\n    }\n    Map<String, PropSetter> props = CLASS_PROPS_CACHE.get(cls);\n    if (props != null) {\n      return props;\n    }\n    // ViewManager \n    props = new HashMap<>(\n        getNativePropSettersForViewManagerClass(\n            (Class<? extends ViewManager>) cls.getSuperclass()));\n    extractPropSettersFromViewManagerClassDefinition(cls, props);\n    CLASS_PROPS_CACHE.put(cls, props);\n    return props;\n    }\n  private static void extractPropSettersFromViewManagerClassDefinition(\n      Class<? extends ViewManager> cls,\n      Map<String, PropSetter> props) {\n    //public,protroct,private,\n    Method[] declaredMethods = cls.getDeclaredMethods();\n    //\n    }\n```\n extractPropSettersFromViewManagerClassDefinition ,** ReactProp **.\n\n,.","source":"_posts/react-natvie-manager-abstractclass.md","raw":"---\ntitle: ReactNative  @ReactMethod  @ReactProp \ndate: 2019-10-14 15:43:46\ntags:\n    - Android\n    - React Native\ncategories: \n---\n#### \n React Native ,, A  B  ReactContextBaseJavaModule  ReactMethod ,,, ReactMethod ,,,.\n<!-- more -->\n#### \n#####  ReactMethod\n,.\n#####  ReactModuleWithSpec\n,,,:\n``` java JavaModuleWrapper.java\n@DoNotStrip\n  private void findMethods() {\n    Systrace.beginSection(TRACE_TAG_REACT_JAVA_BRIDGE, \"findMethods\");\n    Set<String> methodNames = new HashSet<>();\n\n    Class<? extends NativeModule> classForMethods = mModuleClass;\n    //\n    Class<? extends NativeModule> superClass =\n        (Class<? extends NativeModule>) mModuleClass.getSuperclass();\n    if (ReactModuleWithSpec.class.isAssignableFrom(superClass)) {\n        // ReactModuleWithSpec,\n      classForMethods = superClass;\n    }\n    // ReactModuleWithSpec,, ReactMethod ,,.\n    Method[] targetMethods = classForMethods.getDeclaredMethods();\n\n    for (Method targetMethod : targetMethods) {\n      ReactMethod annotation = targetMethod.getAnnotation(ReactMethod.class);\n      if (annotation != null) {\n        // \n      }\n    }\n    Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);\n  }\n```\n,.**, ReactMethod ,,**.\n\n#### ReactProp \n\n ReactProp ,,.,,.\n``` java ViewManagersPropertyCache.java\nstatic Map<String, PropSetter> getNativePropSettersForViewManagerClass(\n      Class<? extends ViewManager> cls) {\n    if (cls == ViewManager.class) {\n      return EMPTY_PROPS_MAP;\n    }\n    Map<String, PropSetter> props = CLASS_PROPS_CACHE.get(cls);\n    if (props != null) {\n      return props;\n    }\n    // ViewManager \n    props = new HashMap<>(\n        getNativePropSettersForViewManagerClass(\n            (Class<? extends ViewManager>) cls.getSuperclass()));\n    extractPropSettersFromViewManagerClassDefinition(cls, props);\n    CLASS_PROPS_CACHE.put(cls, props);\n    return props;\n    }\n  private static void extractPropSettersFromViewManagerClassDefinition(\n      Class<? extends ViewManager> cls,\n      Map<String, PropSetter> props) {\n    //public,protroct,private,\n    Method[] declaredMethods = cls.getDeclaredMethods();\n    //\n    }\n```\n extractPropSettersFromViewManagerClassDefinition ,** ReactProp **.\n\n,.","slug":"react-natvie-manager-abstractclass","published":1,"updated":"2020-03-01T13:51:53.350Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsau0029ndf257aq9hwc","content":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> React Native ,, A  B  ReactContextBaseJavaModule  ReactMethod ,,, ReactMethod ,,,.<br><a id=\"more\"></a></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"-ReactMethod\"><a href=\"#-ReactMethod\" class=\"headerlink\" title=\" ReactMethod\"></a> ReactMethod</h5><p>,.</p>\n<h5 id=\"-ReactModuleWithSpec\"><a href=\"#-ReactModuleWithSpec\" class=\"headerlink\" title=\" ReactModuleWithSpec\"></a> ReactModuleWithSpec</h5><p>,,,:<br><figure class=\"highlight java\"><figcaption><span>JavaModuleWrapper.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@DoNotStrip</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">findMethods</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Systrace.beginSection(TRACE_TAG_REACT_JAVA_BRIDGE, <span class=\"string\">\"findMethods\"</span>);</span><br><span class=\"line\">    Set&lt;String&gt; methodNames = <span class=\"keyword\">new</span> HashSet&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    Class&lt;? extends NativeModule&gt; classForMethods = mModuleClass;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Class&lt;? extends NativeModule&gt; superClass =</span><br><span class=\"line\">        (Class&lt;? extends NativeModule&gt;) mModuleClass.getSuperclass();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ReactModuleWithSpec<span class=\"class\">.<span class=\"keyword\">class</span>.<span class=\"title\">isAssignableFrom</span>(<span class=\"title\">superClass</span>)) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ReactModuleWithSpec,</span></span><br><span class=\"line\">      classForMethods = superClass;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ReactModuleWithSpec,, ReactMethod ,,.</span></span><br><span class=\"line\">    Method[] targetMethods = classForMethods.getDeclaredMethods();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Method targetMethod : targetMethods) &#123;</span><br><span class=\"line\">      ReactMethod annotation = targetMethod.getAnnotation(ReactMethod<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (annotation != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>\n<p>,.<strong>, ReactMethod ,,</strong>.</p>\n<h4 id=\"ReactProp-\"><a href=\"#ReactProp-\" class=\"headerlink\" title=\"ReactProp \"></a>ReactProp </h4><p> ReactProp ,,.,,.<br><figure class=\"highlight java\"><figcaption><span>ViewManagersPropertyCache.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> Map&lt;String, PropSetter&gt; <span class=\"title\">getNativePropSettersForViewManagerClass</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">      Class&lt;? extends ViewManager&gt; cls)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cls == ViewManager<span class=\"class\">.<span class=\"keyword\">class</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> EMPTY_PROPS_MAP;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Map&lt;String, PropSetter&gt; props = CLASS_PROPS_CACHE.get(cls);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (props != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> props;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ViewManager </span></span><br><span class=\"line\">    props = <span class=\"keyword\">new</span> HashMap&lt;&gt;(</span><br><span class=\"line\">        getNativePropSettersForViewManagerClass(</span><br><span class=\"line\">            (Class&lt;? extends ViewManager&gt;) cls.getSuperclass()));</span><br><span class=\"line\">    extractPropSettersFromViewManagerClassDefinition(cls, props);</span><br><span class=\"line\">    CLASS_PROPS_CACHE.put(cls, props);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> props;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">extractPropSettersFromViewManagerClassDefinition</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">      Class&lt;? extends ViewManager&gt; cls,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">      Map&lt;String, PropSetter&gt; props)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//public,protroct,private,</span></span><br><span class=\"line\">    Method[] declaredMethods = cls.getDeclaredMethods();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p> extractPropSettersFromViewManagerClassDefinition ,<strong> ReactProp </strong>.</p>\n<p>,.</p>\n","site":{"data":{}},"excerpt":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> React Native ,, A  B  ReactContextBaseJavaModule  ReactMethod ,,, ReactMethod ,,,.<br>","more":"</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"-ReactMethod\"><a href=\"#-ReactMethod\" class=\"headerlink\" title=\" ReactMethod\"></a> ReactMethod</h5><p>,.</p>\n<h5 id=\"-ReactModuleWithSpec\"><a href=\"#-ReactModuleWithSpec\" class=\"headerlink\" title=\" ReactModuleWithSpec\"></a> ReactModuleWithSpec</h5><p>,,,:<br><figure class=\"highlight java\"><figcaption><span>JavaModuleWrapper.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@DoNotStrip</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">findMethods</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    Systrace.beginSection(TRACE_TAG_REACT_JAVA_BRIDGE, <span class=\"string\">\"findMethods\"</span>);</span><br><span class=\"line\">    Set&lt;String&gt; methodNames = <span class=\"keyword\">new</span> HashSet&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    Class&lt;? extends NativeModule&gt; classForMethods = mModuleClass;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    Class&lt;? extends NativeModule&gt; superClass =</span><br><span class=\"line\">        (Class&lt;? extends NativeModule&gt;) mModuleClass.getSuperclass();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ReactModuleWithSpec<span class=\"class\">.<span class=\"keyword\">class</span>.<span class=\"title\">isAssignableFrom</span>(<span class=\"title\">superClass</span>)) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// ReactModuleWithSpec,</span></span><br><span class=\"line\">      classForMethods = superClass;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ReactModuleWithSpec,, ReactMethod ,,.</span></span><br><span class=\"line\">    Method[] targetMethods = classForMethods.getDeclaredMethods();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (Method targetMethod : targetMethods) &#123;</span><br><span class=\"line\">      ReactMethod annotation = targetMethod.getAnnotation(ReactMethod<span class=\"class\">.<span class=\"keyword\">class</span>)</span>;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (annotation != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// </span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>\n<p>,.<strong>, ReactMethod ,,</strong>.</p>\n<h4 id=\"ReactProp-\"><a href=\"#ReactProp-\" class=\"headerlink\" title=\"ReactProp \"></a>ReactProp </h4><p> ReactProp ,,.,,.<br><figure class=\"highlight java\"><figcaption><span>ViewManagersPropertyCache.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> Map&lt;String, PropSetter&gt; <span class=\"title\">getNativePropSettersForViewManagerClass</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">      Class&lt;? extends ViewManager&gt; cls)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cls == ViewManager<span class=\"class\">.<span class=\"keyword\">class</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> EMPTY_PROPS_MAP;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    Map&lt;String, PropSetter&gt; props = CLASS_PROPS_CACHE.get(cls);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (props != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> props;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// ViewManager </span></span><br><span class=\"line\">    props = <span class=\"keyword\">new</span> HashMap&lt;&gt;(</span><br><span class=\"line\">        getNativePropSettersForViewManagerClass(</span><br><span class=\"line\">            (Class&lt;? extends ViewManager&gt;) cls.getSuperclass()));</span><br><span class=\"line\">    extractPropSettersFromViewManagerClassDefinition(cls, props);</span><br><span class=\"line\">    CLASS_PROPS_CACHE.put(cls, props);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> props;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">extractPropSettersFromViewManagerClassDefinition</span><span class=\"params\">(</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">      Class&lt;? extends ViewManager&gt; cls,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">      Map&lt;String, PropSetter&gt; props)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//public,protroct,private,</span></span><br><span class=\"line\">    Method[] declaredMethods = cls.getDeclaredMethods();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p> extractPropSettersFromViewManagerClassDefinition ,<strong> ReactProp </strong>.</p>\n<p>,.</p>"},{"title":" Android ()","date":"2019-08-21T12:23:16.000Z","_content":"#### \n Android `blink` ViewGroup ??.\n\n[LayoutInflater](https://developer.android.com/reference/android/view/LayoutInflater), xml  object ,,`inflate(layoutRes,parent`.\n\n,`View createViewFromTag(View parent, String name, Context context, AttributeSet attrs, boolean ignoreThemeAttr)`,,,.\n![](https://miro.medium.com/max/1400/1*4Nb8L6s0VJN5QrGO5RSgbw.png)\n`\nLet's party like it's 1995!\n`\n<!-- more -->\n,,.** ViewGroup   View **. ViewGroup ?`tag1995`?\n,`blink` ViewGroup , Android `LinearLayout``ReltaiveLayout` ViewGroup . Android ?,.\n?\n![Usage in xml layout\n](https://miro.medium.com/max/3348/1*6dHMO7KqOUsW9pXbZ7E4Cw.png)\n![Party!!!\n](https://miro.medium.com/max/1200/1*QawR47hKULpQqtwyYJUbZw.gif)\n Android Framework .,..\n\n[Romain Guy](https://medium.com/u/c967b7e51f8b?source=post_page-----e46a556d0773----------------------)  Android  Framwork `blink`.\n#### \n[](https://medium.com/@anoopss/you-thought-you-knew-android-e46a556d0773)\n[blink ](https://android.googlesource.com/platform/frameworks/base/+/9c1223a71397b565f38015c07cae57a5015a6500%5E%21)","source":"_posts/you-thought-you-knew-android.md","raw":"---\ntitle:  Android ()\ndate: 2019-08-21 20:23:16\ntags:\n    - Android\n    - \ncategories:\n    - \n---\n#### \n Android `blink` ViewGroup ??.\n\n[LayoutInflater](https://developer.android.com/reference/android/view/LayoutInflater), xml  object ,,`inflate(layoutRes,parent`.\n\n,`View createViewFromTag(View parent, String name, Context context, AttributeSet attrs, boolean ignoreThemeAttr)`,,,.\n![](https://miro.medium.com/max/1400/1*4Nb8L6s0VJN5QrGO5RSgbw.png)\n`\nLet's party like it's 1995!\n`\n<!-- more -->\n,,.** ViewGroup   View **. ViewGroup ?`tag1995`?\n,`blink` ViewGroup , Android `LinearLayout``ReltaiveLayout` ViewGroup . Android ?,.\n?\n![Usage in xml layout\n](https://miro.medium.com/max/3348/1*6dHMO7KqOUsW9pXbZ7E4Cw.png)\n![Party!!!\n](https://miro.medium.com/max/1200/1*QawR47hKULpQqtwyYJUbZw.gif)\n Android Framework .,..\n\n[Romain Guy](https://medium.com/u/c967b7e51f8b?source=post_page-----e46a556d0773----------------------)  Android  Framwork `blink`.\n#### \n[](https://medium.com/@anoopss/you-thought-you-knew-android-e46a556d0773)\n[blink ](https://android.googlesource.com/platform/frameworks/base/+/9c1223a71397b565f38015c07cae57a5015a6500%5E%21)","slug":"you-thought-you-knew-android","published":1,"updated":"2019-11-24T11:46:47.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsav002cndf2p7ygbouw","content":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Android <code>blink</code> ViewGroup ??.</p>\n<p><a href=\"https://developer.android.com/reference/android/view/LayoutInflater\" target=\"_blank\" rel=\"noopener\">LayoutInflater</a>, xml  object ,,<code>inflate(layoutRes,parent</code>.</p>\n<p>,<code>View createViewFromTag(View parent, String name, Context context, AttributeSet attrs, boolean ignoreThemeAttr)</code>,,,.<br><img src=\"https://miro.medium.com/max/1400/1*4Nb8L6s0VJN5QrGO5RSgbw.png\" alt><br><code>Let&#39;s party like it&#39;s 1995!</code><br><a id=\"more\"></a><br>,,.<strong> ViewGroup   View </strong>. ViewGroup ?<code>tag1995</code>?<br>,<code>blink</code> ViewGroup , Android <code>LinearLayout</code><code>ReltaiveLayout</code> ViewGroup . Android ?,.<br>?<br><img src=\"https://miro.medium.com/max/3348/1*6dHMO7KqOUsW9pXbZ7E4Cw.png\" alt=\"Usage in xml layout\n\"><br><img src=\"https://miro.medium.com/max/1200/1*QawR47hKULpQqtwyYJUbZw.gif\" alt=\"Party!!!\n\"><br> Android Framework .,..<br><br><a href=\"https://medium.com/u/c967b7e51f8b?source=post_page-----e46a556d0773----------------------\" target=\"_blank\" rel=\"noopener\">Romain Guy</a>  Android  Framwork <code>blink</code>.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://medium.com/@anoopss/you-thought-you-knew-android-e46a556d0773\" target=\"_blank\" rel=\"noopener\"></a><br><a href=\"https://android.googlesource.com/platform/frameworks/base/+/9c1223a71397b565f38015c07cae57a5015a6500%5E%21\" target=\"_blank\" rel=\"noopener\">blink </a></p>\n","site":{"data":{}},"excerpt":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> Android <code>blink</code> ViewGroup ??.</p>\n<p><a href=\"https://developer.android.com/reference/android/view/LayoutInflater\" target=\"_blank\" rel=\"noopener\">LayoutInflater</a>, xml  object ,,<code>inflate(layoutRes,parent</code>.</p>\n<p>,<code>View createViewFromTag(View parent, String name, Context context, AttributeSet attrs, boolean ignoreThemeAttr)</code>,,,.<br><img src=\"https://miro.medium.com/max/1400/1*4Nb8L6s0VJN5QrGO5RSgbw.png\" alt><br><code>Let&#39;s party like it&#39;s 1995!</code><br>","more":"<br>,,.<strong> ViewGroup   View </strong>. ViewGroup ?<code>tag1995</code>?<br>,<code>blink</code> ViewGroup , Android <code>LinearLayout</code><code>ReltaiveLayout</code> ViewGroup . Android ?,.<br>?<br><img src=\"https://miro.medium.com/max/3348/1*6dHMO7KqOUsW9pXbZ7E4Cw.png\" alt=\"Usage in xml layout\n\"><br><img src=\"https://miro.medium.com/max/1200/1*QawR47hKULpQqtwyYJUbZw.gif\" alt=\"Party!!!\n\"><br> Android Framework .,..<br><br><a href=\"https://medium.com/u/c967b7e51f8b?source=post_page-----e46a556d0773----------------------\" target=\"_blank\" rel=\"noopener\">Romain Guy</a>  Android  Framwork <code>blink</code>.</p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><a href=\"https://medium.com/@anoopss/you-thought-you-knew-android-e46a556d0773\" target=\"_blank\" rel=\"noopener\"></a><br><a href=\"https://android.googlesource.com/platform/frameworks/base/+/9c1223a71397b565f38015c07cae57a5015a6500%5E%21\" target=\"_blank\" rel=\"noopener\">blink </a></p>"},{"title":"Intellij Plugin ()","date":"2019-05-29T12:46:36.000Z","_content":"Intellij ,.EventBus .EventBus Plugin . EventBus,,,.\n\n###  \n .\n 1. File->New->Project  Intellij Platform Plugin \n ![](https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plguin-new.png)\n Project SDK  Intellij , SDK , Intellij  Android Stuido\n  Gradle Kotlin  Gradle  JavaKotlinIntellij Platform Plugin\n ![](https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-new2.png)\n 2. , Finish \n 3.  SandBox\n IntelliJ Plugin Run/Debug SandBox , Intellij , Project Structure  Sandbox Home .\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-sandbox.png)\n<!-- more -->\n\n###  plugin.xml\nplugin.xml  Android  AndroidMainfest.xml ,,.\n`<idea-version since-build=\"173.0\"/>`,[]( http://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/build_number_ranges.html) 2017.3 .\n`<depends>com.intellij.modules.lang</depends>`\n``` xml plugin.xml\n<extensions defaultExtensionNs=\"com.intellij\">\n        <!-- Add your extensions here -->\n        <codeInsight.lineMarkerProvider language=\"JAVA\"\n                                        implementationClass=\"com.***.eventbus.EventBusLineMarkerProvider\"/>\n</extensions>\n```\nextensions ,defaultExtensionNs  Intellij Core ,codeInsight.lineMarkerProvider ,,,,.\n,.\n\n###  LineMarkerProvider\n``` java LineMarkerProvider.java\npublic class EventBusLineMarkerProvider implements LineMarkerProvider {\n\n    // resources/icons \n    private static final Icon ICON = IconLoader.getIcon(\"/icons/icon.png\");\n    // 100 \n    private static final int MAX_USAGES = 100;\n\n    private static GutterIconNavigationHandler<PsiElement> SHOW_SENDERS =\n            (e, psiElement) -> {\n                if (psiElement instanceof PsiMethod) {\n                    Project project = psiElement.getProject();\n                    JavaPsiFacade javaPsiFacade = JavaPsiFacade.getInstance(project);\n                    // project  EventBus PsiClass\n                    PsiClass eventBusClass = javaPsiFacade.findClass(\"com.***.event.EventBus\", GlobalSearchScope.allScope(project));\n                    if (eventBusClass != null) {\n                        // EventBus  post() \n                        PsiMethod postMethod = eventBusClass.findMethodsByName(\"post\", false)[0];\n                        PsiMethod method = (PsiMethod) psiElement;\n\n                        PsiClass eventClass = ((PsiClassType) method.getParameterList().getParameters()[0].getTypeElement().getType()).resolve();\n                        ShowUsagesAction action = new ShowUsagesAction(new SenderFilter(eventClass));\n                        //,\n                        action.startFindUsages(postMethod, new RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);\n                    }\n                }\n            };\n\n    private static GutterIconNavigationHandler<PsiElement> SHOW_RECEIVERS =\n            (e, psiElement) -> {\n                if (psiElement instanceof PsiMethodCallExpression) {\n                    PsiMethodCallExpression expression = (PsiMethodCallExpression) psiElement;\n                    PsiType[] expressionTypes = expression.getArgumentList().getExpressionTypes();\n                    if (expressionTypes.length > 0) {\n                        PsiClass eventClass = PsiUtils.getClass(expressionTypes[0], psiElement);\n                        if (eventClass != null) {\n                            List<PsiElement> generatedDeclarations = new ArrayList<>();\n                            generatedDeclarations.add(PsiUtils.getClass(expressionTypes[0]));\n                            //,,\n                            // Event2 extend Event ,EventBus.post(new Event2())  Event2  Event \n                            for (PsiType superType : expressionTypes[0].getSuperTypes()) {\n                                generatedDeclarations.add(PsiUtils.getClass(superType));\n                            }\n                            new ShowUsagesAction(new ReceiverFilter()).startFindUsages(generatedDeclarations, eventClass, new RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);\n                        }\n                    }\n                }\n            };\n\n    @Nullable\n    @Override\n    public LineMarkerInfo getLineMarkerInfo(@NotNull PsiElement psiElement) {\n        if (PsiUtils.isEventBusPost(psiElement)) {\n            //\n            return new LineMarkerInfo<>(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, null, SHOW_RECEIVERS, GutterIconRenderer.Alignment.LEFT);\n        } else if (PsiUtils.isEventBusReceiver(psiElement)) {\n            //\n            return new LineMarkerInfo<>(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, null, SHOW_SENDERS, GutterIconRenderer.Alignment.LEFT);\n        }\n        return null;\n    }\n\n    @Override\n    public void collectSlowLineMarkers(@NotNull List<PsiElement> elements, @NotNull Collection<LineMarkerInfo> result) {\n\n    }\n\n}\n```\nLineMarkerProvider , getLineMarkerInfo , ICON ,icon  `16 * 16`  `32 * 32` .\nPSI (Program Structure Interface),(PSI),,., Intellij  psi , Tool->View PSI Structure of Current File .PSI ,\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-psi.png)\n[PsiElement ](http://www.jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi_elements.html).\n\n### \n,,,, GitHub ,.\n ","source":"_posts/intellij-plugin-eventbus-1.md","raw":"---\ntitle: Intellij Plugin ()\ndate: 2019-05-29 20:46:36\ntags:\n    Intellij Plugin\ncategories:\n    \n---\nIntellij ,.EventBus .EventBus Plugin . EventBus,,,.\n\n###  \n .\n 1. File->New->Project  Intellij Platform Plugin \n ![](https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plguin-new.png)\n Project SDK  Intellij , SDK , Intellij  Android Stuido\n  Gradle Kotlin  Gradle  JavaKotlinIntellij Platform Plugin\n ![](https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-new2.png)\n 2. , Finish \n 3.  SandBox\n IntelliJ Plugin Run/Debug SandBox , Intellij , Project Structure  Sandbox Home .\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-sandbox.png)\n<!-- more -->\n\n###  plugin.xml\nplugin.xml  Android  AndroidMainfest.xml ,,.\n`<idea-version since-build=\"173.0\"/>`,[]( http://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/build_number_ranges.html) 2017.3 .\n`<depends>com.intellij.modules.lang</depends>`\n``` xml plugin.xml\n<extensions defaultExtensionNs=\"com.intellij\">\n        <!-- Add your extensions here -->\n        <codeInsight.lineMarkerProvider language=\"JAVA\"\n                                        implementationClass=\"com.***.eventbus.EventBusLineMarkerProvider\"/>\n</extensions>\n```\nextensions ,defaultExtensionNs  Intellij Core ,codeInsight.lineMarkerProvider ,,,,.\n,.\n\n###  LineMarkerProvider\n``` java LineMarkerProvider.java\npublic class EventBusLineMarkerProvider implements LineMarkerProvider {\n\n    // resources/icons \n    private static final Icon ICON = IconLoader.getIcon(\"/icons/icon.png\");\n    // 100 \n    private static final int MAX_USAGES = 100;\n\n    private static GutterIconNavigationHandler<PsiElement> SHOW_SENDERS =\n            (e, psiElement) -> {\n                if (psiElement instanceof PsiMethod) {\n                    Project project = psiElement.getProject();\n                    JavaPsiFacade javaPsiFacade = JavaPsiFacade.getInstance(project);\n                    // project  EventBus PsiClass\n                    PsiClass eventBusClass = javaPsiFacade.findClass(\"com.***.event.EventBus\", GlobalSearchScope.allScope(project));\n                    if (eventBusClass != null) {\n                        // EventBus  post() \n                        PsiMethod postMethod = eventBusClass.findMethodsByName(\"post\", false)[0];\n                        PsiMethod method = (PsiMethod) psiElement;\n\n                        PsiClass eventClass = ((PsiClassType) method.getParameterList().getParameters()[0].getTypeElement().getType()).resolve();\n                        ShowUsagesAction action = new ShowUsagesAction(new SenderFilter(eventClass));\n                        //,\n                        action.startFindUsages(postMethod, new RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);\n                    }\n                }\n            };\n\n    private static GutterIconNavigationHandler<PsiElement> SHOW_RECEIVERS =\n            (e, psiElement) -> {\n                if (psiElement instanceof PsiMethodCallExpression) {\n                    PsiMethodCallExpression expression = (PsiMethodCallExpression) psiElement;\n                    PsiType[] expressionTypes = expression.getArgumentList().getExpressionTypes();\n                    if (expressionTypes.length > 0) {\n                        PsiClass eventClass = PsiUtils.getClass(expressionTypes[0], psiElement);\n                        if (eventClass != null) {\n                            List<PsiElement> generatedDeclarations = new ArrayList<>();\n                            generatedDeclarations.add(PsiUtils.getClass(expressionTypes[0]));\n                            //,,\n                            // Event2 extend Event ,EventBus.post(new Event2())  Event2  Event \n                            for (PsiType superType : expressionTypes[0].getSuperTypes()) {\n                                generatedDeclarations.add(PsiUtils.getClass(superType));\n                            }\n                            new ShowUsagesAction(new ReceiverFilter()).startFindUsages(generatedDeclarations, eventClass, new RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);\n                        }\n                    }\n                }\n            };\n\n    @Nullable\n    @Override\n    public LineMarkerInfo getLineMarkerInfo(@NotNull PsiElement psiElement) {\n        if (PsiUtils.isEventBusPost(psiElement)) {\n            //\n            return new LineMarkerInfo<>(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, null, SHOW_RECEIVERS, GutterIconRenderer.Alignment.LEFT);\n        } else if (PsiUtils.isEventBusReceiver(psiElement)) {\n            //\n            return new LineMarkerInfo<>(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, null, SHOW_SENDERS, GutterIconRenderer.Alignment.LEFT);\n        }\n        return null;\n    }\n\n    @Override\n    public void collectSlowLineMarkers(@NotNull List<PsiElement> elements, @NotNull Collection<LineMarkerInfo> result) {\n\n    }\n\n}\n```\nLineMarkerProvider , getLineMarkerInfo , ICON ,icon  `16 * 16`  `32 * 32` .\nPSI (Program Structure Interface),(PSI),,., Intellij  psi , Tool->View PSI Structure of Current File .PSI ,\n![](https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-psi.png)\n[PsiElement ](http://www.jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi_elements.html).\n\n### \n,,,, GitHub ,.\n ","slug":"intellij-plugin-eventbus-1","published":1,"updated":"2019-11-24T11:46:47.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsaw002gndf23tnmxje5","content":"<p>Intellij ,.EventBus .EventBus Plugin . EventBus,,,.</p>\n<h3 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\" \"></a> </h3><p> .</p>\n<ol>\n<li>File-&gt;New-&gt;Project  Intellij Platform Plugin <br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plguin-new.png\" alt><br>Project SDK  Intellij , SDK , Intellij  Android Stuido<br> Gradle Kotlin  Gradle  JavaKotlinIntellij Platform Plugin<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-new2.png\" alt></li>\n<li>, Finish </li>\n<li> SandBox<br>IntelliJ Plugin Run/Debug SandBox , Intellij , Project Structure  Sandbox Home .<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-sandbox.png\" alt><a id=\"more\"></a>\n</li>\n</ol>\n<h3 id=\"-plugin-xml\"><a href=\"#-plugin-xml\" class=\"headerlink\" title=\" plugin.xml\"></a> plugin.xml</h3><p>plugin.xml  Android  AndroidMainfest.xml ,,.<br><code>&lt;idea-version since-build=&quot;173.0&quot;/&gt;</code>,<a href=\"http://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/build_number_ranges.html\" target=\"_blank\" rel=\"noopener\"></a> 2017.3 .<br><code>&lt;depends&gt;com.intellij.modules.lang&lt;/depends&gt;</code><br><figure class=\"highlight xml\"><figcaption><span>plugin.xml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">extensions</span> <span class=\"attr\">defaultExtensionNs</span>=<span class=\"string\">\"com.intellij\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Add your extensions here --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">codeInsight.lineMarkerProvider</span> <span class=\"attr\">language</span>=<span class=\"string\">\"JAVA\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                                        <span class=\"attr\">implementationClass</span>=<span class=\"string\">\"com.***.eventbus.EventBusLineMarkerProvider\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">extensions</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>extensions ,defaultExtensionNs  Intellij Core ,codeInsight.lineMarkerProvider ,,,,.<br>,.</p>\n<h3 id=\"-LineMarkerProvider\"><a href=\"#-LineMarkerProvider\" class=\"headerlink\" title=\" LineMarkerProvider\"></a> LineMarkerProvider</h3><figure class=\"highlight java\"><figcaption><span>LineMarkerProvider.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventBusLineMarkerProvider</span> <span class=\"keyword\">implements</span> <span class=\"title\">LineMarkerProvider</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// resources/icons </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Icon ICON = IconLoader.getIcon(<span class=\"string\">\"/icons/icon.png\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 100 </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAX_USAGES = <span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> GutterIconNavigationHandler&lt;PsiElement&gt; SHOW_SENDERS =</span><br><span class=\"line\">            (e, psiElement) -&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (psiElement <span class=\"keyword\">instanceof</span> PsiMethod) &#123;</span><br><span class=\"line\">                    Project project = psiElement.getProject();</span><br><span class=\"line\">                    JavaPsiFacade javaPsiFacade = JavaPsiFacade.getInstance(project);</span><br><span class=\"line\">                    <span class=\"comment\">// project  EventBus PsiClass</span></span><br><span class=\"line\">                    PsiClass eventBusClass = javaPsiFacade.findClass(<span class=\"string\">\"com.***.event.EventBus\"</span>, GlobalSearchScope.allScope(project));</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (eventBusClass != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// EventBus  post() </span></span><br><span class=\"line\">                        PsiMethod postMethod = eventBusClass.findMethodsByName(<span class=\"string\">\"post\"</span>, <span class=\"keyword\">false</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">                        PsiMethod method = (PsiMethod) psiElement;</span><br><span class=\"line\"></span><br><span class=\"line\">                        PsiClass eventClass = ((PsiClassType) method.getParameterList().getParameters()[<span class=\"number\">0</span>].getTypeElement().getType()).resolve();</span><br><span class=\"line\">                        ShowUsagesAction action = <span class=\"keyword\">new</span> ShowUsagesAction(<span class=\"keyword\">new</span> SenderFilter(eventClass));</span><br><span class=\"line\">                        <span class=\"comment\">//,</span></span><br><span class=\"line\">                        action.startFindUsages(postMethod, <span class=\"keyword\">new</span> RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> GutterIconNavigationHandler&lt;PsiElement&gt; SHOW_RECEIVERS =</span><br><span class=\"line\">            (e, psiElement) -&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (psiElement <span class=\"keyword\">instanceof</span> PsiMethodCallExpression) &#123;</span><br><span class=\"line\">                    PsiMethodCallExpression expression = (PsiMethodCallExpression) psiElement;</span><br><span class=\"line\">                    PsiType[] expressionTypes = expression.getArgumentList().getExpressionTypes();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (expressionTypes.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        PsiClass eventClass = PsiUtils.getClass(expressionTypes[<span class=\"number\">0</span>], psiElement);</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (eventClass != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                            List&lt;PsiElement&gt; generatedDeclarations = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">                            generatedDeclarations.add(PsiUtils.getClass(expressionTypes[<span class=\"number\">0</span>]));</span><br><span class=\"line\">                            <span class=\"comment\">//,,</span></span><br><span class=\"line\">                            <span class=\"comment\">// Event2 extend Event ,EventBus.post(new Event2())  Event2  Event </span></span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (PsiType superType : expressionTypes[<span class=\"number\">0</span>].getSuperTypes()) &#123;</span><br><span class=\"line\">                                generatedDeclarations.add(PsiUtils.getClass(superType));</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"keyword\">new</span> ShowUsagesAction(<span class=\"keyword\">new</span> ReceiverFilter()).startFindUsages(generatedDeclarations, eventClass, <span class=\"keyword\">new</span> RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> LineMarkerInfo <span class=\"title\">getLineMarkerInfo</span><span class=\"params\">(@NotNull PsiElement psiElement)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (PsiUtils.isEventBusPost(psiElement)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> LineMarkerInfo&lt;&gt;(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, <span class=\"keyword\">null</span>, SHOW_RECEIVERS, GutterIconRenderer.Alignment.LEFT);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (PsiUtils.isEventBusReceiver(psiElement)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> LineMarkerInfo&lt;&gt;(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, <span class=\"keyword\">null</span>, SHOW_SENDERS, GutterIconRenderer.Alignment.LEFT);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">collectSlowLineMarkers</span><span class=\"params\">(@NotNull List&lt;PsiElement&gt; elements, @NotNull Collection&lt;LineMarkerInfo&gt; result)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>LineMarkerProvider , getLineMarkerInfo , ICON ,icon  <code>16 * 16</code>  <code>32 * 32</code> .<br>PSI (Program Structure Interface),(PSI),,., Intellij  psi , Tool-&gt;View PSI Structure of Current File .PSI ,<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-psi.png\" alt><br><a href=\"http://www.jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi_elements.html\" target=\"_blank\" rel=\"noopener\">PsiElement </a>.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>,,,, GitHub ,.</p>\n","site":{"data":{}},"excerpt":"<p>Intellij ,.EventBus .EventBus Plugin . EventBus,,,.</p>\n<h3 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\" \"></a> </h3><p> .</p>\n<ol>\n<li>File-&gt;New-&gt;Project  Intellij Platform Plugin <br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plguin-new.png\" alt><br>Project SDK  Intellij , SDK , Intellij  Android Stuido<br> Gradle Kotlin  Gradle  JavaKotlinIntellij Platform Plugin<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-new2.png\" alt></li>\n<li>, Finish </li>\n<li> SandBox<br>IntelliJ Plugin Run/Debug SandBox , Intellij , Project Structure  Sandbox Home .<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-sandbox.png\" alt>","more":"</li>\n</ol>\n<h3 id=\"-plugin-xml\"><a href=\"#-plugin-xml\" class=\"headerlink\" title=\" plugin.xml\"></a> plugin.xml</h3><p>plugin.xml  Android  AndroidMainfest.xml ,,.<br><code>&lt;idea-version since-build=&quot;173.0&quot;/&gt;</code>,<a href=\"http://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/build_number_ranges.html\" target=\"_blank\" rel=\"noopener\"></a> 2017.3 .<br><code>&lt;depends&gt;com.intellij.modules.lang&lt;/depends&gt;</code><br><figure class=\"highlight xml\"><figcaption><span>plugin.xml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">extensions</span> <span class=\"attr\">defaultExtensionNs</span>=<span class=\"string\">\"com.intellij\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Add your extensions here --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">codeInsight.lineMarkerProvider</span> <span class=\"attr\">language</span>=<span class=\"string\">\"JAVA\"</span></span></span><br><span class=\"line\"><span class=\"tag\">                                        <span class=\"attr\">implementationClass</span>=<span class=\"string\">\"com.***.eventbus.EventBusLineMarkerProvider\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">extensions</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>extensions ,defaultExtensionNs  Intellij Core ,codeInsight.lineMarkerProvider ,,,,.<br>,.</p>\n<h3 id=\"-LineMarkerProvider\"><a href=\"#-LineMarkerProvider\" class=\"headerlink\" title=\" LineMarkerProvider\"></a> LineMarkerProvider</h3><figure class=\"highlight java\"><figcaption><span>LineMarkerProvider.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">EventBusLineMarkerProvider</span> <span class=\"keyword\">implements</span> <span class=\"title\">LineMarkerProvider</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// resources/icons </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Icon ICON = IconLoader.getIcon(<span class=\"string\">\"/icons/icon.png\"</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 100 </span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> MAX_USAGES = <span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> GutterIconNavigationHandler&lt;PsiElement&gt; SHOW_SENDERS =</span><br><span class=\"line\">            (e, psiElement) -&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (psiElement <span class=\"keyword\">instanceof</span> PsiMethod) &#123;</span><br><span class=\"line\">                    Project project = psiElement.getProject();</span><br><span class=\"line\">                    JavaPsiFacade javaPsiFacade = JavaPsiFacade.getInstance(project);</span><br><span class=\"line\">                    <span class=\"comment\">// project  EventBus PsiClass</span></span><br><span class=\"line\">                    PsiClass eventBusClass = javaPsiFacade.findClass(<span class=\"string\">\"com.***.event.EventBus\"</span>, GlobalSearchScope.allScope(project));</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (eventBusClass != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"comment\">// EventBus  post() </span></span><br><span class=\"line\">                        PsiMethod postMethod = eventBusClass.findMethodsByName(<span class=\"string\">\"post\"</span>, <span class=\"keyword\">false</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">                        PsiMethod method = (PsiMethod) psiElement;</span><br><span class=\"line\"></span><br><span class=\"line\">                        PsiClass eventClass = ((PsiClassType) method.getParameterList().getParameters()[<span class=\"number\">0</span>].getTypeElement().getType()).resolve();</span><br><span class=\"line\">                        ShowUsagesAction action = <span class=\"keyword\">new</span> ShowUsagesAction(<span class=\"keyword\">new</span> SenderFilter(eventClass));</span><br><span class=\"line\">                        <span class=\"comment\">//,</span></span><br><span class=\"line\">                        action.startFindUsages(postMethod, <span class=\"keyword\">new</span> RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> GutterIconNavigationHandler&lt;PsiElement&gt; SHOW_RECEIVERS =</span><br><span class=\"line\">            (e, psiElement) -&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (psiElement <span class=\"keyword\">instanceof</span> PsiMethodCallExpression) &#123;</span><br><span class=\"line\">                    PsiMethodCallExpression expression = (PsiMethodCallExpression) psiElement;</span><br><span class=\"line\">                    PsiType[] expressionTypes = expression.getArgumentList().getExpressionTypes();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (expressionTypes.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        PsiClass eventClass = PsiUtils.getClass(expressionTypes[<span class=\"number\">0</span>], psiElement);</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (eventClass != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                            List&lt;PsiElement&gt; generatedDeclarations = <span class=\"keyword\">new</span> ArrayList&lt;&gt;();</span><br><span class=\"line\">                            generatedDeclarations.add(PsiUtils.getClass(expressionTypes[<span class=\"number\">0</span>]));</span><br><span class=\"line\">                            <span class=\"comment\">//,,</span></span><br><span class=\"line\">                            <span class=\"comment\">// Event2 extend Event ,EventBus.post(new Event2())  Event2  Event </span></span><br><span class=\"line\">                            <span class=\"keyword\">for</span> (PsiType superType : expressionTypes[<span class=\"number\">0</span>].getSuperTypes()) &#123;</span><br><span class=\"line\">                                generatedDeclarations.add(PsiUtils.getClass(superType));</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                            <span class=\"keyword\">new</span> ShowUsagesAction(<span class=\"keyword\">new</span> ReceiverFilter()).startFindUsages(generatedDeclarations, eventClass, <span class=\"keyword\">new</span> RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Nullable</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> LineMarkerInfo <span class=\"title\">getLineMarkerInfo</span><span class=\"params\">(@NotNull PsiElement psiElement)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (PsiUtils.isEventBusPost(psiElement)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> LineMarkerInfo&lt;&gt;(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, <span class=\"keyword\">null</span>, SHOW_RECEIVERS, GutterIconRenderer.Alignment.LEFT);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (PsiUtils.isEventBusReceiver(psiElement)) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> LineMarkerInfo&lt;&gt;(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, <span class=\"keyword\">null</span>, SHOW_SENDERS, GutterIconRenderer.Alignment.LEFT);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">collectSlowLineMarkers</span><span class=\"params\">(@NotNull List&lt;PsiElement&gt; elements, @NotNull Collection&lt;LineMarkerInfo&gt; result)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>LineMarkerProvider , getLineMarkerInfo , ICON ,icon  <code>16 * 16</code>  <code>32 * 32</code> .<br>PSI (Program Structure Interface),(PSI),,., Intellij  psi , Tool-&gt;View PSI Structure of Current File .PSI ,<br><img src=\"https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-psi.png\" alt><br><a href=\"http://www.jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi_elements.html\" target=\"_blank\" rel=\"noopener\">PsiElement </a>.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>,,,, GitHub ,.</p>"},{"title":"Intellij Plugin ()","date":"2019-07-10T14:17:55.000Z","_content":", EventBus .\n Java GUI ,,,.\n### \n EventBus ,`XXX.send(new NotifyEvent())`(XXX ), Event , Sender .\n``` java XXXX.java\n    public static void notify(){\n        send(new NotifyEvent());\n    }\n    static void send(Object eventModel) {\n          Smart.getEventBus().post(eventModel);\n      }\n```\n<!-- more -->\n#### \n java , getLineMarkerInfo (,, PsiElement), PsiElement . EventBus .\n``` java PsiUtil.java\n   public static boolean isEventBusPost(PsiElement psiElement) {\n        // psiElement ()\n        if (psiElement instanceof PsiCallExpression) {\n            PsiCallExpression callExpression = (PsiCallExpression) psiElement;\n            PsiMethod method = callExpression.resolveMethod();\n            if (method != null) {\n                String name = method.getName();\n                PsiElement parent = method.getParent();\n                //  Smart.getEventBus().post()  XXXX.send() \n                if (\"post\".equals(name) && parent instanceof PsiClass) {\n                    PsiClass implClass = (PsiClass) parent;\n                    return isEventBusClass(implClass) || isSuperClassEventBus(implClass);\n                } else if (\"send\".equals(name) && parent instanceof PsiClass) {\n                    PsiClass implClass = (PsiClass) parent;\n                    return isEventSenderClass(implClass) || isSuperClassEventSender(implClass);\n                }\n            }\n        }\n        return false;\n    }\n\n    //\n    private static boolean isEventBusClass(PsiClass psiClass) {\n        return \"SmartEventBus\".equals(psiClass.getName());\n    }\n\n    //\n    private static boolean isSuperClassEventBus(PsiClass psiClass) {\n        PsiClass[] supers = psiClass.getSupers();\n        if (supers.length == 0) {\n            return false;\n        }\n        for (PsiClass superClass : supers) {\n            if (\"SmartEventBus\".equals(superClass.getName())) {\n                return true;\n            }\n        }\n        return false;\n    }\n```\n#### \n\n``` java\n    public static boolean isEventBusReceiver(PsiElement psiElement) {\n        if (psiElement instanceof PsiMethod) {\n            PsiMethod method = (PsiMethod) psiElement;\n            String name = method.getName();\n            // EventBus 2.0  onEvent  onEventMainThread , PsiClassType ,\n            return (\"onEvent\".equals(name) || \"onEventMainThread\".equals(name)) && method.getParameterList().getParametersCount() == 1 && method.getParameterList().getParameters()[0].getType() instanceof PsiClassType;\n        }\n        return false;\n    }\n```\n,.\n### \n`ShowUsagesAction``AnAction` icon `ShowUsagesAction.actionPerformed()`,, intellij .,[ShowUsagesAction](https://github.com/kgmyshin/eventbus-intellij-plugin/blob/master/src/com/kgmyshin/ideaplugin/eventbus/ShowUsagesAction.java).,.\n\n### \n[IntelliJ Platform SDK](http://www.jetbrains.org/intellij/sdk/docs/welcome.html)\n[eventbus-intellij-plugin](https://github.com/kgmyshin/eventbus-intellij-plugin)\n\n","source":"_posts/intellij-plugin-eventbus-2.md","raw":"---\ntitle: Intellij Plugin ()\ndate: 2019-07-10 22:17:55\ntags:\n    Intellij Plugin\ncategories:\n    \n---\n, EventBus .\n Java GUI ,,,.\n### \n EventBus ,`XXX.send(new NotifyEvent())`(XXX ), Event , Sender .\n``` java XXXX.java\n    public static void notify(){\n        send(new NotifyEvent());\n    }\n    static void send(Object eventModel) {\n          Smart.getEventBus().post(eventModel);\n      }\n```\n<!-- more -->\n#### \n java , getLineMarkerInfo (,, PsiElement), PsiElement . EventBus .\n``` java PsiUtil.java\n   public static boolean isEventBusPost(PsiElement psiElement) {\n        // psiElement ()\n        if (psiElement instanceof PsiCallExpression) {\n            PsiCallExpression callExpression = (PsiCallExpression) psiElement;\n            PsiMethod method = callExpression.resolveMethod();\n            if (method != null) {\n                String name = method.getName();\n                PsiElement parent = method.getParent();\n                //  Smart.getEventBus().post()  XXXX.send() \n                if (\"post\".equals(name) && parent instanceof PsiClass) {\n                    PsiClass implClass = (PsiClass) parent;\n                    return isEventBusClass(implClass) || isSuperClassEventBus(implClass);\n                } else if (\"send\".equals(name) && parent instanceof PsiClass) {\n                    PsiClass implClass = (PsiClass) parent;\n                    return isEventSenderClass(implClass) || isSuperClassEventSender(implClass);\n                }\n            }\n        }\n        return false;\n    }\n\n    //\n    private static boolean isEventBusClass(PsiClass psiClass) {\n        return \"SmartEventBus\".equals(psiClass.getName());\n    }\n\n    //\n    private static boolean isSuperClassEventBus(PsiClass psiClass) {\n        PsiClass[] supers = psiClass.getSupers();\n        if (supers.length == 0) {\n            return false;\n        }\n        for (PsiClass superClass : supers) {\n            if (\"SmartEventBus\".equals(superClass.getName())) {\n                return true;\n            }\n        }\n        return false;\n    }\n```\n#### \n\n``` java\n    public static boolean isEventBusReceiver(PsiElement psiElement) {\n        if (psiElement instanceof PsiMethod) {\n            PsiMethod method = (PsiMethod) psiElement;\n            String name = method.getName();\n            // EventBus 2.0  onEvent  onEventMainThread , PsiClassType ,\n            return (\"onEvent\".equals(name) || \"onEventMainThread\".equals(name)) && method.getParameterList().getParametersCount() == 1 && method.getParameterList().getParameters()[0].getType() instanceof PsiClassType;\n        }\n        return false;\n    }\n```\n,.\n### \n`ShowUsagesAction``AnAction` icon `ShowUsagesAction.actionPerformed()`,, intellij .,[ShowUsagesAction](https://github.com/kgmyshin/eventbus-intellij-plugin/blob/master/src/com/kgmyshin/ideaplugin/eventbus/ShowUsagesAction.java).,.\n\n### \n[IntelliJ Platform SDK](http://www.jetbrains.org/intellij/sdk/docs/welcome.html)\n[eventbus-intellij-plugin](https://github.com/kgmyshin/eventbus-intellij-plugin)\n\n","slug":"intellij-plugin-eventbus-2","published":1,"updated":"2019-11-24T11:46:47.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsax002jndf28nydn1ud","content":"<p>, EventBus .<br> Java GUI ,,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> EventBus ,<code>XXX.send(new NotifyEvent())</code>(XXX ), Event , Sender .<br><figure class=\"highlight java\"><figcaption><span>XXXX.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    send(<span class=\"keyword\">new</span> NotifyEvent());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">send</span><span class=\"params\">(Object eventModel)</span> </span>&#123;</span><br><span class=\"line\">      Smart.getEventBus().post(eventModel);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>\n<a id=\"more\"></a>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> java , getLineMarkerInfo (,, PsiElement), PsiElement . EventBus .<br><figure class=\"highlight java\"><figcaption><span>PsiUtil.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isEventBusPost</span><span class=\"params\">(PsiElement psiElement)</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"comment\">// psiElement ()</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (psiElement <span class=\"keyword\">instanceof</span> PsiCallExpression) &#123;</span><br><span class=\"line\">         PsiCallExpression callExpression = (PsiCallExpression) psiElement;</span><br><span class=\"line\">         PsiMethod method = callExpression.resolveMethod();</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (method != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">             String name = method.getName();</span><br><span class=\"line\">             PsiElement parent = method.getParent();</span><br><span class=\"line\">             <span class=\"comment\">//  Smart.getEventBus().post()  XXXX.send() </span></span><br><span class=\"line\">             <span class=\"keyword\">if</span> (<span class=\"string\">\"post\"</span>.equals(name) &amp;&amp; parent <span class=\"keyword\">instanceof</span> PsiClass) &#123;</span><br><span class=\"line\">                 PsiClass implClass = (PsiClass) parent;</span><br><span class=\"line\">                 <span class=\"keyword\">return</span> isEventBusClass(implClass) || isSuperClassEventBus(implClass);</span><br><span class=\"line\">             &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"string\">\"send\"</span>.equals(name) &amp;&amp; parent <span class=\"keyword\">instanceof</span> PsiClass) &#123;</span><br><span class=\"line\">                 PsiClass implClass = (PsiClass) parent;</span><br><span class=\"line\">                 <span class=\"keyword\">return</span> isEventSenderClass(implClass) || isSuperClassEventSender(implClass);</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isEventBusClass</span><span class=\"params\">(PsiClass psiClass)</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"string\">\"SmartEventBus\"</span>.equals(psiClass.getName());</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isSuperClassEventBus</span><span class=\"params\">(PsiClass psiClass)</span> </span>&#123;</span><br><span class=\"line\">     PsiClass[] supers = psiClass.getSupers();</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (supers.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">for</span> (PsiClass superClass : supers) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (<span class=\"string\">\"SmartEventBus\"</span>.equals(superClass.getName())) &#123;</span><br><span class=\"line\">             <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isEventBusReceiver</span><span class=\"params\">(PsiElement psiElement)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (psiElement <span class=\"keyword\">instanceof</span> PsiMethod) &#123;</span><br><span class=\"line\">        PsiMethod method = (PsiMethod) psiElement;</span><br><span class=\"line\">        String name = method.getName();</span><br><span class=\"line\">        <span class=\"comment\">// EventBus 2.0  onEvent  onEventMainThread , PsiClassType ,</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"string\">\"onEvent\"</span>.equals(name) || <span class=\"string\">\"onEventMainThread\"</span>.equals(name)) &amp;&amp; method.getParameterList().getParametersCount() == <span class=\"number\">1</span> &amp;&amp; method.getParameterList().getParameters()[<span class=\"number\">0</span>].getType() <span class=\"keyword\">instanceof</span> PsiClassType;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>ShowUsagesAction</code><code>AnAction</code> icon <code>ShowUsagesAction.actionPerformed()</code>,, intellij .,<a href=\"https://github.com/kgmyshin/eventbus-intellij-plugin/blob/master/src/com/kgmyshin/ideaplugin/eventbus/ShowUsagesAction.java\">ShowUsagesAction</a>.,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://www.jetbrains.org/intellij/sdk/docs/welcome.html\" target=\"_blank\" rel=\"noopener\">IntelliJ Platform SDK</a><br><a href=\"https://github.com/kgmyshin/eventbus-intellij-plugin\">eventbus-intellij-plugin</a></p>\n","site":{"data":{}},"excerpt":"<p>, EventBus .<br> Java GUI ,,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> EventBus ,<code>XXX.send(new NotifyEvent())</code>(XXX ), Event , Sender .<br><figure class=\"highlight java\"><figcaption><span>XXXX.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    send(<span class=\"keyword\">new</span> NotifyEvent());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">send</span><span class=\"params\">(Object eventModel)</span> </span>&#123;</span><br><span class=\"line\">      Smart.getEventBus().post(eventModel);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p> java , getLineMarkerInfo (,, PsiElement), PsiElement . EventBus .<br><figure class=\"highlight java\"><figcaption><span>PsiUtil.java</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isEventBusPost</span><span class=\"params\">(PsiElement psiElement)</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"comment\">// psiElement ()</span></span><br><span class=\"line\">     <span class=\"keyword\">if</span> (psiElement <span class=\"keyword\">instanceof</span> PsiCallExpression) &#123;</span><br><span class=\"line\">         PsiCallExpression callExpression = (PsiCallExpression) psiElement;</span><br><span class=\"line\">         PsiMethod method = callExpression.resolveMethod();</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (method != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">             String name = method.getName();</span><br><span class=\"line\">             PsiElement parent = method.getParent();</span><br><span class=\"line\">             <span class=\"comment\">//  Smart.getEventBus().post()  XXXX.send() </span></span><br><span class=\"line\">             <span class=\"keyword\">if</span> (<span class=\"string\">\"post\"</span>.equals(name) &amp;&amp; parent <span class=\"keyword\">instanceof</span> PsiClass) &#123;</span><br><span class=\"line\">                 PsiClass implClass = (PsiClass) parent;</span><br><span class=\"line\">                 <span class=\"keyword\">return</span> isEventBusClass(implClass) || isSuperClassEventBus(implClass);</span><br><span class=\"line\">             &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"string\">\"send\"</span>.equals(name) &amp;&amp; parent <span class=\"keyword\">instanceof</span> PsiClass) &#123;</span><br><span class=\"line\">                 PsiClass implClass = (PsiClass) parent;</span><br><span class=\"line\">                 <span class=\"keyword\">return</span> isEventSenderClass(implClass) || isSuperClassEventSender(implClass);</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isEventBusClass</span><span class=\"params\">(PsiClass psiClass)</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"string\">\"SmartEventBus\"</span>.equals(psiClass.getName());</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">//</span></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isSuperClassEventBus</span><span class=\"params\">(PsiClass psiClass)</span> </span>&#123;</span><br><span class=\"line\">     PsiClass[] supers = psiClass.getSupers();</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (supers.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">for</span> (PsiClass superClass : supers) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (<span class=\"string\">\"SmartEventBus\"</span>.equals(superClass.getName())) &#123;</span><br><span class=\"line\">             <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isEventBusReceiver</span><span class=\"params\">(PsiElement psiElement)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (psiElement <span class=\"keyword\">instanceof</span> PsiMethod) &#123;</span><br><span class=\"line\">        PsiMethod method = (PsiMethod) psiElement;</span><br><span class=\"line\">        String name = method.getName();</span><br><span class=\"line\">        <span class=\"comment\">// EventBus 2.0  onEvent  onEventMainThread , PsiClassType ,</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"string\">\"onEvent\"</span>.equals(name) || <span class=\"string\">\"onEventMainThread\"</span>.equals(name)) &amp;&amp; method.getParameterList().getParametersCount() == <span class=\"number\">1</span> &amp;&amp; method.getParameterList().getParameters()[<span class=\"number\">0</span>].getType() <span class=\"keyword\">instanceof</span> PsiClassType;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>ShowUsagesAction</code><code>AnAction</code> icon <code>ShowUsagesAction.actionPerformed()</code>,, intellij .,<a href=\"https://github.com/kgmyshin/eventbus-intellij-plugin/blob/master/src/com/kgmyshin/ideaplugin/eventbus/ShowUsagesAction.java\">ShowUsagesAction</a>.,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><a href=\"http://www.jetbrains.org/intellij/sdk/docs/welcome.html\" target=\"_blank\" rel=\"noopener\">IntelliJ Platform SDK</a><br><a href=\"https://github.com/kgmyshin/eventbus-intellij-plugin\">eventbus-intellij-plugin</a></p>"},{"title":"","date":"2019-02-21T07:34:41.000Z","_content":" DownloadManger , api ,.\n<!-- more -->\n## \n### 6.0\n\n\n``` java\n        //downloadId  DownloadManager  id\n        Uri uri = downloadManager.getUriForDownloadedFile(downloadId);\n        Intent intent = new Intent(Intent.ACTION_VIEW);\n        intent.setDataAndType(uri, \"application/vnd.android.package-archive\");\n        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n        intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);\n        mContext.startActivity(intent);\n```\n### 6.0\n\n&#123;% note info %&#125;  &#123;% endnote %&#125;\n,\n&#123;% note danger %&#125; \nCaused by: android.content.ActivityNotFoundException: No Activity found to handle Intent { act=android.intent.action.VIEW dat=content: typ=application/vnd.android.package-archive flg=0x10000000 } \n&#123;% endnote %&#125;\n 6.0  `downloadManager.getUriForDownloadedFile(downloadId)`  uri  content://downloads/my_downloads/109 ,*,** 6.0**, 6.0 \n``` java\n if (Build.VERSION_CODES.M == Build.VERSION.SDK_INT) {\n            DownloadManager dManager = (DownloadManager) mContext.getSystemService(Context.DOWNLOAD_SERVICE);\n            DownloadManager.Query query = new DownloadManager.Query().setFilterById(downloadId);\n            Cursor c = null;\n            if (dManager != null) {\n                c = dManager.query(query);\n            }\n            if (c != null) {\n                if (c.moveToFirst()) {\n                    int columnIndex = c.getColumnIndex(DownloadManager.COLUMN_STATUS);\n                    if (DownloadManager.STATUS_SUCCESSFUL == c.getInt(columnIndex)) {\n                        String downloadFileUrl = c.getString(c.getColumnIndex(DownloadManager.COLUMN_LOCAL_URI));\n                        // apk \n                        installAPK(Uri.parse(downloadFileUrl));\n                    }\n                }\n                c.close();\n            }\n        } else {\n            Uri downloadFileUri = downloadManager.getUriForDownloadedFile(downloadId);\n            installAPK(downloadFileUri);\n }\n```\n apk \n\n### 7.0\n\n&#123;% note info %&#125; \n Android 7.0 ,Android  StrictMode API  file:// URI URI  intent  FileUriExposedException  \n&#123;% endnote %&#125;\n  [ Android 7.0  FileProvider ](http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/)\n\n### 8.0\n\n  AndroidManifest.xml \n``` xml\n    <uses-permission android:name=\"android.permission.REQUEST_INSTALL_PACKAGES\"/>\n```\n RuntimeExcetption\n GitHub , Android 8.0 Oreo ,Google , Play Store  Android ,, 8.1  9.0 . ,, issues \n[](https://github.com/yjfnypeu/UpdatePlugin/issues/51)\n\n## \n[ Android 7.0  FileProvider ](http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/)\n[](https://github.com/yjfnypeu/UpdatePlugin/issues/51)","source":"_posts/install_apk_refer.md","raw":"---\ntitle: \ndate: 2019-02-21 15:34:41\ntags:\n    - Android\n    - \ncategories: \n    - \n---\n DownloadManger , api ,.\n<!-- more -->\n## \n### 6.0\n\n\n``` java\n        //downloadId  DownloadManager  id\n        Uri uri = downloadManager.getUriForDownloadedFile(downloadId);\n        Intent intent = new Intent(Intent.ACTION_VIEW);\n        intent.setDataAndType(uri, \"application/vnd.android.package-archive\");\n        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n        intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);\n        mContext.startActivity(intent);\n```\n### 6.0\n\n&#123;% note info %&#125;  &#123;% endnote %&#125;\n,\n&#123;% note danger %&#125; \nCaused by: android.content.ActivityNotFoundException: No Activity found to handle Intent { act=android.intent.action.VIEW dat=content: typ=application/vnd.android.package-archive flg=0x10000000 } \n&#123;% endnote %&#125;\n 6.0  `downloadManager.getUriForDownloadedFile(downloadId)`  uri  content://downloads/my_downloads/109 ,*,** 6.0**, 6.0 \n``` java\n if (Build.VERSION_CODES.M == Build.VERSION.SDK_INT) {\n            DownloadManager dManager = (DownloadManager) mContext.getSystemService(Context.DOWNLOAD_SERVICE);\n            DownloadManager.Query query = new DownloadManager.Query().setFilterById(downloadId);\n            Cursor c = null;\n            if (dManager != null) {\n                c = dManager.query(query);\n            }\n            if (c != null) {\n                if (c.moveToFirst()) {\n                    int columnIndex = c.getColumnIndex(DownloadManager.COLUMN_STATUS);\n                    if (DownloadManager.STATUS_SUCCESSFUL == c.getInt(columnIndex)) {\n                        String downloadFileUrl = c.getString(c.getColumnIndex(DownloadManager.COLUMN_LOCAL_URI));\n                        // apk \n                        installAPK(Uri.parse(downloadFileUrl));\n                    }\n                }\n                c.close();\n            }\n        } else {\n            Uri downloadFileUri = downloadManager.getUriForDownloadedFile(downloadId);\n            installAPK(downloadFileUri);\n }\n```\n apk \n\n### 7.0\n\n&#123;% note info %&#125; \n Android 7.0 ,Android  StrictMode API  file:// URI URI  intent  FileUriExposedException  \n&#123;% endnote %&#125;\n  [ Android 7.0  FileProvider ](http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/)\n\n### 8.0\n\n  AndroidManifest.xml \n``` xml\n    <uses-permission android:name=\"android.permission.REQUEST_INSTALL_PACKAGES\"/>\n```\n RuntimeExcetption\n GitHub , Android 8.0 Oreo ,Google , Play Store  Android ,, 8.1  9.0 . ,, issues \n[](https://github.com/yjfnypeu/UpdatePlugin/issues/51)\n\n## \n[ Android 7.0  FileProvider ](http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/)\n[](https://github.com/yjfnypeu/UpdatePlugin/issues/51)","slug":"install_apk_refer","published":1,"updated":"2020-06-18T12:46:49.168Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckbksjsay002mndf2nbd0j7dp","content":"<p> DownloadManger , api ,.<br><a id=\"more\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"6-0\"><a href=\"#6-0\" class=\"headerlink\" title=\"6.0\"></a>6.0</h3><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//downloadId  DownloadManager  id</span></span><br><span class=\"line\">Uri uri = downloadManager.getUriForDownloadedFile(downloadId);</span><br><span class=\"line\">Intent intent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class=\"line\">intent.setDataAndType(uri, <span class=\"string\">\"application/vnd.android.package-archive\"</span>);</span><br><span class=\"line\">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class=\"line\">intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class=\"line\">mContext.startActivity(intent);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"6-0\"><a href=\"#6-0\" class=\"headerlink\" title=\"6.0\"></a>6.0</h3><p>&#123;% note info %&#125;  &#123;% endnote %&#125;<br>,<br>&#123;% note danger %&#125;<br>Caused by: android.content.ActivityNotFoundException: No Activity found to handle Intent { act=android.intent.action.VIEW dat=content: typ=application/vnd.android.package-archive flg=0x10000000 }<br>&#123;% endnote %&#125;<br> 6.0  <code>downloadManager.getUriForDownloadedFile(downloadId)</code>  uri  content://downloads/my_downloads/109 ,*,<strong> 6.0</strong>, 6.0 <br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (Build.VERSION_CODES.M == Build.VERSION.SDK_INT) &#123;</span><br><span class=\"line\">           DownloadManager dManager = (DownloadManager) mContext.getSystemService(Context.DOWNLOAD_SERVICE);</span><br><span class=\"line\">           DownloadManager.Query query = <span class=\"keyword\">new</span> DownloadManager.Query().setFilterById(downloadId);</span><br><span class=\"line\">           Cursor c = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (dManager != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">               c = dManager.query(query);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (c.moveToFirst()) &#123;</span><br><span class=\"line\">                   <span class=\"keyword\">int</span> columnIndex = c.getColumnIndex(DownloadManager.COLUMN_STATUS);</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (DownloadManager.STATUS_SUCCESSFUL == c.getInt(columnIndex)) &#123;</span><br><span class=\"line\">                       String downloadFileUrl = c.getString(c.getColumnIndex(DownloadManager.COLUMN_LOCAL_URI));</span><br><span class=\"line\">                       <span class=\"comment\">// apk </span></span><br><span class=\"line\">                       installAPK(Uri.parse(downloadFileUrl));</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               c.close();</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">           Uri downloadFileUri = downloadManager.getUriForDownloadedFile(downloadId);</span><br><span class=\"line\">           installAPK(downloadFileUri);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> apk </p>\n<h3 id=\"7-0\"><a href=\"#7-0\" class=\"headerlink\" title=\"7.0\"></a>7.0</h3><p>&#123;% note info %&#125;<br> Android 7.0 ,Android  StrictMode API  file:// URI URI  intent  FileUriExposedException <br>&#123;% endnote %&#125;<br>  <a href=\"http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/\" target=\"_blank\" rel=\"noopener\"> Android 7.0  FileProvider </a></p>\n<h3 id=\"8-0\"><a href=\"#8-0\" class=\"headerlink\" title=\"8.0\"></a>8.0</h3><p>  AndroidManifest.xml <br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.REQUEST_INSTALL_PACKAGES\"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p> RuntimeExcetption<br> GitHub , Android 8.0 Oreo ,Google , Play Store  Android ,, 8.1  9.0 . ,, issues <br><a href=\"https://github.com/yjfnypeu/UpdatePlugin/issues/51\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/\" target=\"_blank\" rel=\"noopener\"> Android 7.0  FileProvider </a><br><a href=\"https://github.com/yjfnypeu/UpdatePlugin/issues/51\"></a></p>\n","site":{"data":{}},"excerpt":"<p> DownloadManger , api ,.<br>","more":"</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"6-0\"><a href=\"#6-0\" class=\"headerlink\" title=\"6.0\"></a>6.0</h3><p><br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//downloadId  DownloadManager  id</span></span><br><span class=\"line\">Uri uri = downloadManager.getUriForDownloadedFile(downloadId);</span><br><span class=\"line\">Intent intent = <span class=\"keyword\">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class=\"line\">intent.setDataAndType(uri, <span class=\"string\">\"application/vnd.android.package-archive\"</span>);</span><br><span class=\"line\">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class=\"line\">intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class=\"line\">mContext.startActivity(intent);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"6-0\"><a href=\"#6-0\" class=\"headerlink\" title=\"6.0\"></a>6.0</h3><p>&#123;% note info %&#125;  &#123;% endnote %&#125;<br>,<br>&#123;% note danger %&#125;<br>Caused by: android.content.ActivityNotFoundException: No Activity found to handle Intent { act=android.intent.action.VIEW dat=content: typ=application/vnd.android.package-archive flg=0x10000000 }<br>&#123;% endnote %&#125;<br> 6.0  <code>downloadManager.getUriForDownloadedFile(downloadId)</code>  uri  content://downloads/my_downloads/109 ,*,<strong> 6.0</strong>, 6.0 <br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (Build.VERSION_CODES.M == Build.VERSION.SDK_INT) &#123;</span><br><span class=\"line\">           DownloadManager dManager = (DownloadManager) mContext.getSystemService(Context.DOWNLOAD_SERVICE);</span><br><span class=\"line\">           DownloadManager.Query query = <span class=\"keyword\">new</span> DownloadManager.Query().setFilterById(downloadId);</span><br><span class=\"line\">           Cursor c = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (dManager != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">               c = dManager.query(query);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (c.moveToFirst()) &#123;</span><br><span class=\"line\">                   <span class=\"keyword\">int</span> columnIndex = c.getColumnIndex(DownloadManager.COLUMN_STATUS);</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (DownloadManager.STATUS_SUCCESSFUL == c.getInt(columnIndex)) &#123;</span><br><span class=\"line\">                       String downloadFileUrl = c.getString(c.getColumnIndex(DownloadManager.COLUMN_LOCAL_URI));</span><br><span class=\"line\">                       <span class=\"comment\">// apk </span></span><br><span class=\"line\">                       installAPK(Uri.parse(downloadFileUrl));</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               c.close();</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">           Uri downloadFileUri = downloadManager.getUriForDownloadedFile(downloadId);</span><br><span class=\"line\">           installAPK(downloadFileUri);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p> apk </p>\n<h3 id=\"7-0\"><a href=\"#7-0\" class=\"headerlink\" title=\"7.0\"></a>7.0</h3><p>&#123;% note info %&#125;<br> Android 7.0 ,Android  StrictMode API  file:// URI URI  intent  FileUriExposedException <br>&#123;% endnote %&#125;<br>  <a href=\"http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/\" target=\"_blank\" rel=\"noopener\"> Android 7.0  FileProvider </a></p>\n<h3 id=\"8-0\"><a href=\"#8-0\" class=\"headerlink\" title=\"8.0\"></a>8.0</h3><p>  AndroidManifest.xml <br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">uses-permission</span> <span class=\"attr\">android:name</span>=<span class=\"string\">\"android.permission.REQUEST_INSTALL_PACKAGES\"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p> RuntimeExcetption<br> GitHub , Android 8.0 Oreo ,Google , Play Store  Android ,, 8.1  9.0 . ,, issues <br><a href=\"https://github.com/yjfnypeu/UpdatePlugin/issues/51\"></a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/\" target=\"_blank\" rel=\"noopener\"> Android 7.0  FileProvider </a><br><a href=\"https://github.com/yjfnypeu/UpdatePlugin/issues/51\"></a></p>"}],"PostAsset":[],"PostCategory":[{"post_id":"ckbksjs9v0007ndf20e8tt1or","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsa0000endf2a848gg4u"},{"post_id":"ckbksjs9l0000ndf2o4m87nkj","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsa4000jndf2qd05f326"},{"post_id":"ckbksjs9w0008ndf2rmeodug0","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsa5000mndf2guvdrgjq"},{"post_id":"ckbksjs9y000cndf2vixjouex","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsa6000qndf2swb5mc5v"},{"post_id":"ckbksjs9q0002ndf2o47zrqvk","category_id":"ckbksjs9x0009ndf2ldnidv5i","_id":"ckbksjsa8000tndf2bgyy17yf"},{"post_id":"ckbksjsa0000dndf2ta0ut7fe","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsa9000wndf2l2t276fy"},{"post_id":"ckbksjsa2000indf2vwwu96v5","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsaa000zndf28xfz0isu"},{"post_id":"ckbksjs9u0006ndf2qcmc1qzx","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsac0013ndf2vg717tie"},{"post_id":"ckbksjsa6000pndf2c18pcknr","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsad0016ndf2pe3tx16p"},{"post_id":"ckbksjsa7000sndf2gzbum208","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsaf001andf2809ee179"},{"post_id":"ckbksjsa9000vndf2b8krzj3t","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsag001dndf2452gn5vl"},{"post_id":"ckbksjsa5000lndf2zyenemr7","category_id":"ckbksjsa7000rndf24s38vv5r","_id":"ckbksjsai001hndf2o1phsadx"},{"post_id":"ckbksjsaa000yndf2dx9wc2mm","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsak001kndf2xn12pr2n"},{"post_id":"ckbksjsab0012ndf2metvv6s4","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsam001nndf2i6ruh6mk"},{"post_id":"ckbksjsac0015ndf2wkhzn62k","category_id":"ckbksjsa7000rndf24s38vv5r","_id":"ckbksjsan001qndf2kvgx068u"},{"post_id":"ckbksjsae0019ndf2y2xn03qq","category_id":"ckbksjs9x0009ndf2ldnidv5i","_id":"ckbksjsap001sndf2tug6fytu"},{"post_id":"ckbksjsag001cndf2lyjm9ych","category_id":"ckbksjs9x0009ndf2ldnidv5i","_id":"ckbksjsaq001vndf20m864445"},{"post_id":"ckbksjsah001gndf21pb04o2o","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsar001yndf2qsvua3sw"},{"post_id":"ckbksjsaj001jndf2vi8q4ra5","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsas0022ndf239lho8bx"},{"post_id":"ckbksjsal001mndf23xg65emp","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsat0024ndf2vpqsqy95"},{"post_id":"ckbksjsam001pndf2rbjn5m9k","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsau0027ndf2frofq4yq"},{"post_id":"ckbksjsao001rndf208x4jl45","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsav002andf2qm8tlim4"},{"post_id":"ckbksjsap001undf26hvsbplj","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsaw002dndf2h2m278oe"},{"post_id":"ckbksjsaq001xndf2gs0r98i1","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsax002hndf2vkm6vhkp"},{"post_id":"ckbksjsas0021ndf2nwu6ca7c","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsay002kndf2r45n9api"},{"post_id":"ckbksjsau0029ndf257aq9hwc","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsaz002nndf2f3catuvj"},{"post_id":"ckbksjsav002cndf2p7ygbouw","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsaz002pndf2ddbshm7r"},{"post_id":"ckbksjsaw002gndf23tnmxje5","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsaz002sndf2tvzz7vml"},{"post_id":"ckbksjsax002jndf28nydn1ud","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsb0002undf2ooi0f78t"},{"post_id":"ckbksjsay002mndf2nbd0j7dp","category_id":"ckbksjs9s0004ndf23jdevosp","_id":"ckbksjsb0002xndf2rei7j8zz"}],"PostTag":[{"post_id":"ckbksjs9v0007ndf20e8tt1or","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjs9y000bndf205gbfalt"},{"post_id":"ckbksjs9y000cndf2vixjouex","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsa2000hndf28ohy15at"},{"post_id":"ckbksjs9l0000ndf2o4m87nkj","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsa4000kndf20tcfzztd"},{"post_id":"ckbksjs9l0000ndf2o4m87nkj","tag_id":"ckbksjs9x000andf2s1c25lyp","_id":"ckbksjsa6000ondf2rraeu3ll"},{"post_id":"ckbksjs9q0002ndf2o47zrqvk","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsaa000xndf2udaa1ijj"},{"post_id":"ckbksjs9q0002ndf2o47zrqvk","tag_id":"ckbksjsa5000nndf2tajqaubu","_id":"ckbksjsaa0010ndf20kvq7v6i"},{"post_id":"ckbksjsa9000vndf2b8krzj3t","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsac0014ndf22hgkx4i8"},{"post_id":"ckbksjsa9000vndf2b8krzj3t","tag_id":"ckbksjs9x000andf2s1c25lyp","_id":"ckbksjsae0017ndf23lugz4aw"},{"post_id":"ckbksjs9u0006ndf2qcmc1qzx","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsaf001bndf2rzmg9at6"},{"post_id":"ckbksjs9u0006ndf2qcmc1qzx","tag_id":"ckbksjs9x000andf2s1c25lyp","_id":"ckbksjsah001endf2pbbkha1i"},{"post_id":"ckbksjs9w0008ndf2rmeodug0","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsai001indf26y3sb7n4"},{"post_id":"ckbksjs9w0008ndf2rmeodug0","tag_id":"ckbksjsae0018ndf2pz40mo7o","_id":"ckbksjsal001lndf2eozgmg2k"},{"post_id":"ckbksjsa0000dndf2ta0ut7fe","tag_id":"ckbksjsah001fndf2o90svram","_id":"ckbksjsaq001wndf2w5powya7"},{"post_id":"ckbksjsa0000dndf2ta0ut7fe","tag_id":"ckbksjsam001ondf2p57fi2sn","_id":"ckbksjsar001zndf26p23umre"},{"post_id":"ckbksjsa2000indf2vwwu96v5","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsau0028ndf2kq7hfkb6"},{"post_id":"ckbksjsa2000indf2vwwu96v5","tag_id":"ckbksjsap001tndf234cwko5o","_id":"ckbksjsav002bndf275oydi3f"},{"post_id":"ckbksjsa2000indf2vwwu96v5","tag_id":"ckbksjsar0020ndf2swsqy2v3","_id":"ckbksjsaw002fndf29zeruexa"},{"post_id":"ckbksjsa5000lndf2zyenemr7","tag_id":"ckbksjsat0025ndf2b1cm7xez","_id":"ckbksjsax002indf2eev3t1ny"},{"post_id":"ckbksjsa6000pndf2c18pcknr","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsaz002ondf2iz62qabi"},{"post_id":"ckbksjsa6000pndf2c18pcknr","tag_id":"ckbksjsaw002endf28g78pedc","_id":"ckbksjsaz002qndf26s7vupag"},{"post_id":"ckbksjsay002mndf2nbd0j7dp","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsaz002tndf286yt2abf"},{"post_id":"ckbksjsay002mndf2nbd0j7dp","tag_id":"ckbksjsay002lndf2qhrfe8r1","_id":"ckbksjsb0002vndf2mj33gt22"},{"post_id":"ckbksjsa7000sndf2gzbum208","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsb0002yndf2y7jzobsw"},{"post_id":"ckbksjsa7000sndf2gzbum208","tag_id":"ckbksjsay002lndf2qhrfe8r1","_id":"ckbksjsb0002zndf2ytdwpgbn"},{"post_id":"ckbksjsaa000yndf2dx9wc2mm","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsb10032ndf2wmn5jej3"},{"post_id":"ckbksjsaa000yndf2dx9wc2mm","tag_id":"ckbksjsaz002rndf2fqpnf9dd","_id":"ckbksjsb10033ndf284e391ws"},{"post_id":"ckbksjsaa000yndf2dx9wc2mm","tag_id":"ckbksjsay002lndf2qhrfe8r1","_id":"ckbksjsb10035ndf2oy2lco71"},{"post_id":"ckbksjsaa000yndf2dx9wc2mm","tag_id":"ckbksjsb00030ndf2wcnya85e","_id":"ckbksjsb10036ndf2fbmo752z"},{"post_id":"ckbksjsab0012ndf2metvv6s4","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsb10038ndf2h562xxgq"},{"post_id":"ckbksjsab0012ndf2metvv6s4","tag_id":"ckbksjsb00031ndf2fjn5foex","_id":"ckbksjsb10039ndf2nrv7nmt8"},{"post_id":"ckbksjsac0015ndf2wkhzn62k","tag_id":"ckbksjsat0025ndf2b1cm7xez","_id":"ckbksjsb2003bndf2blb6gw4m"},{"post_id":"ckbksjsae0019ndf2y2xn03qq","tag_id":"ckbksjsb10037ndf2paexrctb","_id":"ckbksjsb2003cndf2zee9eivt"},{"post_id":"ckbksjsag001cndf2lyjm9ych","tag_id":"ckbksjsb10037ndf2paexrctb","_id":"ckbksjsb2003endf24u008uyv"},{"post_id":"ckbksjsah001gndf21pb04o2o","tag_id":"ckbksjsb2003dndf2x1d347lc","_id":"ckbksjsb3003gndf29ppxque7"},{"post_id":"ckbksjsaj001jndf2vi8q4ra5","tag_id":"ckbksjsah001fndf2o90svram","_id":"ckbksjsb3003indf21lnkpfrl"},{"post_id":"ckbksjsaj001jndf2vi8q4ra5","tag_id":"ckbksjsam001ondf2p57fi2sn","_id":"ckbksjsb3003jndf202uzmr5m"},{"post_id":"ckbksjsal001mndf23xg65emp","tag_id":"ckbksjsb3003hndf2rfz5mb73","_id":"ckbksjsb3003lndf2kpccwoyo"},{"post_id":"ckbksjsam001pndf2rbjn5m9k","tag_id":"ckbksjsb3003hndf2rfz5mb73","_id":"ckbksjsb4003nndf2y5e0umcq"},{"post_id":"ckbksjsao001rndf208x4jl45","tag_id":"ckbksjsb3003mndf2dqqnacia","_id":"ckbksjsb4003qndf2ah41v8fl"},{"post_id":"ckbksjsao001rndf208x4jl45","tag_id":"ckbksjsb4003ondf2s2f2abky","_id":"ckbksjsb4003rndf2aayli81a"},{"post_id":"ckbksjsap001undf26hvsbplj","tag_id":"ckbksjsb4003pndf23dzc602a","_id":"ckbksjsb5003tndf2l9ji2caj"},{"post_id":"ckbksjsaq001xndf2gs0r98i1","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsb5003vndf2w1qm03yl"},{"post_id":"ckbksjsaq001xndf2gs0r98i1","tag_id":"ckbksjsay002lndf2qhrfe8r1","_id":"ckbksjsb5003wndf20jynspwn"},{"post_id":"ckbksjsas0021ndf2nwu6ca7c","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsb6003yndf2clv0fn1d"},{"post_id":"ckbksjsas0021ndf2nwu6ca7c","tag_id":"ckbksjsb5003undf2bkw4pleq","_id":"ckbksjsb6003zndf20o6v0vgs"},{"post_id":"ckbksjsas0023ndf2cyz4h0dh","tag_id":"ckbksjsb5003xndf2xxfd4wg2","_id":"ckbksjsb70041ndf2g1ajit5k"},{"post_id":"ckbksjsas0023ndf2cyz4h0dh","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsb70042ndf2q2cdmi8e"},{"post_id":"ckbksjsat0026ndf2eigpo1wk","tag_id":"ckbksjsb5003xndf2xxfd4wg2","_id":"ckbksjsb70044ndf2qqplvdnt"},{"post_id":"ckbksjsat0026ndf2eigpo1wk","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsb70045ndf2nzlyaz30"},{"post_id":"ckbksjsau0029ndf257aq9hwc","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsb80047ndf2a56wvzr1"},{"post_id":"ckbksjsau0029ndf257aq9hwc","tag_id":"ckbksjsb5003xndf2xxfd4wg2","_id":"ckbksjsb80048ndf2rv77qgzw"},{"post_id":"ckbksjsav002cndf2p7ygbouw","tag_id":"ckbksjs9t0005ndf2b4zq0kv0","_id":"ckbksjsb8004andf23ayk7b0z"},{"post_id":"ckbksjsav002cndf2p7ygbouw","tag_id":"ckbksjsb4003ondf2s2f2abky","_id":"ckbksjsb8004bndf2q4x1nh2m"},{"post_id":"ckbksjsaw002gndf23tnmxje5","tag_id":"ckbksjsb80049ndf2t6ckgfl5","_id":"ckbksjsb9004dndf232eiri6i"},{"post_id":"ckbksjsax002jndf28nydn1ud","tag_id":"ckbksjsb80049ndf2t6ckgfl5","_id":"ckbksjsb9004endf2ay0jbn28"}],"Tag":[{"name":"Android","_id":"ckbksjs9t0005ndf2b4zq0kv0"},{"name":"","_id":"ckbksjs9x000andf2s1c25lyp"},{"name":"","_id":"ckbksjsa5000nndf2tajqaubu"},{"name":"Tips","_id":"ckbksjsae0018ndf2pz40mo7o"},{"name":"Git","_id":"ckbksjsah001fndf2o90svram"},{"name":"Shell","_id":"ckbksjsam001ondf2p57fi2sn"},{"name":"AspectJ","_id":"ckbksjsap001tndf234cwko5o"},{"name":"Javassist","_id":"ckbksjsar0020ndf2swsqy2v3"},{"name":"","_id":"ckbksjsat0025ndf2b1cm7xez"},{"name":"Camera","_id":"ckbksjsaw002endf28g78pedc"},{"name":"","_id":"ckbksjsay002lndf2qhrfe8r1"},{"name":"","_id":"ckbksjsaz002rndf2fqpnf9dd"},{"name":"","_id":"ckbksjsb00030ndf2wcnya85e"},{"name":"","_id":"ckbksjsb00031ndf2fjn5foex"},{"name":"","_id":"ckbksjsb10037ndf2paexrctb"},{"name":"GitHub","_id":"ckbksjsb2003dndf2x1d347lc"},{"name":"Flutter","_id":"ckbksjsb3003hndf2rfz5mb73"},{"name":"Gradle","_id":"ckbksjsb3003mndf2dqqnacia"},{"name":"","_id":"ckbksjsb4003ondf2s2f2abky"},{"name":"Maven","_id":"ckbksjsb4003pndf23dzc602a"},{"name":"OKHttp","_id":"ckbksjsb5003undf2bkw4pleq"},{"name":"React Native","_id":"ckbksjsb5003xndf2xxfd4wg2"},{"name":"Intellij Plugin","_id":"ckbksjsb80049ndf2t6ckgfl5"}]}}