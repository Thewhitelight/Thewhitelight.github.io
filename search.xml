<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>React Native çš„ NativeMoudle ç”Ÿå‘½å‘¨æœŸ</title>
    <url>/2020/06/15/react-native-moudle-lifecycle/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨æ··åˆå¼€å‘æ—¶ç»å¸¸éœ€è¦è°ƒç”¨ Native æ–¹æ³•è·å–èµ„æºï¼Œæ­¤æ—¶éœ€è¦ä»¥ NativeMoudle çš„æ–¹å¼ä¾›å‰ç«¯è°ƒç”¨ã€‚å½“ç»§æ‰¿ReactContextBaseJavaModuleæ—¶å¯ä»¥é‡å†™çš„æ–¹æ³•åªæœ‰ onCatalystInstanceDestroy() å¯ä»¥çœ‹å‡ºæ¥æ˜¯å®¹å™¨é”€æ¯æ—¶ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼Œä½†æ˜¯å…¶ä»–çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ²¡æœ‰ç›¸å…³æ–¹æ³•ã€‚é€šè¿‡æŸ¥è¯¢apiå‘ç°<code>LifecycleEventListener</code>Â·è¿™ä¸ªlistenerå¯ä»¥ç›‘å¬ä¸»è¦çš„ç”Ÿå‘½å‘¨æœŸå¦‚<code>onHostResume() onHostPause() onHostDestroy()</code>é€šè¿‡è¿™å‡ ä¸ªæ–¹æ³•å¯ä»¥ç›‘å¬é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ–¹ä¾¿é‡Šæ”¾èµ„æºã€‚</p>
<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>ä½†æ˜¯æœ‰ä¸ªå¾ˆç‰¹æ®Šçš„åœºæ™¯å°±æ˜¯ä»é”å±ç•Œé¢è°ƒç”¨ ReactNative ç•Œé¢ï¼Œè¿™æ—¶ ReactNative ç•Œé¢ä¼šåœ¨è°ƒç”¨<code>onResume()</code>åç›´æ¥è°ƒç”¨<code>onPause()</code>,è¿™ä¸ªæ˜¯ç”±äºç³»ç»Ÿæœºåˆ¶å†³å®šçš„ï¼Œæ— æ³•æ›´æ”¹è¿™ä¸ªé€»è¾‘ã€‚ç”±äºå¿«é€Ÿè¿›å…¥ pause çŠ¶æ€å¯¼è‡´ NativeMoudle çš„<code>onHostResume()</code>æ²¡æœ‰è°ƒç”¨ï¼Œé€ æˆæ— æ³•è§¦å‘è¿™ä¸ªæ–¹æ³•é‡Œçš„é€»è¾‘ã€‚</p>
<h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>é‚£è¿™æ ·çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä»å“ªé‡Œå¼€å§‹è°ƒç”¨ï¼Œä»¥ä»€ä¹ˆæ–¹å¼å¼€å§‹è°ƒç”¨å‘¢ã€‚ä¸‹é¢åšä¸ªç®€å•çš„åˆ†æã€‚<br>å½“çœ‹åˆ°<code>onHostResume</code>æ—¶ä¸€å®šä¼šå‘ç°å’Œ<code>Activity</code>çš„ç”Ÿå‘½å‘¨æœŸå¾ˆç›¸ä¼¼ï¼Œæ‰€æœ‰å½“éœ€è¦ä» Activity ä¸­å…¥æ‰‹æŸ¥çœ‹ã€‚æœ¬æ–‡å¿½ç•¥<code>ReactFragment</code>ç›¸å…³å†…å®¹ã€‚<br><a id="more"></a></p>
<h2 id="NativeMoudle-åŠ è½½æµç¨‹"><a href="#NativeMoudle-åŠ è½½æµç¨‹" class="headerlink" title="NativeMoudle åŠ è½½æµç¨‹"></a>NativeMoudle åŠ è½½æµç¨‹</h2><p>ReactActivity æ˜¯ ReactNative çš„å…¥å£æ‰¿è½½é¡µé¢ï¼ŒReactActivity ä¸­å®é™…æ˜¯äº¤ç»™ReactActivityDelegateæ¥å®Œæˆã€‚</p>
<ol>
<li>ReactActivityDelegate ä¸­åˆå§‹åŒ– ReactInstanceManager ï¼Œå¹¶å°†æ‰€æœ‰çš„ ReactPackage æ·»åŠ è¿› ReactInstanceManager</li>
<li>ReactInstanceManager ä¸­åˆ›å»ºå‡ºæ‰€æœ‰çš„ ReactPackage  å¹¶å°†å…¶è®¾ç½®è¿› CatalystInstanceImpl</li>
<li>CatalystInstanceImpl ä¸­å°†æ‰€æœ‰ ReactPackage ä¼ å…¥ C++ å±‚ï¼Œé€šè¿‡C++å®ç°ä¸js é€šä¿¡</li>
</ol>
<h2 id="NativeMoudle-ç”Ÿå‘½å‘¨æœŸ"><a href="#NativeMoudle-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="NativeMoudle ç”Ÿå‘½å‘¨æœŸ"></a>NativeMoudle ç”Ÿå‘½å‘¨æœŸ</h2><p>åœ¨ js å±‚è§¦å‘ componentWillMount æ—¶ï¼ŒNativeMoudle å·²ç»åˆå§‹åŒ–å®Œæˆã€‚å·²ç»å¯ä»¥è°ƒç”¨ç›¸å…³çš„ ReactMethod æ–¹æ³•ã€‚<br>å‰é¢è¯´ NativeMoudle çš„åŠ è½½æµç¨‹ï¼Œå½“ ReactInstanceManager åŠ è½½åï¼ŒReactRootView è°ƒç”¨ startReactApplication æ—¶ä¾¿å¼€å§‹åœ¨ä¸»çº¿ç¨‹ä¸Šå¼‚æ­¥åˆå§‹åŒ– ReactContextã€CatalystInstanceImplã€‚<br><figure class="highlight java"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç®€åŒ–è¿‡çš„ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupReactContext</span><span class="params">(<span class="keyword">final</span> ReactApplicationContext reactContext)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">synchronized</span> (mAttachedReactRoots) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (mReactContextLock) &#123;</span><br><span class="line">      mCurrentReactContext = Assertions.assertNotNull(reactContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CatalystInstance catalystInstance =</span><br><span class="line">      Assertions.assertNotNull(reactContext.getCatalystInstance());</span><br><span class="line"></span><br><span class="line">    catalystInstance.initialize();</span><br><span class="line">    <span class="comment">//è°ƒç”¨ NativeMoudle ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">    moveReactContextToCurrentLifecycleState();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ReactRoot reactRoot : mAttachedReactRoots) &#123;</span><br><span class="line">      attachRootViewToInstance(reactRoot);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">moveReactContextToCurrentLifecycleState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (mLifecycleState == LifecycleState.RESUMED) &#123;</span><br><span class="line">    moveToResumedLifecycleState(<span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ­¤æ–¹æ³•ä¼šè°ƒç”¨ä¸¤æ¬¡ï¼Œåœ¨ onHostResume é‡Œ force=false è°ƒç”¨ï¼Œä¹Ÿä¼šåœ¨ moveReactContextToCurrentLifecycleState force=true æ—¶è°ƒç”¨</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">moveToResumedLifecycleState</span><span class="params">(<span class="keyword">boolean</span> force)</span> </span>&#123;</span><br><span class="line">  ReactContext currentContext = getCurrentReactContext();</span><br><span class="line">  <span class="keyword">if</span> (currentContext != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">//å½“ currentContext ä¸ä¸ºç©ºä¸”æœªè°ƒç”¨è¿‡</span></span><br><span class="line">    <span class="comment">// we currently don't have an onCreate callback so we call onResume for both transitions</span></span><br><span class="line">    <span class="keyword">if</span> (force</span><br><span class="line">      || mLifecycleState == LifecycleState.BEFORE_RESUME</span><br><span class="line">      || mLifecycleState == LifecycleState.BEFORE_CREATE) &#123;</span><br><span class="line">      currentContext.onHostResume(mCurrentActivity);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  mLifecycleState = LifecycleState.RESUMED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å½“ LifecycleState ä¸º RESUMED ä¸” ReactContext ä¸ä¸ºç©º æ—¶ä¾¿ä¼šè°ƒç”¨ NativeMoudle çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³• <code>onHostResume()</code>ã€‚<br>å½“é€€å‡º Activity æ—¶è°ƒç”¨ ReactInstanceManager çš„ onHostPause æ–¹æ³•è¿›è€Œ è°ƒç”¨<code>moveToBeforeResumeLifecycleState()</code><br><figure class="highlight java"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">moveToBeforeResumeLifecycleState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ReactContext currentContext = getCurrentReactContext();</span><br><span class="line">  <span class="keyword">if</span> (currentContext != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (mLifecycleState == LifecycleState.BEFORE_CREATE) &#123;</span><br><span class="line">      currentContext.onHostResume(mCurrentActivity);</span><br><span class="line">      currentContext.onHostPause();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mLifecycleState == LifecycleState.RESUMED) &#123;</span><br><span class="line">      <span class="comment">//å› ä¸º CatalystInstanceImpl åˆå§‹åŒ–å mLifecycleState ä¼šå˜ä¸º RESUMED æ‰€ä»¥ä¼šè¿›å…¥æ­¤åˆ†æ”¯</span></span><br><span class="line">      currentContext.onHostPause();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  mLifecycleState = LifecycleState.BEFORE_RESUME;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="é”å±å¼•èµ·çš„å¼‚å¸¸æµç¨‹"><a href="#é”å±å¼•èµ·çš„å¼‚å¸¸æµç¨‹" class="headerlink" title="é”å±å¼•èµ·çš„å¼‚å¸¸æµç¨‹"></a>é”å±å¼•èµ·çš„å¼‚å¸¸æµç¨‹</h2><p>ç”±äºé”å±è°ƒç”¨ ReactNative ç•Œé¢ä¼šåœ¨é¡µé¢æœªæ˜¾ç¤ºå‰å¿«é€Ÿè°ƒç”¨<code>onPause</code>ä»è€Œè°ƒç”¨åˆ° ReactInstanceManager <code>moveToBeforeResumeLifecycleState()</code>æ–¹æ³•,ä½¿å¾— <code>mLifecycleState</code> ä¸º <code>LifecycleState.BEFORE_RESUME</code><br><figure class="highlight java"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">moveToBeforeResumeLifecycleState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ReactContext currentContext = getCurrentReactContext();</span><br><span class="line">  <span class="keyword">if</span> (currentContext != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (mLifecycleState == LifecycleState.BEFORE_CREATE) &#123;</span><br><span class="line">      currentContext.onHostResume(mCurrentActivity);</span><br><span class="line">      currentContext.onHostPause();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mLifecycleState == LifecycleState.RESUMED) &#123;</span><br><span class="line">      currentContext.onHostPause();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//æ­¤å¤„æ›´æ”¹äº† mLifecycleState çŠ¶æ€</span></span><br><span class="line">  mLifecycleState = LifecycleState.BEFORE_RESUME;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨<code>moveReactContextToCurrentLifecycleState()</code>ä¸­<code>mLifecycleState==LifecycleState.RESUMED</code>æ—¶æ‰ä¼šè°ƒç”¨ NativeMoudle çš„<code>onHostResume()</code>,ä½†ç°åœ¨å·²ç»ä¸ä¼šè°ƒç”¨åˆ°<code>moveToBeforeResumeLifecycleState</code>,å¯¼è‡´åœ¨ NativeMoudle çš„<code>onHostResume()</code>ä»£ç éƒ½ä¸ä¼šè°ƒç”¨ã€‚</p>
<h1 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h1><p>å°†<code>moveReactContextToCurrentLifecycleState()</code>ä¿®æ”¹ä¸‹<br><figure class="highlight java"><figcaption><span>ReactInstanceManager.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">moveReactContextToCurrentLifecycleState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ³¨é‡Šæ‰åŸæœ‰çš„çŠ¶æ€åˆ¤æ–­ï¼Œå¯ä»¥åœ¨ä»»æ„çŠ¶æ€ä¸‹è°ƒç”¨    </span></span><br><span class="line">  <span class="comment">//if (mLifecycleState == LifecycleState.RESUMED) &#123;</span></span><br><span class="line">    moveToResumedLifecycleState(<span class="keyword">true</span>);</span><br><span class="line">  <span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>  è€Œåœ¨<code>moveToResumedLifecycleState()</code>é‡Œå«æœ‰å…³äºçŠ¶æ€çš„åˆ¤æ–­ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒä¼šé‡å¤è°ƒç”¨<code>onHostResume()</code>å¼•èµ·å…¶ä»–é—®é¢˜ã€‚</p>
]]></content>
      <tags>
        <tag>Android</tag>
        <tag>React Native</tag>
      </tags>
  </entry>
  <entry>
    <title>React Native ç‰ˆæœ¬æ ¡éªŒ</title>
    <url>/2020/05/11/react-native-check-version/</url>
    <content><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æˆ‘ä»¬ä¸šåŠ¡çš„ SDK åŒ…å« ReactNative æ–¹æ¡ˆ,æ‰€ä»¥å¿…é¡»ä¾èµ– React Native çš„ AARï¼Œä½†æ˜¯æœ€è¿‘å¯¹æ¥çš„å®¢æˆ·æœ‰è‡ªå·±ä¾èµ–çš„ç‰ˆæœ¬ï¼Œå’Œæˆ‘ä»¬ä½¿ç”¨çš„ç‰ˆæœ¬ä¸åŒï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬çš„ React Nativ ä»£ç è¿è¡Œåœ¨ä»–ä»¬ä½¿ç”¨çš„ç‰ˆæœ¬ä¸Šã€‚</p>
<h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>å½“ React Native ç‰ˆæœ¬å’Œ Native ç‰ˆæœ¬ä¸ä¸€è‡´æ—¶ï¼Œä¼šå¼¹å‡ºçº¢æ¡†æç¤º<br><div class="note danger">
            <p>React Native version mismatch.<br>JavaScript version:0.xx.x<br>Native Version:0.xx.x</p>
          </div></p>
<h1 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h1><p>æ ¹æ®æç¤ºåœ¨æºç é‡Œæœç´¢å‘ç°ï¼Œæ¥è‡ªäº<a href="https://github.com/facebook/react-native/blob/aee88b6843cea63d6aa0b5879ad6ef9da4701846/Libraries/Core/ReactNativeVersionCheck.js">Libraries/Core/ReactNativeVersionCheck.js</a>è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œæ ¹æ®æ–‡ä»¶æ³¨é‡Šå¯ä»¥çœ‹å‡ºæ˜¯ä¸“é—¨åšç‰ˆæœ¬æ ¡éªŒ<br><a id="more"></a><br><figure class="highlight js"><figcaption><span>ReactNativeVersionCheck.js</span></figcaption><table><tr><td class="code"><pre><span class="line">exports.checkVersions = <span class="function"><span class="keyword">function</span> <span class="title">checkVersions</span>(<span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> nativeVersion = Platform.constants.reactNativeVersion;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    ReactNativeVersion.version.major !== nativeVersion.major ||</span><br><span class="line">    ReactNativeVersion.version.minor !== nativeVersion.minor</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(</span><br><span class="line">      <span class="string">`React Native version mismatch.\n\nJavaScript version: <span class="subst">$&#123;_formatVersion(</span></span></span><br><span class="line"><span class="string"><span class="subst">        ReactNativeVersion.version,</span></span></span><br><span class="line"><span class="string"><span class="subst">      )&#125;</span>\n`</span> +</span><br><span class="line">        <span class="string">`Native version: <span class="subst">$&#123;_formatVersion(nativeVersion)&#125;</span>\n\n`</span> +</span><br><span class="line">        <span class="string">'Make sure that you have rebuilt the native code. If the problem '</span> +</span><br><span class="line">        <span class="string">'persists try clearing the Watchman and packager caches with '</span> +</span><br><span class="line">        <span class="string">'`watchman watch-del-all &amp;&amp; react-native start --reset-cache`.'</span>,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºå¦‚æœæ˜¯ path å…¼å®¹ç‰ˆæœ¬åˆ™ä¸ä¼šå¼¹æ¡†æç¤ºï¼Œéå…¼å®¹ç‰ˆæœ¬æ—¶ä¼šå¼¹æ¡†è­¦å‘Šï¼Œå¦‚æœè¦æƒ³å»æ‰å¼¹æ¡†æç¤ºï¼Œåˆ™ç›´æ¥æ³¨é‡Šæ‰è¿™ä¸ªæ ¡éªŒä»£ç ï¼Œå†ä½¿ç”¨å‘½ä»¤è¡Œé‡æ–°æ‰“åŒ… js ä»£ç å³å¯ã€‚</p>
<h1 id="æ¢ç©¶"><a href="#æ¢ç©¶" class="headerlink" title="æ¢ç©¶"></a>æ¢ç©¶</h1><p>æ ¹æ®ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæ ¹æ®å‘½åå¤§æ¦‚å¯ä»¥çŒœå‡º<code>ReactNativeVersion</code>æ˜¯ js ä¾§çš„ç‰ˆæœ¬å·ï¼Œ <code>Platform.constants.reactNativeVersion</code>æ˜¯ Native ä¾§çš„ç‰ˆæœ¬å·ã€‚<br>ä» ReactNativeVersionCheck æ–‡ä»¶çš„å¯¼åŒ…å¯ä»¥çœ‹åˆ°ä»–ä»¬çš„å®šä¹‰ç›®å½•<br><figure class="highlight js"><figcaption><span>ReactNativeVersionCheck.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Platform <span class="keyword">from</span> <span class="string">'../Utilities/Platform'</span>;</span><br><span class="line"><span class="keyword">const</span> ReactNativeVersion = <span class="built_in">require</span>(<span class="string">'./ReactNativeVersion'</span>);</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡æœç´¢æºç å‘ç° ReactNativeVersionCheck.js-&gt;Platform.android.js-&gt;NativePlatformConstantsAndroid.js(PlatformConstants)-&gt;AndroidInfoModule.java-&gt;ReactNativeVersion.java åœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°äº†å®šä¹‰çš„åœ°æ–¹<br><figure class="highlight java"><figcaption><span>ReactNativeVersion.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactNativeVersion</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Object&gt; VERSION = MapBuilder.&lt;String, Object&gt;of(</span><br><span class="line">      <span class="string">"major"</span>, <span class="number">0</span>,</span><br><span class="line">      <span class="string">"minor"</span>, <span class="number">0</span>,</span><br><span class="line">      <span class="string">"patch"</span>, <span class="number">0</span>,</span><br><span class="line">      <span class="string">"prerelease"</span>, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯éƒ½æ˜¯ 0 è¿˜æœªèµ‹å€¼ï¼Œçœ‹åˆ°æœ‰è¿™æ ·çš„æ³¨é‡Š<code>* @generated by scripts/bump-oss-version.js</code>ï¼ŒåŸæ¥æ˜¯é€šè¿‡è„šæœ¬åŠ¨æ€èµ‹å€¼çš„ã€‚<br>æŸ¥çœ‹è„šæœ¬å‘ç°<br><figure class="highlight js"><figcaption><span>bump-oss-version.js</span></figcaption><table><tr><td class="code"><pre><span class="line">fs.writeFileSync(</span><br><span class="line">  <span class="string">'ReactAndroid/src/main/java/com/facebook/react/modules/systeminfo/ReactNativeVersion.java'</span>,</span><br><span class="line">  cat(<span class="string">'scripts/versiontemplates/ReactNativeVersion.java.template'</span>)</span><br><span class="line">    .replace(<span class="string">'$&#123;major&#125;'</span>, major)</span><br><span class="line">    .replace(<span class="string">'$&#123;minor&#125;'</span>, minor)</span><br><span class="line">    .replace(<span class="string">'$&#123;patch&#125;'</span>, patch)</span><br><span class="line">    .replace(</span><br><span class="line">      <span class="string">'$&#123;prerelease&#125;'</span>,</span><br><span class="line">      prerelease !== <span class="literal">undefined</span> ? <span class="string">`"<span class="subst">$&#123;prerelease&#125;</span>"`</span> : <span class="string">'null'</span>,</span><br><span class="line">    ),</span><br><span class="line">  <span class="string">'utf-8'</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">fs.writeFileSync(</span><br><span class="line">  <span class="string">'ReactCommon/cxxreact/ReactNativeVersion.h'</span>,</span><br><span class="line">  cat(<span class="string">'scripts/versiontemplates/ReactNativeVersion.h.template'</span>)</span><br><span class="line">    .replace(<span class="string">'$&#123;major&#125;'</span>, major)</span><br><span class="line">    .replace(<span class="string">'$&#123;minor&#125;'</span>, minor)</span><br><span class="line">    .replace(<span class="string">'$&#123;patch&#125;'</span>, patch)</span><br><span class="line">    .replace(</span><br><span class="line">      <span class="string">'$&#123;prerelease&#125;'</span>,</span><br><span class="line">      prerelease !== <span class="literal">undefined</span> ? <span class="string">`"<span class="subst">$&#123;prerelease&#125;</span>"`</span> : <span class="string">'""'</span>,</span><br><span class="line">    ),</span><br><span class="line">  <span class="string">'utf-8'</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">fs.writeFileSync(</span><br><span class="line">  <span class="string">'Libraries/Core/ReactNativeVersion.js'</span>,</span><br><span class="line">  cat(<span class="string">'scripts/versiontemplates/ReactNativeVersion.js.template'</span>)</span><br><span class="line">    .replace(<span class="string">'$&#123;major&#125;'</span>, major)</span><br><span class="line">    .replace(<span class="string">'$&#123;minor&#125;'</span>, minor)</span><br><span class="line">    .replace(<span class="string">'$&#123;patch&#125;'</span>, patch)</span><br><span class="line">    .replace(</span><br><span class="line">      <span class="string">'$&#123;prerelease&#125;'</span>,</span><br><span class="line">      prerelease !== <span class="literal">undefined</span> ? <span class="string">`'<span class="subst">$&#123;prerelease&#125;</span>'`</span> : <span class="string">'null'</span>,</span><br><span class="line">    ),</span><br><span class="line">  <span class="string">'utf-8'</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>åˆ†åˆ«ç»™ jsï¼ŒAndroidï¼ŒiOS èµ‹å€¼çš„ä»£ç ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å°±äº†è§£äº† React Native ç‰ˆæœ¬æ ¡éªŒçš„é€»è¾‘ã€‚é€šè¿‡è„šæœ¬åŠ¨æ€ç”Ÿæˆä¸‰ç«¯çš„ç‰ˆæœ¬å·ã€‚</p>
<h1 id="ç–‘æƒ‘"><a href="#ç–‘æƒ‘" class="headerlink" title="ç–‘æƒ‘"></a>ç–‘æƒ‘</h1><p>åœ¨ bump-oss-version.js é‡Œå‘ç°è¿™æ®µä»£ç ï¼Œæ„Ÿè§‰æŒºéš¾ç†è§£ä¸ºå•¥è¦åšè¿™æ ·çš„é™åˆ¶ã€‚<br><figure class="highlight js"><figcaption><span>bump-oss-version.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// - check that argument version matches branch</span></span><br><span class="line"><span class="comment">// e.g. 0.33.1 or 0.33.0-rc4</span></span><br><span class="line"><span class="keyword">let</span> version = argv._[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">if</span> (!version || version.indexOf(versionMajor) !== <span class="number">0</span>) &#123;</span><br><span class="line">  echo(</span><br><span class="line">    <span class="string">`You must pass a tag like 0.<span class="subst">$&#123;versionMajor&#125;</span>.[X]-rc[Y] to bump a version`</span>,</span><br><span class="line">  );</span><br><span class="line">  exit(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      <tags>
        <tag>Android</tag>
        <tag>React Native</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven ä¸Šä¼ ä¸‹è½½æ“ä½œ</title>
    <url>/2020/03/09/maven-related/</url>
    <content><![CDATA[<p>Java å¼€å‘ä¸­ä½¿ç”¨æœ€å¤šçš„æ„å»ºå·¥å…·å°±æ˜¯ Mavenï¼ŒAndroid çš„ Gradle æ„å»ºå·¥å…·ä½¿ç”¨çš„ç‰ˆæœ¬ä»“åº“ä¹Ÿæ˜¯ Mavenï¼Œå¯¹äºä½¿ç”¨è„šæœ¬æ‰“åŒ…å‡ºäº§ç‰©ä¸Šä¼ è‡³è¿œç¨‹ä»“åº“çš„æ–¹å¼å·²ç»å¾ˆç†Ÿæ‚‰ï¼Œä½†æ˜¯æœ‰æ—¶å€™éœ€è¦ä» Maven ä¸‹è½½äº§ç‰©æˆ–è€…ç›´æ¥ä¸Šä¼ äº§ç‰©ã€‚å¦‚æœæ¯æ¬¡éƒ½åœ¨ Maven çš„æœåŠ¡ç«¯é¡µé¢æ“ä½œå°±å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥å¦‚æœä½¿ç”¨è„šæœ¬å°±å¾ˆæ–¹ä¾¿ã€‚<br><a id="more"></a></p>
<h1 id="é…ç½®-mvn"><a href="#é…ç½®-mvn" class="headerlink" title="é…ç½® mvn"></a>é…ç½® mvn</h1><h2 id="å®‰è£…-mvn-å‘½ä»¤è¡Œï¼Œmac-ä¸‹å¯ä»¥ä½¿ç”¨-brew-install-mvnã€‚"><a href="#å®‰è£…-mvn-å‘½ä»¤è¡Œï¼Œmac-ä¸‹å¯ä»¥ä½¿ç”¨-brew-install-mvnã€‚" class="headerlink" title="å®‰è£… mvn å‘½ä»¤è¡Œï¼Œmac ä¸‹å¯ä»¥ä½¿ç”¨ brew install mvnã€‚"></a>å®‰è£… mvn å‘½ä»¤è¡Œï¼Œmac ä¸‹å¯ä»¥ä½¿ç”¨ <code>brew install mvn</code>ã€‚</h2><h2 id="é…ç½®-mvn-æ–‡ä»¶"><a href="#é…ç½®-mvn-æ–‡ä»¶" class="headerlink" title="é…ç½® mvn æ–‡ä»¶"></a>é…ç½® mvn æ–‡ä»¶</h2><p>å½“ mvn å®‰è£…å¥½åå‘½ä»¤è¡Œæ‰§è¡Œ<code>which mvn</code>æŸ¥çœ‹å®‰è£…è·¯å¾„ï¼Œå¦‚<code>/usr/local/apache-maven-3.6.3/bin/mvn</code>ï¼Œç„¶å<code>cd apache-maven-3.6.3/conf/</code>å¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸‹å‘ç°<code>settings.xml</code>ï¼Œæ‰“å¼€ xml æ–‡ä»¶é…ç½®å¦‚ä¸‹<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ·»åŠ  server èŠ‚ç‚¹ï¼Œid å¯ä»¥ä»»æ„å†™ï¼Œæ³¨æ„åé¢çš„å‘½ä»¤è¡Œå‚æ•°ä¼šç”¨åˆ°ï¼Œusername password ä¸ºç§æœ‰ maven é…ç½® --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>***<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>***<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="å‘½ä»¤è¡Œä¸Šä¼ äº§ç‰©"><a href="#å‘½ä»¤è¡Œä¸Šä¼ äº§ç‰©" class="headerlink" title="å‘½ä»¤è¡Œä¸Šä¼ äº§ç‰©"></a>å‘½ä»¤è¡Œä¸Šä¼ äº§ç‰©</h1><p>ä»¥ä¸Šä¼ <code>com.android.support:appcompat-v7:28.0.0</code>ä¸ºä¾‹,æ¯”å¦‚åœ¨å½“å‰ç›®å½•ä¸‹æœ‰<code>appcompat-v7-28.0.0.aar</code>è¿™ä¸ªåŒ…<br>ä½¿ç”¨ ä¸‹é¢å‘½ä»¤è¡Œå³å¯ä¸Šä¼ <br><code>mvn deploy:deploy-file -Dfile=appcompat-v7-28.0.0.aar -DgroupId=com.android.support -DartifactId=appcompat-v7 -Dversion=28.0.0 -Dpackaging=aar -Durl=https://www.***.com/repository/maven-releases/ -DrepositoryId=releases -DpomFile=appcompat-v7-28.0.0.pom</code></p>
<p><code>-DrepositoryId</code>å³ä¸º<code>xml</code>ä¸­é…ç½®çš„ idï¼Œåå­—å¿…é¡»ç›¸åŒ<br><code>-Dpackaging</code>å³ä¸ºä¸Šä¼ äº§ç‰©ç±»å‹<br><code>-Durl</code>å³ä¸ºä¸Šä¼ åœ°å€<br><code>-DpomFile</code>å³ä¸ºä¸Šä¼ çš„ pom æ–‡ä»¶ï¼Œå¯é€‰å‚æ•°</p>
<h1 id="ä¸‹è½½äº§ç‰©"><a href="#ä¸‹è½½äº§ç‰©" class="headerlink" title="ä¸‹è½½äº§ç‰©"></a>ä¸‹è½½äº§ç‰©</h1><h2 id="mvn-install"><a href="#mvn-install" class="headerlink" title="mvn install"></a>mvn install</h2><p>å¦‚æœæœ‰ pom æ–‡ä»¶ ç›´æ¥åœ¨ç›®å½•ä¸‹æ‰§è¡Œ <code>mvn install</code> å°±å¯ä»¥ä¸‹è½½ï¼Œä½†æ˜¯å‰æå¾—æœ‰ pom è¾ƒä¸ºéº»çƒ¦</p>
<h2 id="è„šæœ¬ä¸‹è½½"><a href="#è„šæœ¬ä¸‹è½½" class="headerlink" title="è„šæœ¬ä¸‹è½½"></a>è„šæœ¬ä¸‹è½½</h2><p>æ¨¡æ‹Ÿ support åŒ…çš„ä¸‹è½½è·¯å¾„æ˜¯è¿™æ ·<code>https://www.***.com/repository/maven-releases/com/android/support/appcompat-v7/28.0.0/appcompat-v7-28.0.0.pom</code>ï¼Œè§‚å¯Ÿ url æˆ‘ä»¬å°±å¯ä»¥å‘ç°æ˜¯é€šè¿‡ä¾èµ–åŒ…åå°±å¯ä»¥æ„é€ å‡ºæ¥çš„è·¯å¾„ï¼Œ<code>aarã€jarã€sourec.jar</code>éƒ½æ˜¯ç±»ä¼¼çš„è·¯å¾„ã€‚æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>curl</code>å‘½ä»¤æ„é€ è·¯å¾„ç›´æ¥ä¸‹è½½åˆ°æƒ³è¦çš„äº§ç‰©ï¼Œç”±äºè„šæœ¬è¿‡äºç®€å•å°±ä¸åšæ¼”ç¤ºã€‚</p>
<h1 id="æ‰¹é‡è·å–-maven-äº§ç‰©"><a href="#æ‰¹é‡è·å–-maven-äº§ç‰©" class="headerlink" title="æ‰¹é‡è·å– maven äº§ç‰©"></a>æ‰¹é‡è·å– maven äº§ç‰©</h1><p>ç”±äºä¸šåŠ¡éœ€è¦æŸ¥çœ‹ maven é‡Œäº§ç‰©çš„å†…å®¹ï¼Œä½†æ˜¯ä¸€ä¸ªä¸€ä¸ªä¸‹è½½æŸ¥çœ‹å°±å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æŠ“åŒ…çœ‹äº†ä¸‹ maven æœç´¢é¡µé¢å‘ç°è¿™ä¸ªé“¾æ¥<code>https://www.***.com/service/extdirect</code>,åœ¨åŠ ä¸ŠæŠ“å–çš„ Head æˆ‘ä»¬å°±å¯ä»¥æ¨¡æ‹Ÿå‡ºä¸€ä¸ªæ­£å¸¸çš„è¯·æ±‚ä»è€Œè·å–åˆ°æƒ³è¦çš„æ‰€æœ‰çš„äº§ç‰©é“¾æ¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¼€æ”¾ API(<a href="https://www.***.com/service/rest/v1/search" target="_blank" rel="noopener">https://www.***.com/service/rest/v1/search</a>) è·å–å…¨éƒ¨äº§ç‰©ï¼Œé€šè¿‡è§£æ<code>json</code>è¿›ä¸€æ­¥è·å–ä¸‹è½½åœ°å€ï¼Œé€šè¿‡<code>curl</code>å³å¯ä¸‹è½½åˆ°äº§ç‰©ï¼Œæœ€åé€šè¿‡<code>unzip</code>å°±å¯ä»¥æ‹†åŒ…è§£æäº§ç‰©ã€‚æ‰€ä»¥æµç¨‹æœ‰ç‚¹é•¿ä½†æ˜¯ä¸€æ¬¡å†™å¥½è„šæœ¬ä»¥åï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„é‡å¤ä½¿ç”¨ã€‚</p>
<h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>mvn è‡ªå·±ä¸ç®—äº†è§£ï¼Œåœ¨å·¥ä½œå®è·µä¸­æ…¢æ…¢çš„äº†è§£ï¼Œå¤šæ¬¡å°è¯•æ€»ç»“å‡ºä¸€ç‚¹ä½¿ç”¨æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨ BECAUSE é©¾é©­ä½ çš„ Gradle ä¾èµ– (è¯‘)</title>
    <url>/2020/02/20/gradle-dependencies-because/</url>
    <content><![CDATA[<h1 id="è¯‘æ–‡"><a href="#è¯‘æ–‡" class="headerlink" title="è¯‘æ–‡"></a>è¯‘æ–‡</h1><p>ä½ æ˜¯å¦çŸ¥é“å¯ä»¥æŒ‡å®šä½¿ç”¨æŸä¸ªä¾èµ–æˆ–è€…æŸä¸ªç‰ˆæœ¬çš„ä¾èµ–çš„åŸå› .<br>æ˜¯çš„,åœ¨<a href="https://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/Dependency.html#because-java.lang.String-" target="_blank" rel="noopener">API</a>å’Œ<a href="https://docs.gradle.org/current/userguide/declaring_dependencies.html#sec:documenting-dependencies" target="_blank" rel="noopener">DOCS</a>ä¸­<br><div class="note info">
            <p>void because?(@Nullable String reason)</p><p>Sets the reason why this dependency should be used.<br>Since:<br>4.6</p>
          </div><br><a id="more"></a><br>åŸºæœ¬ç”¨æ³•å¦‚ä¸‹æ‰€ç¤º<br><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">implementation(<span class="string">"com.blundell:app-auth android:1.2.3"</span>) &#123;</span><br><span class="line">    because <span class="string">"We use fragment auth, original AppAuth library does not support this feature."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Gradle å…è®¸ä½ å†™ä¸€ä¸¤å¥ä¸ºä»€ä¹ˆé€‰æ‹©æ”¹ä¾èµ–çš„å¥å­ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æå–è¯¥æ³¨é‡Šï¼Œä»¥æ˜¾ç¤ºåœ¨æŠ¥å‘Šä¸­ï¼š<br><code>gradle -q dependencyInsight â€“dependency app-auth android</code><br>ä½†æ˜¯è¿™ä¸æ˜¯æˆ‘æœ‰å…´è¶£ä½¿ç”¨å®ƒçš„åŸå› ï¼<br>æ­¤åŠŸèƒ½æœ€ä¸»è¦çš„æ”¶ç›Šå°±æ˜¯ä½¿ç”¨åœ¨æ•æ·å›¢é˜Ÿä¸­ï¼Œæ€»æœ‰ä¸€äº›ä½¿ç”¨æŸç§ä¾èµ–çš„åŸå› ï¼Œæœ‰æ—¶ä½ ä¼šåšæŒä½¿ç”¨æ—©å‰ç‰ˆæœ¬ä»¥å®ç°å…¼å®¹æ€§ã€‚æœ‰æ—¶ä½ å› ä¸ºç¼–è¯‘æ—¶é—´å’Œæ²¡æœ‰åå°„éœ€è¦ä½¿ç”¨ä¸€ä¸ªè§£æåº“é‡Œè€Œä¸æ˜¯å¦ä¸€ä¸ªã€‚æœ‰æ—¶ä½ éœ€è¦æ”¯æŒå¤šä¸ªå›½å®¶å¹¶ä¸”æ˜¯å”¯ä¸€çš„ä¾èµ–ï¼Œå³ä½¿ä»–ä¸æ˜¯æ ‡å‡†çš„åšæ³•ã€‚<br>æ‰€æœ‰è¿™ä¸ªåŸå› é€šå¸¸éƒ½ä¼šæ¶ˆå¤±åœ¨æ—¶é—´çš„è¿·é›¾ä¸­ï¼Œå¦‚æœå¹¸è¿çš„è¯ï¼Œå®ƒä»¬ä¼šå‡ºç°åœ¨ git commit message ä¸­ï¼ˆä½†æ˜¯è¯´å®è¯ï¼Œå®ƒä»¬ä¸ä¼šé¦–å…ˆè¢«æ£€æŸ¥ï¼‰ã€‚<br>ä½¿ç”¨ because å‡½æ•°å¯ä»¥ä½¿ä½ å¯¹ç‰¹å®šçš„ä¸šåŠ¡å†³ç­–è¿›è¡Œè¯´æ˜ï¼Œå¹¶æƒ³å›¢é˜Ÿå…¶ä»–æˆå‘˜æ˜ç¡®è¯´æ˜ä¸ºå•¥è¿™ä¹ˆåšã€‚ ä¸å¸Œæœ›/æŸ¥æ‰¾/å¿½ç•¥å’Œæ›´æ”¹ä¾èµ–é¡¹çš„äººä¸€èµ·èŠ‚çœæ—¶é—´ï¼Œç²¾åŠ›å’Œæ½œåœ¨çš„é”™è¯¯ã€‚<br>æ‰€ä»¥å¼€å§‹ä½¿ç”¨å®ƒï¼ ğŸ™‚<br><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">implementation(<span class="string">"com.blundell:android-blog:1.2.3"</span>) &#123;</span><br><span class="line">    because <span class="string">"If we didn't Blundell might cry."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="åŸæ–‡"><a href="#åŸæ–‡" class="headerlink" title="åŸæ–‡"></a>åŸæ–‡</h1><p><a href="https://blog.blundellapps.co.uk/tame-your-gradle-dependencies-just-because/3" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Gradle</tag>
        <tag>è¯‘æ–‡</tag>
      </tags>
  </entry>
  <entry>
    <title>AndroidX è¿ç§»è„šæœ¬å®ç°</title>
    <url>/2019/12/07/androidx-migrate-script/</url>
    <content><![CDATA[<h1 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h1><p>ç°åœ¨ Android 10 æ—©å·²ç»å‘å¸ƒ,å½“ targetVersion ä¸º29æ—¶å¿…é¡»ä½¿ç”¨ AndroidX å¹¶ä¸”ç°åœ¨æ–°å»ºé¡¹ç›®æ—¶å·²ç»å¿…é¡»å‹¾é€‰ AndriodX é€‰é¡¹äº†,æ‰€ä»¥éœ€è¦å¼€å§‹è¿ç§»å·¥ä½œäº†,æœ‰äº›ä¸‰æ–¹åº“ä¹Ÿåªæä¾› AndroidX ç‰ˆæœ¬,æˆ‘ä»¬é‡åˆ° QQ éŸ³ä¹å’Œ GoogleMap çš„ SDK å°±åªæä¾› AndroidX ç‰ˆæœ¬.å¦‚æœå¯¹äºå•ä¸ªå·¥ç¨‹è€Œè¨€åªéœ€è¦ Refactor-&gt;Migrate to AndroiX å³å¯ä»¥å®Œæˆè‡ªåŠ¨è¿ç§»,ä½†æ˜¯å¯¹äºæœ‰æ›´å¤šé¡¹ç›®è€Œè¨€ä½¿ç”¨è¿™æ ·çš„æ–¹å¼è™½ç„¶å¯ä»¥å®Œæˆè¿ç§»,ä½†æ˜¯å¤ªè¿‡äºç¹ç,ä¹Ÿä¸å¥½ç»Ÿä¸€ AndroidX åº“çš„ç‰ˆæœ¬.ä¸ºäº†æ–¹ä¾¿æ•´ä¸ªå›¢é˜Ÿé¡¹ç›®è¿›è¡Œè¿ç§»,æ‰€ä»¥ä½¿ç”¨è„šæœ¬è¿›è¡Œè¿ç§»ä¼šæ–¹ä¾¿å¾ˆå¤š.</p>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>æ•´ä¸ªæµç¨‹å¾ˆç®€å•</p>
<ol>
<li>checkout æ–°åˆ†æ”¯</li>
<li>å‡çº§æ–° gradle ç‰ˆæœ¬</li>
<li>å‡çº§ gradle tool ç‰ˆæœ¬</li>
<li>gradle.properties æ·»åŠ  AndroidX æ”¯æŒ</li>
<li>æ›¿æ¢å·¥ç¨‹é‡Œæ‰€æœ‰ support åŒ…å</li>
<li>æ›¿æ¢å·¥ç¨‹é‡Œæ‰€æœ‰ support ä¾èµ–</li>
<li>æ·»åŠ æ··æ·†æ–‡ä»¶</li>
</ol>
<p>æ¢³ç†å®Œæˆæµç¨‹,å°±å¯ä»¥åŠ¨æ‰‹è¿ç§»äº†.éœ€è¦æ³¨æ„ AndroidX å¿…é¡»ä½¿ç”¨ gradle tool 3.2 ç‰ˆæœ¬ä»¥ä¸Š,ä¸ºäº†ä¿è¯å…¼å®¹æ€§,å·¥ç¨‹å½“å‰æœ€å¥½ä½¿ç”¨ supprot 28 çš„ä¾èµ–.<br><a id="more"></a></p>
<h2 id="checkout-è¿ç§»æ–°åˆ†æ”¯"><a href="#checkout-è¿ç§»æ–°åˆ†æ”¯" class="headerlink" title="checkout è¿ç§»æ–°åˆ†æ”¯"></a>checkout è¿ç§»æ–°åˆ†æ”¯</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$(cd .. | git branch androidx_migrate)</span><br><span class="line">$(cd .. | git checkout androidx_migrate)</span><br></pre></td></tr></table></figure>
<h2 id="å‡çº§-gradle-ç‰ˆæœ¬"><a href="#å‡çº§-gradle-ç‰ˆæœ¬" class="headerlink" title="å‡çº§ gradle ç‰ˆæœ¬"></a>å‡çº§ gradle ç‰ˆæœ¬</h2><p>å°† gradle å‡çº§è‡³æœ€æ–°.<code>&gt;/dev/null</code>ç›¸å½“äºæ•è·å¼‚å¸¸ä¿¡æ¯.<br><code>./gradlew wrapper --gradle-version 5.4.1 &gt;/dev/null</code></p>
<h2 id="å‡çº§-gradle-tools"><a href="#å‡çº§-gradle-tools" class="headerlink" title="å‡çº§ gradle tools"></a>å‡çº§ gradle tools</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span>(sed -i "" "s/com.android.tools.build:gradle:.*/com.android.tools.build:gradle:3.5.2/g" $&#123;BUILD_FILE&#125;)</span><br></pre></td></tr></table></figure>
<p><code>${BUILD_FILE}</code>ä¸ºæ ¹ç›®å½•çš„<code>build.gradle</code>,æ›¿æ¢æ‰è€ç‰ˆæœ¬.æ³¨æ„è¿™é‡Œçš„ gradle tool åº”è¯¥ä¸ gradle ç‰ˆæœ¬å¯¹åº”.</p>
<h2 id="ä¿®æ”¹-gradle-properties"><a href="#ä¿®æ”¹-gradle-properties" class="headerlink" title="ä¿®æ”¹ gradle.properties"></a>ä¿®æ”¹ gradle.properties</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo '\nandroid.useAndroidX=true</span><br><span class="line">android.enableJetifier=true' &gt;&gt;$PROJECT_DIR/gradle.properties</span><br></pre></td></tr></table></figure>
<p><code>android.useAndroidX=true</code>Android æ’ä»¶ä¼šä½¿ç”¨å¯¹åº”çš„ AndroidX åº“ï¼ˆè€Œéæ”¯æŒåº“ï¼‰<br><code>android.enableJetifier=true</code>Android æ’ä»¶ä¼šé€šè¿‡é‡å†™å…¶äºŒè¿›åˆ¶æ–‡ä»¶æ¥è‡ªåŠ¨è¿ç§»ç°æœ‰çš„ç¬¬ä¸‰æ–¹åº“ä»¥ä½¿ç”¨ AndroidX</p>
<h2 id="æ›¿æ¢-support-åŒ…"><a href="#æ›¿æ¢-support-åŒ…" class="headerlink" title="æ›¿æ¢ support åŒ…"></a>æ›¿æ¢ support åŒ…</h2><p>é¦–å…ˆåº”è¯¥æ‰¾åˆ° support ä¸ androidx çš„å¯¹åº”å…³ç³»,ä¸è¿‡ google å·²ç»å¸®æˆ‘ä»¬æ•´ç†å¥½è¿™ä»½<a href="https://developer.android.com/jetpack/androidx/migrate/class-mappings" target="_blank" rel="noopener">æ–‡æ¡£</a>,é€šè¿‡å…³ç³»å‘½ä»¤è¡Œæ›¿æ¢æ‰ç›¸åº”çš„åŒ…åå°±å¯ä»¥äº†<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">from_pkgs=""</span><br><span class="line">replace=""</span><br><span class="line">while IFS=, read -r from_pkg to_pkg</span><br><span class="line">do</span><br><span class="line">    from_pkgs+=" -e $from_pkg"</span><br><span class="line">    replace+="; s/$from_pkg/$to_pkg/g"</span><br><span class="line">done &lt;&lt;&lt; "$(tail -n +2 $MAPPING_FILE)"</span><br><span class="line"></span><br><span class="line">rg --files-with-matches -t java -t kotlin -t xml -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e "$replace"</span><br></pre></td></tr></table></figure></p>
<p><code>$MAPPING_FILE)</code>ä¸º androidx_class_map.csv çš„ç›®å½•,è¿™ä¸ªæ–‡ä»¶å°±æ˜¯ gooogle æä¾›çš„æ–‡æ¡£,ä½†æ˜¯ç”¨å®˜æ–¹çš„æ–‡ä»¶å‡ºç°äº†æ›¿æ¢åå¯¹åº”ä¸æ­£ç¡®çš„é—®é¢˜,æˆ‘è‡ªå·±æ”¹å˜ä¸‹æ–‡ä»¶é‡Œçš„é¡ºåºå,åˆ™å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†.<br><code>$(tail -n +2 $MAPPING_FILE)</code>ç›¸å½“äº<code>cat</code>åªæ˜¯ä»ç¬¬2è¡Œè¯»å–åˆ°æ–‡ä»¶ç»“å°¾.å› ä¸ºç¬¬1è¡Œé support å¯¹åº”å…³ç³».<br><code>replace+=&quot;; s/$from_pkg/$to_pkg/g&quot;</code>æ˜¯ç”¨æ¥è¿›è¡Œæ›¿æ¢çš„è§„åˆ™,ä½¿ç”¨è¿‡<code>sed</code>å°±å¯ä»¥ç†è§£è¿™ä¸ªæ“ä½œ.æ„ä¸ºå°†æœ¬è¡Œé‡Œçš„<code>$to_pkg</code>æ›¿æ¢ä¸º<code>$from_pkg</code>,å½“æœ‰å¤šä¸ªå†…å®¹æ›¿æ¢æ—¶ç”¨<code>;</code>åˆ†éš”.<br><code>rg</code>æ˜¯æ¯”<code>find</code>æ›´å¿«çš„æœç´¢å·¥å…·.é€šè¿‡<code>rg</code>æœç´¢åˆ°æˆ‘ä»¬éœ€è¦æ›¿æ¢çš„æ–‡ä»¶ç±»å‹,å®ƒå†…ç½®äº†å¾ˆå¤šæ–‡ä»¶ç±»å‹,æ–‡æœ«å‚è€ƒé‡Œæœ‰è¯¦ç»†æ•™ç¨‹.<code>xml</code>é‡Œçš„å¸ƒå±€ä¹Ÿéœ€è¦æ›¿æ¢æ‰,æ‰€ä»¥ä¹Ÿéœ€è¦æŠŠåŒ…å« support åŒ…çš„ç›¸å…³æ–‡ä»¶æœç´¢å‡ºæ¥.<br><code>xargs</code>æ˜¯ç»™å…¶ä»–å‘½ä»¤ä¼ é€’å‚æ•°çš„ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä¹Ÿæ˜¯ç»„åˆå¤šä¸ªå‘½ä»¤çš„ä¸€ä¸ªå·¥å…·.<br><code>perl</code>çš„æ­£åˆ™æ”¯æŒæ¯”<code>sed</code>å¥½å¾ˆå¤š,æ‰€ä»¥ä½¿ç”¨å®ƒå¯ä»¥å°‘è¸©å¾ˆå¤šæ­£åˆ™ä¸Šçš„å‘.</p>
<h2 id="æ›¿æ¢-support-ä¾èµ–"><a href="#æ›¿æ¢-support-ä¾èµ–" class="headerlink" title="æ›¿æ¢ support ä¾èµ–"></a>æ›¿æ¢ support ä¾èµ–</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">from_pkgs=""</span><br><span class="line">replace=""</span><br><span class="line">while IFS=, read -r from_pkg to_pkg</span><br><span class="line">do</span><br><span class="line">    from_pkgs+=" -e $from_pkg"</span><br><span class="line">    replace+="; s/(\"|')$from_pkg.*(\"|')/\"$to_pkg\"/g"</span><br><span class="line">    #å¦‚æœä½¿ç”¨sed æ­£åˆ™å°±éœ€è¦å†™æˆè¿™ç§å½¢å¼,å¤ªè¿‡ç¹çäº†</span><br><span class="line">    #replace+="; s/\(\\\"\|'\)$from_pkg.*\(\\\"\|'\)/\\\"$to_pkg\\\"/g"</span><br><span class="line">done &lt;&lt;&lt; "$(tail -n +2 $ARTIFACT_MAPPING_FILE)"</span><br><span class="line"></span><br><span class="line">rg --files-with-matches -t groovy -F $from_pkgs $PROJECT_DIR | xargs perl -pi -e "$replace"</span><br></pre></td></tr></table></figure>
<p>å’Œæ›¿æ¢ support åŒ…çš„ä»£ç å·®ä¸å¤š,åªæ˜¯æ¢äº†è¯»å–çš„æ–‡ä»¶,åªæ˜¯è¿™é‡Œçš„æ­£åˆ™ç¨æœ‰ç¨æœ‰ä¸åŒ.<br>åœ¨é¡¹ç›®é‡Œä¼šæœ‰å„ç§å½¢å¼çš„ä¾èµ–å†™æ³•å¦‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">api &quot;com.android.support:support-v4:$&#123;rootProject.ext.supportLibVersion&#125;&quot;</span><br><span class="line">api &quot;com.android.support:support-v4:28.0.0&quot;</span><br><span class="line">api &apos;com.android.support:support-v4:28.0.0&apos;</span><br></pre></td></tr></table></figure></p>
<p>æ‰€ä»¥éœ€è¦<code>(&quot;|&#39;)package.*(&quot;|&#39;)</code>åŒ¹é…æ‰€æœ‰çš„å½¢å¼å»æ›¿æ¢æˆæˆ‘ä»¬éœ€è¦çš„ç‰ˆæœ¬.<br><code>$ARTIFACT_MAPPING_FILE</code>ä¸ºä¾èµ–çš„æ˜ å°„æ–‡ä»¶.<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Old build artifact,AndroidX build artifact</span><br><span class="line">com.android.support:support-v4:,androidx.legacy:legacy-support-v4:1.0.0</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„<code>1.0.0</code>åˆ™å¯ä»¥å†™æˆç»Ÿä¸€çš„ä¾èµ–ç‰ˆæœ¬.æ¯”å¦‚<code>${rootProject.ext.v4Version}</code>è¿™æ ·å¯¹äºä¾¿äºç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†.</p>
<h2 id="æ··æ·†æ–‡ä»¶"><a href="#æ··æ·†æ–‡ä»¶" class="headerlink" title="æ··æ·†æ–‡ä»¶"></a>æ··æ·†æ–‡ä»¶</h2><p>ç”±äºåŒ…åå˜åŒ–æ‰€ä»¥éœ€è¦æ–°å¢æ··æ·†æ–‡ä»¶å¦‚<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-dontwarn com.google.android.material.**</span><br><span class="line">-keep class com.google.android.material.** &#123; *; &#125;</span><br><span class="line"></span><br><span class="line">-dontwarn androidx.**</span><br><span class="line">-keep class androidx.** &#123; *; &#125;</span><br><span class="line">-keep interface androidx.** &#123; *; &#125;</span><br></pre></td></tr></table></figure></p>
<p>æ€»ç»“<br>è‡³æ­¤å°±å®Œæˆè¿™ä¸ªé‚£ä¸ªé¡¹ç›®è¿ç§»,æ•´ä¸ªè¿‡ç¨‹æ ¹æ®å·¥ç¨‹å¤§å°ä¼šè€—æ—¶å‡ åˆ°å‡ åç§’é’Ÿ,å¤§é‡çš„æ—¶é—´æ¶ˆè€—åœ¨å‡çº§ gradle,æ£€ç´¢æ›¿æ¢æ–‡ä»¶è€—æ—¶å¾ˆå°‘.æŒæ¡ä¸€äº›è„šæœ¬å¯ä»¥æå¤§çš„æé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡.<br><a href="https://github.com/Thewhitelight/androidx_migrate_scripts">è¿ç§»è„šæœ¬æºç </a></p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://www.hi-linux.com/posts/29245.html" target="_blank" rel="noopener">rg æ•™ç¨‹</a><br><a href="https://developer.android.com/jetpack/androidx" target="_blank" rel="noopener">å®˜æ–¹è¿ç§»æ–‡æ¡£</a><br><a href="https://gist.github.com/loganj/7535a13e98be83460f362b63dbd13e07" target="_blank" rel="noopener">å‚è€ƒè¿ç§»è„šæœ¬</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>æå– Git Messages ç”Ÿæˆ ChangeLog</title>
    <url>/2019/11/18/git-commit-message-generate-changelog/</url>
    <content><![CDATA[<h1 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h1><p>éšç€ç‰ˆæœ¬è¿­ä»£è¶Šæ¥è¶Šå¤š,æˆ‘ä»¬éœ€è¦æ¯æ¬¡æ‰‹åŠ¨ä¿®æ”¹ ChangeLog,å¤šäººç»´æŠ¤é¡¹ç›®åˆ™å®¹æ˜“å¿˜è®°å¡«å†™,å¹¶ä¸”ç»„ä»¶åŒ–åæ¯ä¸ªæ¨¡å—å¤šäººç»´æŠ¤,å®¹æ˜“å¿˜è®°å¡«å†™.Module é‡Œå¡«å†™äº† ChangeLog ä½†æ˜¯ App å£³é¡¹ç›®ä¹Ÿè¦å¡«å†™ç›¸åŒå†…å®¹,ä¹Ÿæ˜¯æ¯”è¾ƒéº»çƒ¦çš„äº‹.æ‰€ä»¥éœ€è¦å¼•å…¥è‡ªåŠ¨åŒ–æ¥é™ä½æˆ‘ä»¬æ‰‹åŠ¨ç»´æŠ¤çš„æˆæœ¬.<br><a id="more"></a></p>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>ä¸»è¦é—®é¢˜æ˜¯è§£å†³æ‰‹åŠ¨ç»´æŠ¤çš„é—®é¢˜,æ‰€ä»¥è§£å†³åŠæ³•è‡ªç„¶è€Œç„¶å°±æ˜¯ä½¿ç”¨è‡ªåŠ¨åŒ–æ–¹æ¡ˆ,é‚£ä¹ˆæ€ä¹ˆäº¤ç»™è‡ªåŠ¨åŒ–å¤„ç†å‘¢,è‡ªç„¶æ˜¯äº¤ç»™ Git å’Œ Shell äº†.æˆ‘ä»¬é€šè¿‡è·å–æœ€è¿‘ä¸¤ä¸ª git tag ä¹‹é—´æ‰€æœ‰çš„ commit message,ç„¶åç­›é€‰ç¬¦åˆè§„åˆ™çš„ messge,æŠŠè¿™äº› message åˆæˆç„¶åç”Ÿæˆ ChangeLog,è¿™æ ·å°±ç”Ÿæˆ Modlue çš„ ChangeLog,ç„¶åæˆ‘ä»¬å¯ä»¥æŠŠ ChangeLog æ–‡ä»¶æ¨åˆ°ä¸€ä¸ªæŒ‡å®šä»“åº“é‡Œ,ç„¶åé€šè¿‡ç‰¹å®šè„šæœ¬åˆæˆ App çš„ ChangeLog.ä¸ºäº†è§„èŒƒ commit message ,æ‰€ä»¥ä¹Ÿéœ€è¦ç”¨åˆ° git hook åœ¨ commit çš„æ—¶å€™å»æ£€æŸ¥ message æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„è§„èŒƒ.</p>
<h2 id="commit-message-è§„èŒƒ"><a href="#commit-message-è§„èŒƒ" class="headerlink" title="commit message è§„èŒƒ"></a>commit message è§„èŒƒ</h2><p>è¦ç”Ÿæˆ ChangeLog å°±éœ€è¦å¡«å†™ç¬¦åˆè§„åˆ™çš„ message,æˆ‘ä»¬å‚è€ƒ<a href="https://github.com/angular/angular/commits/master">Angular Commit è§„èŒƒ</a>,ç„¶ååšäº†ç›¸åº”çš„ç®€åŒ–.<br>commit message æ ¼å¼:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type: subject</span><br><span class="line"></span><br><span class="line">body</span><br><span class="line"></span><br><span class="line">footer</span><br></pre></td></tr></table></figure></p>
<h3 id="header"><a href="#header" class="headerlink" title="header"></a>header</h3><p>Header éƒ¨åˆ†åªæœ‰ä¸€è¡Œï¼ŒåŒ…æ‹¬ä¸¤ä¸ªå­—æ®µï¼štypeï¼ˆå¿…éœ€ï¼‰å’Œ subjectï¼ˆå¿…éœ€ï¼‰ã€‚</p>
<h4 id="type-ç”¨äºè¯´æ˜-commit-çš„ç±»åˆ«ï¼Œåªå…è®¸ä½¿ç”¨ä¸‹é¢3ä¸ªæ ‡è¯†ã€‚"><a href="#type-ç”¨äºè¯´æ˜-commit-çš„ç±»åˆ«ï¼Œåªå…è®¸ä½¿ç”¨ä¸‹é¢3ä¸ªæ ‡è¯†ã€‚" class="headerlink" title="type ç”¨äºè¯´æ˜ commit çš„ç±»åˆ«ï¼Œåªå…è®¸ä½¿ç”¨ä¸‹é¢3ä¸ªæ ‡è¯†ã€‚"></a>type ç”¨äºè¯´æ˜ commit çš„ç±»åˆ«ï¼Œåªå…è®¸ä½¿ç”¨ä¸‹é¢3ä¸ªæ ‡è¯†ã€‚</h4><ul>
<li>feat æ–°åŠŸèƒ½ï¼ˆfeatureï¼‰</li>
<li>fix ä¿®è¡¥bug</li>
<li>other</li>
</ul>
<p>å¦‚æœ type ä¸º feat å’Œ fixï¼Œåˆ™è¯¥ commit å°†è‚¯å®šå‡ºç°åœ¨ Change log ä¹‹ä¸­ã€‚<br><strong>å¦‚æœ type ä¸º feat å’Œ fixï¼Œåˆ™è¯¥ commit å°†è‚¯å®šå‡ºç°åœ¨ Change log ä¹‹ä¸­ã€‚</strong></p>
<h4 id="subject-æ˜¯-commit-ç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡50ä¸ªå­—ç¬¦ã€‚"><a href="#subject-æ˜¯-commit-ç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡50ä¸ªå­—ç¬¦ã€‚" class="headerlink" title="subject æ˜¯ commit ç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡50ä¸ªå­—ç¬¦ã€‚"></a>subject æ˜¯ commit ç›®çš„çš„ç®€çŸ­æè¿°ï¼Œä¸è¶…è¿‡50ä¸ªå­—ç¬¦ã€‚</h4><p>ä»¥åŠ¨è¯å¼€å¤´ï¼Œä½¿ç”¨ç¬¬ä¸€äººç§°ç°åœ¨æ—¶ï¼Œæ¯”å¦‚ changeï¼Œè€Œä¸æ˜¯ changed æˆ– changes<br>ç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™<br>ç»“å°¾ä¸åŠ å¥å·</p>
<h3 id="body-æè¿°ä¸ºä»€ä¹ˆä¿®æ”¹-åšäº†ä»€ä¹ˆæ ·çš„ä¿®æ”¹-ä»¥åŠå¼€å‘çš„æ€è·¯ç­‰ç­‰"><a href="#body-æè¿°ä¸ºä»€ä¹ˆä¿®æ”¹-åšäº†ä»€ä¹ˆæ ·çš„ä¿®æ”¹-ä»¥åŠå¼€å‘çš„æ€è·¯ç­‰ç­‰" class="headerlink" title="body æè¿°ä¸ºä»€ä¹ˆä¿®æ”¹, åšäº†ä»€ä¹ˆæ ·çš„ä¿®æ”¹, ä»¥åŠå¼€å‘çš„æ€è·¯ç­‰ç­‰"></a>body æè¿°ä¸ºä»€ä¹ˆä¿®æ”¹, åšäº†ä»€ä¹ˆæ ·çš„ä¿®æ”¹, ä»¥åŠå¼€å‘çš„æ€è·¯ç­‰ç­‰</h3><h3 id="footer-æ”¾-Breaking-Changes-æˆ–-Closed-Issues"><a href="#footer-æ”¾-Breaking-Changes-æˆ–-Closed-Issues" class="headerlink" title="footer æ”¾ Breaking Changes æˆ– Closed Issues"></a>footer æ”¾ Breaking Changes æˆ– Closed Issues</h3><h2 id="Git-Commit-å·¥å…·"><a href="#Git-Commit-å·¥å…·" class="headerlink" title="Git Commit å·¥å…·"></a>Git Commit å·¥å…·</h2><p>Messageè§„åˆ™å¾ˆç®€å•,å¦‚æœå…»æˆä¹ æƒ¯å¾ˆå®¹æ˜“ä¸Šæ‰‹,å¦‚æœåˆšå¼€å§‹ä¸é€‚åº”å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•</p>
<h3 id="é…ç½®-git-æ¨¡ç‰ˆ"><a href="#é…ç½®-git-æ¨¡ç‰ˆ" class="headerlink" title="é…ç½® git æ¨¡ç‰ˆ"></a>é…ç½® git æ¨¡ç‰ˆ</h3><ol>
<li><p>åœ¨gitå…¨å±€é…ç½®é‡Œè¿›è¡Œè®¾ç½®ï¼Œlinx/mac è¿›å…¥æ–‡ä»¶<code>.gitconfig</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vi ~/.gitconfig</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‹¥ä¸å­˜åœ¨[commit] templateï¼Œåˆ™è®¾ç½®å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[commit]</span><br><span class="line">        template = /Users/&lt;name&gt;/.myCommitMsg</span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¾ç½®æ¨¡æ¿å®Œæ¯•åï¼Œä¸‹ä¸€æ­¥è¿›è¡Œæ¨¡æ¿å†…å®¹çš„ä¿®æ”¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ vi /Users/&lt;name&gt;/.myCommitMsg</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ç²˜å…¥ä»¥ä¸‹å†…å®¹ä¿å­˜å³å¯<br>æ¨¡ç‰ˆå¯ä»¥æ ¹æ®è‡ªå·±å–œå¥½éšæ„é…ç½®,ä½†æ˜¯ Header çš„æ ¼å¼å’Œå†…å®¹ä¸€å®šè¦ä¿è¯æ­£ç¡®<br>ä½¿ç”¨æ—¶ä¿®æ”¹ä¸ºè‡ªå·±æäº¤çš„å†…å®¹<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type: subject</span><br><span class="line"></span><br><span class="line">body</span><br><span class="line"></span><br><span class="line">footer</span><br><span class="line"></span><br><span class="line"># - type: </span><br><span class="line">#    feat(æ–°ç‰¹æ€§), </span><br><span class="line">#    fix(ä¿®æ”¹é—®é¢˜), </span><br><span class="line">#    other(å…¶ä»–ä»»ä½•ä¿®æ”¹), </span><br><span class="line"># - subject</span><br><span class="line">#   æäº¤æè¿°</span><br><span class="line"># - body:</span><br><span class="line">#    æè¿°ä¸ºä»€ä¹ˆä¿®æ”¹, åšäº†ä»€ä¹ˆæ ·çš„ä¿®æ”¹, ä»¥åŠå¼€å‘çš„æ€è·¯</span><br><span class="line"># - footer:</span><br><span class="line">#    æ”¾ Breaking Changes æˆ– Closed Issues</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>è‹¥ä½¿ç”¨ terminal åˆ™ä½¿ç”¨<code>git commit</code></li>
</ol>
<p>è‹¥ä½¿ç”¨ sourcetree ç­‰ git ç®¡ç†è½¯ä»¶ï¼Œåˆ™éœ€è¦é‡å¯è½¯ä»¶æ‰èƒ½ç”Ÿæ•ˆã€‚</p>
<h3 id="Sourcetree"><a href="#Sourcetree" class="headerlink" title="Sourcetree"></a>Sourcetree</h3><p>è®¾ç½®-&gt;æäº¤æ¨¡ç‰ˆ-&gt;è‡ªå®šä¹‰,å¯ä»¥ä½¿ç”¨å¡«å…¥ä¸Šè¿°æ¨¡ç‰ˆ,å¹¶ä¸”åªé’ˆå¯¹æ­¤é¡¹ç›®ç”Ÿæ•ˆ.å¦‚æœä½¿ç”¨å…¨å±€é…ç½®,å‚è€ƒä¸Šæ¡é…ç½®æ–¹å¼.</p>
<h3 id="git-cz"><a href="#git-cz" class="headerlink" title="git cz"></a>git cz</h3><p>å®‰è£…<a href="https://github.com/commitizen/cz-cli">git cz</a><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g commitizen cz-conventional-changelog</span><br><span class="line">echo &apos;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&apos; &gt; ~/.czrc</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨<code>git cz</code>ä»£æ›¿<code>git commit</code>å‘½ä»¤,ä¼šå‡ºç°æäº¤é€‰é¡¹,æŒ‰è§„åˆ™æäº¤å°±å¯ä»¥,å¦‚ä¸‹æ‰€ç¤º</p>
<p><img src="https://raw.githubusercontent.com/commitizen/cz-cli/master/meta/screenshots/add-commit.png" alt></p>
<p>ç„¶ååœ¨æ ¹æ®å¯¹åº”çš„æç¤ºä¸‹,å†™å…¥å†…å®¹å³å¯å®Œæˆä¸€æ¬¡æäº¤<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">âœ  sh git:(master) âœ— git cz</span><br><span class="line">cz-cli@4.0.3, cz-conventional-changelog@3.0.1</span><br><span class="line"></span><br><span class="line">? Select the type of change that you're committing: feat:        A new feature</span><br><span class="line">? What is the scope of this change (e.g. component or file name): (press enter t</span><br><span class="line">o skip)</span><br><span class="line">? Write a short, imperative tense description of the change (max 94 chars):</span><br><span class="line"> (4) test</span><br><span class="line">? Provide a longer description of the change: (press enter to skip)</span><br><span class="line"></span><br><span class="line">? Are there any breaking changes? Yes</span><br><span class="line">? A BREAKING CHANGE commit requires a body. Please enter a longer description of the commit</span><br><span class="line">itself:</span><br><span class="line"> -</span><br><span class="line">? Describe the breaking changes:</span><br><span class="line"></span><br><span class="line">? Does this change affect any open issues? No</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯æ­¤æ ¼å¼ä¸ç¬¦åˆæˆ‘ä»¬çš„è§„èŒƒ,å·²ç»ä¸èƒ½ä½¿ç”¨.</p>
<h3 id="Android-Studio-Commit-Message-æ’ä»¶"><a href="#Android-Studio-Commit-Message-æ’ä»¶" class="headerlink" title="Android Studio Commit Message æ’ä»¶"></a>Android Studio Commit Message æ’ä»¶</h3><p>ä½¿ç”¨<a href="https://plugins.jetbrains.com/plugin/9364-commit-message-template" target="_blank" rel="noopener">Commit Message Template</a>åœ¨<code>Settings &gt; Tools &gt; Commit Message Template</code>ä¸­å¡«å…¥æ–‡ç« å¼€å§‹çš„æ ¼å¼.</p>
<h3 id="git-cz-1"><a href="#git-cz-1" class="headerlink" title="git cz"></a>git cz</h3><p>å®‰è£…<a href="https://github.com/commitizen/cz-cli">git cz</a><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g commitizen cz-conventional-changelog</span><br><span class="line">echo &apos;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&apos; &gt; ~/.czrc</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯æ­¤æ ¼å¼ä¸ç¬¦åˆæˆ‘ä»¬çš„è§„èŒƒ,å·²ç»ä¸èƒ½ä½¿ç”¨.</p>
<h3 id="Android-Studio-Commit-Message-æ’ä»¶-1"><a href="#Android-Studio-Commit-Message-æ’ä»¶-1" class="headerlink" title="Android Studio Commit Message æ’ä»¶"></a>Android Studio Commit Message æ’ä»¶</h3><p>ä½¿ç”¨<a href="https://plugins.jetbrains.com/plugin/9364-commit-message-template" target="_blank" rel="noopener">Commit Message Template</a>åœ¨<code>Settings &gt; Tools &gt; Commit Message Template</code>ä¸­å¡«å…¥æ–‡ç« å¼€å§‹çš„æ ¼å¼.</p>
<h3 id="git-cz-2"><a href="#git-cz-2" class="headerlink" title="git cz"></a>git cz</h3><p>å®‰è£…<a href="https://github.com/commitizen/cz-cli">git cz</a><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g commitizen cz-conventional-changelog</span><br><span class="line">echo &apos;&#123; &quot;path&quot;: &quot;cz-conventional-changelog&quot; &#125;&apos; &gt; ~/.czrc</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨<code>git cz</code>ä»£æ›¿<code>git commit</code>å‘½ä»¤,ä¼šå‡ºç°æäº¤é€‰é¡¹,æŒ‰è§„åˆ™æäº¤å°±å¯ä»¥,å¦‚ä¸‹æ‰€ç¤º<br>ä½†æ˜¯æ­¤æ ¼å¼ä¸ç¬¦åˆæˆ‘ä»¬çš„è§„èŒƒ,å·²ç»ä¸èƒ½ä½¿ç”¨.</p>
<h3 id="Android-Studio-Commit-Message-æ’ä»¶-2"><a href="#Android-Studio-Commit-Message-æ’ä»¶-2" class="headerlink" title="Android Studio Commit Message æ’ä»¶"></a>Android Studio Commit Message æ’ä»¶</h3><p>ä½¿ç”¨<a href="https://plugins.jetbrains.com/plugin/9364-commit-message-template" target="_blank" rel="noopener">Commit Message Template</a>åœ¨<code>Settings &gt; Tools &gt; Commit Message Template</code>ä¸­å¡«å…¥æ–‡ç« å¼€å§‹çš„æ ¼å¼.<br>è¿™æ ·å°±å¯ä»¥åœ¨æäº¤æ—¶ç‚¹å‡»é€‰æ‹©æ¨¡ç‰ˆ,æˆ‘ä»¬åŸºäºæ¨¡ç‰ˆä¿®æ”¹å°±å¯ä»¥äº†.</p>
<h2 id="ç”Ÿæˆ-Module-çš„-ChangeLog"><a href="#ç”Ÿæˆ-Module-çš„-ChangeLog" class="headerlink" title="ç”Ÿæˆ Module çš„ ChangeLog"></a>ç”Ÿæˆ Module çš„ ChangeLog</h2><p>ç®€å•å½’çº³æ­¥éª¤å¦‚ä¸‹:</p>
<ol>
<li>git tag è·å–æœ€è¿‘çš„ä¸¤ä¸ªtag</li>
<li>è·å–ä¸¤ä¸ªtagä¹‹é—´çš„commit message</li>
<li>ä½¿ç”¨è„šæœ¬æ¸…æ´— log,ç­›é€‰ç¬¦åˆè§„åˆ™çš„ message</li>
<li>ç”Ÿæˆchangelog.md<br>è„šæœ¬ä½¿ç”¨ shell ç¼–å†™,æ‰€ä»¥å¯¹å…¶éœ€è¦æœ‰ç¨å¾®çš„äº†è§£.</li>
</ol>
<h3 id="è·å–æœ€è¿‘ä¸¤ä¸ª-tag"><a href="#è·å–æœ€è¿‘ä¸¤ä¸ª-tag" class="headerlink" title="è·å–æœ€è¿‘ä¸¤ä¸ª tag"></a>è·å–æœ€è¿‘ä¸¤ä¸ª tag</h3><p>å¦‚æœæœªè¾“å…¥ä¸¤ä¸ª tag,åˆ™è·å–æœ€è¿‘çš„ä¸¤ä¸ª tag<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> è·å–æœ€è¿‘æäº¤çš„ä¸¤ä¸ª tag</span><br><span class="line">function getAutoTag()&#123;</span><br><span class="line"><span class="meta">#</span> æ ¹æ®æ—¥æœŸæ’åºè·å–æ‰€æœ‰tag</span><br><span class="line">current_git_tags=$(git tag --sort=taggerdate)</span><br><span class="line">for word in $&#123;current_git_tags&#125;</span><br><span class="line">do</span><br><span class="line">    tags[temp]=$&#123;word&#125;</span><br><span class="line">    ((++temp))</span><br><span class="line">done</span><br><span class="line"><span class="meta">#</span> è·å–æœ€è¿‘çš„ä¸¤ä¸ª tag</span><br><span class="line">tag1=$&#123;tags[temp-2]&#125;</span><br><span class="line">tag2=$&#123;tags[temp-1]&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="è·å–ä¸¤ä¸ª-tag-æˆ–è€…-commitId-ä¹‹é—´æ‰€æœ‰çš„-message"><a href="#è·å–ä¸¤ä¸ª-tag-æˆ–è€…-commitId-ä¹‹é—´æ‰€æœ‰çš„-message" class="headerlink" title="è·å–ä¸¤ä¸ª tag æˆ–è€… commitId ä¹‹é—´æ‰€æœ‰çš„ message"></a>è·å–ä¸¤ä¸ª tag æˆ–è€… commitId ä¹‹é—´æ‰€æœ‰çš„ message</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> è·å–ä¸¤ä¸ª commitId ä¹‹é—´çš„ message</span><br><span class="line">function getInputCommitId()&#123;</span><br><span class="line">tag2=$&#123;input2&#125;</span><br><span class="line">tag1=$&#123;input1&#125;</span><br><span class="line"><span class="meta">#</span> è·å–çš„ message åŒºé—´ä¸º[)</span><br><span class="line">git log --pretty=format:"%s" $&#123;tag2&#125;...$&#123;tag1&#125; &gt;commits.txt</span><br><span class="line"><span class="meta">#</span> å†™å…¥ç©ºæ ¼</span><br><span class="line">echo  &gt;&gt;commits.txt</span><br><span class="line"><span class="meta">#</span> è·å–ç¬¬äºŒä¸ªè¾“å…¥ commitId çš„ message</span><br><span class="line">git log --pretty=format:"%s" $&#123;tag1&#125; -1 &gt;&gt;commits.txt</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> è·å–ä¸¤ä¸ªtagä¹‹é—´æ‰€æœ‰çš„ message</span><br><span class="line">function getTagMessages()&#123;</span><br><span class="line">getAutoTag</span><br><span class="line">echo $tag2  $tag1</span><br><span class="line">if [[ "" = $&#123;tag1&#125; ]]</span><br><span class="line">    then</span><br><span class="line"><span class="meta">#</span> å¦‚æœä¸ºè·å–åˆ°åæäº¤çš„ tag,åˆ™è·å–å…ˆæäº¤ tag ä»¥å‰æ‰€æœ‰çš„ message,å¹¶å†™å…¥åˆ° commits.txtæ–‡ä»¶é‡Œ</span><br><span class="line">    git log --pretty=format:"%s" $&#123;tag2&#125; &gt;commits.txt</span><br><span class="line">else</span><br><span class="line">git log --pretty=format:"%s" $&#123;tag2&#125;...$&#123;tag1&#125; &gt;commits.txt</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span> å°†ä¸¤ä¸ªtagä¹‹é—´çš„æ‰€æœ‰commit messageå†™å…¥commits.txt</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±è·å–äº†æ‰€æœ‰çš„ messageå¹¶å†™å…¥åˆ°äº†commits.txtæ–‡ä»¶ä¸­,ç°åœ¨éœ€è¦åšçš„å°±æ˜¯æ¸…æ´—æäº¤è®°å½•</p>
<h3 id="ç­›é€‰ç¬¦åˆè§„åˆ™çš„-message"><a href="#ç­›é€‰ç¬¦åˆè§„åˆ™çš„-message" class="headerlink" title="ç­›é€‰ç¬¦åˆè§„åˆ™çš„ message"></a>ç­›é€‰ç¬¦åˆè§„åˆ™çš„ message</h3><p>ä¸Šä¸€æ­¥æˆ‘ä»¬æŠŠæ‰€æœ‰çš„ message å†™å…¥åˆ°äº† commits æ–‡ä»¶ä¸­å»,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠæ–‡ä»¶è¯»å‡ºæ¥è¿›è¡Œç­›é€‰,è·å¾—ç¬¦åˆè§„èŒƒçš„ message<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> ä½¿ç”¨æ­£åˆ™åˆ¤æ–­ commits.txt æ¯è¡Œå¼€å¤´æ˜¯å¦ç¬¦åˆæˆ‘å—¯çš„è§„åˆ™,å¹¶ç”Ÿæˆfeat.txtå’Œfix.txt</span><br><span class="line">function generateDoc()&#123;</span><br><span class="line">    # $1 ä»£è¡¨æ–¹æ³• ç¬¬ä¸€ä¸ªå…¥å‚æ•°,æ–¹æ³•å‚æ•°ä¸ºæ¯è¡Œæ–‡æœ¬</span><br><span class="line">    if [[ "$1" =~ ^feat.*:$ ]]</span><br><span class="line">        then</span><br><span class="line">        # msg ä»£è¡¨ feat: åæ‰€æœ‰çš„æ–‡æœ¬</span><br><span class="line">        msg="$&#123;@:2&#125;"</span><br><span class="line">        echo $&#123;msg&#125; &gt;&gt; feat.txt</span><br><span class="line">    elif [[ "$1" =~ ^fix.*:$ ]]</span><br><span class="line">        then</span><br><span class="line">        # msg ä»£è¡¨ fix: åæ‰€æœ‰çš„æ–‡æœ¬</span><br><span class="line">        msg="$&#123;@:2&#125;"</span><br><span class="line">        echo $msg &gt;&gt; fix.txt</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> è¯»å– commits.txt æ¯è¡Œæ–‡æœ¬</span><br><span class="line">while read line || [[ -n $&#123;line&#125; ]]</span><br><span class="line">do</span><br><span class="line">    message=$&#123;line&#125;</span><br><span class="line">    generateDoc $&#123;message&#125;</span><br><span class="line">done &lt; commits.txt</span><br><span class="line"><span class="meta">#</span> åˆ é™¤ commits.txt</span><br><span class="line"><span class="meta">$</span>(rm -rf commits.txt)</span><br></pre></td></tr></table></figure></p>
<h3 id="åˆæˆ-ChangeLog"><a href="#åˆæˆ-ChangeLog" class="headerlink" title="åˆæˆ ChangeLog"></a>åˆæˆ ChangeLog</h3><p>é€šè¿‡åˆ†åˆ«è¯»å– feat.txt å’Œ fix.txt æ–‡ä»¶åˆæˆ ChangeLog<br><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span> ç”Ÿæˆtagæ ‡é¢˜</span><br><span class="line"><span class="meta">#</span> inputType=2 ä»£è¡¨ä½¿ç”¨ commitId ç”Ÿæˆ log</span><br><span class="line">if [[ $&#123;inputType&#125; = "2" ]]</span><br><span class="line">    then</span><br><span class="line">    branch=$(git symbolic-ref --short -q HEAD)</span><br><span class="line">    time=$(git log --pretty=format:"%ai" $&#123;tag2&#125; -1)</span><br><span class="line">    echo "## $tag2 - $tag1 $branch ($time)" &gt;&gt;CHANGELOG.md</span><br><span class="line">else</span><br><span class="line"><span class="meta">#</span> ä½¿ç”¨ tag ç”Ÿæˆ log</span><br><span class="line">    time=$(git log -1 --format=%ai $&#123;tag2&#125;)</span><br><span class="line">    echo  "## $tag2 ($time)"&gt;&gt;CHANGELOG.md</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ç”ŸæˆFeaturesè¡Œ</span><br><span class="line">echo "### Features" &gt;&gt;CHANGELOG.md</span><br><span class="line">while read line</span><br><span class="line">do</span><br><span class="line">    echo "* "$&#123;line&#125; &gt;&gt; CHANGELOG.md</span><br><span class="line">done &lt; feat.txt</span><br><span class="line"><span class="meta">$</span>(rm -rf feat.txt)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ç”ŸæˆFixsè¡Œ</span><br><span class="line">echo "### Fixs" &gt;&gt;CHANGELOG.md</span><br><span class="line">while read line</span><br><span class="line">do</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><br><span class="line">if [[ -f "./CHANGELOG.md" ]]</span><br><span class="line">then</span><br><span class="line">    echo CHANGELOG.md is exsit</span><br><span class="line">else</span><br><span class="line">    echo '# ChangeLog' &gt;CHANGELOG.md</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> è¯»å– ChangeLog æ–‡ä»¶,åˆ é™¤é‡å¤è¾“å…¥ä¸€ç›´çš„å†…å®¹,ä½¿ç”¨ç¬¬ä¸€ä¸ªè¾“å…¥çš„å‚æ•°ä½œä¸ºé”šç‚¹å¯¹æ¯”</span><br><span class="line">while read text</span><br><span class="line">do</span><br><span class="line">    ((++i))</span><br><span class="line">    if [[ $&#123;text&#125; =~ "## $tag2" ]]</span><br><span class="line">        then</span><br><span class="line">        start=$i</span><br><span class="line">    elif [[ $tag1 != "" &amp;&amp; $&#123;text&#125; =~ "## $tag1" ]]</span><br><span class="line">        then</span><br><span class="line">        end=$i</span><br><span class="line">    fi</span><br><span class="line">done &lt; CHANGELOG.md</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> $&#123;start&#125; ä¸ºèµ·å§‹è¡Œ</span><br><span class="line"><span class="meta">#</span> $&#123;end&#125; ä¸ºç»“æŸè¡Œ</span><br><span class="line"></span><br><span class="line">if [[ "" = "$end" ]]</span><br><span class="line">    then</span><br><span class="line">    if [[ "" != "$start" ]]</span><br><span class="line">        then</span><br><span class="line">        # å¦‚æœæ²¡æœ‰ç»“æŸè¡Œ,åˆ™åˆ é™¤èµ·å§‹è¡Œä»¥åæ‰€æœ‰çš„å†…å®¹</span><br><span class="line">        $(sed -i "" "$start,\$d" CHANGELOG.md)</span><br><span class="line">    fi</span><br><span class="line">else</span><br><span class="line">    ((--end))</span><br><span class="line">    # åº”æ¢ä¸ºæ’å…¥</span><br><span class="line">    if [[ "$start" -gt "$end" ]]</span><br><span class="line">        then</span><br><span class="line">        $(sed -i "" "$start,\$d" CHANGELOG.md)</span><br><span class="line">    else</span><br><span class="line">    # å¦‚æœæœ‰ç»“æŸè¡Œ åˆ™åˆ é™¤ä¹‹é—´æ‰€æœ‰çš„å†…å®¹</span><br><span class="line">        $(sed -i "" "$start,$&#123;end&#125;d" CHANGELOG.md)</span><br><span class="line">    fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></p>
<h1 id="é›†æˆå·¥å…·"><a href="#é›†æˆå·¥å…·" class="headerlink" title="é›†æˆå·¥å…·"></a>é›†æˆå·¥å…·</h1><p>å› ä¸ºéœ€è¦æä¾› git templateã€æ£€æŸ¥ git message æ˜¯å¦ç¬¦åˆè§„èŒƒå’Œç”Ÿæˆ CHANGELOGå¹¶ä¸”è„šæœ¬éƒ½æ˜¯åœ¨å®¢æˆ·ç«¯,å¦‚æœé€šè¿‡æ‰‹åŠ¨æ‹·è´çš„æ–¹å¼åˆ†äº«ç»™ç»„å†…æˆå‘˜ä¼šå¾ˆéº»çƒ¦,å¹¶ä¸”åç»­æ›´æ–°ä¹Ÿæ˜¯å¾ˆå¤§çš„é—®é¢˜.æ‰€ä»¥é€šè¿‡ curl å’Œ wget ç­‰å‘½ä»¤,ç›´æ¥æ‰§è¡Œç›¸åº”è„šæœ¬,å¯ä»¥æå¤§çš„æ–¹ä¾¿æ¥å…¥è„šæœ¬å·¥å…·.</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç”±äºè‡ªå·±ä¹Ÿæ˜¯åˆæ¬¡æ¥è§¦ shell å¯èƒ½å†™çš„ä¸ç®—å¥½,è¾¹å­¦è¾¹å†™å®Œæˆäº†è¿™ä¸ªéœ€æ±‚,shell å¯¹äºæ•°æ®çš„å¤„ç†è¿˜æ˜¯å¾ˆæ–¹ä¾¿,å¯ä»¥åšå¾ˆå¤šæœ‰æ„æ€çš„äº‹æƒ…,æé«˜å¼€å‘æ•ˆç‡.æœ€è¿‘é¡¹ç›®æ‰“ç®—è¿ç§» androidx,ç”±äºæ¨¡å—å¤ªå¤šä½¿ç”¨ AS è‡ªå¸¦æ’ä»¶é€ä¸ªå‡çº§,å¤ªéº»çƒ¦æ‰€ä»¥è‚¯å®šä¹Ÿéœ€è¦é€šè¿‡è„šæœ¬ç›´æ¥ä¿®æ”¹æºç å‡çº§,æ­£å¥½ä¹ŸåŠ å¼ºå­¦ä¹  shell.<br>æœ¬æ¬¡åªæ˜¯å®ç°äº† Module çš„ ChangeLog ç”Ÿæˆ,ä½†æ˜¯ App çš„è¿˜æœªå®Œæˆ,ç›®å‰è€ƒè™‘çš„æ–¹æ¡ˆæœ‰ä¸¤ç§</p>
<ul>
<li>åœ¨ç”Ÿæˆè„šæœ¬é‡ŒæŠŠæ–‡ä»¶ä¼ åˆ°è¿œç¨‹æŒ‡å®šç›®å½•ä¸‹,ç„¶åé€šè¿‡è„šæœ¬æå–æ‰€æœ‰ module çš„æ–‡ä»¶,å†é‡æ–°ç”Ÿæˆ App çš„ ChangeLog</li>
<li>é€šè¿‡è„šæœ¬è·å– App çš„æ‰€æœ‰ä¸šåŠ¡ä¾èµ–,ç„¶åé€šè¿‡ä¾èµ–å†è·å– git åœ°å€,é€šè¿‡ git åœ°å€ä¸‹è½½åˆ° module çš„ ChangeLog,åœ¨é‡æ–°ç”Ÿæˆ App çš„ ChangeLog<br>ä¸¤ä¸ªæ–¹æ³•ä¸ªæœ‰å¥½å¤„å§,ç”±äºå…¶ä»–äº‹æƒ…è€½è¯¯ç›®å‰è¿˜æ²¡å¼€å§‹åš,æ–¹æ¡ˆè®°å½•ä¸‹æ¥æœ‰ç©ºå®ç°.</li>
</ul>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://ruby-china.org/topics/15737" target="_blank" rel="noopener">https://ruby-china.org/topics/15737</a></p>
<p><a href="https://juejin.im/post/5afc5242f265da0b7f44bee4" target="_blank" rel="noopener">https://juejin.im/post/5afc5242f265da0b7f44bee4</a></p>
<p><a href="https://commitlint.js.org/" target="_blank" rel="noopener">git message lint å·¥å…·</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>ReactNative ä¸­ä½¿ç”¨ @ReactMethod å’Œ @ReactProp åº”æ³¨æ„çš„é—®é¢˜</title>
    <url>/2019/10/14/react-natvie-manager-abstractclass/</url>
    <content><![CDATA[<h4 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h4><p>å…¬å¸é¡¹ç›®ä¸­ä½¿ç”¨ React Native å®ç°éƒ¨åˆ†åŠŸèƒ½,å› ä¸ºä¸šåŠ¡éœ€æ±‚é—®é¢˜,æ¯”å¦‚ A å’Œ B åˆ†åˆ«ç»§æ‰¿ ReactContextBaseJavaModule ä¸”å…¶ ReactMethod æ‰€æ³¨è§£çš„æ–¹æ³•ä¹Ÿç›¸åŒ,ä½†æ˜¯å…¶å®ç°ç•¥æœ‰ä¸åŒ,è¿™æ—¶å€™æ­£å¸¸åšæ³•æ˜¯ä¼šå†™æŠ½è±¡ç±»æˆ–è€…è¯´æ¥å£,è¿™æ—¶å€™ ReactMethod åº”è¯¥å†™åœ¨é‚£é‡Œå‘¢,å¦‚æœåœ¨çˆ¶ç±»æˆ–è€…æ¥å£é‡Œ,è¿è¡Œèµ·æ¥ä¼šå‘ç°æ‰¾ä¸åˆ°è¿™ä¸ªæ–¹æ³•,å¦‚æœå†™åœ¨å®ç°ç±»é‡Œä¼šå¾ˆéº»çƒ¦.<br><a id="more"></a></p>
<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><h5 id="å®ç°ç±»çš„æ–¹æ³•é‡ŒåŠ -ReactMethod"><a href="#å®ç°ç±»çš„æ–¹æ³•é‡ŒåŠ -ReactMethod" class="headerlink" title="å®ç°ç±»çš„æ–¹æ³•é‡ŒåŠ  ReactMethod"></a>å®ç°ç±»çš„æ–¹æ³•é‡ŒåŠ  ReactMethod</h5><p>è¿™ç§æ–¹å¼å°±å¾ˆéº»çƒ¦ä¸å¤Ÿä¼˜é›…,ä½†æ˜¯å¯ä»¥ç«‹é©¬è§£å†³é—®é¢˜.</p>
<h5 id="æŠ½è±¡ç±»å®ç°æˆ–è€…æ¥å£ç»§æ‰¿-ReactModuleWithSpec"><a href="#æŠ½è±¡ç±»å®ç°æˆ–è€…æ¥å£ç»§æ‰¿-ReactModuleWithSpec" class="headerlink" title="æŠ½è±¡ç±»å®ç°æˆ–è€…æ¥å£ç»§æ‰¿ ReactModuleWithSpec"></a>æŠ½è±¡ç±»å®ç°æˆ–è€…æ¥å£ç»§æ‰¿ ReactModuleWithSpec</h5><p>ä¸ºä»€ä¹ˆç›´æ¥åœ¨çˆ¶ç±»ç»™æ–¹æ³•åŠ æ³¨è§£å°±ä¸è¡Œå‘¢,è¿˜æ˜¯å¾—ä»æºç é‡Œæ‰¾ç­”æ¡ˆ,ç›´æ¥æœç´¢æºç é‡Œå¤„ç†æ³¨è§£çš„åœ°æ–¹,å¦‚ä¸‹æ‰€ç¤º:<br><figure class="highlight java"><figcaption><span>JavaModuleWrapper.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">@DoNotStrip</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findMethods</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Systrace.beginSection(TRACE_TAG_REACT_JAVA_BRIDGE, <span class="string">"findMethods"</span>);</span><br><span class="line">    Set&lt;String&gt; methodNames = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends NativeModule&gt; classForMethods = mModuleClass;</span><br><span class="line">    <span class="comment">//è·å–çˆ¶ç±»</span></span><br><span class="line">    Class&lt;? extends NativeModule&gt; superClass =</span><br><span class="line">        (Class&lt;? extends NativeModule&gt;) mModuleClass.getSuperclass();</span><br><span class="line">    <span class="keyword">if</span> (ReactModuleWithSpec<span class="class">.<span class="keyword">class</span>.<span class="title">isAssignableFrom</span>(<span class="title">superClass</span>)) </span>&#123;</span><br><span class="line">        <span class="comment">//å¦‚æœçˆ¶ç±»å®ç° ReactModuleWithSpecå,ä¼šè·å–çˆ¶ç±»çš„æ–¹æ³•</span></span><br><span class="line">      classForMethods = superClass;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¦‚æœçˆ¶ç±»æ²¡æœ‰å®ç° ReactModuleWithSpec,åˆ™ä¼šæ‹¿å­ç±»çš„æ–¹æ³•,å¦‚æœå­ç±»æ–¹æ³•æ²¡æœ‰ ReactMethod æ³¨è§£,åˆ™ä¸ä¼šè°ƒç”¨,è¿™å°±è§£é‡Šäº†æˆ‘ä»¬åˆšå¼€å§‹é‡åˆ°çš„é—®é¢˜.</span></span><br><span class="line">    Method[] targetMethods = classForMethods.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Method targetMethod : targetMethods) &#123;</span><br><span class="line">      ReactMethod annotation = targetMethod.getAnnotation(ReactMethod<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">      <span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//Â·Â·Â· å¿½ç•¥éé‡ç‚¹ä»£ç </span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>æ ¹æ®æºç ,æˆ‘ä»¬å°±å¾ˆæ¸…æ¥šçš„ç†è§£æ‰€é‡åˆ°çš„é—®é¢˜äº†.<strong>ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨å®ç°ç±»é‡Œåšæ‰©å±•,å†åŠ å«æœ‰ ReactMethod æ³¨è§£çš„æ–¹æ³•æ—¶,æˆ‘ä»¬è¿è¡Œæ—¶ä¹Ÿä¼šæ‰¾ä¸åˆ°æ­¤æ–¹æ³•,æ‰€ä»¥ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„è¿™ä¸€ç‚¹</strong>.</p>
<h4 id="ReactProp-ç±»ä¼¼é—®é¢˜"><a href="#ReactProp-ç±»ä¼¼é—®é¢˜" class="headerlink" title="ReactProp ç±»ä¼¼é—®é¢˜"></a>ReactProp ç±»ä¼¼é—®é¢˜</h4><p>å½“æˆ‘ä»¬åœ¨æŠ½è±¡ç±»ä¸­å¯¹æ–¹æ³•ä½¿ç”¨ ReactProp æ³¨è§£æ—¶,è¿è¡Œæ—¶å¯ä»¥å‘ç°,ä»–ä»¬æ—¶ç”Ÿæ•ˆçš„.è¿™ä¸ªé€šè¿‡æŸ¥çœ‹æºç å‘ç°,å…¶é€’å½’è·å–äº†çˆ¶ç±»,ç„¶åè·å–äº†æ–¹æ³•.<br><figure class="highlight java"><figcaption><span>ViewManagersPropertyCache.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> Map&lt;String, PropSetter&gt; <span class="title">getNativePropSettersForViewManagerClass</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      Class&lt;? extends ViewManager&gt; cls)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (cls == ViewManager<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> EMPTY_PROPS_MAP;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, PropSetter&gt; props = CLASS_PROPS_CACHE.get(cls);</span><br><span class="line">    <span class="keyword">if</span> (props != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> props;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é€’å½’è·å–ç»§æ‰¿äº† ViewManager çš„ç±»</span></span><br><span class="line">    props = <span class="keyword">new</span> HashMap&lt;&gt;(</span><br><span class="line">        getNativePropSettersForViewManagerClass(</span><br><span class="line">            (Class&lt;? extends ViewManager&gt;) cls.getSuperclass()));</span><br><span class="line">    extractPropSettersFromViewManagerClassDefinition(cls, props);</span><br><span class="line">    CLASS_PROPS_CACHE.put(cls, props);</span><br><span class="line">    <span class="keyword">return</span> props;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">extractPropSettersFromViewManagerClassDefinition</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      Class&lt;? extends ViewManager&gt; cls,</span></span></span><br><span class="line"><span class="function"><span class="params">      Map&lt;String, PropSetter&gt; props)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è·å–è¿™ä¸ªç±»çš„public,protroct,privateæ–¹æ³•,ä½†ä¸åŒ…æ‹¬å®ç°æ¥å£å’Œçˆ¶ç±»çš„æ–¹æ³•</span></span><br><span class="line">    Method[] declaredMethods = cls.getDeclaredMethods();</span><br><span class="line">    <span class="comment">//Â·Â·Â·çœç•¥æ— å…³ä»£ç </span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ extractPropSettersFromViewManagerClassDefinition è¿™ä¸ªæ–¹æ³•,æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå¦‚æœåœ¨<strong>æ¥å£ä¸­å¯¹æ–¹æ³•ä½¿ç”¨ ReactProp æ—¶ä¼šä¸ç”Ÿæ•ˆ</strong>.</p>
<p>é‡åˆ°é—®é¢˜å¤šçœ‹çœ‹æºç å®ç°,ä¹Ÿè®¸å°±ä¼šæ‰¾åˆ°æ€è·¯.</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>React Native</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½ ä»¥ä¸ºä½ æ‡‚å¾— Android (è¯‘)</title>
    <url>/2019/08/21/you-thought-you-knew-android/</url>
    <content><![CDATA[<h4 id="è¯‘æ–‡"><a href="#è¯‘æ–‡" class="headerlink" title="è¯‘æ–‡"></a>è¯‘æ–‡</h4><p>ä½ çŸ¥é“ Android é‡Œæœ‰ä¸ªå«<code>blink</code>çš„ ViewGroup å—?æƒŠè®¶å—?æˆ‘ç¬¬ä¸€æ¬¡çŸ¥é“å®ƒæ—¶å’Œä½ æ˜¯åŒæ ·çš„è¡¨ç°.</p>
<p>å½“æˆ‘æ­£åœ¨é˜…è¯»<a href="https://developer.android.com/reference/android/view/LayoutInflater" target="_blank" rel="noopener">LayoutInflater</a>çš„æºç ,æˆ‘å¯¹ xml å¦‚ä½•è½¬æ¢æˆ object ç‰¹åˆ«æ„Ÿå…´è¶£,æ‰€ä»¥æˆ‘æ²¡æœ‰ä»å¤´å¼€å§‹é˜…è¯»è¿™ä¸ªç±»,è€Œæ˜¯ç›´æ¥é˜…è¯»<code>inflate(layoutRes,parent</code>æ–¹æ³•.</p>
<p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„é˜…è¯»,æˆ‘åœ¨<code>View createViewFromTag(View parent, String name, Context context, AttributeSet attrs, boolean ignoreThemeAttr)</code>æ–¹æ³•å‰åœäº†ä¸‹æ¥,è¿™ä¸ªæ–¹æ³•ç­¾åæ²¡æœ‰ç‰¹åˆ«ä¹‹å¤„,ä½†æ˜¯ä»¥ä¸‹çš„æƒ…å†µå¾ˆå¥‡æ€ª,å¹¶ä¸”æ³¨é‡Šä¹Ÿæ˜¯.<br><img src="https://miro.medium.com/max/1400/1*4Nb8L6s0VJN5QrGO5RSgbw.png" alt><br><code>Let&#39;s party like it&#39;s 1995!</code><br><a id="more"></a><br>çœ‹èµ·æ¥å¾ˆæœ‰æ„æ€,ä½†æ˜¯æ¥ä¸‹æ¥è¿™æœ‰è¶£å°±è¦è¢«æ‰“ç ´äº†,æˆ‘ä»¬ç¡®åˆ‡çš„çŸ¥é“å®ƒä¼šå‘ç”Ÿä»€ä¹ˆ.<strong>ä¸€ä¸ª ViewGroup è®© å®ƒçš„å­ View åƒèŠ‚æ—¥ç¯ä¸€æ ·çš„é—ªçƒ</strong>.ä½†è¿™ ViewGroup çš„åå­—æ˜¯ä»€ä¹ˆå‘¢?æ˜¯<code>tag1995</code>å—?<br>ä¸æ˜¯çš„,<code>blink</code>æ‰æ˜¯è¿™ä¸ª ViewGroup çš„åå­—,ä¸åƒ Android é‡Œçš„<code>LinearLayout</code>æˆ–è€…<code>ReltaiveLayout</code>æˆ–ä»»ä½•å…¶ä»–çš„ ViewGroup çš„å¸ƒå±€åç¼€.é‚£ä¹ˆå®ƒå¯¹ä»»ä½• Android å¼€å‘è€…éƒ½å¤§æœ‰ç”¨å¤„å—?å¤§éƒ¨åˆ†ä¸æ˜¯çš„,ä½†æ˜¯çŸ¥é“æœ‰è¿™æ ·ä¸€ä¸ªå½©è›‹æ˜¯ä¸é”™çš„ğŸ™‚.<br>æƒ³çœ‹å®ƒçš„å®é™…æ•ˆæœ?å¦‚ä¸‹æ‰€ç¤º<br><img src="https://miro.medium.com/max/3348/1*6dHMO7KqOUsW9pXbZ7E4Cw.png" alt="Usage in xml layout
"><br><img src="https://miro.medium.com/max/1200/1*QawR47hKULpQqtwyYJUbZw.gif" alt="Party!!!
"><br>åœ¨ Android Framework æºç é‡Œå°è¯•å‘ç°å½©è›‹.ä¸çŸ¥é“æˆ‘èƒ½å‘ç°å¤šå°‘,å¦‚æœæˆ‘åé¢æ²¡æœ‰æ›´å¤šçš„æ–‡ç« å¯èƒ½å°±æ„å‘³ç€æ²¡æœ‰äº†.åƒğŸ¤è¿™æ ·äº¤å‰æ‰‹æŒ‡å‘ç°æ›´å¤šçš„å½©è›‹å§.<br>å‚è€ƒ<br><a href="https://medium.com/u/c967b7e51f8b?source=post_page-----e46a556d0773----------------------" target="_blank" rel="noopener">Romain Guy</a> å‘ Android  Framwork é‡Œæäº¤äº†<code>blink</code>å¸ƒå±€æºç .</p>
<h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="https://medium.com/@anoopss/you-thought-you-knew-android-e46a556d0773" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a><br><a href="https://android.googlesource.com/platform/frameworks/base/+/9c1223a71397b565f38015c07cae57a5015a6500%5E%21" target="_blank" rel="noopener">blink æºç </a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>è¯‘æ–‡</tag>
      </tags>
  </entry>
  <entry>
    <title>Intellij Plugin å¼€å‘(äºŒ)</title>
    <url>/2019/07/10/intellij-plugin-eventbus-2/</url>
    <content><![CDATA[<p>ä¸Šä¸€ç¯‡ä»‹ç»æ€æ ·æ–°å»ºä¸€ä¸ªæ’ä»¶å·¥ç¨‹,æœ¬ç¯‡åˆ†æ EventBus æ’ä»¶çš„å®ç°.<br>æ­¤æ’ä»¶æ¶‰åŠè¾ƒå¤šçš„ Java GUI ä»£ç ,ä½†æ˜¯è‡ªå·±ä¹Ÿä¸æ˜¯å¾ˆç†Ÿæ‚‰,åªèƒ½åšå¤§æ¦‚åˆ†æ,é‡ç‚¹åœ¨äºåˆ†ææ‰«æå¼•ç”¨ç‚¹.</p>
<h3 id="æ‰«æè§„åˆ™"><a href="#æ‰«æè§„åˆ™" class="headerlink" title="æ‰«æè§„åˆ™"></a>æ‰«æè§„åˆ™</h3><p>æˆ‘ä»¬é¡¹ç›®å¯¹äº EventBus æœ‰ç‰¹æ®Šçš„å°è£…,å°±éœ€è¦æ’ä»¶å¯ä»¥æ‰«æå‡º<code>XXX.send(new NotifyEvent())</code>(XXX ç±»ä¹Ÿå¯èƒ½ä¼šæœ‰å­ç±»),å¯ä»¥æ‰¾å‡ºè¿™ä¸ª Event æ‰€æœ‰çš„æ¥æ”¶ç‚¹,å¹¶ä¸”å¯¹äºç»§æ‰¿äº† Sender çš„ç±»é¡µéƒ½åº”è¯¥æ”¯æŒ.<br><figure class="highlight java"><figcaption><span>XXXX.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">notify</span><span class="params">()</span></span>&#123;</span><br><span class="line">    send(<span class="keyword">new</span> NotifyEvent());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(Object eventModel)</span> </span>&#123;</span><br><span class="line">      Smart.getEventBus().post(eventModel);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h4 id="åˆ¤æ–­å‘å°„ç‚¹"><a href="#åˆ¤æ–­å‘å°„ç‚¹" class="headerlink" title="åˆ¤æ–­å‘å°„ç‚¹"></a>åˆ¤æ–­å‘å°„ç‚¹</h4><p>å½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ª java æ–‡ä»¶æ—¶,å°±ä¼šæ¡†æ¶å°±ä¼šè°ƒç”¨ getLineMarkerInfo æ–¹æ³•å»æ‰«æå½“å‰ç±»çš„æ¯ä¸€è¡Œä»£ç (è¿™ä¹ˆè¯´ä¸æ°å½“,åº”è¯¥æ˜¯æ¯ä¸ªå­—æ®µä¹ŸåŒ…æ‹¬ç©ºæ ¼ã€ç©ºè¡Œä¹‹ç±»,æ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šè½¬åŒ–æˆ PsiElement),ç„¶åæˆ‘ä»¬é€šè¿‡ PsiElement å»åˆ¤æ–­æ˜¯å¦æ—¶ç¬¦åˆæˆ‘ä»¬çš„è§„åˆ™.ä¾‹å¦‚åˆ¤æ–­ EventBus å‘å°„ç‚¹.<br><figure class="highlight java"><figcaption><span>PsiUtil.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isEventBusPost</span><span class="params">(PsiElement psiElement)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//åˆ¤æ–­ psiElement æ˜¯å¦æ˜¯æ–¹æ³•(åŒ…æ‹¬æ„é€ æ–¹æ³•)çš„è°ƒç”¨</span></span><br><span class="line">     <span class="keyword">if</span> (psiElement <span class="keyword">instanceof</span> PsiCallExpression) &#123;</span><br><span class="line">         PsiCallExpression callExpression = (PsiCallExpression) psiElement;</span><br><span class="line">         PsiMethod method = callExpression.resolveMethod();</span><br><span class="line">         <span class="keyword">if</span> (method != <span class="keyword">null</span>) &#123;</span><br><span class="line">             String name = method.getName();</span><br><span class="line">             PsiElement parent = method.getParent();</span><br><span class="line">             <span class="comment">//åˆ¤æ–­æ–¹æ³•åæ˜¯å¦æ˜¯å‘å°„ç‚¹ æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ Smart.getEventBus().post() å’Œ XXXX.send() å’Œä¸€äº›ç‰¹æ®Šå½¢å¼</span></span><br><span class="line">             <span class="keyword">if</span> (<span class="string">"post"</span>.equals(name) &amp;&amp; parent <span class="keyword">instanceof</span> PsiClass) &#123;</span><br><span class="line">                 PsiClass implClass = (PsiClass) parent;</span><br><span class="line">                 <span class="keyword">return</span> isEventBusClass(implClass) || isSuperClassEventBus(implClass);</span><br><span class="line">             &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"send"</span>.equals(name) &amp;&amp; parent <span class="keyword">instanceof</span> PsiClass) &#123;</span><br><span class="line">                 PsiClass implClass = (PsiClass) parent;</span><br><span class="line">                 <span class="keyword">return</span> isEventSenderClass(implClass) || isSuperClassEventSender(implClass);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//åˆ¤æ–­ç±»æ˜¯å¦æ˜¯æˆ‘ä»¬è‡ªå°è£…çš„ç±»</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isEventBusClass</span><span class="params">(PsiClass psiClass)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="string">"SmartEventBus"</span>.equals(psiClass.getName());</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//åˆ¤æ–­ç±»æ˜¯å¦æ˜¯æˆ‘ä»¬è‡ªå°è£…ç±»çš„å­ç±»</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSuperClassEventBus</span><span class="params">(PsiClass psiClass)</span> </span>&#123;</span><br><span class="line">     PsiClass[] supers = psiClass.getSupers();</span><br><span class="line">     <span class="keyword">if</span> (supers.length == <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">for</span> (PsiClass superClass : supers) &#123;</span><br><span class="line">         <span class="keyword">if</span> (<span class="string">"SmartEventBus"</span>.equals(superClass.getName())) &#123;</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="åˆ¤æ–­æ¥æ”¶ç‚¹"><a href="#åˆ¤æ–­æ¥æ”¶ç‚¹" class="headerlink" title="åˆ¤æ–­æ¥æ”¶ç‚¹"></a>åˆ¤æ–­æ¥æ”¶ç‚¹</h4><p>åˆ¤æ–­ç¬¦åˆæˆ‘ä»¬è§„åˆ™çš„æ¥æ”¶ç‚¹<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isEventBusReceiver</span><span class="params">(PsiElement psiElement)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (psiElement <span class="keyword">instanceof</span> PsiMethod) &#123;</span><br><span class="line">        PsiMethod method = (PsiMethod) psiElement;</span><br><span class="line">        String name = method.getName();</span><br><span class="line">        <span class="comment">//æ”¯æŒ EventBus 2.0 ç‰ˆæœ¬çš„ onEvent å’Œ onEventMainThread ä¸¤ç§æ¥æ”¶ç‚¹,ä¸”åªæœ‰ä¸€ä¸ªå‚æ•°å¹¶ä¸”æ˜¯ PsiClassType ç±»å‹,ä¸è‡³äºé€ æˆå¯¹å…¶ä»–æ–¹æ³•çš„è¯¯åˆ¤</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"onEvent"</span>.equals(name) || <span class="string">"onEventMainThread"</span>.equals(name)) &amp;&amp; method.getParameterList().getParametersCount() == <span class="number">1</span> &amp;&amp; method.getParameterList().getParameters()[<span class="number">0</span>].getType() <span class="keyword">instanceof</span> PsiClassType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»¥ä¸Šå°±æ˜¯é’ˆå¯¹æˆ‘ä»¬é¡¹ç›®å…³äºæ‰«æçš„è‡ªå®šä¹‰ä»£ç ,é€šè¿‡è¿™å‡ ä¸ªç®€å•çš„è§„åˆ™å°±å¯ä»¥åšåˆ°é¢„æœŸçš„æ•ˆæœ.</p>
<h3 id="æŸ¥æ‰¾ä½¿ç”¨"><a href="#æŸ¥æ‰¾ä½¿ç”¨" class="headerlink" title="æŸ¥æ‰¾ä½¿ç”¨"></a>æŸ¥æ‰¾ä½¿ç”¨</h3><p><code>ShowUsagesAction</code>ç»§æ‰¿<code>AnAction</code>å½“æˆ‘ä»¬ç‚¹å‡» icon åä¼šæ‰§è¡Œ<code>ShowUsagesAction.actionPerformed()</code>æ–¹æ³•,åœ¨æ­¤å¤„æ‰§è¡Œæœç´¢å…¨å±€ä»£ç ã€æ”¶é›†ä½¿ç”¨ç‚¹ã€æ˜¾ç¤ºæœç´¢æ¡†å’Œæç¤ºæ¡†ç­‰,éœ€è¦æ·±å…¥äº†è§£ intellij æºç .ç”±äºèƒ½åŠ›æœ‰é™ä¸æ•¢åšè¿‡å¤šåˆ†æ,å…·ä½“ä»£ç å¯ä»¥æŸ¥çœ‹<a href="https://github.com/kgmyshin/eventbus-intellij-plugin/blob/master/src/com/kgmyshin/ideaplugin/eventbus/ShowUsagesAction.java">ShowUsagesActionæºç </a>.ç”±äºæºç å‡ ä¹æ²¡æœ‰æ³¨é‡Š,æ‰€ä»¥é˜…è¯»èµ·æ¥æœ‰ä¸€å®šå›°éš¾.</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="http://www.jetbrains.org/intellij/sdk/docs/welcome.html" target="_blank" rel="noopener">IntelliJ Platform SDK</a><br><a href="https://github.com/kgmyshin/eventbus-intellij-plugin">eventbus-intellij-plugin</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Intellij Plugin</tag>
      </tags>
  </entry>
  <entry>
    <title>Intellij Plugin å¼€å‘(ä¸€)</title>
    <url>/2019/05/29/intellij-plugin-eventbus-1/</url>
    <content><![CDATA[<p>Intellij æœ‰å¾ˆå¤šä¼˜ç§€çš„å¼€æºæ’ä»¶,è®©æˆ‘ä»¬æ›´åŠ é«˜æ•ˆçš„ç¼–ç¨‹.EventBus è™½ç„¶å¯ä»¥å¾ˆå¥½çš„è§£è€¦ï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨è€…æ¥è¯´ä¸é‚£ä¹ˆæ–¹ä¾¿æ‰¾åˆ°å‘å°„ç‚¹å’Œæ¥æ”¶ç‚¹.EventBus Plugin å¸®æˆ‘ä»¬æ„‰å¿«çš„è§£å†³äº†è¿™ä¸ªç—›ç‚¹.ä½†æ˜¯ç”±äºæˆ‘ä»¬é¡¹ç›®è‡ªå·±å°è£… EventBus,æ‰€ä»¥å…¶æ’ä»¶æ— æ³•ç”Ÿæ•ˆ,åªèƒ½é€šè¿‡ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š,ä¿®æ”¹è½®å­è®©ä»–é‡æ–°è·‘èµ·æ¥.</p>
<h3 id="é…ç½®å¼€å‘ç¯å¢ƒ-æ–°å»ºé¡¹ç›®"><a href="#é…ç½®å¼€å‘ç¯å¢ƒ-æ–°å»ºé¡¹ç›®" class="headerlink" title="é…ç½®å¼€å‘ç¯å¢ƒ æ–°å»ºé¡¹ç›®"></a>é…ç½®å¼€å‘ç¯å¢ƒ æ–°å»ºé¡¹ç›®</h3><p> å¼€å‘æ’ä»¶å¯ä»¥ä½¿ç”¨æ”¶è´¹æ——èˆ°ç‰ˆä¹Ÿå¯æ˜¯ä½¿ç”¨å…è´¹ç¤¾åŒºç‰ˆæœ¬.</p>
<ol>
<li>File-&gt;New-&gt;Project é€‰æ‹© Intellij Platform Plugin å¦‚å›¾<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plguin-new.png" alt><br>Project SDK é€‰æ‹© Intellij çš„å®‰è£…ç›®å½•,è¿™ä¸ª SDK ç‰ˆæœ¬è§‰å¾—è¿™æœ€ä½å…¼å®¹ç‰ˆæœ¬,å¦‚æœè¦é€‚é…ä½ç‰ˆæœ¬çš„ Intellij æˆ–è€… Android Stuido<br>å¦‚æœæƒ³ä½¿ç”¨ Gradle Kotlin ä¹‹ç±»çš„å¼€å‘æ–¹å¼å¯ä»¥é€‰æ‹© Gradle ç„¶åå‹¾é€‰ Javaã€Kotlinã€Intellij Platform Plugin<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-new2.png" alt></li>
<li>è¾“å…¥é¡¹ç›®åç§°å’Œè·¯å¾„,ç‚¹å‡» Finish å³å¯åˆ›å»ºæ’ä»¶é¡¹ç›®</li>
<li>é…ç½® SandBox<br>IntelliJ Plugin Run/Debugæ¨¡å¼è¿è¡Œåœ¨ SandBox ä¸­è¿›è¡Œçš„,å’Œå½“å‰ Intellij æ²¡ä»€ä¹ˆå…³ç³»,éœ€è¦åœ¨ Project Structure ä¸­è®¾ç½® Sandbox Home è·¯å¾„.<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-sandbox.png" alt><a id="more"></a>
</li>
</ol>
<h3 id="é…ç½®-plugin-xml"><a href="#é…ç½®-plugin-xml" class="headerlink" title="é…ç½® plugin.xml"></a>é…ç½® plugin.xml</h3><p>plugin.xml å°±åƒæ˜¯æˆ‘ä»¬å¼€å‘ Android æ—¶çš„ AndroidMainfest.xml æ–‡ä»¶,ä½¿ç”¨åˆ°çš„ç»„ä»¶éƒ½å¿…é¡»åœ¨è¿™é‡Œæ³¨å†Œ,å¦åˆ™å°±ä¸ä¼šç”Ÿæ•ˆ.<br><code>&lt;idea-version since-build=&quot;173.0&quot;/&gt;</code>è¿™ä¸ªè¡¨ç¤ºæ’ä»¶æ”¯æŒçš„èµ·å§‹ç‰ˆæœ¬,æ ¹æ®<a href="http://www.jetbrains.org/intellij/sdk/docs/basics/getting_started/build_number_ranges.html" target="_blank" rel="noopener">æ–‡æ¡£</a>å¯çŸ¥æ˜¯ 2017.3 ç‰ˆæœ¬.<br><code>&lt;depends&gt;com.intellij.modules.lang&lt;/depends&gt;</code>æ˜¯é¡¹ç›®ä¸­ç”¨åˆ°çš„ä¾èµ–æ’ä»¶<br><figure class="highlight xml"><figcaption><span>plugin.xml</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">extensions</span> <span class="attr">defaultExtensionNs</span>=<span class="string">"com.intellij"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Add your extensions here --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">codeInsight.lineMarkerProvider</span> <span class="attr">language</span>=<span class="string">"JAVA"</span></span></span><br><span class="line"><span class="tag">                                        <span class="attr">implementationClass</span>=<span class="string">"com.***.eventbus.EventBusLineMarkerProvider"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>extensions å®šä¹‰æ’ä»¶çš„æ‰©å±•ç±»å‹,defaultExtensionNs å®šä¹‰æ­¤é¡¹ç›®æ˜¯åŸºäº Intellij Core ç¼–å†™çš„æ’ä»¶,codeInsight.lineMarkerProvider æ˜¯ä¸€ç§æ‰©å±•ç±»å‹æ„ä¸ºæ ‡è®°æç¤ºå™¨,å…¶å®ç°çš„åŠŸèƒ½å°±æ˜¯æˆ‘ä»¬æ­¤æ¬¡éœ€è¦çš„,å°±åƒæˆ‘ä»¬å®ç°æ¥å£çš„æ–¹æ³•å,å®ç°ç±»çš„æ–¹æ³•å‰çš„å›¾æ ‡,ç‚¹å‡»åä¼šè·³è½¬åˆ°æ¥å£ä¸­.<br>ç»è¿‡è¿™ä¸¤ä¸ªæ­¥éª¤å°±æ–°å»ºé…ç½®å¥½äº†æ’ä»¶é¡¹ç›®,æˆ‘ä»¬å°±å¯ä»¥åŸºäºæ­¤å®ç°æˆ‘ä»¬çš„é€»è¾‘äº†.</p>
<h3 id="å®ç°-LineMarkerProvider"><a href="#å®ç°-LineMarkerProvider" class="headerlink" title="å®ç° LineMarkerProvider"></a>å®ç° LineMarkerProvider</h3><figure class="highlight java"><figcaption><span>LineMarkerProvider.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventBusLineMarkerProvider</span> <span class="keyword">implements</span> <span class="title">LineMarkerProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å›¾ç‰‡èµ„æºåº”åœ¨ resources/icons ç›®å½•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Icon ICON = IconLoader.getIcon(<span class="string">"/icons/icon.png"</span>);</span><br><span class="line">    <span class="comment">//æœ€å¤šæŸ¥æ‰¾åº”ç”¨æ•°é‡ 100 ä¸ª</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_USAGES = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> GutterIconNavigationHandler&lt;PsiElement&gt; SHOW_SENDERS =</span><br><span class="line">            (e, psiElement) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (psiElement <span class="keyword">instanceof</span> PsiMethod) &#123;</span><br><span class="line">                    Project project = psiElement.getProject();</span><br><span class="line">                    JavaPsiFacade javaPsiFacade = JavaPsiFacade.getInstance(project);</span><br><span class="line">                    <span class="comment">//æŸ¥æ‰¾ project èŒƒå›´å†… EventBus çš„PsiClass</span></span><br><span class="line">                    PsiClass eventBusClass = javaPsiFacade.findClass(<span class="string">"com.***.event.EventBus"</span>, GlobalSearchScope.allScope(project));</span><br><span class="line">                    <span class="keyword">if</span> (eventBusClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">//ç¬¦åˆ EventBus ä¸­ post() æ–¹æ³•</span></span><br><span class="line">                        PsiMethod postMethod = eventBusClass.findMethodsByName(<span class="string">"post"</span>, <span class="keyword">false</span>)[<span class="number">0</span>];</span><br><span class="line">                        PsiMethod method = (PsiMethod) psiElement;</span><br><span class="line"></span><br><span class="line">                        PsiClass eventClass = ((PsiClassType) method.getParameterList().getParameters()[<span class="number">0</span>].getTypeElement().getType()).resolve();</span><br><span class="line">                        ShowUsagesAction action = <span class="keyword">new</span> ShowUsagesAction(<span class="keyword">new</span> SenderFilter(eventClass));</span><br><span class="line">                        <span class="comment">//è§¦å‘æŸ¥æ‰¾åŠ¨ä½œ,å¼¹æ¡†å±•ç¤ºå·²ç»æŸ¥æ‰¾åˆ°çš„å¼•ç”¨ç‚¹</span></span><br><span class="line">                        action.startFindUsages(postMethod, <span class="keyword">new</span> RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> GutterIconNavigationHandler&lt;PsiElement&gt; SHOW_RECEIVERS =</span><br><span class="line">            (e, psiElement) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (psiElement <span class="keyword">instanceof</span> PsiMethodCallExpression) &#123;</span><br><span class="line">                    PsiMethodCallExpression expression = (PsiMethodCallExpression) psiElement;</span><br><span class="line">                    PsiType[] expressionTypes = expression.getArgumentList().getExpressionTypes();</span><br><span class="line">                    <span class="keyword">if</span> (expressionTypes.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        PsiClass eventClass = PsiUtils.getClass(expressionTypes[<span class="number">0</span>], psiElement);</span><br><span class="line">                        <span class="keyword">if</span> (eventClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            List&lt;PsiElement&gt; generatedDeclarations = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                            generatedDeclarations.add(PsiUtils.getClass(expressionTypes[<span class="number">0</span>]));</span><br><span class="line">                            <span class="comment">//æ‰¾åˆ°æ¥æ”¶ç‚¹æ¥æ”¶å¯¹è±¡çš„çˆ¶ç±»,è¿™æ ·é€šè¿‡å‘å°„ç‚¹å‘å°„å…¶å­ç±»,ä¹Ÿå¯ä»¥çœ‹åˆ°å…¶çˆ¶ç±»çš„æ¥æ”¶ç‚¹ä½ç½®</span></span><br><span class="line">                            <span class="comment">//ä¾‹å¦‚ Event2 extend Event ,EventBus.post(new Event2()) é‚£ä¹ˆå¯ä»¥åœ¨å‘å°„ç‚¹åŒæ—¶çœ‹åˆ° Event2 å’Œ Event çš„æ¥æ”¶ç‚¹ä½ç½®</span></span><br><span class="line">                            <span class="keyword">for</span> (PsiType superType : expressionTypes[<span class="number">0</span>].getSuperTypes()) &#123;</span><br><span class="line">                                generatedDeclarations.add(PsiUtils.getClass(superType));</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">new</span> ShowUsagesAction(<span class="keyword">new</span> ReceiverFilter()).startFindUsages(generatedDeclarations, eventClass, <span class="keyword">new</span> RelativePoint(e), PsiUtilBase.findEditor(psiElement), MAX_USAGES);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LineMarkerInfo <span class="title">getLineMarkerInfo</span><span class="params">(@NotNull PsiElement psiElement)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (PsiUtils.isEventBusPost(psiElement)) &#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å‘å°„ç‚¹</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LineMarkerInfo&lt;&gt;(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, <span class="keyword">null</span>, SHOW_RECEIVERS, GutterIconRenderer.Alignment.LEFT);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (PsiUtils.isEventBusReceiver(psiElement)) &#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯æ¥æ”¶ç‚¹</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LineMarkerInfo&lt;&gt;(psiElement, psiElement.getTextRange(), ICON, Pass.UPDATE_ALL, <span class="keyword">null</span>, SHOW_SENDERS, GutterIconRenderer.Alignment.LEFT);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">collectSlowLineMarkers</span><span class="params">(@NotNull List&lt;PsiElement&gt; elements, @NotNull Collection&lt;LineMarkerInfo&gt; result)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>LineMarkerProvider ä¼šåœ¨æˆ‘ä»¬æ¯æ¬¡æ‰“å¼€æ–‡ä»¶æ—¶æ‰§è¡Œ,å½“ getLineMarkerInfo æ‰§è¡Œåä¸€è¡Œä»£ç å¦‚æœç¬¦åˆæˆ‘ä»¬çš„æ¡ä»¶æ—¶,åˆ™è¡Œå·åä¼šå‡ºç° ICON å®šä¹‰çš„ä»£ç ,è¿™ä¸ªicon å¿…é¡»æ˜¯ <code>16 * 16</code> æˆ–è€… <code>32 * 32</code> å°ºå¯¸çš„å›¾æ ‡.<br>PSI (Program Structure Interface)ç¨‹åºç»“æ„æ¥å£,å¯ä»¥æè¿°æ–‡ä»¶çš„å±‚æ¬¡ç»“æ„(æ‰€è°“çš„PSIæ ‘),è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹ä»£ç ,é€ä¸ªè¿›è¡ŒåŒ¹é…åˆ†æ.è¿™ä¸ªç›¸å…³æ–‡æ¡£å¾ˆå°‘,ä½†æ˜¯ Intellij è‡ªå¸¦å·¥å…·å¯ä»¥å¸®æˆ‘ä»¬åˆ†ææ–‡ä»¶çš„ psi æ ‘,ç‚¹å‡» Tool-&gt;View PSI Structure of Current File è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´è§‚çš„é¢„è§ˆéœ€è¦å¤„ç†çš„æ–‡ä»¶.PSI å¯¹äºä»£ç æ‰€æœ‰çš„å…³é”®å­—å’Œæ ‡ç‚¹éƒ½æœ‰å®šä¹‰,å¦‚ä¸‹å›¾é‡Œå¯ä»¥æ¸…æ¥šçš„çœ‹å‡º<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/intellij-plugin-psi.png" alt><br>é€šè¿‡è¿™ä¸ªå·¥å…·å’Œç»“åˆ<a href="http://www.jetbrains.org/intellij/sdk/docs/basics/architectural_overview/psi_elements.html" target="_blank" rel="noopener">PsiElement æ–‡æ¡£</a>å¯ä»¥å­¦ä¹ æ€ä¹ˆä½¿ç”¨å®ƒ.</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>è¿™ç¯‡åªæ˜¯ä»‹ç»ä¸‹æ€ä¹ˆå…¥é—¨,ç®€å•çš„äº†è§£ä¸‹æ€ä¹ˆæ–°å»ºé¡¹ç›®å’ŒåŸºç¡€çš„ä»£ç å®ç°,ç”±äºç›¸å…³æ–‡æ¡£æ¯”è¾ƒå°‘,å¦‚æœæƒ³è¦ç¼–å†™å®ç”¨çš„æ’ä»¶,å°±éœ€è¦å‚è€ƒ GitHub ä¸­å¤§é‡çš„æ’ä»¶å·¥ç¨‹,é€šè¿‡å­¦ä¹ å¯ä»¥æ›´å¿«å…¥é—¨.</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Intellij Plugin</tag>
      </tags>
  </entry>
  <entry>
    <title>Android P åå°„ç°åå•æ–¹æ³•å¼•èµ·çš„é—®é¢˜</title>
    <url>/2019/03/17/android-p-invoke/</url>
    <content><![CDATA[<p><strong>æœ¬æ–‡ä¸­çš„ç°åå•æŒ‡çš„æ˜¯ Aandroid è§„å®šçš„æ·±ç°åå•</strong><br>æˆ‘ä»¬åº”ç”¨ä½¿ç”¨äº† <a href="https://github.com/whataa/pandora">Pandora 1.3.2 ç‰ˆæœ¬</a> åº“,æ–¹ä¾¿æµ‹è¯•ç¯å¢ƒé‡ŒæŸ¥çœ‹ç•Œé¢å…ƒç´ ã€ç½‘ç»œã€æ•°æ®åº“ä¹‹ç±»çš„æ•°æ®.åœ¨ä½¿ç”¨ Aandroid 9.0 æ—¶å‘ç°ä¼šå¼¹å‡ºä¸‹é¢è¿™æ ·çš„æç¤ºæ¡†.éœ€è¦æ¢å¯»ä¸‹æ˜¯ä»€ä¹ˆåŸå› å¼•èµ·çš„,åœ¨é‚£é‡Œè°ƒç”¨çš„,èƒ½ä¸èƒ½å»æ‰è¿™ä¸ªå¼ºåˆ¶æç¤º.<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/android_p_invoke.jpg" alt><br>åº”ç”¨çš„ targetSdkVersion æ˜¯ 27,compileSdkVersion æ˜¯ 28<br>Pandora 2.0 ç‰ˆæœ¬ç›®å‰å·²ç»è§„é¿äº†è¿™ä¸ªé—®é¢˜,éƒ½ä½¿ç”¨äº†æµ…ç°åå•é‡Œçš„æ–¹æ³•æˆ–å­—æ®µ.<br><a id="more"></a></p>
<h2 id="å¯»æ‰¾é—®é¢˜"><a href="#å¯»æ‰¾é—®é¢˜" class="headerlink" title="å¯»æ‰¾é—®é¢˜"></a>å¯»æ‰¾é—®é¢˜</h2><p>åœ¨æ‰“å¼€ Pandora ä¹‹å,ä½¿ç”¨äº†å…¶ä¸­ä¸€é¡¹åŠŸèƒ½å‘ç° Logcat ä¸­è¾“å‡ºäº†<code>Accessing hidden field Landroid/view/ViewRootImpl;-&gt;mWindowAttributes:Landroid/view/WindowManager$LayoutParams; (dark greylist, reflection)</code>è¿™æ®µä¿¡æ¯,åº”è¯¥æ˜¯ä»–åå°„è°ƒç”¨äº†ç°åå•çš„å­—æ®µ,æ‰€ä»¥ä¼šæœ‰æç¤ºå’Œå¼¹æ¡†.<br>é¦–å…ˆå°†è¿™æ®µæç¤ºå¤åˆ¶åˆ° AS é‡Œé€šè¿‡å…¨å±€æœç´¢å‘ç°,æ˜¯åœ¨ Activity çš„ performStart æ–¹æ³•é‡Œè°ƒç”¨äº†æç¤ºæ¡†<br><figure class="highlight java"><figcaption><span>Activity.java</span></figcaption><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">performStart</span><span class="params">(String reason)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//çœç•¥äº†å…¶ä»–ä»£ç </span></span><br><span class="line">    <span class="comment">//ç™½ç°é»‘åå•ç»´æŠ¤åœ¨ç³»ç»Ÿ,å¯¹ç³»ç»Ÿåº”ç”¨ä¸åšé™åˆ¶</span></span><br><span class="line">    <span class="keyword">boolean</span> isApiWarningEnabled = SystemProperties.getInt(<span class="string">"ro.art.hiddenapi.warning"</span>, <span class="number">0</span>) == <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (isAppDebuggable || isApiWarningEnabled) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mMainThread.mHiddenApiWarningShown &amp;&amp; VMRuntime.getRuntime().hasUsedHiddenApi()) &#123;</span><br><span class="line">            <span class="comment">// ä»…æç¤ºä¸€æ¬¡</span></span><br><span class="line">            mMainThread.mHiddenApiWarningShown = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            String appName = getApplicationInfo().loadLabel(getPackageManager())</span><br><span class="line">                    .toString();</span><br><span class="line">            String warning = <span class="string">"Detected problems with API compatibility\n"</span></span><br><span class="line">                             + <span class="string">"(visit g.co/dev/appcompat for more info)"</span>;</span><br><span class="line">            <span class="keyword">if</span> (isAppDebuggable) &#123;</span><br><span class="line">                <span class="comment">//å¼¹çª—æç¤º</span></span><br><span class="line">                <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>)</span><br><span class="line">                    .setTitle(appName)</span><br><span class="line">                    .setMessage(warning)</span><br><span class="line">                    .setPositiveButton(android.R.string.ok, <span class="keyword">null</span>)</span><br><span class="line">                    <span class="comment">//ç«Ÿç„¶å¦‚æ­¤å¼ºåˆ¶,ç”Ÿæ€•å¼€å‘è€…ä¸æ³¨æ„å…³é—­</span></span><br><span class="line">                    .setCancelable(<span class="keyword">false</span>)</span><br><span class="line">                    .show();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//å¦‚æœé debug ç‰ˆæœ¬åª Toast æç¤º</span></span><br><span class="line">                Toast.makeText(<span class="keyword">this</span>, appName + <span class="string">"\n"</span> + warning, Toast.LENGTH_LONG).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>çœ‹è¿‡æºç çŸ¥é“äº†è°ƒç”¨åœ°ç‚¹,é‚£ä¹ˆåªæ”¹å˜è°ƒç”¨æ¡ä»¶å°±å¯ä»¥å°†å®ƒä¸æç¤ºäº†.è¿™ä¸ªå˜é‡ä¾¿æ˜¯æˆ‘ä»¬çš„çªç ´å£</p>
<h2 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h2><h3 id="targetSdkVersion-27"><a href="#targetSdkVersion-27" class="headerlink" title="targetSdkVersion 27"></a>targetSdkVersion 27</h3><ul>
<li>VMRuntime.getRuntime().hasUsedHiddenApi() è¿™ä¸ªæ–¹æ³•åœ¨ASé‡Œæ— æ³•æŸ¥çœ‹,ä½†æ˜¯åœ¨ Androidxref æŸ¥çœ‹åæ˜¯ä¸ª Natvie æ–¹æ³•,åå°„ä¿®æ”¹èµ·æ¥å›°éš¾æœ‰ç‚¹å¤§ </li>
<li>mMainThread.mHiddenApiWarningShown è¿™ä¸ªå˜é‡å¾ˆæ˜æ˜¾åå°„å®¹æ˜“ç‚¹,å¹¶ä¸”æ ¹æ®æ³¨é‡Šå’Œæºç å¾—çŸ¥,ä¹Ÿå°±åªåœ¨è¿™é‡Œä½¿ç”¨<br>æŸ¥çœ‹æºç è¿™ä¸ªå˜é‡æ¥è‡ªäº ActivityThread é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥åå°„ä¿®æ”¹è¿™ä¸ªå˜é‡åˆå§‹å€¼å³å¯.<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">         Class cls = Class.forName(<span class="string">"android.app.ActivityThread"</span>);</span><br><span class="line">         Method declaredMethod = cls.getDeclaredMethod(<span class="string">"currentActivityThread"</span>);</span><br><span class="line">         declaredMethod.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">         Object activityThread = declaredMethod.invoke(<span class="keyword">null</span>);</span><br><span class="line">         Field mHiddenApiWarningShown = cls.getDeclaredField(<span class="string">"mHiddenApiWarningShown"</span>);</span><br><span class="line">         mHiddenApiWarningShown.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">         mHiddenApiWarningShown.setBoolean(activityThread, <span class="keyword">true</span>);</span><br><span class="line">         Log.e(<span class="string">"reflection dark greylist is"</span>,<span class="string">"success"</span>);</span><br><span class="line">     &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">         Log.e(<span class="string">"reflection dark greylist is"</span>,<span class="string">"fail"</span>);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å°†åå°„ä¿®æ”¹å˜é‡æ–¹æ³•æ”¾åœ¨ Application åˆå§‹åŒ–é‡Œä¾¿å¯ä»¥äº†.å†ä¹Ÿä¸ç”¨çƒ¦æ¼æç¤ºæ¡†çš„å‡ºç°äº†.</p>
<h3 id="targetSdkVersion-28"><a href="#targetSdkVersion-28" class="headerlink" title="targetSdkVersion 28"></a>targetSdkVersion 28</h3><p>å½“åœ¨ targetSdkVersion ä¸º28æ—¶,ç³»ç»Ÿæ˜¯ä¸å…è®¸åå°„ç°åå•ä¸­çš„ API,å¦‚æœä½¿ç”¨åˆ™ä¼šæŠ›å‡ºè¿™ä¸ªé”™è¯¯<code>java.lang.NoSuchFieldException: No field mWindowAttributes in class Landroid/view/ViewRootImpl; (declaration of &#39;android.view.ViewRootImpl&#39; appears in /system/framework/framework.jar!classes2.dex)</code>,è€Œæˆ‘ä»¬åå°„çš„ ActivityThread ç±»ä¹Ÿåœ¨ç°åå•,è¿™æ ·å°±å°´å°¬äº†é™·å…¥æ­»å¾ªç¯é‡Œäº†.Google Play å¯¹äº 2019/5/1 ä»¥åä¸Šçº¿çš„ APP å¿…é¡»åŸºäº 28 ç‰ˆæœ¬å¼€å‘,æ‰€ä»¥è§£å†³å„ç§ hook é—®é¢˜æ˜¯å¾ˆæœ‰å¿…è¦å’Œè¿«åˆ‡çš„.<br>å¯¹äºåå°„ç°åå•çš„å­—æ®µæˆ–è€…æ–¹æ³•éƒ½ä¼šæŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸<img src="http://gityuan.com/images/hidden-api/hidden-api-exp.png" alt="hidden-api"></p>
<h4 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h4><p>ä½†æ˜¯å¤©æ— ç»äººä¹‹è·¯,ä¸‡ç‰©çš†å¯åå°„,æœ‰å¤§ä½¬ç»™å‡ºäº†è§£å†³åŠæ³•æ€è·¯éªšçš„ä¸è¡Œ,æ„Ÿè§‰è‡ªå·±çœŸçš„æ€ç»´é™åˆ¶äº†æˆ‘çš„æƒ³è±¡.é€šè¿‡<strong>ä»¥ç³»ç»Ÿèº«ä»½å»åå°„</strong>æ‹¿åˆ° API ,ç„¶åå†å»åå°„ä¿®æ”¹ç°åå• API,è¿™æ ·ç³»ç»Ÿå°±è®¤ä¸ºæˆ‘ä»¬ç¬¬äºŒæ¬¡ä¿®æ”¹çš„æ—¶å€™æ˜¯ç³»ç»Ÿç±»è€Œè±å…äº†æ£€æŸ¥.<a href="http://weishu.me/2019/03/16/another-free-reflection-above-android-p/" target="_blank" rel="noopener">å¦ä¸€ç§ç»•è¿‡ Android Pä»¥ä¸Šéå…¬å¼€APIé™åˆ¶çš„åŠæ³•</a>,è¿™ä¸ªæ˜¯å¤§ä½¬çš„åšæ–‡,è¯¦ç»†é˜è¿°äº†æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜,å¹¶ä¸”åœ¨ GitHub å¼€æºäº†ä»£ç .é‰´äº Android P ç‰ˆæœ¬å·²ç»å‘å¸ƒ,æ‰€ä»¥è¿™ä¸ªæ–¹å¼å¾ˆç¨³å®š,å¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒ.è€Œä¸”åœ¨ Android Q beta 1 é‡Œæµ‹è¯•ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥æ–¹å¼.</p>
<h4 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h4><p>Pandora 2.0 ç‰ˆæœ¬æ›´æ–°åæŸ¥çœ‹äº†ä¸‹æºç æ˜¯æ€ä¹ˆå®ç°ç»•è¿‡ç°åå•æ£€æŸ¥æœºåˆ¶çš„,ç„¶åä¹Ÿå‘ç°äº†å¾ˆå·§å¦™çš„åšæ³•,å°† Class çš„ classloader ç½®ç©º,ä»è€Œç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨äº† BootCalssLoader å»åŠ è½½,å³æˆåŠŸä¼ªé€ æˆäº†ç³»ç»Ÿæ–¹æ³•å»åå°„ç°åå•å­—æ®µ,ç»•è¿‡äº†æ£€æŸ¥æœºåˆ¶,æ€è·¯ä¹Ÿæ˜¯å¾ˆæ£’.<a href="https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java">Reflect28Util</a>è¿™ä¸ªæ˜¯åå°„å·¥å…·ç±»,æ‰€æœ‰çš„åå°„éƒ½é€šè¿‡è¿™ä¸ªå·¥å…·ç±»è¿›è¡Œæ“ä½œ.</p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://github.com/whataa/pandora/blob/master/pandora-core/src/main/java/tech/linjiang/pandora/util/Reflect28Util.java">Pandora ç»•è¿‡æ£€æŸ¥</a><br><a href="https://github.com/tiann/FreeReflection">FreeReflection</a><br><a href="http://weishu.me/2019/03/16/another-free-reflection-above-android-p/" target="_blank" rel="noopener">å¦ä¸€ç§ç»•è¿‡ Android Pä»¥ä¸Šéå…¬å¼€APIé™åˆ¶çš„åŠæ³•</a><br><a href="http://weishu.me/2018/06/07/free-reflection-above-android-p/" target="_blank" rel="noopener">ä¸€ç§ç»•è¿‡Android På¯¹éSDKæ¥å£é™åˆ¶çš„ç®€å•æ–¹æ³•</a><br><a href="http://gityuan.com/2019/01/26/hidden_api/" target="_blank" rel="noopener">ç†è§£Android På†…éƒ¨APIçš„é™åˆ¶è°ƒç”¨æœºåˆ¶</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>ç‰ˆæœ¬é€‚é…</tag>
      </tags>
  </entry>
  <entry>
    <title>Android 9.0 Choreographer åŸç†è§£æ</title>
    <url>/2019/03/15/choreographer/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸ºäº†ç›‘æµ‹ APP è¿è¡Œæ—¶æ˜¯å¦æµç•…,é¡¹ç›®ä½¿ç”¨ Choreographer é…åˆ ActivityLifecycleCallbacks ç›‘æµ‹é¡µé¢æ‰å¸§æƒ…å†µ,ç„¶ååœ¨è®°å½•åˆ°æ•°æ®åº“,æ–¹ä¾¿å›é¡¾é‚£äº›é¡µé¢å‡ºç°é¢‘ç¹å¡é¡¿æƒ…å†µ,ç›®å‰åªæ˜¯åœ¨æµ‹è¯•ç¯å¢ƒä½¿ç”¨,è¿˜æœªå®ç°ä¸Šä¼ è‡³æœåŠ¡å™¨åšæ›´ç›´è§‚çš„åˆ†æ,éƒ½éœ€è¦dump å‡º db æ–‡ä»¶å†åˆ†æ.é¡¹ç›®æœ€ä½ç‰ˆæœ¬ä¹Ÿæ˜¯ 4.1 ä»¥ä¸Š,æ‰€ä»¥ä½¿ç”¨äº† Choreographer è¿™ç§æ–¹å¼.<br><a id="more"></a></p>
<h2 id="Choreographer"><a href="#Choreographer" class="headerlink" title="Choreographer"></a>Choreographer</h2><h3 id="getInstance"><a href="#getInstance" class="headerlink" title="getInstance"></a>getInstance</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Choreographer <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sThreadInstance.get();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Choreographer&gt; sThreadInstance =</span><br><span class="line">        <span class="keyword">new</span> ThreadLocal&lt;Choreographer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Choreographer <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Looper looper = Looper.myLooper();</span><br><span class="line">        <span class="keyword">if</span> (looper == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"The current thread must have a looper!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Choreographer choreographer = <span class="keyword">new</span> Choreographer(looper, VSYNC_SOURCE_APP);</span><br><span class="line">        <span class="keyword">if</span> (looper == Looper.getMainLooper()) &#123;</span><br><span class="line">            mMainInstance = choreographer;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> choreographer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è·å–å½“å‰çº¿ç¨‹çš„ Looper,è€Œ Choreographer æˆ‘ä»¬æ˜¯åˆå§‹åŒ–åœ¨ä¸»çº¿ç¨‹,æ‰€ä»¥è¿™é‡Œç›¸å½“äºæ˜¯ä¸»çº¿ç¨‹,æ‰€ä»¥è¿™æ ·å°±æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨ doFrame æ—¶éœ€è¦èµ·ä¸€ä¸ªå­çº¿ç¨‹å»æ‰“å° Log å’Œä¿å­˜åˆ°æ•°æ®åº“çš„åŸå› .</p>
<h3 id="ç§æœ‰æ„é€ å‡½æ•°"><a href="#ç§æœ‰æ„é€ å‡½æ•°" class="headerlink" title="ç§æœ‰æ„é€ å‡½æ•°"></a>ç§æœ‰æ„é€ å‡½æ•°</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Choreographer</span><span class="params">(Looper looper, <span class="keyword">int</span> vsyncSource)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ–¹æ³•å†…ä»£ç æœ‰çœç•¥</span></span><br><span class="line">    <span class="comment">//FrameHandler å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">    mHandler = <span class="keyword">new</span> FrameHandler(looper);</span><br><span class="line">    <span class="comment">//æ¥æ”¶ Native æ–¹æ³•çš„ VSYNC ä¿¡å·</span></span><br><span class="line">    mDisplayEventReceiver = USE_VSYNC</span><br><span class="line">            ? <span class="keyword">new</span> FrameDisplayEventReceiver(looper, vsyncSource)</span><br><span class="line">            : <span class="keyword">null</span>;</span><br><span class="line">    mLastFrameTimeNanos = Long.MIN_VALUE;</span><br><span class="line">    <span class="comment">//åˆ·æ–°é—´éš”æ—¶é—´ ä¹Ÿå°±æ˜¯16.67ms  getRefreshRate()åœ¨ VirtualDisplayDevice ä¸­å®šä¹‰ä¸º 60,ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é»˜è®¤åˆ·æ–°ç‡</span></span><br><span class="line">    mFrameIntervalNanos = (<span class="keyword">long</span>)(<span class="number">1000000000</span> / getRefreshRate());</span><br><span class="line">    <span class="comment">//åˆ›å»ºå›è°ƒå¯¹è±¡é˜Ÿåˆ— å…±æœ‰å››ç§å›è°ƒ æ‰€ä»¥åˆå§‹åŒ– size ä¸º 4</span></span><br><span class="line">    mCallbackQueues = <span class="keyword">new</span> CallbackQueue[CALLBACK_LAST + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= CALLBACK_LAST; i++) &#123;</span><br><span class="line">        mCallbackQueues[i] = <span class="keyword">new</span> CallbackQueue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="FrameHandler"><a href="#FrameHandler" class="headerlink" title="FrameHandler"></a>FrameHandler</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FrameHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FrameHandler</span><span class="params">(Looper looper)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(looper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">            <span class="comment">//æ¸²æŸ“å¸§</span></span><br><span class="line">            <span class="keyword">case</span> MSG_DO_FRAME:</span><br><span class="line">                doFrame(System.nanoTime(), <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//è¯·æ±‚ VSYNC</span></span><br><span class="line">            <span class="keyword">case</span> MSG_DO_SCHEDULE_VSYNC:</span><br><span class="line">                doScheduleVsync();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//è¯·æ±‚å›è°ƒ</span></span><br><span class="line">            <span class="keyword">case</span> MSG_DO_SCHEDULE_CALLBACK:</span><br><span class="line">                doScheduleCallback(msg.arg1);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="FrameDisplayEventReceiver"><a href="#FrameDisplayEventReceiver" class="headerlink" title="FrameDisplayEventReceiver"></a>FrameDisplayEventReceiver</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FrameDisplayEventReceiver</span> <span class="keyword">extends</span> <span class="title">DisplayEventReceiver</span></span></span><br><span class="line"><span class="class">            <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> mHavePendingVsync;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">long</span> mTimestampNanos;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> mFrame;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//looper æ­¤æ—¶ä¹Ÿæ˜¯ä¸»çº¿ç¨‹</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">FrameDisplayEventReceiver</span><span class="params">(Looper looper, <span class="keyword">int</span> vsyncSource)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(looper, vsyncSource);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç³»ç»Ÿ native æ–¹æ³•ä¼šè°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onVsync</span><span class="params">(<span class="keyword">long</span> timestampNanos, <span class="keyword">int</span> builtInDisplayId, <span class="keyword">int</span> frame)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯ä¸»æ˜¾ç¤ºå±å¹•</span></span><br><span class="line">            <span class="keyword">if</span> (builtInDisplayId != SurfaceControl.BUILT_IN_DISPLAY_ID_MAIN) &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"Received vsync from secondary display, but we don't support "</span></span><br><span class="line">                        + <span class="string">"this case yet.  Choreographer needs a way to explicitly request "</span></span><br><span class="line">                        + <span class="string">"vsync for a specific display to ensure it doesn't lose track "</span></span><br><span class="line">                        + <span class="string">"of its scheduled vsync."</span>);</span><br><span class="line">                scheduleVsync();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¿®æ­£æ—¶é—´ç¡®ä¿æ—¶é—´é¡ºåºæ­£ç¡®</span></span><br><span class="line">            <span class="keyword">long</span> now = System.nanoTime();</span><br><span class="line">            <span class="keyword">if</span> (timestampNanos &gt; now) &#123;</span><br><span class="line">                Log.w(TAG, <span class="string">"Frame time is "</span> + ((timestampNanos - now) * <span class="number">0.000001f</span>)</span><br><span class="line">                        + <span class="string">" ms in the future!  Check that graphics HAL is generating vsync "</span></span><br><span class="line">                        + <span class="string">"timestamps using the correct timebase."</span>);</span><br><span class="line">                timestampNanos = now;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (mHavePendingVsync) &#123;</span><br><span class="line">                Log.w(TAG, <span class="string">"Already have a pending vsync event.  There should only be "</span></span><br><span class="line">                        + <span class="string">"one at a time."</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                mHavePendingVsync = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            mTimestampNanos = timestampNanos;</span><br><span class="line">            mFrame = frame;</span><br><span class="line">            <span class="comment">//å‘ä¸»çº¿ç¨‹å‘é€å¼‚æ­¥æ¶ˆæ¯å¤„ç†ä¸‹ä¸€å¸§ å³è°ƒç”¨ run()</span></span><br><span class="line">            Message msg = Message.obtain(mHandler, <span class="keyword">this</span>);</span><br><span class="line">            msg.setAsynchronous(<span class="keyword">true</span>);</span><br><span class="line">            mHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            mHavePendingVsync = <span class="keyword">false</span>;</span><br><span class="line">            doFrame(mTimestampNanos, mFrame);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>onVsync å‘ä¸»çº¿ç¨‹å‘é€<strong>å¼‚æ­¥æ¶ˆæ¯</strong>æ—¶ç”±äº FrameDisplayEventReceiver å®ç°äº† Runnable æ‰€ä»¥ä¼šç›´æ¥è°ƒç”¨å…¶ run æ–¹æ³•</p>
<h3 id="doFrame"><a href="#doFrame" class="headerlink" title="doFrame"></a>doFrame</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•å†…æœ‰çœç•¥</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doFrame</span><span class="params">(<span class="keyword">long</span> frameTimeNanos, <span class="keyword">int</span> frame)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> startNanos;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mFrameScheduled) &#123;</span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">//å¦‚æœä¸ºæ¸²æŸ“å®Œæˆ,åˆ™ç›´æ¥è¿”å›,è¿™æ ·å°±æ¸²æŸ“ä¸äº†å½“å‰å¸§</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åŸæ¥å¸§çš„ç»˜åˆ¶æ—¶é—´ç‚¹</span></span><br><span class="line">        <span class="keyword">long</span> intendedFrameTimeNanos = frameTimeNanos;</span><br><span class="line">        startNanos = System.nanoTime();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> jitterNanos = startNanos - frameTimeNanos;</span><br><span class="line">        <span class="keyword">if</span> (jitterNanos &gt;= mFrameIntervalNanos) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">long</span> skippedFrames = jitterNanos / mFrameIntervalNanos;</span><br><span class="line">            <span class="comment">//SKIPPED_FRAME_WARNING_LIMIT=30 å¦‚æœé¡µé¢å¤æ‚æ—¶,æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ° Log é‡Œè¾“å‡ºä¸‹é¢çš„ä¿¡æ¯,ä¹Ÿå°±æ˜¯è¯´å®˜æ–¹è®¤ä¸ºæ‰å¸§æ•°=30æ—¶å°±è®¤ä¸ºå¤ªå¡,å»ºè®®ä¼˜åŒ–äº†</span></span><br><span class="line">            <span class="keyword">if</span> (skippedFrames &gt;= SKIPPED_FRAME_WARNING_LIMIT) &#123;</span><br><span class="line">                Log.i(TAG, <span class="string">"Skipped "</span> + skippedFrames + <span class="string">" frames!  "</span></span><br><span class="line">                        + <span class="string">"The application may be doing too much work on its main thread."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">long</span> lastFrameOffset = jitterNanos % mFrameIntervalNanos;</span><br><span class="line">            <span class="keyword">if</span> (DEBUG_JANK) &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"Missed vsync by "</span> + (jitterNanos * <span class="number">0.000001f</span>) + <span class="string">" ms "</span></span><br><span class="line">                        + <span class="string">"which is more than the frame interval of "</span></span><br><span class="line">                        + (mFrameIntervalNanos * <span class="number">0.000001f</span>) + <span class="string">" ms!  "</span></span><br><span class="line">                        + <span class="string">"Skipping "</span> + skippedFrames + <span class="string">" frames and setting frame "</span></span><br><span class="line">                        + <span class="string">"time to "</span> + (lastFrameOffset * <span class="number">0.000001f</span>) + <span class="string">" ms in the past."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            frameTimeNanos = startNanos - lastFrameOffset;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (frameTimeNanos &lt; mLastFrameTimeNanos) &#123;</span><br><span class="line">            <span class="keyword">if</span> (DEBUG_JANK) &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"Frame time appears to be going backwards.  May be due to a "</span></span><br><span class="line">                        + <span class="string">"previously skipped frame.  Waiting for next vsync."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è¯·æ±‚ VSYNC</span></span><br><span class="line">            scheduleVsyncLocked();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mFrameInfo.setVsync(intendedFrameTimeNanos, frameTimeNanos);</span><br><span class="line">        mFrameScheduled = <span class="keyword">false</span>;</span><br><span class="line">        mLastFrameTimeNanos = frameTimeNanos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Trace.traceBegin(Trace.TRACE_TAG_VIEW, <span class="string">"Choreographer#doFrame"</span>);</span><br><span class="line">        AnimationUtils.lockAnimationClock(frameTimeNanos / TimeUtils.NANOS_PER_MS);</span><br><span class="line">        <span class="comment">//ä¼˜å…ˆå¤„ç†è¾“å…¥äº‹ä»¶</span></span><br><span class="line">        mFrameInfo.markInputHandlingStart();</span><br><span class="line">        doCallbacks(Choreographer.CALLBACK_INPUT, frameTimeNanos);</span><br><span class="line"></span><br><span class="line">        mFrameInfo.markAnimationsStart();</span><br><span class="line">        doCallbacks(Choreographer.CALLBACK_ANIMATION, frameTimeNanos);</span><br><span class="line"></span><br><span class="line">        mFrameInfo.markPerformTraversalsStart();</span><br><span class="line">        doCallbacks(Choreographer.CALLBACK_TRAVERSAL, frameTimeNanos);</span><br><span class="line"></span><br><span class="line">        doCallbacks(Choreographer.CALLBACK_COMMIT, frameTimeNanos);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        AnimationUtils.unlockAnimationClock();</span><br><span class="line">        Trace.traceEnd(Trace.TRACE_TAG_VIEW);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (DEBUG_FRAMES) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> endNanos = System.nanoTime();</span><br><span class="line">        Log.d(TAG, <span class="string">"Frame "</span> + frame + <span class="string">": Finished, took "</span></span><br><span class="line">                + (endNanos - startNanos) * <span class="number">0.000001f</span> + <span class="string">" ms, latency "</span></span><br><span class="line">                + (startNanos - frameTimeNanos) * <span class="number">0.000001f</span> + <span class="string">" ms."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="scheduleVsync"><a href="#scheduleVsync" class="headerlink" title="scheduleVsync"></a>scheduleVsync</h3><figure class="highlight java"><figcaption><span>scheduleVsyncLocked.java</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scheduleVsyncLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è°ƒç”¨äº† FrameDisplayEventReceiver çˆ¶ç±» DisplayEventReceiver</span></span><br><span class="line">    mDisplayEventReceiver.scheduleVsync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>DisplayEventReceiver.java</span></figcaption><table><tr><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduleVsync</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mReceiverPtr == <span class="number">0</span>) &#123;</span><br><span class="line">        Log.w(TAG, <span class="string">"Attempted to schedule a vertical sync pulse but the display event "</span></span><br><span class="line">                + <span class="string">"receiver has already been disposed."</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨äº† Native æ–¹æ³•</span></span><br><span class="line">        nativeScheduleVsync(mReceiverPtr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºè¯·æ±‚ VSYNC æœ€ç»ˆæ‰§è¡Œäº† Native æ–¹æ³•,ç”±äºè‡ªå·±ä¸ç†Ÿæ‚‰æ‰€ä»¥å…ˆä¸æ·±ç©¶åšäº†ä»€ä¹ˆ,ä½†æ˜¯å¯ä»¥è‚¯å®š,æœ€ç»ˆä¼šæ‰§è¡Œ onVsync æ–¹æ³•.</p>
<h3 id="scheduleFrameLocked"><a href="#scheduleFrameLocked" class="headerlink" title="scheduleFrameLocked"></a>scheduleFrameLocked</h3><p>åœ¨ FrameHandler æ”¶åˆ° MSG_DO_SCHEDULE_CALLBACK æ—¶è°ƒç”¨ doScheduleCallback æ–¹æ³•,æœ€ç»ˆè°ƒç”¨äº† scheduleFrameLocked;<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scheduleFrameLocked</span><span class="params">(<span class="keyword">long</span> now)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!mFrameScheduled) &#123;</span><br><span class="line">        mFrameScheduled = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (USE_VSYNC) &#123;</span><br><span class="line">            <span class="keyword">if</span> (DEBUG_FRAMES) &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"Scheduling next frame on vsync."</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (isRunningOnLooperThreadLocked()) &#123;</span><br><span class="line">                <span class="comment">//å¦‚æœåœ¨å½“å‰Looperçº¿ç¨‹ åˆ™ç«‹å³è¯·æ±‚VSYNC</span></span><br><span class="line">                scheduleVsyncLocked();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//å¦åˆ™å‘ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯</span></span><br><span class="line">                Message msg = mHandler.obtainMessage(MSG_DO_SCHEDULE_VSYNC);</span><br><span class="line">                msg.setAsynchronous(<span class="keyword">true</span>);</span><br><span class="line">                mHandler.sendMessageAtFrontOfQueue(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">//åªåˆ†æç”¨æˆ·ä½¿ç”¨ VSYNC çš„æƒ…å†µ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="doScheduleCallback"><a href="#doScheduleCallback" class="headerlink" title="doScheduleCallback"></a>doScheduleCallback</h3><p>åœ¨ FrameHandler æ”¶åˆ° MSG_DO_SCHEDULE_CALLBACK æ—¶è°ƒç”¨ doScheduleCallback(callbackType) æ–¹æ³•,æ ¹æ®å›è°ƒé˜Ÿåˆ—è·å–å½“å‰æ—¶é—´çš„å›è°ƒç±»å‹,æœ€ç»ˆè°ƒç”¨äº† scheduleFrameLocked æ–¹æ³•;</p>
<h3 id="doCallbacks"><a href="#doCallbacks" class="headerlink" title="doCallbacks"></a>doCallbacks</h3><p>doFrame æ–¹æ³•é‡Œåœ¨æœ€åè°ƒç”¨äº†å››ç§ç±»å‹çš„ callback<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¾“å…¥ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CALLBACK_INPUT = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//åŠ¨ç”»ç±»å‹</span></span><br><span class="line"><span class="meta">@TestApi</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CALLBACK_ANIMATION = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//éå†ç±»å‹ å…¶ä»–å¼‚æ­¥æ¶ˆæ¯å¤„ç†å®Œä¹‹å,å¤„ç†æ‰§è¡Œ layout å’Œ draw</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CALLBACK_TRAVERSAL = <span class="number">2</span>;</span><br><span class="line"><span class="comment">//æäº¤ç±»å‹ åœ¨ traversalå®Œæˆå å¤„ç† post-draw æ“ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CALLBACK_COMMIT = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doCallbacks</span><span class="params">(<span class="keyword">int</span> callbackType, <span class="keyword">long</span> frameTimeNanos)</span> </span>&#123;</span><br><span class="line">    CallbackRecord callbacks;</span><br><span class="line">    <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> now = System.nanoTime();</span><br><span class="line">        callbacks = mCallbackQueues[callbackType].extractDueCallbacksLocked(</span><br><span class="line">                now / TimeUtils.NANOS_PER_MS);</span><br><span class="line">        <span class="keyword">if</span> (callbacks == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mCallbacksRunning = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (callbackType == Choreographer.CALLBACK_COMMIT) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">long</span> jitterNanos = now - frameTimeNanos;</span><br><span class="line">            Trace.traceCounter(Trace.TRACE_TAG_VIEW, <span class="string">"jitterNanos"</span>, (<span class="keyword">int</span>) jitterNanos);</span><br><span class="line">            <span class="keyword">if</span> (jitterNanos &gt;= <span class="number">2</span> * mFrameIntervalNanos) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">long</span> lastFrameOffset = jitterNanos % mFrameIntervalNanos</span><br><span class="line">                        + mFrameIntervalNanos;</span><br><span class="line">                <span class="keyword">if</span> (DEBUG_JANK) &#123;</span><br><span class="line">                    Log.d(TAG, <span class="string">"Commit callback delayed by "</span> + (jitterNanos * <span class="number">0.000001f</span>)</span><br><span class="line">                            + <span class="string">" ms which is more than twice the frame interval of "</span></span><br><span class="line">                            + (mFrameIntervalNanos * <span class="number">0.000001f</span>) + <span class="string">" ms!  "</span></span><br><span class="line">                            + <span class="string">"Setting frame time to "</span> + (lastFrameOffset * <span class="number">0.000001f</span>)</span><br><span class="line">                            + <span class="string">" ms in the past."</span>);</span><br><span class="line">                    mDebugPrintNextFrameTimeDelta = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                frameTimeNanos = now - lastFrameOffset;</span><br><span class="line">                mLastFrameTimeNanos = frameTimeNanos;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Trace.traceBegin(Trace.TRACE_TAG_VIEW, CALLBACK_TRACE_TITLES[callbackType]);</span><br><span class="line">        <span class="keyword">for</span> (CallbackRecord c = callbacks; c != <span class="keyword">null</span>; c = c.next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (DEBUG_FRAMES) &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"RunCallback: type="</span> + callbackType</span><br><span class="line">                        + <span class="string">", action="</span> + c.action + <span class="string">", token="</span> + c.token</span><br><span class="line">                        + <span class="string">", latencyMillis="</span> + (SystemClock.uptimeMillis() - c.dueTime));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœtoken=FRAME_CALLBACK_TOKEN,åˆ™è°ƒç”¨ä¸‹ä¸€ä¸ªå›è°ƒçš„ doFrame å¦åˆ™ç»§ç»­è°ƒç”¨ run</span></span><br><span class="line">            c.run(frameTimeNanos);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (mLock) &#123;</span><br><span class="line">            mCallbacksRunning = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">final</span> CallbackRecord next = callbacks.next;</span><br><span class="line">                recycleCallbackLocked(callbacks);</span><br><span class="line">                callbacks = next;</span><br><span class="line">            &#125; <span class="keyword">while</span> (callbacks != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Trace.traceEnd(Trace.TRACE_TAG_VIEW);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="CallbackRecord"><a href="#CallbackRecord" class="headerlink" title="CallbackRecord"></a>CallbackRecord</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CallbackRecord</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> CallbackRecord next;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> dueTime;</span><br><span class="line">    <span class="comment">//Runnable ç±»å‹ æˆ–è€… FrameCallbackç±»å‹</span></span><br><span class="line">    <span class="keyword">public</span> Object action;</span><br><span class="line">    <span class="keyword">public</span> Object token;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(<span class="keyword">long</span> frameTimeNanos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (token == FRAME_CALLBACK_TOKEN) &#123;</span><br><span class="line">            ((FrameCallback)action).doFrame(frameTimeNanos);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//æ‰§è¡Œè¾“å…¥ã€åŠ¨ç”»æˆ–è€…éå†çš„ Runnalbe 2.8èŠ‚æœ‰é˜è¿°</span></span><br><span class="line">            ((Runnable)action).run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="CallbackQueue"><a href="#CallbackQueue" class="headerlink" title="CallbackQueue"></a>CallbackQueue</h3><figure class="highlight java"><figcaption><span>CallbackQueue.addCallbackLocked</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCallbackLocked</span><span class="params">(<span class="keyword">long</span> dueTime, Object action, Object token)</span> </span>&#123;</span><br><span class="line">           CallbackRecord callback = obtainCallbackLocked(dueTime, action, token);</span><br><span class="line">           CallbackRecord entry = mHead;</span><br><span class="line">           <span class="keyword">if</span> (entry == <span class="keyword">null</span>) &#123;</span><br><span class="line">               mHead = callback;</span><br><span class="line">               <span class="keyword">return</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//æŒ‰ç…§æ—¶é—´é™åºå…¥é˜Ÿ</span></span><br><span class="line">           <span class="keyword">if</span> (dueTime &lt; entry.dueTime) &#123;</span><br><span class="line">               callback.next = entry;</span><br><span class="line">               mHead = callback;</span><br><span class="line">               <span class="keyword">return</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">while</span> (entry.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="keyword">if</span> (dueTime &lt; entry.next.dueTime) &#123;</span><br><span class="line">                   callback.next = entry.next;</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">               &#125;</span><br><span class="line">               entry = entry.next;</span><br><span class="line">           &#125;</span><br><span class="line">           entry.next = callback;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>CallbackQueue æ˜¯ä¸€ä¸ªç”± CallbackRecord æ„æˆçš„å•å‘é“¾è¡¨,æŠŠ CallbackRecord æŒ‰ç…§äº‹ä»¶å‘ç”Ÿé¡ºåºæ’å…¥åˆ°é˜Ÿåˆ—ä¸­,åœ¨ doFrame æ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºæœ€å…ˆæ”¾å…¥ input å›è°ƒ,è¿™æ ·ä¹Ÿä¿è¯è¾“å…¥äº‹ä»¶æœ€å…ˆæ‰§è¡Œ,è¿™æ ·ä¹Ÿæ­£å¥½å¯¹åº”åˆ°<code>ViewRootImpl</code>ä¸­<code>ConsumeBatchedInputRunnable InvalidateOnAnimationRunnable TraversalRunnable</code>ä»–ä»¬ä¸‰ä¸ªåˆ†åˆ«å¯¹åº”äº†ä¸‰ç§å›è°ƒç±»å‹çš„ Runnalbe.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TestApi</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postCallback</span><span class="params">(<span class="keyword">int</span> callbackType, Runnable action, Object token)</span> </span>&#123;</span><br><span class="line">    postCallbackDelayed(callbackType, action, token, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ViewRootImpl ä¸­åˆå§‹åŒ– Choreographer ååˆ™é€šè¿‡è°ƒç”¨ä¸Šé¢è¿™ä¸ªæ–¹æ³•,æ‰§è¡Œä¸åŒçš„äº‹ä»¶ç±»å‹.</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡æŸ¥çœ‹æºç çŸ¥é“æ•´ä¸ªå±å¹•åˆ·æ–°æœºåˆ¶,å¹³æ—¶çœ‹åˆ° Log é‡Œæ‰“å°<code>The application may be doing too much work on its main thread</code>ä¹ŸçŸ¥é“äº†å‡ºå¤„.ä¹ŸçŸ¥é“äº†ç»å¸¸ä½¿ç”¨çš„ requestLayout å…¶å®æœ€ç»ˆå…¶å®æ‰§è¡Œçš„æ˜¯ ViewRootImpl çš„ TraversalRunnable,å¯¹äºå¡é¡¿çš„å½¢æˆä¹Ÿç¨å¾®æœ‰ç‚¹äº†è§£.</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.jianshu.com/p/c2d93861095a" target="_blank" rel="noopener">Android8.1 Choreographeræœºåˆ¶ä¸æºç åˆ†æ</a><br><a href="http://gityuan.com/2017/02/25/choreographer/" target="_blank" rel="noopener">ChoreographeråŸç†</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æºç è§£æ</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨ Camera Api æ‹æ‘„èº«ä»½è¯</title>
    <url>/2019/02/27/camera-id-card/</url>
    <content><![CDATA[<p>é¡¹ç›®ä¸­éœ€è¦æ ¸éªŒèº«ä»½ä¿¡æ¯,æ‰€ä»¥æ¨¡æ‹Ÿæ”¯ä»˜å®çš„èº«ä»½è¯ OCR ç•Œé¢,åšä¸€ä¸ªç±»ä¼¼çš„åŠŸèƒ½.ä½†æ˜¯åˆæœ‰ä¸åŒçš„åœ°æ–¹,æˆ‘ä»¬éœ€è¦æ‹ä¸‹ç…§ç‰‡è€Œä¸æ˜¯ä¸æ–­çš„æ‰«æè·å–å›¾åƒ.<br>ç”±äºé¡¹ç›®æœ€ä½æ”¯æŒ 4.0 ç³»ç»Ÿä¸ºäº†æ–¹ä¾¿èµ·è§ä½¿ç”¨ Camera è€Œä¸æ˜¯ Camera2 æ¥å£,å› ä¸º Camera2 æ˜¯ 5.0 ä»¥ååŠ å…¥çš„ api.<br><a id="more"></a></p>
<h3 id="è¯·æ±‚ç›¸æœºæƒé™"><a href="#è¯·æ±‚ç›¸æœºæƒé™" class="headerlink" title="è¯·æ±‚ç›¸æœºæƒé™"></a>è¯·æ±‚ç›¸æœºæƒé™</h3><p>æ‰“å¼€ç›¸æœºéœ€è¦<code>&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot; /&gt;</code>æƒé™,å¹¶ä¸”ç›¸æœºæƒé™ä¹Ÿæ˜¯è¿è¡Œæ—¶æƒé™,éœ€è¦åœ¨æ‰“å¼€ç›¸æœºå‰åŠ¨æ€è¯·æ±‚.</p>
<h3 id="è¯·æ±‚å­˜å‚¨æƒé™"><a href="#è¯·æ±‚å­˜å‚¨æƒé™" class="headerlink" title="è¯·æ±‚å­˜å‚¨æƒé™"></a>è¯·æ±‚å­˜å‚¨æƒé™</h3><p>å› ä¸º sample ä¸­ä½¿ç”¨äº† cache ç›®å½•,æ‰€ä»¥ä¸éœ€è¦è¯·æ±‚å­˜å‚¨æƒé™,å¦‚æœä½¿ç”¨å¤–éƒ¨å­˜å‚¨,åˆ™éœ€è¦è¯·æ±‚è¿è¡Œæ—¶æƒé™.</p>
<h3 id="è°ƒç”¨ç›¸æœºæ¥å£"><a href="#è°ƒç”¨ç›¸æœºæ¥å£" class="headerlink" title="è°ƒç”¨ç›¸æœºæ¥å£"></a>è°ƒç”¨ç›¸æœºæ¥å£</h3><ol>
<li>åˆ›å»ºé¢„è§ˆç•Œé¢ï¼Œä½¿ç”¨ SurfaceView ç»˜åˆ¶å®æ—¶é¢„è§ˆå›¾åƒ,ç°åœ¨æ¨èä½¿ç”¨ TextureView,å…³äºä¸¤è€…çš„ç‰¹æ€§å’ŒåŒºåˆ«ä¸å†èµ˜è¿°,æ–‡æœ«æœ‰å‚è€ƒæ–‡ç« ,<br>ç”±äºç›¸æœºé•œå¤´æ˜¯æ¨ªå‘çš„,æ‰€ä»¥éœ€è¦è®¾ç½®ç›¸æœºé¢„è§ˆä¸ºç«–å±<code>camera.setDisplayOrientation(90);</code>,åœ¨æ‹ç…§é¡µé¢é€€å‡ºæ—¶ä¹Ÿéœ€è¦åŠæ—¶é‡Šæ”¾ç›¸æœºèµ„æº.</li>
<li><strong>è°ƒæ•´é¢„è§ˆå°ºå¯¸ã€è°ƒæ•´å›¾ç‰‡å°ºå¯¸</strong> è¿™ä¸ªæ˜¯æ‹ç…§å…³é”®<br>æˆ‘ä»¬æ‰€è¦å®ç°çš„åŠŸèƒ½æ˜¯å…¨å±é¢„è§ˆ,ç›¸æœºé¢„è§ˆå°ºå¯¸æ˜¯ä»å®ƒæ‰€æ”¯æŒçš„è§„æ ¼é‡Œé¢é€‰æ‹©,è€Œä¸æ˜¯æˆ‘ä»¬è‡ªèº«å†³å®š,è€Œä¸åŒæ‰‹æœºåˆæœ‰ä¸åŒå±å¹•çš„æ¯”ä¾‹,æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ‰‹æœºé¢„è§ˆå°ºå¯¸åŒ¹é…åˆ°ä¸€ä¸ªæœ€ç›¸è¿‘çš„å°ºå¯¸,è®¾ç½®ä¸ºç›¸æœºçš„é¢„è§ˆå°ºå¯¸.<br>åŒ¹é…ç®—æ³•:<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Point <span class="title">machBestSize</span><span class="params">(Camera.Parameters parameters, Point screenResolution, List&lt;Camera.Size&gt; supportedSizes)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//é™åºæ’åˆ—</span></span><br><span class="line">        List&lt;Camera.Size&gt; supportedPreviewSizes = <span class="keyword">new</span> ArrayList&lt;Camera.Size&gt;(supportedSizes);</span><br><span class="line">        Collections.sort(supportedPreviewSizes, <span class="keyword">new</span> Comparator&lt;Camera.Size&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Camera.Size a, Camera.Size b)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">int</span> aPixels = a.height * a.width;</span><br><span class="line">                <span class="keyword">int</span> bPixels = b.height * b.width;</span><br><span class="line">                <span class="keyword">if</span> (bPixels &lt; aPixels) &#123;</span><br><span class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (bPixels &gt; aPixels) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//æ‰“å°é•œå¤´æ”¯æŒçš„é¢„è§ˆå°ºå¯¸</span></span><br><span class="line">        <span class="keyword">if</span> (Log.isLoggable(TAG, Log.INFO)) &#123;</span><br><span class="line">            StringBuilder previewSizesString = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (Camera.Size supportedPreviewSize : supportedPreviewSizes) &#123;</span><br><span class="line">                previewSizesString.append(supportedPreviewSize.width).append(<span class="string">'x'</span>).append(supportedPreviewSize.height).append(<span class="string">' '</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            Log.i(TAG, <span class="string">"Supported preview sizes: "</span> + previewSizesString);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">double</span> screenAspectRatio = (<span class="keyword">double</span>) screenResolution.x / (<span class="keyword">double</span>) screenResolution.y;</span><br><span class="line"></span><br><span class="line">        Iterator&lt;Camera.Size&gt; it = supportedPreviewSizes.iterator();</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">            Camera.Size supportedPreviewSize = it.next();</span><br><span class="line">            <span class="keyword">int</span> realWidth = supportedPreviewSize.width;</span><br><span class="line">            <span class="keyword">int</span> realHeight = supportedPreviewSize.height;</span><br><span class="line">            <span class="comment">//MIN_PREVIEW_PIXELS = 480 * 320 ç§»é™¤è¿‡å°çš„å°ºå¯¸</span></span><br><span class="line">            <span class="keyword">if</span> (realWidth * realHeight &lt; MIN_PREVIEW_PIXELS) &#123;</span><br><span class="line">                it.remove();</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">boolean</span> isCandidatePortrait = realWidth &lt; realHeight;</span><br><span class="line">            <span class="keyword">int</span> maybeFlippedWidth = isCandidatePortrait ? realHeight : realWidth;</span><br><span class="line">            <span class="keyword">int</span> maybeFlippedHeight = isCandidatePortrait ? realWidth : realHeight;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">double</span> aspectRatio = (<span class="keyword">double</span>) maybeFlippedWidth / (<span class="keyword">double</span>) maybeFlippedHeight;</span><br><span class="line">            <span class="keyword">double</span> distortion = Math.abs(aspectRatio - screenAspectRatio);</span><br><span class="line">            <span class="comment">// MAX_ASPECT_DISTORTION = 1.5 å¼‚å¸¸çºµæ¨ªæ¯”åå·®è¿‡å¤§çš„å°ºå¯¸</span></span><br><span class="line">            <span class="keyword">if</span> (distortion &gt; MAX_ASPECT_DISTORTION) &#123;</span><br><span class="line">                it.remove();</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (maybeFlippedWidth == screenResolution.x &amp;&amp; maybeFlippedHeight == screenResolution.y) &#123;</span><br><span class="line">                Point exactPoint = <span class="keyword">new</span> Point(realWidth, realHeight);</span><br><span class="line">                Log.i(TAG, <span class="string">"Found preview size exactly matching screen size: "</span> + exactPoint);</span><br><span class="line">                <span class="keyword">return</span> exactPoint;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ²¡æœ‰åŒ¹é…åˆ°æœ€ä¼˜ç»“æœæƒ…å†µä¸‹çš„å…œåº•ç­–ç•¥</span></span><br><span class="line">        <span class="keyword">if</span> (!supportedPreviewSizes.isEmpty()) &#123;</span><br><span class="line">            Camera.Size largestPreview = supportedPreviewSizes.get(<span class="number">0</span>);</span><br><span class="line">            Point largestSize = <span class="keyword">new</span> Point(largestPreview.width, largestPreview.height);</span><br><span class="line">            Log.i(TAG, <span class="string">"Using largest suitable preview size: "</span> + largestSize);</span><br><span class="line">            <span class="keyword">return</span> largestSize;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ²¡æœ‰è·å–é¢„è§ˆå°ºå¯¸åˆ—è¡¨ä¸‹çš„å…œåº•ç­–ç•¥</span></span><br><span class="line">        Camera.Size defaultPreview = parameters.getPictureSize();</span><br><span class="line">        Point defaultSize = <span class="keyword">new</span> Point(defaultPreview.width, defaultPreview.height);</span><br><span class="line">        Log.i(TAG, <span class="string">"No suitable preview sizes, using default: "</span> + defaultSize);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> defaultSize;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>é€šè¿‡è¿™ä¸ªç®—æ³•æˆ‘ä»¬å°±å¯ä»¥åŒ¹é…åˆ°ç›¸è¿‘çš„ç›¸æœºé¢„è§ˆå°ºå¯¸,ä½†æ˜¯è¿˜å¿…é¡»åŒ¹é…æ‹ç…§å°ºå¯¸,å› ä¸ºé¢„è§ˆå°ºå¯¸å’Œç…§ç‰‡å°ºå¯¸æ˜¯ä¸¤ä¸ªä¸åŒçš„é€»è¾‘,å¦‚æœåªåŒ¹é…åˆ°é¢„è§ˆå°ºå¯¸,æœ‰çš„æ‰‹æœºä¼šåŒ¹é…åˆ°ä¸€ä¸ªè¿‡å°çš„ç…§ç‰‡å°ºå¯¸,è¿™æ ·å°±æ— æ³•çœ‹æ¸…å›¾ç‰‡ä¿¡æ¯.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Point pictureSize = findBestPictureSizeValue(parameters, cameraResolution);</span><br><span class="line"><span class="comment">//è®¾ç½®æ‹ç…§å°ºå¯¸</span></span><br><span class="line">parameters.setPictureSize(pictureSize.x, pictureSize.y);</span><br><span class="line">camera.setParameters(parameters);</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å°±å¯ä»¥å’Œæ‰‹æœºè‡ªå¸¦çš„ç›¸æœºå…¨å±æ¨¡å¼ä¸‹é¢„è§ˆæ•ˆæœä¸€æ ·äº†</p>
<h3 id="æ‹ç…§ã€å‰ªè£ã€å‹ç¼©ã€ä¿å­˜"><a href="#æ‹ç…§ã€å‰ªè£ã€å‹ç¼©ã€ä¿å­˜" class="headerlink" title="æ‹ç…§ã€å‰ªè£ã€å‹ç¼©ã€ä¿å­˜"></a>æ‹ç…§ã€å‰ªè£ã€å‹ç¼©ã€ä¿å­˜</h3><p>ä¸ºäº†æ–¹ä¾¿OCR,æ‰€ä»¥æˆ‘ä»¬å°†å›¾ç‰‡è¿›è¡Œå‰ªè£è‡³èº«ä»½è¯å¤§å°,å¯¹äºè¿‡å¤§çš„å°ºå¯¸å‹ç¼©è‡³å¤åˆæˆ‘ä»¬è¦æ±‚,ä¿å­˜æˆæ–‡ä»¶æ–¹ä¾¿ä¸Šä¼ è‡³æœåŠ¡å™¨.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ‹ç…§</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">takePhoto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    val camera = cameraManager.camera</span><br><span class="line">    <span class="comment">//åªéœ€è¦è·å– jpeg æ ¼å¼å›¾ç‰‡</span></span><br><span class="line">    camera.takePicture(<span class="keyword">null</span>, <span class="keyword">null</span>, Camera.PictureCallback &#123; data, _ -&gt;</span><br><span class="line">        <span class="keyword">var</span> resource = BitmapFactory.decodeByteArray(data, <span class="number">0</span>, data.size)</span><br><span class="line">        <span class="keyword">if</span> (resource == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span><span class="meta">@CameraActivity</span>, <span class="string">"æ‹ç…§å¤±è´¥"</span>,Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (canCrop) &#123;</span><br><span class="line">                <span class="comment">//å‰ªè£å›¾ç‰‡è‡³èº«ä»½è¯å¤§å°</span></span><br><span class="line">                resource = cropImage(resource)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¿å­˜å›¾ç‰‡è‡³æ–‡ä»¶</span></span><br><span class="line">            val path = saveBitmap(resource)</span><br><span class="line">            <span class="keyword">if</span> (path.isNotEmpty()) &#123;</span><br><span class="line">                Log.e(<span class="string">"photo saved in path:"</span>, path)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Toast.makeText(<span class="keyword">this</span><span class="meta">@CameraActivity</span>, <span class="string">"ç…§ç‰‡ä¿å­˜å¤±è´¥"</span>,Toast.LENGTH_SHORT).show()</span><br><span class="line">            &#125;</span><br><span class="line">            val intent = Intent()</span><br><span class="line">            intent.putExtra(<span class="string">"imagePath"</span>, path)</span><br><span class="line">            setResult(Activity.RESULT_OK, intent)</span><br><span class="line">            finish()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‰ªè£å›¾ç‰‡ é€šè¿‡è®¡ç®—èº«ä»½è¯æ¡†ä¸å±å¹•çš„è·ç¦» ç¡®å®šå›¾ç‰‡å‰ªè£çš„èŒƒå›´</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">cropImage</span><span class="params">(resource: Bitmap)</span>: Bitmap </span>&#123;</span><br><span class="line">    val ratio = resource.width / (height * <span class="number">1.0</span>)</span><br><span class="line">    val pictureWidth = dp2px(<span class="number">450</span>) * ratio</span><br><span class="line">    val pictureHeight = dp2px(<span class="number">282</span>) * ratio</span><br><span class="line">    val x = (resource.width - pictureWidth) / <span class="number">2</span></span><br><span class="line">    val y = (resource.height - pictureHeight) / <span class="number">2</span></span><br><span class="line">    val bitmap = Bitmap.createBitmap(resource, x.toInt(), y.toInt(),pictureWidth.toInt(), pictureHeight.toInt())</span><br><span class="line">    <span class="keyword">if</span> (pictureWidth &gt; maxWidth) &#123;</span><br><span class="line">        val originRatio = (pictureWidth / (pictureHeight * <span class="number">1.0</span>)).toFloat()</span><br><span class="line">        val matrix = Matrix()</span><br><span class="line">        matrix.postScale(originRatio, originRatio)</span><br><span class="line">        <span class="keyword">return</span> Bitmap.createScaledBitmap(bitmap, maxWidth, (maxWidth /originRatio).toInt(), <span class="keyword">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bitmap</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¿å­˜å›¾ç‰‡è‡³ç¼“å­˜ç›®å½•,ä¸éœ€è¦è¯·æ±‚å­˜å‚¨æƒé™</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">saveBitmap</span><span class="params">(resource: Bitmap)</span>: String </span>&#123;</span><br><span class="line">    val picturePathName = cacheDir.absolutePath + File.separator +System.currentTimeMillis() + <span class="string">".jpg"</span></span><br><span class="line">    val file = File(picturePathName)</span><br><span class="line">    <span class="keyword">var</span> result = <span class="string">""</span></span><br><span class="line">    <span class="keyword">var</span> isSuccess = <span class="keyword">false</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        val fos = FileOutputStream(file)</span><br><span class="line">        isSuccess = resource.compress(Bitmap.CompressFormat.JPEG, <span class="number">100</span>, fos)</span><br><span class="line">        fos.flush()</span><br><span class="line">        fos.close()</span><br><span class="line">        result = file.absolutePath</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">        e.printStackTrace()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (isSuccess) result <span class="keyword">else</span> <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æœ‰çš„æ‰‹æœºç›¸æœºå­˜åœ¨é¢„è§ˆæ—¶ç”»é¢ç¨å¾®å˜å½¢,åœ¨ç›¸æœºé‡Œç”¨å…¨å±é¢„è§ˆæ—¶ä¹Ÿå‘ç°æœ‰åŒæ ·çš„é—®é¢˜,åº”è¯¥æ˜¯é¢„è§ˆæ¯”ä¾‹å’Œå±å¹•æ¯”ä¾‹æœ‰å·®åˆ«å¯¼è‡´çš„.å¦‚æœæƒ³è¦é¢„è§ˆæ•ˆæœå®Œç¾åŒ¹é…,åˆ™éœ€è¦æ”¹å˜é¢„è§ˆå°ºå¯¸è€Œä¸æ˜¯å›ºå®šä¸ºå±å¹•å°ºå¯¸å¤§å°.</p>
<h3 id="æˆªå›¾"><a href="#æˆªå›¾" class="headerlink" title="æˆªå›¾"></a>æˆªå›¾</h3><p>æ‹æ‘„å›½å¾½é¡µæ•ˆæœå›¾(sample æ•ˆæœ) å¦‚æœä¸ºäººåƒé¡µåˆ™æœ‰äººåƒæ¡† <strong>å›½å¾½é¡µä¸ºæ­£é¢ äººåƒé¡µä¸ºåé¢</strong><br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/camera_id_card_front.png" alt></p>
<h3 id="æ›´æ–°å…¼å®¹æ€§æ–¹æ¡ˆ"><a href="#æ›´æ–°å…¼å®¹æ€§æ–¹æ¡ˆ" class="headerlink" title="æ›´æ–°å…¼å®¹æ€§æ–¹æ¡ˆ"></a>æ›´æ–°å…¼å®¹æ€§æ–¹æ¡ˆ</h3><p>ç»è¿‡çº¿ä¸ŠéªŒè¯å­˜åœ¨åŒ¹é…ç…§ç‰‡å°ºå¯¸å°äºèº«ä»½è¯å°ºå¯¸çš„é—®é¢˜,å¯¼è‡´æ‹å‡ºçš„å›¾ç‰‡å¤ªå°æ¨¡ç³Šé—®é¢˜.<br>æ‰€ä»¥å¯ç”¨å¤‡ç”¨æ–¹æ¡ˆ,ç‚¹å‡»æ‹ç…§æ—¶ç›´æ¥é€šè¿‡<code>setOneShotPreviewCallback</code>å®æ—¶é¢„è§ˆå›è°ƒè·å–å›¾ç‰‡æ•°ç»„,ç„¶åå°†æ•°ç»„è½¬åŒ–ä¸º Bitmap ä¾›è°ƒç”¨æ–¹ä½¿ç”¨.<br>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ <code>onPreviewFrame</code>é‡Œè¿”å›çš„æ•°ç»„æ˜¯<code>YUV420SP æ ¼å¼</code>,ä¸èƒ½ç›´æ¥é€šè¿‡<code>BitmapFactory</code>ç”Ÿæˆå›¾ç‰‡,éœ€è¦ç”¨<code>YuvImage</code>è¿›è¡Œè½¬åŒ–æ‰å¯ä»¥ä½¿ç”¨.<br><figure class="highlight java"><figcaption><span>ç”Ÿæˆ Bitmap</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> fun <span class="title">generateBitmap</span><span class="params">(camera: Camera, data: ByteArray)</span>: Bitmap? </span>&#123;</span><br><span class="line">        val size = camera.parameters.previewSize</span><br><span class="line">        val w = size.width </span><br><span class="line">        val h = size.height</span><br><span class="line">        val image = YuvImage(data, ImageFormat.NV21,</span><br><span class="line">                w, h, <span class="keyword">null</span>)</span><br><span class="line">        val os = ByteArrayOutputStream()</span><br><span class="line">        <span class="keyword">if</span> (!image.compressToJpeg(Rect(<span class="number">0</span>, <span class="number">0</span>, w, h), <span class="number">100</span>, os)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        val tmp = os.toByteArray()</span><br><span class="line">        <span class="keyword">return</span> BitmapFactory.decodeByteArray(tmp, <span class="number">0</span>, tmp.size, BitmapFactory.Options())</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>å…¶ä»–é€»è¾‘éƒ½ä¸ç”¨æ”¹å˜,è¿™ç§æ–¹æ³•é€šè¿‡ç•Œé¢ä¸Šçš„æ‰€è§å³æ‰€å¾—ç›´æ¥è·å–å›¾ç‰‡,ä»¥å‡å°‘é€‚é…é—®é¢˜.</p>
<h3 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h3><p><a href="https://github.com/Thewhitelight/Tinder/tree/master/camera">GitHub camera moduleä¸ºæ­¤ sample</a></p>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a href="https://blog.csdn.net/jinzhuojun/article/details/44062175" target="_blank" rel="noopener">Android 5.0(Lollipop)ä¸­çš„SurfaceTextureï¼ŒTextureView, SurfaceViewå’ŒGLSurfaceView</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Camera</tag>
      </tags>
  </entry>
  <entry>
    <title>åº”ç”¨å®‰è£…ç‰ˆæœ¬é€‚é…é—®é¢˜</title>
    <url>/2019/02/21/install_apk_refer/</url>
    <content><![CDATA[<p>ä½¿ç”¨ DownloadManger è¿›è¡Œåº”ç”¨å†…æ›´æ–°ç„¶åå½“ä¸‹è½½æˆåŠŸæ—¶è°ƒèµ·å®‰è£…ç•Œé¢,æ„Ÿè§‰æŒºç®€å•è°ƒç”¨ç³»ç»Ÿ api å°±å¯ä»¥å®Œæˆ,ä½†æ˜¯é‡Œé¢é€‚é…çš„å‘çœŸçš„æ˜¯å¾ˆå¤š.<br><a id="more"></a></p>
<h2 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h2><h3 id="6-0ä»¥ä¸‹"><a href="#6-0ä»¥ä¸‹" class="headerlink" title="6.0ä»¥ä¸‹"></a>6.0ä»¥ä¸‹</h3><p>å‡ ä¹æ²¡ä»€ä¹ˆå‘æŒ‰ç…§å¸¸è§„ä»£ç çš„ä¸‹è½½å®‰è£…å³å¯<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//downloadId ä½¿ç”¨ DownloadManager æ—¶æŒ‡å®šçš„ id</span></span><br><span class="line">Uri uri = downloadManager.getUriForDownloadedFile(downloadId);</span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class="line">intent.setDataAndType(uri, <span class="string">"application/vnd.android.package-archive"</span>);</span><br><span class="line">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class="line">mContext.startActivity(intent);</span><br></pre></td></tr></table></figure></p>
<h3 id="6-0"><a href="#6-0" class="headerlink" title="6.0"></a>6.0</h3><div class="note info">
            <p>é¦–å…ˆè¦ç”³è¯·è¿è¡Œæ—¶è¯»å†™æƒé™ </p>
          </div>
è·å¾—æˆæƒå,å¦‚æœä½¿ç”¨ä¸Šè¿°ä»£ç æ‰“å¼€å®‰è£…é¡µé¢åˆ™ä¼šæŠ›å‡ºä¸‹é¢çš„é”™è¯¯
<div class="note danger">
            <p>Caused by: android.content.ActivityNotFoundException: No Activity found to handle Intent { act=android.intent.action.VIEW dat=content: typ=application/vnd.android.package-archive flg=0x10000000 } </p>
          </div>
<p>åº”ä¸ºåœ¨ 6.0 ä¸­ <code>downloadManager.getUriForDownloadedFile(downloadId)</code> è·å–çš„ uri ä¸º content://downloads/my_downloads/109 è¿™ç§æ ¼å¼,æ˜¾ç„¶è¿™ä¸æ˜¯ä¸ªæ–‡ä»¶åœ°å€è·¯å¾„å¯¼è‡´ä¸Šé¢çš„æŠ¥é”™*,<strong>ä½†è¿™ä¸ªé—®é¢˜åªå­˜åœ¨äº 6.0</strong>,æ‰€ä»¥éœ€è¦é’ˆå¯¹ 6.0 ç‰ˆæœ¬è¿›è¡Œåˆ¤æ–­å¤„ç†<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION_CODES.M == Build.VERSION.SDK_INT) &#123;</span><br><span class="line">           DownloadManager dManager = (DownloadManager) mContext.getSystemService(Context.DOWNLOAD_SERVICE);</span><br><span class="line">           DownloadManager.Query query = <span class="keyword">new</span> DownloadManager.Query().setFilterById(downloadId);</span><br><span class="line">           Cursor c = <span class="keyword">null</span>;</span><br><span class="line">           <span class="keyword">if</span> (dManager != <span class="keyword">null</span>) &#123;</span><br><span class="line">               c = dManager.query(query);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (c != <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="keyword">if</span> (c.moveToFirst()) &#123;</span><br><span class="line">                   <span class="keyword">int</span> columnIndex = c.getColumnIndex(DownloadManager.COLUMN_STATUS);</span><br><span class="line">                   <span class="keyword">if</span> (DownloadManager.STATUS_SUCCESSFUL == c.getInt(columnIndex)) &#123;</span><br><span class="line">                       String downloadFileUrl = c.getString(c.getColumnIndex(DownloadManager.COLUMN_LOCAL_URI));</span><br><span class="line">                       <span class="comment">//è·å– apk åœ°å€å®‰è£…</span></span><br><span class="line">                       installAPK(Uri.parse(downloadFileUrl));</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">               c.close();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           Uri downloadFileUri = downloadManager.getUriForDownloadedFile(downloadId);</span><br><span class="line">           installAPK(downloadFileUri);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è·å– apk åœ°å€åä¾¿å¯ä»¥è¿›è¡Œå®‰è£…</p>
<h3 id="7-0"><a href="#7-0" class="headerlink" title="7.0"></a>7.0</h3><div class="note info">
            <p>å¯¹äºé¢å‘ Android 7.0 çš„åº”ç”¨,Android æ¡†æ¶æ‰§è¡Œçš„ StrictMode API æ”¿ç­–ç¦æ­¢åœ¨æ‚¨çš„åº”ç”¨å¤–éƒ¨å…¬å¼€ file:// URIã€‚å¦‚æœä¸€é¡¹åŒ…å«æ–‡ä»¶ URI çš„ intent ç¦»å¼€æ‚¨çš„åº”ç”¨ï¼Œåˆ™åº”ç”¨å‡ºç°æ•…éšœï¼Œå¹¶å‡ºç° FileUriExposedException å¼‚å¸¸ã€‚ </p>
          </div>
<p>å…·ä½“åšæ³• å¯ä»¥å‚è€ƒ <a href="http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/" target="_blank" rel="noopener">å…³äº Android 7.0 é€‚é…ä¸­ FileProvider éƒ¨åˆ†çš„æ€»ç»“</a></p>
<h3 id="8-0ä»¥ä¸Š"><a href="#8-0ä»¥ä¸Š" class="headerlink" title="8.0ä»¥ä¸Š"></a>8.0ä»¥ä¸Š</h3><p>ç”±äºæƒé™å˜æ›´ éœ€è¦åœ¨ AndroidManifest.xml åŠ å…¥<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.REQUEST_INSTALL_PACKAGES"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>å¦åˆ™ä¼š RuntimeExcetption<br>åœ¨ GitHub ä¸­çœ‹åˆ°æœ‰äººåæ˜ ,åœ¨ Android 8.0 Oreo ä¸­,Google ç§»é™¤æ‰äº†å®¹æ˜“è¢«æ»¥ç”¨çš„â€œå…è®¸ä½ç½®æ¥æºâ€åº”ç”¨çš„å¼€å…³,åœ¨å®‰è£… Play Store ä¹‹å¤–çš„ç¬¬ä¸‰æ–¹æ¥æºçš„ Android åº”ç”¨çš„æ—¶å€™,ç«Ÿç„¶æ²¡æœ‰äº†â€œå…è®¸æœªçŸ¥æ¥æºâ€çš„æ£€æŸ¥æ¡†,ä½†æ˜¯æˆ‘æ‰‹ä¸Šçš„ 8.1 å’Œ 9.0 ç³»ç»Ÿåˆ™éƒ½æœ‰è¿™ä¸ªæç¤ºæ¡†. ä½†æ˜¯ä¸èƒ½æ’é™¤æœ‰æ‰‹æœºæ²¡æœ‰æˆ–è€…ç”¨æˆ·å…³é—­è¿‡,æ‰€ä»¥è¿˜æ˜¯åŠ å…¥æƒé™åˆ¤æ–­åŠç”³è¯·ä¼šæ¯”è¾ƒå¥½,è¿™ä¸ª issues æ­£å¥½æä¾›äº†è§£å†³æ–¹æ¡ˆ<br><a href="https://github.com/yjfnypeu/UpdatePlugin/issues/51">ç”³è¯·â€œå…è®¸ä½ç½®æ¥æºâ€</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://yifeng.studio/2017/05/03/android-7-0-compat-fileprovider/" target="_blank" rel="noopener">å…³äº Android 7.0 é€‚é…ä¸­ FileProvider éƒ¨åˆ†çš„æ€»ç»“</a><br><a href="https://github.com/yjfnypeu/UpdatePlugin/issues/51">ç”³è¯·â€œå…è®¸ä½ç½®æ¥æºâ€</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>ç‰ˆæœ¬é€‚é…</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨ AOP å¯¹æ–¹æ³•æ·»åŠ ç›‘æ§æ—¥å¿—</title>
    <url>/2019/01/02/android-track-log/</url>
    <content><![CDATA[<p>åœ¨æŸ¥çœ‹åŒäº‹å†™çš„ä»£ç æ—¶,å‘ç°å„ç§æ–¹æ³•è°ƒç”¨æœ‰ç‚¹æ··ä¹±,ä¸æ˜“å¿«é€Ÿæ¢³ç†é€»è¾‘.æ‰€ä»¥æƒ³ç€æ˜¯å¦å¯ä»¥é€šè¿‡æ‰“å°æ–¹æ³•æ—¥å¿—,ä»è€Œè§‚å¯Ÿå„ç§æ–¹æ³•é—´çš„è°ƒç”¨é€»è¾‘.</p>
<h4 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h4><ol>
<li>æ‰“å°æ–¹æ³•åç§°ã€å…¥å‚ã€è€—æ—¶ã€è¿”å›å€¼</li>
<li>å¯¹é¡¹ç›®æ‰€æœ‰æ–¹æ³•ç”Ÿæ•ˆ</li>
<li>å¯ä»¥è‡ªå®šä¹‰æ’é™¤ä¸æ‰“å°çš„ç±»</li>
<li>å¯ä½œä¸ºä¸‰æ–¹åº“<a id="more"></a>
</li>
</ol>
<h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p>æœ¬é¡¹ç›®ä½¿ç”¨ Javassist å®ç°äº†ä»¥ä¸‹éœ€æ±‚.</p>
<h5 id="AspectJ"><a href="#AspectJ" class="headerlink" title="AspectJ"></a>AspectJ</h5><p>è¿™ä¸ªåŠŸèƒ½è®©æˆ‘æƒ³èµ·äº† JakeWharton å¤§ç¥çš„ hugo åº“,é€šè¿‡ AspectJ å¯¹æ·»åŠ æ³¨è§£çš„æ–¹æ³•æ’å…¥ Log åœ¨è°ƒç”¨çš„æ—¶å€™å°±å¯ä»¥è§‚å¯Ÿè°ƒç”¨é¡ºåºåŠå‚æ•°.ä½†æ˜¯è¿™ä¸ªåº“ä¸èƒ½æ»¡è¶³æ‰€æœ‰æ–¹æ³•çš„æ‰“å°,åªèƒ½å¯¹æ·»åŠ äº†æ³¨è§£çš„æ–¹æ³•æ‰“å°,æ‰‹åŠ¨ç»™æ–¹æ³•æ·»åŠ æ³¨è§£å·¥ç¨‹é‡å¤ªå¤§.ä½†æ˜¯å¯ä»¥é€šè¿‡æ”¹é€ åˆ‡å…¥ç‚¹<code>@Pointcut(&quot;execution(* &quot; + BuildConfig.PACKAGE_NAME + &quot;..*.*(..))  BuildConfig.PACKAGE_NAME ä¸ºé¡¹ç›®åŒ…å</code> ä½¿å…¶åˆ‡å…¥åŒ…å†…æ‰€æœ‰æ–¹æ³•,è¿™æ ·ä¾¿å¯ä»¥æ‰“å°æ‰€æœ‰æ–¹æ³•,ä½†æ˜¯è¿™æ ·åˆä¸èƒ½æ»¡è¶³ä½œä¸ºç¬¬ä¸‰æ–¹åº“çš„é—®é¢˜,å› ä¸ºæ³¨è§£å€¼å¿…é¡»æ˜¯é™æ€å¸¸é‡,ä¸èƒ½åŠ¨æ€ä¿®æ”¹.æœ¬é¡¹ç›®å€Ÿé‰´äº† hugo åº“éƒ¨åˆ†æ€æƒ³.åœ¨<a href="https://github.com/Thewhitelight/Analysis">Github</a> ä¸­æœ‰ä½¿ç”¨ AspectJ å®ç°éƒ¨åˆ†éœ€æ±‚,å¹¶ä¸”å¯ä»¥åˆ‡å…¥ Kotlin.<br>Aspectj æœ¬èº«è¯­æ³•å¾ˆç®€å•,åº”è¯¥æ˜¯æœ€å®¹æ˜“ä¸Šæ‰‹çš„ AOP æ¡†æ¶,ä½†æ˜¯å¯¹ Kotlin æ”¯æŒæœ‰é—®é¢˜,å…³äºè¿™ä¸ªå¯ä»¥å‚è€ƒæ²ªæ±Ÿç½‘æ ¡å¯¹ AspectJ æ”¹é€ çš„å¼€æºé¡¹ç›®,å…¶æ”¯æŒäº†æ›´å¤šåŠŸèƒ½,æ–‡åå‚è€ƒä¸­æœ‰ç»™å‡ºç›¸å…³é“¾æ¥.</p>
<h5 id="Javassist"><a href="#Javassist" class="headerlink" title="Javassist"></a>Javassist</h5><p>Javassist æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æã€ç¼–è¾‘å’Œåˆ›å»º Java å­—èŠ‚ç  çš„ç±»åº“ .æ€§èƒ½è¾ƒ ASM å·®,è·Ÿ cglib å·®ä¸å¤š,ä½†æ˜¯ä½¿ç”¨ç›¸å¯¹ç®€å•.<br>ä¸ºäº†æ–¹ä¾¿å¼•ç”¨æ‰€ä»¥é‡‡ç”¨ gradle plugin æ–¹å¼,æ–¹ä¾¿è°ƒç”¨è€…å¿«é€Ÿæ·»åŠ åˆ°åŸæœ‰é¡¹ç›®ä¸­å».å…³äºç¼–å†™æ’ä»¶çš„æ•™ç¨‹ç½‘ç»œæœ‰å¾ˆå¤š,ä¸åšè¿‡å¤šä»‹ç».</p>
<h6 id="TraceExtension-è‡ªå®šä¹‰-plugin-é…ç½®"><a href="#TraceExtension-è‡ªå®šä¹‰-plugin-é…ç½®" class="headerlink" title="TraceExtension è‡ªå®šä¹‰ plugin é…ç½®"></a>TraceExtension è‡ªå®šä¹‰ plugin é…ç½®</h6><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TraceExtension</span> &#123;</span></span><br><span class="line">    <span class="comment">//éœ€è¦æ’é™¤çš„ç±»</span></span><br><span class="line">    List&lt;String&gt; classExcludes = <span class="keyword">new</span> ArrayList&lt;&gt;()</span><br><span class="line">    <span class="comment">//éœ€è¦æ’é™¤çš„åŒ…</span></span><br><span class="line">    List&lt;String&gt; packageExcludes = <span class="keyword">new</span> ArrayList&lt;&gt;()</span><br><span class="line">    <span class="comment">//æ˜¯å¦å¯ç”¨</span></span><br><span class="line">    <span class="keyword">def</span> enabled = <span class="literal">true</span></span><br><span class="line">    <span class="comment">//é¡¹ç›®åŒ…å,å¹¶éapplicationId</span></span><br><span class="line">    <span class="keyword">def</span> packageName</span><br><span class="line">    <span class="comment">//æ‰“å°æ—¥å¿—çš„çº§åˆ«</span></span><br><span class="line">    <span class="keyword">def</span> logLevel = <span class="string">"d"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TraceExtension å®šä¹‰è‡ªå®šä¹‰é…ç½®ç±»,æ–¹ä¾¿æ’é™¤ä¸€äº›ç®€å•çš„å·¥å…·ç±»è°ƒç”¨.</p>
<h6 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h6><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trace</span> <span class="keyword">implements</span> <span class="title">Plugin</span>&lt;<span class="title">Project</span>&gt; &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">void</span> apply(Project project) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> hasApp = project.plugins.withType(AppPlugin)</span><br><span class="line">        <span class="keyword">def</span> hasLib = project.plugins.withType(LibraryPlugin)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!hasApp &amp;&amp; !hasLib) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"'android' or 'android-library' plugin required."</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">def</span> variants</span><br><span class="line">        <span class="keyword">if</span> (hasApp) &#123;</span><br><span class="line">            variants = project.android.applicationVariants</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            variants = project.android.libraryVariants</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">def</span> log = project.logger</span><br><span class="line">        variants.all &#123; variant -&gt;</span><br><span class="line">            <span class="keyword">if</span> (!variant.buildType.isDebuggable()) &#123;</span><br><span class="line">                log.debug(<span class="string">"Skipping non-debuggable build type '$&#123;variant.buildType.name&#125;'."</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!project.Trace.enabled) &#123;</span><br><span class="line">                log.debug(<span class="string">"Trace is not disabled."</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        project.extensions.create(<span class="string">'Trace'</span>, TraceExtension)</span><br><span class="line"></span><br><span class="line">        println(<span class="string">"=== Trace Plugin ==="</span>)</span><br><span class="line">        <span class="keyword">def</span> android = project.extensions.findByType(AppExtension)</span><br><span class="line">        <span class="comment">//æ³¨å†Œ Transform,æ³¨å…¥æ‰€è¦æ’å…¥çš„ä»£ç </span></span><br><span class="line">        android.registerTransform(<span class="keyword">new</span> TraceTransform(project))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Trace ä¸ºè‡ªå®šä¹‰çš„æ’ä»¶,åœ¨ release ç¯å¢ƒä¸‹ä¸éœ€è¦æ’å…¥ Log ä»¥å…å½±å“æ€§èƒ½.</p>
<h6 id="TraceTransform"><a href="#TraceTransform" class="headerlink" title="TraceTransform"></a>TraceTransform</h6><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TraceTransform</span> <span class="keyword">extends</span> <span class="title">Transform</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    Project project</span><br><span class="line"></span><br><span class="line">    TraceTransform(Project project) &#123;</span><br><span class="line">        <span class="keyword">this</span>.project = project</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    String getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"TraceTransform"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éœ€è¦å¤„ç†çš„æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Set&lt;QualifiedContent.ContentType&gt; getInputTypes() &#123;</span><br><span class="line">        <span class="keyword">return</span> TransformManager.CONTENT_CLASS</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éœ€è¦å¤„ç†çš„èŒƒå›´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Set&lt;? super QualifiedContent.Scope&gt; getScopes() &#123;</span><br><span class="line">        // å®¿ä¸»é¡¹ç›®ã€å…¶å­é¡¹ç›®åŠå¤–éƒ¨å¼•ç”¨åº“</span><br><span class="line">        return TransformManager.SCOPE_FULL_PROJECT</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    boolean isIncremental() &#123;</span><br><span class="line">        return false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    void transform(TransformInvocation transformInvocation) throws TransformException, InterruptedException, IOException &#123;</span><br><span class="line">        super.transform(transformInvocation)</span><br><span class="line">        if (!project.Trace.enabled) &#123;</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        def outputProvider = transformInvocation.outputProvider</span><br><span class="line"></span><br><span class="line">        transformInvocation.inputs.each &#123; TransformInput input -&gt;</span><br><span class="line">            //å®¿ä¸»é¡¹ç›®</span><br><span class="line">            input.directoryInputs.each &#123; DirectoryInput directoryInput -&gt;</span><br><span class="line">                //æ³¨å…¥ä»£ç </span><br><span class="line">                TraceInject.injectDirCode(directoryInput.file.absolutePath, project)</span><br><span class="line">                def dest = outputProvider.getContentLocation(</span><br><span class="line">                        directoryInput.name,</span><br><span class="line">                        directoryInput.contentTypes,</span><br><span class="line">                        directoryInput.scopes,</span><br><span class="line">                        Format.DIRECTORY)</span><br><span class="line">                FileUtils.copyDirectory(directoryInput.file, dest)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            //ç¬¬ä¸‰æ–¹jar è™½ç„¶å¯¹jaræ²¡æœ‰æ“ä½œ,ä½†æ˜¯ä¹Ÿè¦è¾“å‡ºåˆ°outè·¯å¾„ ä¸ç„¶è¿è¡Œæ—¶ä¼šæŠ›é”™.</span><br><span class="line">            input.jarInputs.each &#123; JarInput jarInput -&gt;</span><br><span class="line">                def jarName = jarInput.name</span><br><span class="line">                def md5Name = DigestUtils.md5Hex(jarInput.file.getAbsolutePath())</span><br><span class="line">                if (jarName.endsWith(".jar")) &#123;</span><br><span class="line">                    jarName = jarName.substring(0, jarName.length() - 4)</span><br><span class="line">                &#125;</span><br><span class="line">                def dest = outputProvider.getContentLocation(</span><br><span class="line">                        jarName + md5Name,</span><br><span class="line">                        jarInput.contentTypes,</span><br><span class="line">                        jarInput.scopes,</span><br><span class="line">                        Format.JAR)</span><br><span class="line">                FileUtils.copyFile(jarInput.file, dest)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¸ºäº†åœ¨æ–¹æ³•ä¸­æ·»åŠ  Log å°±éœ€è¦èµ¶åœ¨ class æ–‡ä»¶è¢«è½¬åŒ–ä¸º dex æ–‡ä»¶ä¹‹å‰å»ä¿®æ”¹ç±»,Tranfrom æ³¨å†Œåˆ°æ’ä»¶ä¸­ä¾¿ä¼šè‡ªåŠ¨æ·»åŠ åˆ° Task æ‰§è¡Œåºåˆ—ä¸­ï¼Œå¹¶ä¸”æ­£å¥½æ˜¯é¡¹ç›®è¢«æ‰“åŒ…æˆdexä¹‹å‰,ä¸éœ€è¦åƒ AspectJ é‚£ç”¨æ‰‹åŠ¨æ·»åŠ åˆ°æœ€åä¸€ä¸ª Task ä¸­å».</p>
<h6 id="TraceInject-æ’å…¥-Log"><a href="#TraceInject-æ’å…¥-Log" class="headerlink" title="TraceInject æ’å…¥ Log"></a>TraceInject æ’å…¥ Log</h6><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TraceInject</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> String TAG = <span class="string">"Trace"</span></span><br><span class="line">    <span class="keyword">static</span> ClassPool POOL = ClassPool.getDefault()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> injectDirCode(String path, Project project) &#123;</span><br><span class="line">        POOL.appendClassPath(path)</span><br><span class="line">        <span class="comment">//æ·»åŠ  Android SDK è·¯å¾„</span></span><br><span class="line">        POOL.appendClassPath(project.android.bootClasspath[<span class="number">0</span>].toString())</span><br><span class="line">        File dir = <span class="keyword">new</span> File(path)</span><br><span class="line">        <span class="keyword">if</span> (dir.isDirectory()) &#123;</span><br><span class="line">            dir.eachFileRecurse &#123; File file -&gt;</span><br><span class="line">                String filePath = file.absolutePath</span><br><span class="line">                <span class="comment">//æ’é™¤ä¸éœ€è¦çš„ç³»ç»Ÿç”Ÿæˆclass</span></span><br><span class="line">                <span class="keyword">if</span> (filePath.endsWith(<span class="string">".class"</span>)</span><br><span class="line">                        &amp;&amp; !filePath.contains(<span class="string">'R$'</span>)</span><br><span class="line">                        &amp;&amp; !filePath.contains(<span class="string">'R.class'</span>)</span><br><span class="line">                        &amp;&amp; !filePath.contains(<span class="string">"BuildConfig.class"</span>)) &#123;</span><br><span class="line">                    modifyClass(project, path, filePath)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> modifyClass(Project project, String path, String filePath) &#123;</span><br><span class="line">        String classPath</span><br><span class="line">        <span class="keyword">def</span> packageName = project.Trace.packageName</span><br><span class="line">        filePath = filePath.replace(<span class="string">"/"</span>, <span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (classExcludes(project, filePath)) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (packageExcludes(project, filePath)) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (filePath.contains(packageName)) &#123;</span><br><span class="line">            <span class="keyword">int</span> index = filePath.indexOf(packageName)</span><br><span class="line">            classPath = filePath.substring(index, filePath.length())</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            println(<span class="string">"project can not inject"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å°†è·¯å¾„è½¬åŒ–ä¸ºç±»å</span></span><br><span class="line">        String className = classPath.substring(<span class="number">0</span>, classPath.length() - <span class="number">6</span>)</span><br><span class="line">                .replace(<span class="string">'/'</span>, <span class="string">'.'</span>)</span><br><span class="line">                .replace(<span class="string">'/'</span>, <span class="string">'.'</span>)</span><br><span class="line">        CtClass c = POOL.getCtClass(className)</span><br><span class="line">        <span class="comment">//ç±»éœ€è¦è§£å†»åä¾¿å¯ä»¥ä¿®æ”¹,å¦åˆ™æ— æ³•ä¿®æ”¹</span></span><br><span class="line">        <span class="keyword">if</span> (c.isFrozen()) &#123;</span><br><span class="line">            c.defrost()</span><br><span class="line">        &#125;</span><br><span class="line">        CtMethod[] methods = c.getDeclaredMethods()</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> (CtMethod <span class="string">method :</span> methods) &#123;</span><br><span class="line">            <span class="comment">//æ’é™¤ç©ºæ–¹æ³•å’Œ native æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">if</span> (method.isEmpty() || Modifier.isNative(method.getModifiers())) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            i++</span><br><span class="line">            insertTime(project.Trace.logLevel, className.replace(packageName + <span class="string">"."</span>, <span class="string">""</span>), method)</span><br><span class="line">        &#125;</span><br><span class="line">        c.writeFile(path)</span><br><span class="line">        c.detach()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> insertTime(String logLevel, String className, CtMethod method) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> pos = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            CodeAttribute codeAttribute = method.getMethodInfo().getCodeAttribute()</span><br><span class="line">            LocalVariableAttribute attribute = (LocalVariableAttribute) codeAttribute.getAttribute(LocalVariableAttribute.tag)</span><br><span class="line">            <span class="keyword">int</span> size = method.getParameterTypes().length</span><br><span class="line">            String[] paramTypes = <span class="keyword">new</span> String[size]</span><br><span class="line">            <span class="keyword">if</span> (attribute == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                <span class="comment">//è·å–å…¥å‚ç±»å‹</span></span><br><span class="line">                paramTypes[i] = method.getParameterTypes()[i].name</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> stringType = POOL.getCtClass(<span class="string">"java.lang.String"</span>)</span><br><span class="line">            <span class="keyword">def</span> objType = POOL.getCtClass(<span class="string">"java.lang.Object"</span>)</span><br><span class="line">            <span class="comment">//å®šä¹‰å±€éƒ¨å˜é‡</span></span><br><span class="line">            method.addLocalVariable(<span class="string">"startTime"</span>, CtClass.longType)</span><br><span class="line">            method.addLocalVariable(<span class="string">"endTime"</span>, CtClass.longType)</span><br><span class="line">            <span class="comment">//æ‰“å°ç±»å</span></span><br><span class="line">            method.addLocalVariable(<span class="string">"className"</span>, stringType)</span><br><span class="line">            <span class="comment">//æ‰“å°æ–¹æ³•å</span></span><br><span class="line">            method.addLocalVariable(<span class="string">"methodName"</span>, stringType)</span><br><span class="line">            <span class="comment">//æ‰“å°è¡Œå·</span></span><br><span class="line">            method.addLocalVariable(<span class="string">"lineNumber"</span>, CtClass.intType)</span><br><span class="line">            <span class="comment">//æ‰“å°è¿”å›å€¼</span></span><br><span class="line">            method.addLocalVariable(<span class="string">"returnObj"</span>, objType)</span><br><span class="line"></span><br><span class="line">            StringBuilder startInjectSB = <span class="keyword">new</span> StringBuilder()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//*** çœç•¥æ’å…¥ä»£ç </span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ–¹æ³•å‰æ’å…¥ Log</span></span><br><span class="line">            method.insertBefore(startInjectSB.toString())</span><br><span class="line"></span><br><span class="line">            StringBuilder endInjectSB = <span class="keyword">new</span> StringBuilder()</span><br><span class="line">            <span class="comment">//*** çœç•¥æ’å…¥ä»£ç </span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ–¹æ³• return å‰æ’å…¥ Log</span></span><br><span class="line">            method.insertAfter(endInjectSB.toString())</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Javassit è¯­æ³•ç›¸å¯¹ç®€å•,åœ¨çœ‹è¿‡å‚è€ƒæ–‡æ¡£å’Œä¸€äº›ç®€å•çš„èµ„æ–™å°±å¯ä»¥ç›´æ¥ä¸Šæ‰‹.</p>
<h4 id="ç”¨æ³•åŠé¡¹ç›®åœ°å€"><a href="#ç”¨æ³•åŠé¡¹ç›®åœ°å€" class="headerlink" title="ç”¨æ³•åŠé¡¹ç›®åœ°å€"></a>ç”¨æ³•åŠé¡¹ç›®åœ°å€</h4><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">é¡¹ç›® gradle</span><br><span class="line"><span class="keyword">classpath</span> <span class="string">'cn.libery.analysis:trace:1.0.1'</span> </span><br><span class="line">module gradle</span><br><span class="line">apply plugin: <span class="string">'analysis-trace'</span> </span><br><span class="line">Trace &#123;</span><br><span class="line">        <span class="comment">// æ”¹å˜é…ç½®å€¼å éœ€è¦å…ˆ clean é¡¹ç›®</span></span><br><span class="line">        <span class="comment">//æ˜¯å¦å¯ç”¨æ’ä»¶</span></span><br><span class="line">        enabled <span class="keyword">true</span></span><br><span class="line">        <span class="comment">//åŒ…å(é applicationId)</span></span><br><span class="line">        packageName <span class="string">"cn.libery.analysis.sample"</span></span><br><span class="line">        <span class="comment">//æ—¥å¿—ç­‰çº§ å’Œ Logcat å¯¹åº”</span></span><br><span class="line">        logLevel <span class="string">"i"</span></span><br><span class="line">        <span class="comment">//æ’é™¤çš„ç±»,å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line">        classExcludes = [<span class="string">"cn.libery.analysis.sample.Logger"</span>,</span><br><span class="line">                        <span class="string">"cn.libery.analysis.sample.Logger2"</span>]</span><br><span class="line">        <span class="comment">//æ’é™¤çš„åŒ…,å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line">        packageExcludes = [<span class="string">"cn.libery.analysis.sample.test"</span>]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‚è€ƒ Github ä¸­ sample é…ç½®<br><a href="https://github.com/Thewhitelight/Analysis">Github</a><br> <a href="https://bintray.com/light/Android/trace/_latestVersion" target="_blank" rel="noopener"> <img src="https://api.bintray.com/packages/light/Android/trace/images/download.svg" alt="Download"> </a></p>
<p><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/ic_analysis_trace.png" alt="æ•ˆæœå›¾"><br>-&gt; æ‰“å°å…¥å‚<br>&lt;- æ‰“å°è€—æ—¶åŠè¿”å›å€¼</p>
<h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx">æ²ªæ±Ÿç½‘æ ¡ AspectJ</a><br><a href="https://www.jianshu.com/p/43424242846b" target="_blank" rel="noopener">Javassist ä½¿ç”¨æŒ‡å—</a><br><a href="https://www.jianshu.com/p/44d39585fc20" target="_blank" rel="noopener">AspectJ å’Œ Javassist å¯¹æ¯”</a><br><a href="https://www.mekau.com/4880.html" target="_blank" rel="noopener">AspectJ è¯­æ³•</a><br><a href="https://github.com/JakeWharton/hugo">hugo</a><br><a href="https://stackoverflow.com/questions/44364633/aspectj-doesnt-work-with-kotlin" target="_blank" rel="noopener">AspectJ é€‚é… Kotlin</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>AspectJ</tag>
        <tag>Javassist</tag>
      </tags>
  </entry>
  <entry>
    <title>Android å¼€å‘å°æŠ€å·§</title>
    <url>/2018/12/07/android-tips/</url>
    <content><![CDATA[<p>å¼€å‘ä¸­çš„ä¸€äº›å°æŠ€å·§è®°å½•</p>
<h2 id="ConstraintLayout-å¸ƒå±€æ–‡å­—æ˜¾ç¤ºå®½åº¦"><a href="#ConstraintLayout-å¸ƒå±€æ–‡å­—æ˜¾ç¤ºå®½åº¦" class="headerlink" title="ConstraintLayout å¸ƒå±€æ–‡å­—æ˜¾ç¤ºå®½åº¦"></a>ConstraintLayout å¸ƒå±€æ–‡å­—æ˜¾ç¤ºå®½åº¦</h2><p>å½“ TextView å·¦å³éƒ½æœ‰ View ä¸”æ–‡å­—æ˜¾ç¤ºä¸ä¸‹æ—¶éœ€è¦çœç•¥å·,å¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_constaint_1.png" alt><br><strong>è§£å†³åŠæ³•:</strong><br>å¦‚æœ<code>layout_width=&quot;match_parent&quot;</code>æˆ–è€…<code>ayout_width=&quot;wrap_content&quot;</code>,åˆ™æ–‡å­—æ˜¾ç¤ºæœ‰é—®é¢˜<br>éœ€è¦è®¾ç½®ä¸º<code>layout_width=&quot;0dp&quot; layout_constraintLeft_toLeftOf ä¸ºå‘å·¦å¯¹å…¶ layout_constraintRight_toLeftOf ä¸ºå‘å³å¯¹å…¶å›¾ç‰‡</code>,è¿™æ ·å°±å¯ä»¥æ­£ç¡®æ˜¾ç¤ºå†…å®¹äº†.<br>å¯¹äº ConstraintLayout å†…æ‰€æœ‰å†…å®¹éƒ½åº”è¯¥è¦æœ‰ç›¸å¯¹ä½ç½®çš„è®¾ç½®,ä¸ç„¶ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜.<br>ç¤ºä¾‹ä»£ç :<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:id</span>=<span class="string">"@+id/pin_tuan_title"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_marginTop</span>=<span class="string">"@dimen/toolbar_expand_size"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_marginRight</span>=<span class="string">"12dp"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:ellipsize</span>=<span class="string">"end"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:includeFontPadding</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:maxLines</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:textColor</span>=<span class="string">"@color/main_black"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:textSize</span>=<span class="string">"16sp"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:textStyle</span>=<span class="string">"bold"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">app:layout_constraintRight_toLeftOf</span>=<span class="string">"@id/pin_tuan_more"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">tools:text</span>=<span class="string">"å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“å•†å“"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2 id="å…¨é¢å±é€‚é…-BottomSheet"><a href="#å…¨é¢å±é€‚é…-BottomSheet" class="headerlink" title="å…¨é¢å±é€‚é… BottomSheet"></a>å…¨é¢å±é€‚é… BottomSheet</h2><p>æˆ‘ä»¬çš„é¡¹ç›®å·²ç»é€‚é…è¿‡å…¨é¢å±äº†,é€‚é…æ–¹å¼ä¹Ÿå¾ˆç®€å•,åœ¨ AndroidManifest æ–‡ä»¶ä¸­æ·»åŠ <code>&lt;meta-data 
    android:name=&quot;android.max_aspect&quot;
    android:value=&quot;2.1&quot;/&gt;</code>,ä½†æ˜¯åœ¨ä½¿ç”¨ BottomSheetDialog æ—¶å‡ºç°äº†æ„æƒ³ä¸åˆ°çš„ç»“æœ,å¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_tips_bottomsheet.png" alt>åœ¨æœ€å±å¹•åœ°æ­¥å‡ºç°äº†å¸ƒå±€ä¸Šç§»çš„æƒ…å†µ,è€Œç§»åŠ¨çš„è·ç¦»æ­£å¥½æ˜¯å±å¹•åœ†è§’çš„å¼€å§‹åœ°æ–¹.<br><strong>è§£å†³åŠæ³•:</strong><br>ä½¿ç”¨ BottomSheetDialogFragment å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜.</p>
<h2 id="å¿«é€Ÿæ·»åŠ ç®€å•åŠ¨ç”»"><a href="#å¿«é€Ÿæ·»åŠ ç®€å•åŠ¨ç”»" class="headerlink" title="å¿«é€Ÿæ·»åŠ ç®€å•åŠ¨ç”»"></a>å¿«é€Ÿæ·»åŠ ç®€å•åŠ¨ç”»</h2><p>å½“æˆ‘ä»¬è®¾ç½® View çš„å¯è§ä¸ä¸å¯è§æ—¶æ„Ÿè§‰å¤ªç”Ÿç¡¬ï¼Œå¯ä»¥ç»™çˆ¶å¸ƒå±€æ·»åŠ <code>android:animateLayoutChanges=&quot;true&quot;</code>å±æ€§,å½“ç„¶è¿™ç§é€‚ç”¨äºå¾ˆç®€å•çš„åŠ¨ç”»,è¿™ä¸ªå±æ€§å¼€å¯äº†é»˜è®¤çš„<code>LayoutTransition</code>.å®ƒæœ‰äº”ç§ç±»å‹å¯¹åº”ä¸åŒçš„åŠ¨ä½œ.</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>å¼€å‘Tips</tag>
      </tags>
  </entry>
  <entry>
    <title>Android å¼€å‘å¼‚å¸¸æ€»ç»“</title>
    <url>/2018/12/07/android-exception-summary/</url>
    <content><![CDATA[<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°å„ç§ä¸å¤ªå¸¸è§çš„é—®é¢˜,åœ¨æ­¤è®°å½•.</p>
<h1 id="è¿è¡Œæ—¶å¼‚å¸¸"><a href="#è¿è¡Œæ—¶å¼‚å¸¸" class="headerlink" title="è¿è¡Œæ—¶å¼‚å¸¸"></a>è¿è¡Œæ—¶å¼‚å¸¸</h1><h2 id="Android-8-1-apk-å®‰è£…æƒé™é—®é¢˜-android-permission-ACCESS-ALL-DOWNLOADS"><a href="#Android-8-1-apk-å®‰è£…æƒé™é—®é¢˜-android-permission-ACCESS-ALL-DOWNLOADS" class="headerlink" title="Android 8.1 apk å®‰è£…æƒé™é—®é¢˜ android.permission.ACCESS_ALL_DOWNLOADS"></a>Android 8.1 apk å®‰è£…æƒé™é—®é¢˜ android.permission.ACCESS_ALL_DOWNLOADS</h2><p>targetVersion 28 åº”ç”¨å†…æ›´æ–°å®‰è£… apk å¦‚æœæ²¡æœ‰æ·»åŠ flagå°†ä¼šå¼•èµ·ä»¥ä¸‹é”™è¯¯,åœ¨åä¸º 8.1.0(27) ç³»ç»Ÿé‡åˆ°æ­¤é—®é¢˜,ä½†æ˜¯ä¸‰æ˜Ÿ 8.0(26) ç³»ç»Ÿåˆ™æ²¡æœ‰,ä¼°è®¡æ˜¯å†…éƒ¨å¤„ç†é€»è¾‘ä¸åŒå§.<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Writing exception to parceljava.lang.SecurityException: Permission Denial: reading com.android.providers.downloads.DownloadProvider uri content://downloads/all_downloads/7 from pid=3633, uid=10037 requires android.permission.ACCESS_ALL_DOWNLOADS, or grantUriPermission()</span><br><span class="line">    at android.content.ContentProvider.enforceReadPermissionInner(ContentProvider.java:631)</span><br><span class="line">    at android.content.ContentProvider$Transport.enforceReadPermission(ContentProvider.java:501)</span><br><span class="line">    at android.content.ContentProvider$Transport.enforceFilePermission(ContentProvider.java:492)</span><br><span class="line">    at android.content.ContentProvider$Transport.openTypedAssetFile(ContentProvider.java:420)</span><br><span class="line">    at android.content.ContentProviderNative.onTransact(ContentProviderNative.java:302)</span><br><span class="line">    at android.os.Binder.execTransact(Binder.java:698)</span><br></pre></td></tr></table></figure></p>
<p>è§£å†³åŠæ³•: æ·»åŠ <code>intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</code><br>å®Œæ•´å®‰è£…ä»£ç <br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class="line">       intent.setDataAndType(downloadFileUri, <span class="string">"application/vnd.android.package-archive"</span>);</span><br><span class="line">       intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">       intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class="line">       mContext.startActivity(intent);</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2 id="TimeoutException"><a href="#TimeoutException" class="headerlink" title="TimeoutException"></a>TimeoutException</h2><p>åœ¨ bugly ä¸­çœ‹åˆ°ä¸ªåˆ«è¿™ç§é”™è¯¯<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/exception_timeout.png" alt>ä½†æ˜¯æœºå‹å’Œé¡µé¢ç­‰å…·ä½“æ—¥å¿—éƒ½æ²¡æœ‰,æ‰€ä»¥åªèƒ½çŒœæµ‹é—®é¢˜.<br>æŸ¥çœ‹æºç ,è¿™ä¸ªé”™è¯¯åœ¨è¿™é‡Œè¢«æŠ›å‡ºæ¥<a href="http://androidxref.com/9.0.0_r3/xref/libcore/libart/src/main/java/java/lang/Daemons.java#396" target="_blank" rel="noopener">finalizerTimedOut()</a>,æ ¹æ®æŠ¥é”™å’Œæºç æŸ¥çœ‹å¯ä»¥å¾—çŸ¥æ˜¯ç”±äº Finalizer å¯¹è±¡åˆ›å»ºè¿‡å¤šå¯¼è‡´è¿™ä¸ªæŠ¥é”™.120s åæŠ›è¿™ä¸ªé”™,æœç´¢äº†ä¸‹å‘ç°æ˜¯ oppo çš„ç³»ç»Ÿè§„å®šçš„120s,æ‰€ä»¥ä¼°è®¡è¿™ä¸ªé—®é¢˜åœ¨ oppo æ‰‹æœºæ¯”è¾ƒå¤š.<br>è§£å†³åŠæ³•:</p>
<ol>
<li>é‡å†™ è¯¥å¯¹è±¡çš„ finalize æ–¹æ³•å¹¶æ‰‹åŠ¨ GC,ä½†æ˜¯ä¸ä¼šå¯é ,åªèƒ½å°½é‡å‡å°‘æ­¤ç±»é—®é¢˜</li>
<li>å°½å¯èƒ½å°‘çš„åˆ›å»ºè¯¥å¯¹è±¡</li>
<li>é€šè¿‡åå°„ç½®ç©º FinalizerWatchdogDaemon ä¸­çš„ thread ,è¿™æ ·ä¸ä¼šæ‰§è¡Œæ­¤çº¿ç¨‹,ä¾¿ä¸ä¼šæœ‰å¼‚å¸¸(<a href="https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin),è¿™ä¸ªé‡Œæœ‰ä¸ªå›ç­”ä»‹ç»äº†æ­¤åšæ³•" target="_blank" rel="noopener">https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin),è¿™ä¸ªé‡Œæœ‰ä¸ªå›ç­”ä»‹ç»äº†æ­¤åšæ³•</a><br><a href="https://yq.aliyun.com/articles/225755" target="_blank" rel="noopener">å†è°ˆFinalizerå¯¹è±¡â€“å¤§å‹Appä¸­å†…å­˜ä¸æ€§èƒ½çš„éšæ€§æ€æ‰‹</a> è¿™ç¯‡æ–‡ç« å¯¹è¿™ä¸ªé—®é¢˜åˆ†æçš„å¾ˆé€å½»,å¹¶ä¸”å¤©çŒ«å¯¹ Finalizer æœ‰è‡ªå·±çš„ç›‘æ§ä½“ç³»,è¿™ä¸ªæ–¹æ³•çœŸæ˜¯ç¾¡æ…•.</li>
</ol>
<h2 id="java-lang-IllegalStateException-Only-fullscreen-opaque-activities-can-request-orientation"><a href="#java-lang-IllegalStateException-Only-fullscreen-opaque-activities-can-request-orientation" class="headerlink" title="java.lang.IllegalStateException: Only fullscreen opaque activities can request orientation"></a>java.lang.IllegalStateException: Only fullscreen opaque activities can request orientation</h2><p>åœ¨ bugly å‘ç°å¾®ä¿¡åˆ†äº« WXEntryActivity å‡ºç°äº†è¿™ä¸ª bug,å¹¶ä¸”éƒ½æ˜¯8.0çš„è®¾å¤‡<br>æŸ¥çœ‹ 8.0 æºç å‘ç°åœ¨<a href="https://github.com/aosp-mirror/platform_frameworks_base/blob/39791594560b2326625b663ed6796882900c220f/core/java/android/app/Activity.java#L984">è¿™é‡Œ</a>æŠ›å¼‚å¸¸,ä½†æ˜¯æˆ‘åœ¨ 9.0 æºç ä¸­åˆæ‰¾ä¸åˆ°è¿™ä¸ªæ–¹æ³•,åº”è¯¥æ˜¯è¢«å»æ‰äº†,ä¸å¤ªç†è§£è¿™ä¹ˆåšçš„åŸå› æ˜¯ä»€ä¹ˆ.<br>æ ¹æ®<code>ActivityInfo.isTranslucentOrFloating</code>æ–¹æ³•å¾—çŸ¥,å‡¡æ˜¯åœ¨ Activity çš„ theme ä¸­è®¾ç½®äº† <code>android:windowIsFloating æˆ– android:windowSwipeToDismiss æˆ– android:windowIsTranslucent</code>çš„å€¼ä¸ºçœŸä¸”æŒ‡å®šäº†å±å¹•æ–¹å‘,éƒ½ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸.<br>åœ¨ AndroidManifest ä¸­æŸ¥çœ‹å‘ç°,åŸæ¥å½“æ—¶é…ç½® WXEntryActivity æ—¶è®¾ç½®äº†<code>android:screenOrientation=&quot;portrait&quot;
            android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar&quot;</code><br>ç”±äºè¿™ä¸ª Activity ä¸å¯¹ç”¨æˆ·å±•ç¤ºåªæ˜¯åšäº†åˆ†å‘åŠŸèƒ½,æ‰€ä»¥å»é™¤<code>android:screenOrientation=&quot;portrait&quot;</code>å³å¯.<br>è¿™ç§å…¼å®¹æ€§é€‚é…å‘çœŸæ˜¯å¤ªå¤šäº†,éƒ½æ˜¯æ³ªå•Š.</p>
<h2 id="è‡ªå®šä¹‰ç›¸æœºæ‹ç…§æ—¶å‡ºç°-RuntimeException-takePicture-failed"><a href="#è‡ªå®šä¹‰ç›¸æœºæ‹ç…§æ—¶å‡ºç°-RuntimeException-takePicture-failed" class="headerlink" title="è‡ªå®šä¹‰ç›¸æœºæ‹ç…§æ—¶å‡ºç° RuntimeException: takePicture failed"></a>è‡ªå®šä¹‰ç›¸æœºæ‹ç…§æ—¶å‡ºç° RuntimeException: takePicture failed</h2><p>åœ¨çº¿ä¸Šçœ‹åˆ°è¿™ä¸ª bug æ—¶ä¸€å¤´é›¾æ°´,çœ‹æºç ä¹Ÿçœ‹ä¸åˆ°ä¸€åœºæŠ›å‡ºç‚¹,å› ä¸ºç›´æ¥è°ƒç”¨äº† native æ–¹æ³•,è‡ªå·±å¯¹äº jni ä¸å¤ªäº†è§£,åªèƒ½é€šè¿‡æ‰‹åŠ¨æµ‹è¯•å¤ç°é—®é¢˜äº†,å¯æ˜¯åœ¨åŸæ¥çš„æµ‹è¯•ä¸­ä»æ¥æ²¡å‡ºç°è¿‡è¿™æ ·çš„é—®é¢˜.ä»¥ä¸ºæ˜¯æƒé™è¢«æ‹’ç»å¯¼è‡´ç›¸æœºæ²¡å¯åŠ¨å°±ç‚¹å‡»æ‹ç…§æŠ›å‡ºè¿™ä¸ªé”™,åœ¨å„ç§å°è¯•åè¿˜æ˜¯ä¸èƒ½å¤ç°.æœ€ååœ¨æ— æ„ä¸­å°†æ‹ç…§é”®å¿«é€Ÿè¿å‡»äº†ä¹‹åæŠ›å‡ºäº†è¿™ä¸ªä¸€åœº,ç»ˆäºçŸ¥é“é—®é¢˜æ‰€åœ¨äº†.<br>è§£å†³èµ·æ¥å¾ˆç®€å•,åªéœ€è¦åœ¨ç‚¹å‡»ä¹‹åå°†æ‹ç…§æŒ‰é’®è®¾ç½®ä¸ºä¸å¯ç”¨,æ‹å®Œç…§çš„å›è°ƒé‡Œè®¾ç½®ä¸ºå¯ç”¨å°±å¯ä»¥äº†.</p>
<h2 id="RemoteException-Remote-stack-trace-at-com-android-server-am-ActivityManagerService-enforcePermission"><a href="#RemoteException-Remote-stack-trace-at-com-android-server-am-ActivityManagerService-enforcePermission" class="headerlink" title="RemoteException:Remote stack trace: at com.android.server.am.ActivityManagerService.enforcePermission()"></a>RemoteException:Remote stack trace: at com.android.server.am.ActivityManagerService.enforcePermission()</h2><p>æµ‹è¯•ç¯å¢ƒé‡Œå½“ App åœ¨åå°æ—¶,æœ‰æ—¶ä¼šå¼¹å‡ºå¼‚å¸¸å´©æºƒæç¤ºæ¡†,ç„¶åå† bugly ä¸­å‘ç°å¼‚å¸¸åªåœ¨ 9.0 è®¾å¤‡é‡Œå‡ºç°,çœ‹äº†ä¸‹æ—¥å¿—å‘ç°æ˜¯ Leakcanary åº“å¼•èµ·çš„.<br>åœ¨ 9.0 æºç é‡Œ AMS çš„<code>enforcePermission</code>æ–¹æ³•æ£€æŸ¥äº†<code>android.permission.FOREGROUND_SERVICE</code>æƒé™,ç”±äº AndroidManifest æ–‡ä»¶æ²¡æœ‰é…ç½®è¿™ä¸ªæƒé™,æ‰€ä»¥å¯¼è‡´å¼‚å¸¸.åœ¨ 9.0 é‡Œ<a href="https://developer.android.com/reference/android/app/Service.html#startForeground(int,%20android.app.Notification" target="_blank" rel="noopener">åˆ›å»ºå‰å°æœåŠ¡</a>)éƒ½å¿…é¡»ç”³è¯·è¿™ä¸ªæƒé™.<br>å¯¹äºåº”ç”¨ targetSdkVersion çš„è¿ç§»ä¸€å®šè¦é˜…è¯» Android å®˜æ–¹çš„<a href="https://developer.android.com/about/versions/pie/android-9.0-migration" target="_blank" rel="noopener">è¿ç§»æç¤º</a>ä»¥å…å‡ºç°é‡å¤§é—®é¢˜.</p>
<ul>
<li>å¯¹äº 9.0 å¤šè¿›ç¨‹ä½¿ç”¨ WebView ä¹Ÿä½œå‡ºäº†é‡å¤§æ”¹å˜,å¯ä»¥å‚è€ƒ<a href="https://developer.android.com/about/versions/pie/android-9.0-changes-28#web-data-dirs" target="_blank" rel="noopener">è¡Œä¸ºå˜æ›´</a>é‡Œçš„å»ºè®®ä¿®æ”¹</li>
</ul>
<h2 id="èµ„æºæ–‡ä»¶ç»Ÿä¸€å­˜æ”¾-ä¸èƒ½éšæ„ç”³æ˜å¦åˆ™ä¼šå¯¼è‡´-FileNotFoundException"><a href="#èµ„æºæ–‡ä»¶ç»Ÿä¸€å­˜æ”¾-ä¸èƒ½éšæ„ç”³æ˜å¦åˆ™ä¼šå¯¼è‡´-FileNotFoundException" class="headerlink" title="èµ„æºæ–‡ä»¶ç»Ÿä¸€å­˜æ”¾,ä¸èƒ½éšæ„ç”³æ˜å¦åˆ™ä¼šå¯¼è‡´ FileNotFoundException"></a>èµ„æºæ–‡ä»¶ç»Ÿä¸€å­˜æ”¾,ä¸èƒ½éšæ„ç”³æ˜å¦åˆ™ä¼šå¯¼è‡´ FileNotFoundException</h2><p>é¡¹ç›®å›¾ç‰‡èµ„æºæ–‡ä»¶éƒ½åœ¨ xhdpi ä¸‹,ä½†æ˜¯ç”±äºå¤šæ¨¡å—é—´å¼•ç”¨,æœ‰æ—¶å€™ä¸å»ä¾èµ–æ¨¡å—è€Œæ˜¯ç›´æ¥åœ¨è‡ªå·±æ¨¡å—é‡Œç”³æ˜<code>&lt;item name=&quot;test&quot;  type=&quot;drawable&quot;/&gt;</code>ä¸€ä¸‹,åœ¨å±å¹•åˆ†è¾¨ç‡é«˜äº xhdpi çš„æ‰‹æœºä¸Šæ˜¯æ­£å¸¸è¿è¡Œ,ä½†æ˜¯åœ¨ä½äºè¿™ä¸ªå±å¹•åˆ†è¾¨ç‡ä¸‹,å°±ä¼šç›´æ¥è¯»å–äº†ç©ºçš„ç”³æ˜èµ„æº,å¯¼è‡´ä¼šæŠ›å‡º<code>java.io.FileNotFoundException</code>.</p>
<h1 id="ç¼–è¯‘å¼‚å¸¸"><a href="#ç¼–è¯‘å¼‚å¸¸" class="headerlink" title="ç¼–è¯‘å¼‚å¸¸"></a>ç¼–è¯‘å¼‚å¸¸</h1><h2 id="SSLå¼‚å¸¸"><a href="#SSLå¼‚å¸¸" class="headerlink" title="SSLå¼‚å¸¸"></a>SSLå¼‚å¸¸</h2><p>ç”µè„‘å¼€ç€ä»£ç†å,ASç¼–è¯‘æ—¶æœ‰æ–°çš„ä¸‰æ–¹åº“æ›´æ–°æ—¶,ä¼šæç¤ºSSLé”™è¯¯<br>è§£å†³åŠæ³•:å…³é—­ä»£ç†,é‡å¯AS(å¿…é¡» command+q é€€å‡ºAS)</p>
<h2 id="app-transformNativeLibsWithStripDebugSymbolForProduceRelease-not-found-mips64el-linux-android-strip"><a href="#app-transformNativeLibsWithStripDebugSymbolForProduceRelease-not-found-mips64el-linux-android-strip" class="headerlink" title="app:transformNativeLibsWithStripDebugSymbolForProduceRelease, not found mips64el-linux-android-strip"></a>app:transformNativeLibsWithStripDebugSymbolForProduceRelease, not found mips64el-linux-android-strip</h2><p>é¡¹ç›®ç¯å¢ƒ AS 3.2.1, Gradle 3.0.1, NDK 17, é…ç½® NDK åå‡ºç°å¦‚ä¸‹å¼‚å¸¸<img src="https://def-201655.cos.ap-shanghai.myqcloud.com/ic_android_exception_ndk.png" alt>æ‰“å¼€å¼‚å¸¸é‡ŒæŠ›å‡ºçš„æ–‡ä»¶è·¯å¾„å‘ç°æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶,åŸå› æ˜¯ 17 é‡Œåˆ é™¤äº†è¿™ä¸ªé…ç½®.<br>è§£å†³åŠæ³•:</p>
<ol>
<li>Gradle ç‰ˆæœ¬å‡çº§åˆ°æœ€æ–°,ç°åœ¨æ˜¯ 3.2.1,ä½†æ˜¯è¿™æ ·åšå¤ªéº»çƒ¦äº†,å¦‚æœç‰ˆæœ¬è¾ƒä½è¦åšå¤§é‡çš„é€‚é…å·¥ä½œ.</li>
<li>ä¸‹è½½ NDK 16,å°† ndk-bundle/ æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å…¨éƒ¨æ›¿æ¢æ‰</li>
<li>ä¸‹è½½ NDK 16,å°† mips64el-linux-android-strip å¤åˆ¶åˆ°æŠ›é”™æç¤ºçš„æ–‡ä»¶è·¯å¾„é‡Œ</li>
</ol>
<h2 id="PKIX-path-building-failed"><a href="#PKIX-path-building-failed" class="headerlink" title="PKIX path building failed"></a>PKIX path building failed</h2><p>æŠ¥é”™ä¿¡æ¯ <code>sun.security.validator.ValidatorException: PKIX path building failed:
sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</code><br>è§£å†³åŠæ³•:<br>å…³é—­ä»£ç†,ç‚¹å‡» File-&gt;invalidate Caches/Restart é‡å¯ AS</p>
<p>Error occurred while communicating with CMake server. Check log /Users/libery_tuya/Company/react-native/ReactAndroid/.externalNativeBuild/cmake/debug/armeabi/cmake_server_log.txt for additional information.</p>
<h2 id="æ‰“æ··æ·†åŒ…å-æœ‰åŒ…åè¢«æ”¹ä¸ºç±»ä¼¼a-a-a"><a href="#æ‰“æ··æ·†åŒ…å-æœ‰åŒ…åè¢«æ”¹ä¸ºç±»ä¼¼a-a-a" class="headerlink" title="æ‰“æ··æ·†åŒ…å,æœ‰åŒ…åè¢«æ”¹ä¸ºç±»ä¼¼a.a.a"></a>æ‰“æ··æ·†åŒ…å,æœ‰åŒ…åè¢«æ”¹ä¸ºç±»ä¼¼<code>a.a.a</code></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">        minifyEnabled true</span><br><span class="line">        //éœ€è¦åŠ å…¥ Androidé»˜è®¤æ··æ·†è§„åˆ™ proguard-android.txt </span><br><span class="line">        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>å¼‚å¸¸å›é¡¾</tag>
        <tag>ç‰ˆæœ¬é€‚é…</tag>
        <tag>å…¼å®¹æ€§é—®é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title>Android 8.0 è‡ªå®šä¹‰é€šçŸ¥é“ƒå£°</title>
    <url>/2018/12/04/notification-8-0-sound/</url>
    <content><![CDATA[<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>Android ç³»ç»Ÿä¸æ–­çš„æ›´æ–°, targetVersion ä¸€ç›´å®šåœ¨ 25 ,æ„Ÿè§‰å·®çš„æœ‰ç‚¹å¤š,å¦‚æœè¿˜ä¸å‡çº§æ›´æ–°,ä»¥åå†æ”¹ä¼°è®¡å‘ä¼šæ›´å¤š,æ‰€ä»¥åœ¨æ–°çš„è¿­ä»£é‡Œ,å°† targetVersion å‡çº§åˆ° 28 . æœç„¶å’Œé¢„æƒ³çš„ä¸€æ ·,æœ‰é€‚é…çš„é—®é¢˜å‡ºç°äº†.<br>åœ¨ 8.0 å’Œ 8.1 çš„æ‰‹æœºä¸Šé€šçŸ¥ä¸èƒ½æ’­æ”¾è‡ªå®šä¹‰é“ƒå£°,5.0.2 çš„æ‰‹æœºåˆæ˜¯å¯ä»¥æ­£å¸¸æ’­æ”¾.è‡ªå®šä¹‰æ’­æ”¾é“ƒå£°ä½¿ç”¨<code>channel.setSound(notificationUri, Notification.AUDIO_ATTRIBUTES_DEFAULT);</code>,ç„¶åçœ‹åˆ°ç½‘ä¸Šè¯´è°ƒæ•´<code>channel.setImportance()</code>å‘ç°è¿˜æ˜¯æ— æ•ˆ,ä½†æ˜¯è®¾ç½®è¿™ä¸ªå€¼ä¼šå½±å“é€šçŸ¥çš„æ˜¾ç¤ºå’Œæ˜¯å¦éœ‡åŠ¨ã€æ˜¾ç¤ºæŒ‡ç¤ºç¯ã€é™éŸ³ç­‰æƒ…å†µ.æŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€ä½¿ç”¨ NotificationCompat.Builder çš„ setSound() æ–¹æ³•,æœç„¶è¿˜æ˜¯ä¸è¡Œ.<br><a id="more"></a></p>
<h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>æ²¡æŠ˜åªèƒ½ç¡¬ç€å¤´çš®çœ‹ä¸‹ api ç„¶åçŒœçŒœå“ªé‡Œå‡ºé—®é¢˜<img src="https://def-201655.cos.ap-shanghai.myqcloud.com/notification_8.0_setSound.png" alt>çœ‹åˆ°æœ€åä¸€å¥è¯,å¿…é¡»åœ¨ createNotificationChannel() æ–¹æ³•ä¹‹å‰ä¿®æ”¹é“ƒå£°.ä½†æ˜¯æˆ‘çš„ä»£ç ç¡®å®ä¹Ÿæ˜¯è¿™æ ·å†™çš„.è¿™é‡Œå…¶å®å¯¹äºé€šçŸ¥æ¸ é“è¿™ä¸ªæ¦‚å¿µç†è§£é”™äº†.å•çº¯çš„ä»¥ä¸ºå¯¹äºä¸åŒçš„é“ƒå£°åªè¦åœ¨åŒä¸€ä¸ªæ¸ é“é‡Œä¿®æ”¹é“ƒå£°å°±å¯ä»¥äº†,å…¶å®è¿™æ ·çš„æ–¹æ³•æ˜¯é”™çš„.<strong>å¯¹äºä¸åŒçš„é€šçŸ¥ç±»å‹(é“ƒå£°ä¸åŒ,æŒ‡ç¤ºç¯é¢œè‰²ä¸åŒã€éœ‡åŠ¨æ¨¡å¼ä¸åŒ),å¿…é¡»ä½¿ç”¨ä¸åŒçš„æ¸ é“(channelId ä¸åŒ)</strong>,ç†è§£äº†è¿™ä¸ªå°±å¾ˆå®¹æ˜“å†™å‡ºçœŸæ­£é€‚é…çš„ä»£ç äº†.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@TargetApi</span>(Build.VERSION_CODES.O)</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createNotificationChannel</span><span class="params">(String channel_id, Uri voiceUri)</span> </span>&#123;</span><br><span class="line">    NotificationChannel channel = <span class="keyword">new</span> NotificationChannel(channel_id, CHANNEL_NAME, NotificationManager.IMPORTANCE_HIGH);</span><br><span class="line">    channel.setBypassDnd(<span class="keyword">true</span>);<span class="comment">//æ˜¯å¦ç»•è¿‡è¯·å‹¿æ‰“æ‰°æ¨¡å¼</span></span><br><span class="line">    channel.enableLights(<span class="keyword">true</span>);<span class="comment">//é—ªå…‰ç¯</span></span><br><span class="line">    channel.setLockscreenVisibility(VISIBILITY_PUBLIC);<span class="comment">//é”å±æ˜¾ç¤ºé€šçŸ¥</span></span><br><span class="line">    channel.setLightColor(Color.RED);<span class="comment">//é—ªå…³ç¯çš„ç¯å…‰é¢œè‰²</span></span><br><span class="line">    channel.setShowBadge(<span class="keyword">true</span>);<span class="comment">//æ¡Œé¢launcherçš„æ¶ˆæ¯è§’æ ‡</span></span><br><span class="line">    channel.enableVibration(<span class="keyword">true</span>);<span class="comment">//æ˜¯å¦å…è®¸éœ‡åŠ¨</span></span><br><span class="line">    channel.setVibrationPattern(<span class="keyword">new</span> <span class="keyword">long</span>[]&#123;<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>&#125;);<span class="comment">//è®¾ç½®éœ‡åŠ¨æ¨¡å¼</span></span><br><span class="line">    <span class="keyword">if</span> (voiceUri == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//å½“æ— ç‰¹æ®Šé€šçŸ¥é“ƒå£°æ—¶,ä½¿ç”¨ç³»ç»Ÿé»˜è®¤</span></span><br><span class="line">        Uri uri = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);</span><br><span class="line">        channel.setSound(uri, Notification.AUDIO_ATTRIBUTES_DEFAULT);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        channel.setSound(voiceUri, Notification.AUDIO_ATTRIBUTES_DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line">    getManager().createNotificationChannel(channel);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> NotificationManager <span class="title">getManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mManager = (NotificationManager) MyApp.getInstance().getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> intent       ç‚¹å‡»é€šçŸ¥æ‰“å¼€ç›¸åº” Activity çš„ Intent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> title        é€šçŸ¥æ ‡é¢˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> content      é€šçŸ¥å†…å®¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pushId       pushId ä¸èƒ½é‡å¤</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> soundCommand é€šçŸ¥é“ƒå£°ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendNotify</span><span class="params">(Context context, Intent intent, String title, String content, <span class="keyword">int</span> pushId, String soundCommand)</span> </span>&#123;</span><br><span class="line">    NotificationCompat.Builder builder;</span><br><span class="line">    PendingIntent contentIntent = PendingIntent.getActivity(context, pushId, intent,</span><br><span class="line">            PendingIntent.FLAG_UPDATE_CURRENT);</span><br><span class="line">    Uri uri = notifyVoice(soundCommand);</span><br><span class="line">    <span class="comment">//ä½¿ç”¨ hashCode ä¿è¯ä¸åŒç±»å‹æ¸ é“ channelId ä¸é‡å¤</span></span><br><span class="line">    String id = uri == <span class="keyword">null</span> ? String.valueOf(<span class="string">"channelId"</span>.hashCode()) : String.valueOf(uri.hashCode());</span><br><span class="line">    builder = <span class="keyword">new</span> NotificationCompat.Builder(MyApp.getInstance(), id);</span><br><span class="line">    builder.setSmallIcon(R.drawable.ic_notify)</span><br><span class="line">            .setLargeIcon(BitmapFactory.decodeResource(context.getResources(), R.mipmap.ic_launcher))</span><br><span class="line">            .setContentTitle(title)</span><br><span class="line">            .setContentText(content)</span><br><span class="line">            .setFullScreenIntent(<span class="keyword">null</span>, <span class="keyword">true</span>)</span><br><span class="line">            .setContentIntent(contentIntent)</span><br><span class="line">            .setPriority(NotificationCompat.PRIORITY_DEFAULT)</span><br><span class="line">            .setTicker(content)</span><br><span class="line">            .setDefaults(DEFAULT_LIGHTS)</span><br><span class="line">            .setVisibility(VISIBILITY_PUBLIC)</span><br><span class="line">            .setDefaults(DEFAULT_VIBRATE)</span><br><span class="line">            .setWhen(System.currentTimeMillis())</span><br><span class="line">            .setAutoCancel(<span class="keyword">true</span>)</span><br><span class="line">            .setOnlyAlertOnce(<span class="keyword">true</span>)</span><br><span class="line">            .setOngoing(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</span><br><span class="line">        createNotificationChannel(id, uri);</span><br><span class="line">    &#125;</span><br><span class="line">    getManager().notify(pushId, builder.build());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Uri <span class="title">notifyVoice</span><span class="params">(String soundCommand)</span> </span>&#123;</span><br><span class="line">    Logger.e(soundCommand);</span><br><span class="line">    <span class="keyword">int</span> notifyVoice;</span><br><span class="line">    <span class="keyword">switch</span> (soundCommand) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"N"</span>:</span><br><span class="line">            notifyVoice = R.raw.notify_new_customer;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"O"</span>:</span><br><span class="line">            notifyVoice = R.raw.notify_new_order;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            notifyVoice = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> notifyVoice == <span class="number">0</span> ? <span class="keyword">null</span> : Uri.parse(<span class="string">"android.resource://"</span> + BuildConfig.APPLICATION_ID + <span class="string">"/"</span> + notifyVoice);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>è¿™æ˜¯ä½¿ç”¨ä¸åŒæ¸ é“æ–¹å¼å®ç°äº†è¿™ä¸ªéœ€æ±‚,å¦‚æœæ„Ÿè§‰ä¸æƒ³è®©ç”¨æˆ·å¯¹äºè¿™ä¹ˆå¤šæ¸ é“åšç›¸åº”çš„è®¾ç½®(åœ¨ 8.0 ä»¥ä¸Š,ç”¨æˆ·å¯ä»¥é’ˆå¯¹ä¸åŒçš„é€šçŸ¥æ¸ é“è®¾ç½®ç›¸åº”çš„è¡Œä¸º),æˆ–è€…å¸Œæœ›æ¯æ¡é€šçŸ¥çš„é“ƒå£°éƒ½å¯ä»¥æ’­æ”¾å®Œæ•´,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ Ringtone æ¥æ’­æ”¾éŸ³é¢‘æ–‡ä»¶,å¹¶ä¸”å¯ä»¥åªè®¾ç½®ä¸€ä¸ªé€šçŸ¥æ¸ é“.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Uri uri = notifyVoice(soundCommand);</span><br><span class="line">Ringtone ringtone = RingtoneManager.getRingtone(MyApp.getInstance(), uri);</span><br><span class="line"><span class="keyword">if</span> (ringtone != <span class="keyword">null</span>) &#123;</span><br><span class="line">    ringtone.play();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯è¿™æ ·å°±éœ€è¦é€šçŸ¥å–æ¶ˆæ—¶ stop æ­£åœ¨æ’­æ”¾çš„éŸ³é¢‘.å¯ä»¥é€šè¿‡<code>builder.setDeleteIntent()</code>é…åˆ BroadcastReceiver æ¥å–æ¶ˆæ’­æ”¾.</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://stackoverflow.com/questions/48986856/android-notification-setsound-is-not-working" target="_blank" rel="noopener">Android notification setSound is not working</a><br><a href="https://www.jianshu.com/p/4b9fb73762df" target="_blank" rel="noopener">Notificationæ¡†æ¶ç®€ä»‹</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>ç‰ˆæœ¬é€‚é…</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»¿å°ç±³è¿”å›äº¤äº’</title>
    <url>/2018/09/28/android-slideback/</url>
    <content><![CDATA[<p>è¿›å…¥å…¨é¢å±æ—¶ä»£,iPhone çš„äº¤äº’æ˜¯ä¸šç•Œæ ‡æ†,æ‰€ä»¥Androidé˜µè¥éƒ½å‘å…¶é æ‹¢.å°ç±³å…¨é¢å±æ‰‹åŠ¿æ˜¯æˆ‘æŒºå–œæ¬¢çš„äº¤äº’.æ‰€ä»¥æ¨¡ä»¿ä¸‹å°ç±³çš„è¿”å›æ“ä½œ.å…¶è¿”å›é€»è¾‘è¿œä¸å¦‚å¾®ä¿¡è¿”å›åŠ¨ç”»å¤æ‚,å‡ ä¹æ²¡æœ‰æœºå‹é€‚é…é—®é¢˜çš„å­˜åœ¨.<br><a id="more"></a><br>åŠ¨ç”»æ•ˆæœå¦‚å›¾<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/7g4t2-ihykn.gif" alt></p>
<p>çœ‹åˆ°åŠ¨ç”»æ•ˆæœæˆ‘ä»¬éœ€è¦è¾¾åˆ°çš„æ•ˆæœæ˜¯åœ¨ Activity çš„ DecorView ä¸Šç»˜åˆ¶æ­¤ View,æ‰€ä»¥å°±åƒå½“äºæˆ‘ä»¬æ‰€æœ‰é¡µé¢çš„çš„æ ¹å¸ƒå±€éœ€è¦æ·»åŠ æ­¤ View,å¦‚æœæ¯ä¸ªé¡µé¢éƒ½æ‰‹åŠ¨æ·»åŠ ,åˆ™æ˜¾å¾—å¤ªè¿‡éº»çƒ¦,æ˜¾ç„¶åœ¨æŠ½è±¡çš„ BaseActivity ä¸­ setContentView æ–¹æ³•ä¹‹åè°ƒç”¨<code>activity.getWindow().getDecorView()</code>,ç„¶åè·å– content æ ¹å¸ƒå±€<code>FrameLayout content = viewGroup.findViewById(android.R.id.content); content.addView(slideBackView);</code>å°†æˆ‘ä»¬å¸¦æœ‰è¿”å› View çš„å¸ƒå±€æ·»åŠ åˆ° FameLayout çš„é¡¶å±‚,è¿™æ ·å°±è¾¾åˆ°çš„æœ€å°åŒ–çš„ä¿®æ”¹ä»£ç å®ç°æ•ˆæœ.</p>
<h1 id="å¯¹äºè¿”å›å›¾å½¢çš„ç»˜åˆ¶-ä¸»è¦è¿ç”¨äº†è§¦æ‘¸äº‹ä»¶ã€è´å¡å°”æ›²çº¿ç­‰çŸ¥è¯†ç‚¹"><a href="#å¯¹äºè¿”å›å›¾å½¢çš„ç»˜åˆ¶-ä¸»è¦è¿ç”¨äº†è§¦æ‘¸äº‹ä»¶ã€è´å¡å°”æ›²çº¿ç­‰çŸ¥è¯†ç‚¹" class="headerlink" title="å¯¹äºè¿”å›å›¾å½¢çš„ç»˜åˆ¶,ä¸»è¦è¿ç”¨äº†è§¦æ‘¸äº‹ä»¶ã€è´å¡å°”æ›²çº¿ç­‰çŸ¥è¯†ç‚¹"></a>å¯¹äºè¿”å›å›¾å½¢çš„ç»˜åˆ¶,ä¸»è¦è¿ç”¨äº†è§¦æ‘¸äº‹ä»¶ã€è´å¡å°”æ›²çº¿ç­‰çŸ¥è¯†ç‚¹</h1><ul>
<li>è§¦æ‘¸äº‹ä»¶,åœ¨ View å†…é‡å†™ onTouchEvent æ–¹æ³•,åˆ¤æ–­å·¦å³æ»‘åŠ¨å¹¶ä¸”æ ¹æ®æ»‘åŠ¨è·ç¦»ç»˜åˆ¶è¿”å›å›¾å½¢å®½åº¦</li>
<li>å¯¹äºè¿”å›å›¾å½¢å¯ä»¥ä½™å¼¦å…¬å¼,ä¹Ÿä½¿ç”¨è´å¡å°”æ›²çº¿ç”»æˆ,ä½†è´å¡å°”æ›²çº¿çœ‹èµ·æ¥æ›´åŠ é¡ºæ»‘è‡ªç„¶,ä½†æ˜¯ Android åŸç”Ÿæœ€é«˜æ”¯æŒä¸‰é˜¶,å¯¹äºæˆ‘ä»¬æ‰€è¦ç»˜åˆ¶çš„å›¾å½¢ä¸‰é˜¶ä¼šä¸å¤Ÿè‡ªç„¶,ä½¿ç”¨å…­é˜¶ä¼šæ¯”è¾ƒå¥½,ä½†æ˜¯åˆä¸æ”¯æŒ,æ‰€ä»¥åªèƒ½ç”±ä¸‰ä¸ªäºŒé˜¶ç»„åˆæˆè¿”å›å›¾å½¢<br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_3.png" alt="ä¸‰é˜¶è´å¡å°”æ›²çº¿"><br><img src="https://def-201655.cos.ap-shanghai.myqcloud.com/bezier_6.png" alt="å…­é˜¶è´å¡å°”æ›²çº¿"></li>
</ul>
<h2 id="Viewè§¦æ‘¸äº‹ä»¶"><a href="#Viewè§¦æ‘¸äº‹ä»¶" class="headerlink" title="Viewè§¦æ‘¸äº‹ä»¶"></a>Viewè§¦æ‘¸äº‹ä»¶</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å·¦è¾¹è§†å·®é˜ˆå€¼,ä¸º View çš„ 1/3</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> thresholdLeft;</span><br><span class="line"><span class="comment">//å³è¾¹è¾¹è§†å·®é˜ˆå€¼,ä¸º View çš„ 2/3</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> thresholdRight;</span><br><span class="line"><span class="comment">//è¿”å›å›¾å½¢çš„æœ€å¤§å®½åº¦</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> backMaxWidth;</span><br><span class="line"><span class="comment">//ç»˜åˆ¶è¿”å›å›¾å½¢çš„æœ€å°è¾¹è·</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> backEdgeWidth;</span><br><span class="line"><span class="comment">//è§†å·®çš„å˜é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> bufferX;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å½“å‰åŠ¨ä½œä¸‹ View çš„Xåæ ‡ç‚¹,ä¸èƒ½ç”¨ getRawX,å¦åˆ™è·å–çš„æ˜¯å±å¹•ä¸Šçš„åæ ‡</span></span><br><span class="line">        <span class="keyword">float</span> currentX = ev.getX();</span><br><span class="line">        currentY = ev.getY();</span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                <span class="comment">//æŒ‰ä¸‹æ—¶ View çš„Xåæ ‡ç‚¹</span></span><br><span class="line">                downX = ev.getX();</span><br><span class="line">                forwardX = downX;</span><br><span class="line">                <span class="keyword">if</span> (downX &lt;= backEdgeWidth) &#123;</span><br><span class="line">                <span class="comment">//å½“æŒ‰ä¸‹çš„Xåæ ‡&lt;æœ€å°è§¦å‘è¾¹è·æ—¶,è®¤ä¸ºæœ‰æ•ˆè§¦å‘ç»˜åˆ¶é€»è¾‘å¹¶ç»˜åˆ¶å·¦è¾¹è¿”å›å›¾å½¢</span></span><br><span class="line">                    isEdge = <span class="keyword">true</span>;</span><br><span class="line">                    left = <span class="keyword">true</span>;</span><br><span class="line">                    right = <span class="keyword">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (downX &gt;= getWidth() - backEdgeWidth) &#123;</span><br><span class="line">                <span class="comment">//å½“æŒ‰ä¸‹çš„Xåæ ‡&gt;(View å®½åº¦-æœ€å°è§¦å‘è¾¹è·)æ—¶,è®¤ä¸ºæœ‰æ•ˆè§¦å‘ç»˜åˆ¶é€»è¾‘å¹¶ç»˜åˆ¶å³è¾¹è¿”å›å›¾å½¢</span></span><br><span class="line">                    isEdge = <span class="keyword">true</span>;</span><br><span class="line">                    right = <span class="keyword">true</span>;</span><br><span class="line">                    left = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                <span class="comment">//å½“å‰æ»‘åŠ¨åˆ°çš„ç‚¹ä¸æŒ‰ä¸‹æ—¶çš„ç‚¹Xåæ ‡çš„è·ç¦»</span></span><br><span class="line">                deltaX = currentX - downX;</span><br><span class="line">                <span class="comment">//æ»‘åŠ¨è·ç¦» åˆ¤æ–­è¿ç»­æ»‘åŠ¨æ—¶çš„æ–¹å‘</span></span><br><span class="line">                <span class="keyword">float</span> diff = forwardX - currentX;</span><br><span class="line">                <span class="keyword">if</span> (diff &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//å‘å·¦æ»‘åŠ¨</span></span><br><span class="line">                    <span class="keyword">if</span> (currentX &lt; thresholdLeft &amp;&amp; left) &#123;</span><br><span class="line">                        <span class="comment">//å½“ç»˜åˆ¶å·¦è¾¹å›¾å½¢ã€å‘å·¦æ»‘åŠ¨æ—¶ã€å½“å‰å°äºå±å¹•1/3å¤„æ—¶,ç»˜åˆ¶æ—¶å·®æ•ˆæœ</span></span><br><span class="line">                        deltaX = backMaxWidth;</span><br><span class="line">                        deltaX -= (thresholdLeft - currentX) / <span class="number">2</span>;</span><br><span class="line">                        bufferX = deltaX;</span><br><span class="line">                        <span class="keyword">if</span> (deltaX &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                            deltaX = <span class="number">0</span>;</span><br><span class="line">                            bufferX = <span class="number">0</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((currentX &gt; thresholdRight) &amp;&amp; right) &#123;</span><br><span class="line">                        <span class="comment">//å½“ç»˜åˆ¶å³è¾¹å›¾å½¢ã€å‘å·¦æ»‘åŠ¨æ—¶ã€å½“å‰å¤§äºå±å¹•2/3å¤„æ—¶,ç»˜åˆ¶æ—¶å·®æ•ˆæœ</span></span><br><span class="line">                         bufferX -= diff;</span><br><span class="line">                         deltaX = bufferX;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//å‘å³æ»‘åŠ¨</span></span><br><span class="line">                    <span class="keyword">if</span> ((currentX &lt; thresholdLeft) &amp;&amp; left) &#123;</span><br><span class="line">                        <span class="comment">//å½“ç»˜åˆ¶å·¦è¾¹å›¾å½¢ã€å‘å³æ»‘åŠ¨æ—¶ã€å½“å‰å°äºå±å¹•1/3å¤„æ—¶,ç»˜åˆ¶æ—¶å·®æ•ˆæœ</span></span><br><span class="line">                        bufferX += Math.abs(diff);</span><br><span class="line">                        deltaX = bufferX;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentX &gt; thresholdRight &amp;&amp; right) &#123;</span><br><span class="line">                         <span class="comment">//å½“ç»˜åˆ¶å³è¾¹è¾¹å›¾å½¢ã€å‘å³æ»‘åŠ¨æ—¶ã€å½“å‰å¤§äºå±å¹•2/3å¤„æ—¶,ç»˜åˆ¶æ—¶å·®æ•ˆæœ</span></span><br><span class="line">                        deltaX = -backMaxWidth;</span><br><span class="line">                        deltaX += (currentX - thresholdRight) / <span class="number">2</span>;</span><br><span class="line">                        bufferX = deltaX;</span><br><span class="line">                        <span class="keyword">if</span> (deltaX &lt; -backMaxWidth) &#123;</span><br><span class="line">                            deltaX = -backMaxWidth;</span><br><span class="line">                            bufferX = -backMaxWidth;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//è®°å½•å½“å‰æ»‘åŠ¨çš„Xåæ ‡,ä¸ä¸‹æ¬¡æ»‘åŠ¨ç‚¹åšæ¯”è¾ƒ</span></span><br><span class="line">                forwardX = currentX;</span><br><span class="line">                <span class="keyword">if</span> (isEdge) &#123;</span><br><span class="line">                    invalidate();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                <span class="keyword">if</span> (isEdge) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (deltaX &gt;= backMaxWidth &amp;&amp; left) &#123;</span><br><span class="line">                        <span class="comment">//å½“ç»˜å›¾å½¢å®½åº¦ä¸ºæœ€å¤§æ—¶å¹¶æŠ¬èµ·,è¡¨ç¤ºè¿”å›</span></span><br><span class="line">                        back();</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Math.abs(deltaX) &gt;= backMaxWidth &amp;&amp; right) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!isOnlyLeftBack) &#123;</span><br><span class="line">                            <span class="comment">//å¦‚æœç»˜åˆ¶å³è¾¹æ—¶,å‡ºå‘è¿”å›é€»è¾‘</span></span><br><span class="line">                            back();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    deltaX = <span class="number">0</span>;</span><br><span class="line">                    invalidate();</span><br><span class="line">                &#125;</span><br><span class="line">                left = <span class="keyword">false</span>;</span><br><span class="line">                right = <span class="keyword">false</span>;</span><br><span class="line">                isEdge = <span class="keyword">false</span>;</span><br><span class="line">                bufferX = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isEdge;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä»¥ä¸Šä»£ç ,åˆ†æäº†æ‰‹åŠ¿ä¸ç»˜åˆ¶å›¾å½¢çš„å…³ç³»,å…·ä½“é€»è¾‘å¯ä»¥æ ¹æ®æ•ˆæœåˆ†æ,è§†å·®éƒ¨åˆ†çš„æ•ˆæœå¯ä»¥æ ¹æ®è‡ªèº«è¿›è¡Œè°ƒæ•´.</p>
<h2 id="è´å¡å°”æ›²çº¿ç»˜åˆ¶"><a href="#è´å¡å°”æ›²çº¿ç»˜åˆ¶" class="headerlink" title="è´å¡å°”æ›²çº¿ç»˜åˆ¶"></a>è´å¡å°”æ›²çº¿ç»˜åˆ¶</h2><p>ä½¿ç”¨è´å¡å°”æ›²çº¿ç»˜åˆ¶è¿”å›å›¾å½¢å’Œé‡Œé¢çš„è¿”å›å›¾æ ‡.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">//è¿”å›å›¾å½¢ç”»ç¬”</span></span><br><span class="line">    <span class="keyword">private</span> Paint backPaint;</span><br><span class="line">    <span class="comment">//è¿”å›å›¾æ ‡ç”»ç¬”</span></span><br><span class="line">    <span class="keyword">private</span> Paint arrowPaint;</span><br><span class="line">    <span class="comment">//è¿”å›å›¾å½¢è·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> Path backPath;</span><br><span class="line">    <span class="comment">//è¿”å›å›¾æ ‡è·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> Path arrowPath;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        backPath = <span class="keyword">new</span> Path();</span><br><span class="line">        arrowPath = <span class="keyword">new</span> Path();</span><br><span class="line"></span><br><span class="line">        backPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        backPaint.setColor(<span class="number">0xAA000000</span>);</span><br><span class="line">        backPaint.setStyle(Paint.Style.FILL_AND_STROKE);</span><br><span class="line"></span><br><span class="line">        arrowPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        arrowPaint.setColor(Color.WHITE);</span><br><span class="line">        arrowPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        arrowPaint.setStrokeWidth(<span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">        <span class="comment">//å½“deltaXè¶…è¿‡æœ€å¤§è·ç¦»æ—¶,è®¾ç½®ä¸ºæœ€å¤§è·ç¦»</span></span><br><span class="line">        <span class="keyword">if</span> (deltaX &gt; backMaxWidth &amp;&amp; left) &#123;</span><br><span class="line">            deltaX = backMaxWidth;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (deltaX &lt; -backMaxWidth &amp;&amp; right) &#123;</span><br><span class="line">            deltaX = -backMaxWidth;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–ç»˜åˆ¶åæ ‡ç‚¹Y</span></span><br><span class="line">        <span class="keyword">float</span> deltaY = currentY - backViewHeight / <span class="number">2</span>;</span><br><span class="line">        backPath.reset();</span><br><span class="line">        arrowPath.reset();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (deltaX &gt; <span class="number">0</span> &amp;&amp; left) &#123;</span><br><span class="line">            backPath.moveTo(<span class="number">0</span>, deltaY);</span><br><span class="line">            backPath.quadTo(<span class="number">0</span>, backViewHeight / <span class="number">4</span> + deltaY, deltaX / <span class="number">3</span>, backViewHeight * <span class="number">3</span> / <span class="number">8</span> + deltaY);</span><br><span class="line">            backPath.quadTo(deltaX * <span class="number">5</span> / <span class="number">8</span>, backViewHeight / <span class="number">2</span> + deltaY, deltaX / <span class="number">3</span>, backViewHeight * <span class="number">5</span> / <span class="number">8</span> + deltaY);</span><br><span class="line">            backPath.quadTo(<span class="number">0</span>, backViewHeight * <span class="number">6</span> / <span class="number">8</span> + deltaY, <span class="number">0</span>, backViewHeight + deltaY);</span><br><span class="line">            canvas.drawPath(backPath, backPaint);</span><br><span class="line"></span><br><span class="line">            arrowPath.moveTo(deltaX / <span class="number">6</span> + (<span class="number">15</span> * (deltaX / (width / <span class="number">6</span>))), backViewHeight * <span class="number">15</span> / <span class="number">32</span> + deltaY);</span><br><span class="line">            arrowPath.lineTo(deltaX / <span class="number">6</span>, backViewHeight * <span class="number">16.1f</span> / <span class="number">32</span> + deltaY);</span><br><span class="line">            arrowPath.moveTo(deltaX / <span class="number">6</span>, backViewHeight * <span class="number">15.9f</span> / <span class="number">32</span> + deltaY);</span><br><span class="line">            arrowPath.lineTo(deltaX / <span class="number">6</span> + (<span class="number">15</span> * (deltaX / (width / <span class="number">6</span>))), backViewHeight * <span class="number">17</span> / <span class="number">32</span> + deltaY);</span><br><span class="line">            canvas.drawPath(arrowPath, arrowPaint);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (deltaX &lt; <span class="number">0</span> &amp;&amp; right) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isOnlyLeftBack) &#123;</span><br><span class="line">                deltaX = Math.abs(deltaX);</span><br><span class="line">                backPath.moveTo(width, deltaY);</span><br><span class="line">                backPath.quadTo(width, backViewHeight / <span class="number">4</span> + deltaY, width - deltaX / <span class="number">3</span>, backViewHeight * <span class="number">3</span> / <span class="number">8</span> + deltaY);</span><br><span class="line">                backPath.quadTo(width - deltaX * <span class="number">5</span> / <span class="number">8</span>, backViewHeight / <span class="number">2</span> + deltaY, width - deltaX / <span class="number">3</span>, backViewHeight * <span class="number">5</span> / <span class="number">8</span> + deltaY);</span><br><span class="line">                backPath.quadTo(width, backViewHeight * <span class="number">6</span> / <span class="number">8</span> + deltaY, width, backViewHeight + deltaY);</span><br><span class="line">                canvas.drawPath(backPath, backPaint);</span><br><span class="line"></span><br><span class="line">                arrowPath.moveTo(width - deltaX / <span class="number">6</span> - (<span class="number">15</span> * (deltaX / (width / <span class="number">6</span>))), backViewHeight * <span class="number">15</span> / <span class="number">32</span> + deltaY);</span><br><span class="line">                arrowPath.lineTo(width - deltaX / <span class="number">6</span>, backViewHeight * <span class="number">16.1f</span> / <span class="number">32</span> + deltaY);</span><br><span class="line">                arrowPath.moveTo(width - deltaX / <span class="number">6</span>, backViewHeight * <span class="number">15.9f</span> / <span class="number">32</span> + deltaY);</span><br><span class="line">                arrowPath.lineTo(width - deltaX / <span class="number">6</span> - (<span class="number">15</span> * (deltaX / (width / <span class="number">6</span>))), backViewHeight * <span class="number">17</span> / <span class="number">32</span> + deltaY);</span><br><span class="line">                canvas.drawPath(arrowPath, arrowPaint);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        setAlpha(deltaX / backMaxWidth);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿”å›å›¾å½¢åŠè¿”å›åæ ‡çš„å½¢çŠ¶éƒ½å¯ä»¥é€šè¿‡è¿™æ˜¯ä¸åŒçš„ç»“æŸç‚¹å’Œæ§åˆ¶ç‚¹å»è°ƒèŠ‚,å½¢æˆè‡ªå·±æƒ³è¦çš„æ•ˆæœ,ä¸è¿‡æœ€å¥½å…ˆé€šè¿‡ç»˜å›¾è½¯ä»¶,åˆ†æå¥½æƒ³è¦çš„å›¾å½¢åŠå…¶ç»˜åˆ¶æ¯”ä¾‹.</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>SlideBackç”¨æ³•<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//setContent(layoutResID) æ›¿æ¢ä¸º</span></span><br><span class="line">SlideBack.Builder().init(layoutResID).build(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨è‡ªå®šä¹‰ View å¯ä»¥ä½œå‡ºå„ç§è®¾è®¡å¸ˆæƒ³å®ç°çš„åŠ¨ç”»æ•ˆæœ,ä¸€èˆ¬ä½¿ç”¨ onTouchEventã€onMeasureã€onLayoutã€onDraw ç­‰æ–¹æ³•,æ ¹æ®å®é™…æƒ…å†µé‡å†™è¿™äº›æ–¹æ³•å³å¯å®ç°.é€šè¿‡å®ç°è¿™ä¸ªæ•ˆæœå¯ä»¥æ›´å¥½çš„ç†è§£ Android ä¸­å„ç§è®¾è®¡,æå‡è‡ªå·±å¼€å‘æ°´å¹³.</p>
<h1 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h1><p><a href="https://github.com/Thewhitelight/Tinder">GitHubé¡¹ç›®åœ°å€</a> é‡Œé¢æœ‰ä¸€äº› library é›†åˆ<br><code>cn.libery:slideback:latest</code><br><a href="https://bintray.com/light/Avatar/SlideBack/_latestVersion" target="_blank" rel="noopener"> <img src="https://api.bintray.com/packages/light/Avatar/SlideBack/images/download.svg" alt="Maven"> </a> </p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>Android å†…å­˜ä¼˜åŒ–å®è·µ(ä¸‹)</title>
    <url>/2018/09/13/android-memory-optimization-3/</url>
    <content><![CDATA[<h1 id="Web-ç‹¬ç«‹è¿›ç¨‹"><a href="#Web-ç‹¬ç«‹è¿›ç¨‹" class="headerlink" title="Web ç‹¬ç«‹è¿›ç¨‹"></a>Web ç‹¬ç«‹è¿›ç¨‹</h1><p>ä¸€èˆ¬åº”ç”¨ä¸­ä¼šå¤§é‡ä½¿ç”¨ç½‘é¡µ,æˆ‘ä»¬é¡¹ç›®ç”±äºæœ‰å®¶è£… VR é¡µé¢,å¦‚æœéƒ½æ”¾åœ¨ä¸»è¿›ç¨‹åˆ™ä¼šé€ æˆå¤§é‡çš„å†…å­˜å ç”¨,å› æ­¤å°† WebView æ‹†åˆ†ä¸ºç‹¬ç«‹è¿›ç¨‹è¿è¡Œ,ä»è€Œå‡è½»ä¸»è¿›ç¨‹å†…å­˜å‹åŠ›å¾ˆæœ‰å¿…è¦,å½“å†…å­˜ç´§å¼ æ—¶,ç³»ç»Ÿåˆ™ä¼šè‡ªåŠ¨æ€æ­» web è¿›ç¨‹.æ‹†åˆ†ä¸ºå¤šè¿›ç¨‹å,ä¸»è¦é—®é¢˜åœ¨äºè¿›ç¨‹é—´é€šè®¯ä¸ä¸»è¿›ç¨‹ä¿æ´».</p>
<h2 id="æ‹†åˆ†-Web-è¿›ç¨‹"><a href="#æ‹†åˆ†-Web-è¿›ç¨‹" class="headerlink" title="æ‹†åˆ† Web è¿›ç¨‹"></a>æ‹†åˆ† Web è¿›ç¨‹</h2><p>ç‹¬ç«‹è¿›ç¨‹åˆ†ä¸ºä¸¤ç§æ¨¡å¼,<strong>ç§æœ‰ç‹¬ç«‹è¿›ç¨‹</strong> å’Œ <strong>å…¨å±€ç‹¬ç«‹è¿›ç¨‹</strong> ä¸¤ç§æ¨¡å¼,å¼€å§‹æ–¹å¼ä¹Ÿå¾ˆç®€å•.<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- ç§æœ‰ç‹¬ç«‹è¿›ç¨‹:ä¸ä¸»è¿›ç¨‹åŒShareUID,å…±äº«dataç›®å½•ã€ç»„ä»¶ä¿¡æ¯ã€å…±äº«å†…å­˜æ•°æ®  --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">".WebActivity"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:process</span>=<span class="string">":web"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å…¨å±€ç‹¬ç«‹è¿›ç¨‹:ä¸ä¸»è¿›ç¨‹ä¸åŒShareUID --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">".WebActivity"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:process</span>=<span class="string">".web"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æœ¬é¡¹ç›®ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ³•,å› ä¸ºåªä¸æœ¬åº”ç”¨é€šä¿¡,æ‰€ä»¥ä¸éœ€è¦ä¸ºå…¨å±€ç‹¬ç«‹è¿›ç¨‹.<br><a id="more"></a></p>
<h2 id="è¿›ç¨‹é—´é€šä¿¡"><a href="#è¿›ç¨‹é—´é€šä¿¡" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡"></a>è¿›ç¨‹é—´é€šä¿¡</h2><p>è¿›ç¨‹é—´çš„é€šä¿¡æ–¹å¼:</p>
<ol>
<li>Bundle</li>
<li>æ–‡ä»¶å…±äº«</li>
<li>AIDL</li>
<li>Messager</li>
<li>ContentProvider</li>
<li>Socket</li>
</ol>
<p>å½“æ‰“å¼€ç½‘é¡µæ—¶,å‘é€è¯·æ±‚åº”è¯¥å¸¦ç”¨æˆ·ä¿¡æ¯,åŸæ¥çš„ä¿¡æ¯å­˜å‚¨æ–¹å¼æ˜¯SharePreference,ä½†æ˜¯è¿™ç§æ–¹å¼å¯¹äºå¤šè¿›ç¨‹è°ƒç”¨æ—¶,å®¹æ˜“å‡ºç°ä¸ç¨³å®šçš„æƒ…å†µ,å¹¶ä¸”å®ƒçš„å¤šè¿›ç¨‹è°ƒç”¨æ–¹å¼å·²ç»è¢«æ ‡è®°ä¸ºåºŸå¼ƒ,æ‰€ä»¥ä¸ºäº†ä¿è¯ç¨³å®šæ€§,ä½¿ç”¨ContentProviderå°†å…¶å°è£…,ä¾›ä¸åŒçš„è¿›ç¨‹è°ƒç”¨.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨ web è¿›ç¨‹é‡Œåªæ˜¯è·å–ç”¨æˆ·ä¿¡æ¯,å½“webé‡Œè¿”å›è¦ç™»å½•ä¿¡æ¯æ—¶,è·³è½¬è‡³ä¸»è¿›ç¨‹é‡Œçš„ç™»å½•é¡µé¢,æ‰€ä»¥åªå®ç°äº† query æ–¹æ³•,æ›´æ–° SharePreference ä¾æ—§ä½¿ç”¨äº†å•è¿›ç¨‹è¯»å†™æ¨¡å¼.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String sAuthoriry = BuildConfig.APPLICATION_ID + <span class="string">".UserProvider"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cursor <span class="title">query</span><span class="params">(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è¿™ä¸ª name è·å–çš„å°±æ˜¯ xml çš„æ–‡ä»¶å,é»˜è®¤å– uri çš„ path å­—æ®µçš„ç¬¬ä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span> (!sAuthoriry.equals(uri.getAuthority())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Bundle bundle = <span class="keyword">new</span> Bundle();</span><br><span class="line">        <span class="keyword">if</span> (getContext() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            bundle.putString(<span class="string">"user"</span>, SharedPreferUtil.get(getContext(), Constants.EXTRA_USER_CACHE, <span class="string">""</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BundleCursor(bundle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BundleCursor</span> <span class="keyword">extends</span> <span class="title">MatrixCursor</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Bundle mBundle;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BundleCursor</span><span class="params">(Bundle extras)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(<span class="keyword">new</span> String[]&#123;&#125;, <span class="number">0</span>);</span><br><span class="line">            mBundle = extras;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Bundle <span class="title">getExtras</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> mBundle;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Bundle <span class="title">respond</span><span class="params">(Bundle extras)</span> </span>&#123;</span><br><span class="line">            mBundle = extras;</span><br><span class="line">            <span class="keyword">return</span> mBundle;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">(@NonNull Uri uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"No external call"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Uri <span class="title">insert</span><span class="params">(@NonNull Uri uri, @Nullable ContentValues values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"No external call"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(@NonNull Uri uri, @Nullable String selection, @Nullable String[] selectionArgs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"No external call"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(@NonNull Uri uri, @Nullable ContentValues values, @Nullable String selection, @Nullable String[] selectionArgs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"No external call"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>AndroidManifest.xml é…ç½®<br><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç”±äºåªä¸æœ¬åº”ç”¨é€šä¿¡æ‰€ä»¥å°±æ²¡æœ‰é…ç½®æƒé™ --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">".provider.UserProvider"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:authorities</span>=<span class="string">"$&#123;applicationId&#125;.UserProvider"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:exported</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å°±é…ç½®å¥½äº†å¤šè¿›ç¨‹è¯»å– SharePreference çš„ ContentProvider,å‡¡æ˜¯è¯»å–ç”¨æˆ·ä¿¡æ¯çš„åœ°æ–¹éƒ½éœ€æ›¿æ¢ä¸ºå¦‚ä¸‹æ–¹å¼<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String authority = <span class="string">"content://"</span> + BuildConfig.APPLICATION_ID + <span class="string">".UserProvider"</span>;</span><br><span class="line">    Uri uri = Uri.parse(authority);</span><br><span class="line">    <span class="comment">//ç”±äºå¤šè¿›ç¨‹æ¨¡å¼,æ‰€ä»¥ Application ä¼šå¤šæ¬¡åˆå§‹åŒ–,MyApplication.getInstance() çš„åˆå§‹åŒ–ä¸èƒ½å†™åœ¨æŸä¸ªè¿›ç¨‹é‡Œ,å¦‚æœè¿™æ ·åˆ™å…¶ä»–è¿›ç¨‹è·å–ä¸åˆ°å®ä¾‹,å¯¼è‡´è¿™é‡Œä¼šå‡ºç°NPE</span></span><br><span class="line">    Cursor cursor = MyApplication.getInstance().getContentResolver().query(uri, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">if</span> (cursor != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Bundle args = cursor.getExtras();</span><br><span class="line">        cursor.close();</span><br><span class="line">        <span class="keyword">if</span> (args != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> User.stringToUser(args.getString(<span class="string">"user"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ä»¥ä¸Šé…ç½®,å°±å¯ä»¥åœ¨ä¸åŒè¿›ç¨‹é‡Œè·å–Userå¯¹è±¡.<br>æˆ‘ä»¬ä¸šåŠ¡ä¸­æœ‰ä¸ªé€»è¾‘æ˜¯åˆ†äº«ç½‘é¡µ,å½“ç”¨æˆ·ç‚¹å‡»ç½‘é¡µåˆ†äº«æŒ‰é’®,è°ƒèµ·åˆ†äº«é¡µé¢,ç„¶ååˆ†äº«è‡³å¾®ä¿¡,åˆ†äº«æˆåŠŸè¿”å›åè°ƒç”¨ js,æ‰€ä»¥éœ€è¦åœ¨å¾®ä¿¡å›è°ƒä¸­é€šçŸ¥ç½‘é¡µ,ä½¿ç”¨BroadcastReceiveré€šçŸ¥ç½‘é¡µæ‰§è¡Œ js è„šæœ¬.</p>
<h2 id="å¤šè¿›ç¨‹æ³¨æ„äº‹é¡¹"><a href="#å¤šè¿›ç¨‹æ³¨æ„äº‹é¡¹" class="headerlink" title="å¤šè¿›ç¨‹æ³¨æ„äº‹é¡¹"></a>å¤šè¿›ç¨‹æ³¨æ„äº‹é¡¹</h2><ol>
<li>é™æ€æˆå‘˜å’Œå•ä¾‹æ¨¡å¼ä¼šå¤±æ•ˆ</li>
<li>çº¿ç¨‹åŒæ­¥æœºåˆ¶å¤±æ•ˆ</li>
<li>SharePreference ç¨³å®šæ€§ä¸èƒ½ä¿è¯,ä½¿ç”¨ ContentProvider å°è£…,å¯¹å¤–æä¾›æ•°æ®æœåŠ¡</li>
<li>Application ä¼šå¤šæ¬¡åˆ›å»º,éœ€è¦æ³¨æ„å¤šè¿›ç¨‹é—´ä½¿ç”¨çš„å¯¹è±¡æ˜¯å¦åˆå§‹åŒ–<br>åœ¨ web è¿›ç¨‹ä¸­è°ƒç”¨ä¸»è¿›ç¨‹åŠŸèƒ½éƒ½éœ€è¦æ³¨æ„ Context å’Œæ•°æ®çš„è¯»å–,å¦åˆ™ä¼šå‡ºç°ç©ºæŒ‡é’ˆçš„é—®é¢˜.<h1 id="ä¸»è¿›ç¨‹ä¿æ´»"><a href="#ä¸»è¿›ç¨‹ä¿æ´»" class="headerlink" title="ä¸»è¿›ç¨‹ä¿æ´»"></a>ä¸»è¿›ç¨‹ä¿æ´»</h1>åœ¨å®Œæˆè¿›ç¨‹æ‹†åˆ†åæµ‹è¯•ä¸­å‘ç°,å½“ä¸»è¿›ç¨‹å ç”¨ä¸€ç™¾å¤š MB æ—¶çº¢ç±³ Note3 æœºå™¨æ‰“å¼€ç½‘é¡µè¿›ç¨‹,å†æ¶ˆè€—ä¸€ç™¾å¤š MBæ—¶,ç³»ç»Ÿä¼šè‡ªåŠ¨æ€æ­»ä¸»è¿›ç¨‹,å¯¼è‡´è¿”å›åˆ°ä¸»è¿›ç¨‹ä¼šå†æ¬¡åŠ è½½,ä¸ºäº†é¿å…è¿™ç§é—®é¢˜å‘ç”Ÿ,åªèƒ½åœ¨ç½‘é¡µè¿›ç¨‹å¯åŠ¨å,å°†ä¸»è¿›ç¨‹ç½®ä¸ºå‰å°è¿›ç¨‹.<br>è¿›ç¨‹ä¿æ´»è¯é¢˜å¦‚æœè¦å±•å¼€è°ˆ,å¯ä»¥å†™å¥½å¤šä¸œè¥¿,è¿™é‡Œåªä»‹ç»æˆ‘ä»¬åº”ç”¨çš„æ–¹æ³•.é€»è¾‘å¾ˆç®€å•å°±æ˜¯åœ¨ä¸»è¿›ç¨‹ä¸­å¯åŠ¨ä¸€ä¸ªå‰å° Service,ç„¶åå†å¯åŠ¨ä¸€ä¸ªç›¸åŒ ID çš„ Service,æœ€ååœæ­¢ä¸€ä¸ª Service,è¿™æ ·é€šçŸ¥æ é‡Œä¾¿ä¸ä¼šå‡ºç°é€šçŸ¥,è€Œåº”ç”¨åœ¨å‰å° oom_adj å€¼è¾ƒé«˜,è¿›ç¨‹ä¸ä¼šè¢«æ€æ­».<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KeepLiveService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NOTIFICATION_ID = <span class="number">0x11</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KeepLiveService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Not yet implemented"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.JELLY_BEAN_MR2) &#123;</span><br><span class="line">            <span class="comment">//API 18 ä»¥ä¸‹ï¼Œç›´æ¥å‘é€ Notification å¹¶å°†å…¶ç½®ä¸ºå‰å°</span></span><br><span class="line">            startForeground(NOTIFICATION_ID, <span class="keyword">new</span> Notification());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//API 18 ä»¥ä¸Šï¼Œå‘é€ Notification å¹¶å°†å…¶ç½®ä¸ºå‰å°åï¼Œå¯åŠ¨ InnerService</span></span><br><span class="line">            Notification.Builder builder = <span class="keyword">new</span> Notification.Builder(<span class="keyword">this</span>);</span><br><span class="line">            builder.setSmallIcon(R.drawable.push);</span><br><span class="line">            startForeground(NOTIFICATION_ID, builder.build());</span><br><span class="line">            ContextCompat.startForegroundService(getApplicationContext(), <span class="keyword">new</span> Intent(<span class="keyword">this</span>, InnerService<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InnerService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.onCreate();</span><br><span class="line">            <span class="comment">//å‘é€ä¸ KeepLiveService ä¸­I D ç›¸åŒçš„ Notificationï¼Œç„¶åå–æ¶ˆè‡ªå·±çš„å‰å°æ˜¾ç¤º</span></span><br><span class="line">            Notification.Builder builder = <span class="keyword">new</span> Notification.Builder(<span class="keyword">this</span>);</span><br><span class="line">            builder.setSmallIcon(R.drawable.push);</span><br><span class="line">            startForeground(NOTIFICATION_ID, builder.build());</span><br><span class="line">            stopSelf();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å½“ç„¶ Service ä¹Ÿå¿…é¡»åœ¨ AndroidManifest ä¸­æ³¨å†Œ.</p>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ol>
<li>compleVerison 27 targetVersion 26 å¦‚æœå†ä¸ºæ›´é«˜çš„ç‰ˆæœ¬åˆ™é€šçŸ¥æ‹¦ä¼šæ˜¾ç¤ºå‡ºåº”ç”¨æ­£åœ¨åå°è¿è¡Œ,ç»™ç”¨æˆ·é€ æˆä¸å¥½çš„ä½“éªŒ</li>
<li>ä¸ºäº†åœ¨ç”¨æˆ·ä½“éªŒå’Œå†…å­˜æ¶ˆè€—é—´å¹³è¡¡,åœ¨ Application çš„ onTrimMemoryä¸­,å½“ level å€¼å¤§äºç­‰äº TRIM_MEMORY_MODERATE ä¸” Web è¿›ç¨‹åœ¨åå°å,ä¸»åŠ¨æ€æ­» web è¿›ç¨‹.</li>
</ol>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æ€§èƒ½è°ƒä¼˜</tag>
      </tags>
  </entry>
  <entry>
    <title>Android å†…å­˜ä¼˜åŒ–å®è·µ(ä¸­)</title>
    <url>/2018/09/10/android-memory-optimization-2/</url>
    <content><![CDATA[<p>ä¸Šä¸€ç¯‡ä»å›¾ç‰‡åŠ è½½å’Œå¸ƒå±€æ–¹é¢åˆ†ææ€æ ·ä¼˜åŒ–å†…å­˜,è¿™æ ·å¯ä»¥è§£å†³å¤§éƒ¨åˆ†çš„ OOM é—®é¢˜äº†,ä½†æ˜¯ä¸ºäº†å°½å¯èƒ½å°çš„å ç”¨å†…å­˜,æˆ‘ä»¬è¿˜éœ€è¦ä»å…¶ä»–æ–¹é¢å…¥æ‰‹,ä¸å…‰æ˜¯ä»ç¼–ç¨‹è§’åº¦,è¿˜éœ€è¦åœ¨ä¸šåŠ¡æ–¹é¢é…åˆ.</p>
<h1 id="ViewPager-é¡µé¢ä½¿ç”¨æ‡’åŠ è½½"><a href="#ViewPager-é¡µé¢ä½¿ç”¨æ‡’åŠ è½½" class="headerlink" title="ViewPager é¡µé¢ä½¿ç”¨æ‡’åŠ è½½"></a>ViewPager é¡µé¢ä½¿ç”¨æ‡’åŠ è½½</h1><p>åœ¨é¦–é¡µã€æœç´¢ç­‰é¡µé¢ä¸­éœ€è¦ä½¿ç”¨ ViewPager æ‰¿è½½ä¸åŒ Fragment,å¹¶ä¸”æœ‰çš„éœ€è¦ ViewPager åµŒå¥— ViewPager,å¦‚æœè¿›å…¥ Activity å°±åŠ è½½ Fragment ä¼šæ¶ˆè€—å¤§é‡èµ„æº,å¦‚ç½‘ç»œè¯·æ±‚ã€å†…å­˜ã€å¸ƒå±€ç»˜åˆ¶è€—æ—¶è€—å†…å­˜,å¯¹ç”¨æˆ·è€Œè¨€éœ€è¦ç­‰å¾…é€ æˆä¸å¥½çš„ä½“éªŒ.æ‰€ä»¥éœ€è¦ä½¿ç”¨æ‡’åŠ è½½æ–¹å¼ä»¥å‡å°‘ç½‘ç»œè¯·æ±‚ã€å¸ƒå±€ç»˜åˆ¶ç­‰ä¸å¿…è¦çš„æ¶ˆè€—.<br>æ‡’åŠ è½½çš„æ€è·¯å°±æ˜¯é¦–æ¬¡FragmentåŠ è½½è¿›Activityä¸å¯è§çš„æ—¶å€™ä¸åˆå§‹åŒ–å¸ƒå±€å’Œè¯·æ±‚ç½‘ç»œ,è®©Fragmentåˆ‡æ¢ä¸ºå¯è§æ—¶,å†åŠ è½½å¸ƒå±€ã€è¯·æ±‚ç½‘ç»œ,è¿™æ ·å°±é¿å…é¦–æ¬¡æ‰“å¼€Activityå¡é¡¿å’Œæ¶ˆè€—ä¸å¿…è¦å†…å­˜.åœ¨ Fragment é‡å†™<code>setUserVisibleHint(boolean isVisibleToUser)</code>æ–¹æ³•ä¾¿å¯ä»¥è·å–åˆ°,Fragment æ˜¯å¦ç”¨æˆ·å¯è§.<br><a id="more"></a><br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyFrgment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ‡å¿—ä½ï¼Œæ ‡å¿—å·²ç»åˆå§‹åŒ–å®Œæˆï¼Œå› ä¸ºsetUserVisibleHintæ˜¯åœ¨onCreateViewä¹‹å‰è°ƒç”¨çš„ï¼Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isPrepared;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ‡å¿—å½“å‰é¡µé¢æ˜¯å¦å¯è§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isVisible;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸éœ€è¦æ‡’åŠ è½½ï¼Œéœ€è¦åœ¨onAttachæ—¶è®¾ç½®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> hasNotLazyLoad;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHasNotLazyLoad</span><span class="params">(<span class="keyword">boolean</span> hasNotLazyLoad)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hasNotLazyLoad = hasNotLazyLoad;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        isPrepared = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(getContentView(), container, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewCreated</span><span class="params">(@NonNull View view, @Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState);</span><br><span class="line">        initView(view);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityCreated(savedInstanceState);</span><br><span class="line">        <span class="keyword">if</span> (hasNotLazyLoad) &#123;</span><br><span class="line">            initData();</span><br><span class="line">            loadData();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserVisibleHint</span><span class="params">(<span class="keyword">boolean</span> isVisibleToUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setUserVisibleHint(isVisibleToUser);</span><br><span class="line">        isVisible = getUserVisibleHint();</span><br><span class="line">        <span class="keyword">if</span> (isVisible) &#123;</span><br><span class="line">            onVisible();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            onInvisible();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onVisible</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lazyLoad();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onInvisible</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">lazyLoad</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isVisible &amp;&amp; isPrepared &amp;&amp; !hasNotLazyLoad) &#123;</span><br><span class="line">            isPrepared = <span class="keyword">false</span>;</span><br><span class="line">            initData();</span><br><span class="line">            loadData();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®Fragmentå¸ƒå±€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¸ƒå±€Id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getContentView</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–View</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> view ContentView</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">(View view)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–Viewå±æ€§ã€åŠ è½½åŸºæœ¬æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initData</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ è½½ç½‘ç»œæˆ–è€…æ•°æ®åº“æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å½“ç»§æ‰¿ LazyFragment å,åªéœ€å®ç°å››ä¸ªæŠ½è±¡æ–¹æ³•å,å°±å¯ä»¥å®Œæˆæ‡’åŠ è½½.è¿™æ ·çš„æ–¹å¼ä¹Ÿæœ‰åŠ©äºå‡å°‘ç½‘ç»œå¹¶å‘å¯¼è‡´ Token å¤±æ•ˆçš„é—®é¢˜.å½“ ViewPager ä¸­ Fragment ä¸ªæ•°è¿‡å¤šæ—¶,å¯¹å†…å­˜ä¹Ÿä¼šé€ æˆå¾ˆå¤§å‹åŠ›,æ‰€ä»¥éœ€è¦ç”¨<code>setOffscreenPageLimit</code>ç»™ ViewPager è®¾ç½®ä¸€ä¸ªåˆé€‚çš„ limit å€¼,å½“ ViewPager åŠ è½½ Fragment è¶…è¿‡è¿™ä¸ªå€¼æ—¶,ä¼šå›æ”¶æ ˆåº•çš„ Fragment ç¼“è§£å†…å­˜å‹åŠ›.</p>
<h1 id="é¡µé¢é€’å½’è°ƒç”¨é™åˆ¶"><a href="#é¡µé¢é€’å½’è°ƒç”¨é™åˆ¶" class="headerlink" title="é¡µé¢é€’å½’è°ƒç”¨é™åˆ¶"></a>é¡µé¢é€’å½’è°ƒç”¨é™åˆ¶</h1><p>å½“è¿›å…¥å•†å“è¯¦æƒ…é¡µååˆå¯ä»¥è¿›å…¥åº—é“ºè¯¦æƒ…é¡µ,åº—é“ºè¯¦æƒ…é¡µå°±å¯ä»¥è¿›å…¥å•†å“è¯¦æƒ…é¡µ,è¿™æ ·çš„é€’å½’è°ƒç”¨,ç†è®ºæƒ…å†µä¸€å®šä¼šå‡ºç° OOM,å°±ç®—ä¸å‡ºç° OOM ä¹Ÿä¼šè®©å†…å­˜å‹åŠ›è¿‡å¤§,æœ‰å¯èƒ½ä½¿åº”ç”¨å¡é¡¿.æ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸ªé˜ˆå€¼,å½“é¡µé¢é€’å½’è°ƒç”¨è¶…è¿‡è¿™ä¸ªé˜ˆå€¼å,æ€æ­»è¿™ä¸ªé˜ˆå€¼å‰æ‰€ä»¥çš„å•†å“è¯¦æƒ…é¡µ.å½“ç„¶ä¹Ÿå¯ä»¥æœ‰æ›´å¤æ‚çš„è§„åˆ™,ç›®å‰æˆ‘ä»¬ä¸šåŠ¡è§„åˆ™è¿™æ ·æŒ‡å®š,ä½†æ˜¯æ€»ä½“æ€è·¯ä¸å˜.<br>åœ¨ API 14ä»¥å,Application ä¸­æä¾›äº†ä¸€ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸå›è°ƒçš„æ³¨å†Œæ–¹æ³•ï¼Œç”¨æ¥å¯¹åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œé›†ä¸­ç®¡ç†.è¿™æ ·å¯ä»¥å…å»æ‰‹åŠ¨ç»´æŠ¤ Activity æ ˆ.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨ Application çš„ onCreate è°ƒç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">registerMainProcessActivityLife</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è®°å½•å•†å“è¯¦æƒ…é¡µ,Activity ä¹Ÿæ˜¯å †æ ˆç»“æ„,æ‰€ä»¥é‡‡ç”¨æ­¤æ•°æ®ç»“æ„</span></span><br><span class="line">    <span class="keyword">final</span> Stack&lt;Activity&gt; activities = <span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    <span class="comment">//å•†å“è¯¦æƒ…é¡µæœ€å¤šåŠ è½½ä¸ªæ•°</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> maxGoodDetailActivityNum = <span class="number">3</span>;</span><br><span class="line">    registerActivityLifecycleCallbacks(<span class="keyword">new</span> ActivityLifecycleCallbacks() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityCreated</span><span class="params">(Activity activity, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (activity <span class="keyword">instanceof</span> GoodsDetailActivity) &#123;</span><br><span class="line">                <span class="keyword">if</span> (activities.size() &gt;= maxGoodDetailActivityNum) &#123;</span><br><span class="line">                    activities.peek().finish(); <span class="comment">//ç§»é™¤æ ˆåº•çš„è¯¦æƒ…é¡µ</span></span><br><span class="line">                &#125;</span><br><span class="line">                activities.add(activity);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityStarted</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityResumed</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityPaused</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityStopped</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivitySaveInstanceState</span><span class="params">(Activity activity, Bundle outState)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onActivityDestroyed</span><span class="params">(Activity activity)</span> </span>&#123;</span><br><span class="line">            activities.remove(activity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="å¤æ‚é•¿é¡µé¢ä½¿ç”¨-vlayout"><a href="#å¤æ‚é•¿é¡µé¢ä½¿ç”¨-vlayout" class="headerlink" title="å¤æ‚é•¿é¡µé¢ä½¿ç”¨ vlayout"></a>å¤æ‚é•¿é¡µé¢ä½¿ç”¨ vlayout</h1><p>å¯¹äºç”µå•†é¦–é¡µè€Œè¨€,é¡µé¢æ‰¿è½½å†…å®¹éœ€è¦ååˆ†ä¸°å¯Œ,å¹¶ä¸”æ•°é‡ä¹Ÿå¾ˆå¤š,å¦‚æœä½¿ç”¨ ScrollView æ ¹æœ¬æ— æ³•æ»¡è¶³,å¦‚æœä½¿ç”¨ RecyclerView éœ€è¦ç¼–å†™å¤§é‡çš„å¸ƒå±€,å¯¹æ•°æ®ç»“æ„è¦æ±‚å¾ˆé«˜.ååˆ†æ„Ÿè°¢é˜¿é‡Œåœ¨çš„å¼€æºé¡¹ç›®<a href="https://github.com/alibaba/vlayout">vlayout</a>,ç®€ç›´æ˜¯ç¼–å†™å¤æ‚é¡µé¢ä¹‹å…‰.æˆ‘ä»¬ç›®å‰åº”ç”¨äºé¦–é¡µã€å•†å“è¯¦æƒ…é¡µã€åº—é“ºè¯¦æƒ…é¡µç­‰ç»“æ„æ ·å¼è¾ƒå¤š,ä¸”å†…å®¹è¾ƒå¤šçš„é¡µé¢.vlayout æ”¯æŒå›ºå®šå¸ƒå±€ã€æµ®åŠ¨å¸ƒå±€ã€æµ®åŠ¨å¸ƒå±€ã€ç€‘å¸ƒæµå¸ƒå±€ç­‰å¤æ‚å¸ƒå±€.<code>vlayout æ˜¯ä¸€ä¸ªé’ˆå¯¹ RecyclerView çš„ LayoutManager æ‰©å±•, ä¸»è¦æä¾›ä¸€æ•´å¥—å¸ƒå±€æ–¹æ¡ˆå’Œå¸ƒå±€é—´çš„ç»„ä»¶å¤ç”¨çš„é—®é¢˜ã€‚é€šè¿‡å®šåˆ¶åŒ–çš„LayoutManagerï¼Œæ¥ç®¡æ•´ä¸ªRecyclerViewçš„å¸ƒå±€é€»è¾‘ï¼›LayoutManagerç®¡ç†äº†ä¸€ç³»åˆ—LayoutHelperï¼ŒLayoutHelperè´Ÿè´£å…·ä½“å¸ƒå±€é€»è¾‘å®ç°çš„åœ°æ–¹ï¼›æ¯ä¸€ä¸ªLayoutHelperè´Ÿè´£é¡µé¢æŸä¸€ä¸ªèŒƒå›´å†…çš„ç»„ä»¶å¸ƒå±€ï¼›ä¸åŒçš„LayoutHelperå¯ä»¥åšä¸åŒçš„å¸ƒå±€é€»è¾‘ï¼Œå› æ­¤å¯ä»¥åœ¨ä¸€ä¸ªRecyclerViewé¡µé¢é‡Œæä¾›å¼‚æ„çš„å¸ƒå±€ç»“æ„ï¼Œè¿™å°±èƒ½æ¯”ç³»ç»Ÿè‡ªå¸¦çš„LinearLayoutManagerã€GridLayoutManagerç­‰æä¾›æ›´åŠ ä¸°å¯Œçš„èƒ½åŠ›ã€‚åŒæ—¶æ”¯æŒæ‰©å±•LayoutHelperæ¥æä¾›æ›´å¤šçš„å¸ƒå±€èƒ½åŠ›.</code></p>
<h1 id="onDestroy-ç½®ç©ºå…¨å±€å˜é‡"><a href="#onDestroy-ç½®ç©ºå…¨å±€å˜é‡" class="headerlink" title="onDestroy ç½®ç©ºå…¨å±€å˜é‡"></a>onDestroy ç½®ç©ºå…¨å±€å˜é‡</h1><p>æ­£å¸¸æƒ…å†µä¸‹,Activity finish åç³»ç»Ÿä¼šé”€æ¯ Activity çš„å®ä¾‹,å½“è¯¥ Actiivty å¯¹è±¡å¼•ç”¨æ²¡æœ‰æŒ‡å‘åŸå…ˆåˆ†é…ç»™è¯¥Activityå¯¹è±¡çš„å†…å­˜æ—¶ï¼Œè¯¥å†…å­˜ä¾¿æˆä¸ºåƒåœ¾.JVMçš„ä¸€ä¸ªç³»ç»Ÿçº§çº¿ç¨‹ä¼šè‡ªåŠ¨é‡Šæ”¾è¯¥å†…å­˜å—.ä½†æ˜¯è¿™ä¸ªæœ‰å¯èƒ½ä¸åŠæ—¶,æˆ‘ä»¬æ‰‹åŠ¨ç½®ç©ºåä¼šæ›´åŠ ç§¯æçš„å›æ”¶å†…å­˜.<br>åŸæ¥å¹¶æ²¡æœ‰åœ¨æ„è¿™ä¸ªæ“ä½œä¼šå¸¦æ¥å¤šå¤§å˜åŒ–,ä½†æ˜¯åœ¨ä¼˜åŒ–è¿‡ç¨‹å‘ç°è¿˜æŒºæœ‰æ•ˆ.</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æ€§èƒ½è°ƒä¼˜</tag>
      </tags>
  </entry>
  <entry>
    <title>Android å†…å­˜ä¼˜åŒ–å®è·µ(ä¸Š)</title>
    <url>/2018/09/03/android-memory-optimization/</url>
    <content><![CDATA[<p>ä¸€ç›´åœ¨å†™ä»£ç ,æ„Ÿè§‰æ€»ç»“åæ€æ¯”è¾ƒå°‘,è‡ªå·±çš„è¡¨è¾¾èƒ½åŠ›å¾ˆæ¬ ç¼º,æ‰€ä»¥æƒ³æŠŠè‡ªå·±çš„ä¸€äº›ç»éªŒè®°å½•ä¸‹æ¥,é¡ºä¾¿ç†æ¸…æ€è·¯.<br>å…¬å¸é¡¹ç›®ç»å†äº†ä¸€ä¸¤å¹´å¤šçš„è¿­ä»£,ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚,ç”±äºæ˜¯ç”µå•†é¡¹ç›®,æœ‰å¤§é‡çš„å›¾ç‰‡éœ€è¦åŠ è½½,é¡µé¢å¸ƒå±€å¤šæ ·åŒ–,å¯¹ WebView ä½¿ç”¨ä¹Ÿå¾ˆå¤š,æ‰€ä»¥åœ¨å†…å­˜æ–¹é¢å¼€å§‹å‡ºç°è¾ƒå¤§çš„å‹åŠ›.åœ¨å†ç»å‡ ä¸ªè¿­ä»£å¤„ç†ç›¸å…³é—®é¢˜å,ç°åœ¨é¦–é¡µ Tab å…¨éƒ¨åŠ è½½åå†…å­˜æ¯”ä¼˜åŒ–å‰å†…å­˜ä½¿ç”¨å‡å°‘40%,å½“æ‰“å¼€åå¤šä¸ªé¡µé¢å,å†…å­˜å‡å°‘æœ‰30%ä»¥ä¸Š,ä» bugly çš„æ—¥å¿—æ¥çœ‹å·²ç»æ²¡æœ‰ OOM ç›¸å…³æ—¥å¿—äº†,æ”¹è¿›æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾.<br><a id="more"></a></p>
<h1 id="é’ˆå¯¹åº”ç”¨è¿›è¡Œåˆ†æ-ä¼˜åŒ–å‰ä¸»è¦å­˜åœ¨ä¸‹é¢å‡ ä¸ªé—®é¢˜"><a href="#é’ˆå¯¹åº”ç”¨è¿›è¡Œåˆ†æ-ä¼˜åŒ–å‰ä¸»è¦å­˜åœ¨ä¸‹é¢å‡ ä¸ªé—®é¢˜" class="headerlink" title="é’ˆå¯¹åº”ç”¨è¿›è¡Œåˆ†æ,ä¼˜åŒ–å‰ä¸»è¦å­˜åœ¨ä¸‹é¢å‡ ä¸ªé—®é¢˜:"></a>é’ˆå¯¹åº”ç”¨è¿›è¡Œåˆ†æ,ä¼˜åŒ–å‰ä¸»è¦å­˜åœ¨ä¸‹é¢å‡ ä¸ªé—®é¢˜:</h1><ol>
<li>å›¾ç‰‡é—®é¢˜<ol>
<li>å›¾ç‰‡å†…å­˜å›æ”¶ä¸åŠæ—¶</li>
<li>åªæœ‰å•ä»½æœ¬åœ°å›¾ç‰‡,ä½†æ”¾ç½®åœ¨ xhdpi ä¸­,å½“é«˜åˆ†è¾¨ç‡æ‰‹æœºåŠ è½½æ—¶,ä¼šå ç”¨è¾ƒå¤§å†…å­˜</li>
</ol>
</li>
<li>å¸ƒå±€ä¼˜åŒ–<ol>
<li>è‡ªå®šä¹‰ View æ—¶,åœ¨ xml æ ¹å¸ƒå±€ä½¿ç”¨ LinearLayout ä¹‹ç±»,å¹¶ä¸”åœ¨ä»£ç é‡Œåˆç»§æ‰¿ç›¸åº”çš„ ViewGroup,é€ æˆé‡å¤åµŒå¥—</li>
<li>åœ¨å¤æ‚å¸ƒå±€ä¸­åµŒå¥—è¿‡çš„å¤š,RelativeLayout ä½¿ç”¨ä¹Ÿè¾ƒå¤š,å½±å“å¸ƒå±€æµ‹é‡ç»˜åˆ¶æ€§èƒ½</li>
<li>é¡µé¢ä¸­æœªç»å¸¸ä½¿ç”¨çš„ View ä½¿ç”¨ Gone éšè—,è€Œæœªä½¿ç”¨ ViewStub,å½±å“ç»˜åˆ¶æ€§èƒ½</li>
</ol>
</li>
<li>æŸäº› ViewPager é¡µé¢ä¸ºä½¿ç”¨æ‡’åŠ è½½</li>
<li>æŸäº›é¡µé¢å¯ä»¥é€’å½’è°ƒç”¨,è€Œæœªåšä»»ä½•é™åˆ¶,å­˜åœ¨ OOM é£é™©</li>
<li>å¤æ‚é•¿é¡µé¢ä½¿ç”¨ ScrollView,é€ æˆå•é¡µé¢å†…å­˜æ¶ˆè€—è¿‡å¤§</li>
<li>onDestroy ä¸­ä¸ºå°†å…¨å±€å˜é‡ç½®ç©º,å¯¼è‡´å†…å­˜å›æ”¶ç¼“æ…¢</li>
<li>WebView<ol>
<li>é Web é¡µé¢åµŒå¥— WebView,æ²¡åšå¥½å†…å­˜é‡Šæ”¾å¤„ç†,é€ æˆå†…å­˜å ç”¨ä¸èƒ½é‡Šæ”¾</li>
<li>Webæœªä½¿ç”¨ç‹¬ç«‹è¿›ç¨‹,è€Œ WebView ä¸­ VR å±•ç¤º,å†…å­˜æ¶ˆè€—ä¸¥é‡</li>
</ol>
</li>
</ol>
<h1 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h1><p>æœ‰çš„é—®é¢˜æ˜¯ç¼–ç ä¹ æƒ¯é—®é¢˜,å¹³æ—¶æ²¡æœ‰å…»æˆè‰¯å¥½çš„ä¹ æƒ¯,å¯¼è‡´ä»£ç ç»´æŠ¤è¶Šæ¥è¶Šéš¾åš,è¡¥ä¸è¶Šæ‰“è¶Šå¤š,å¯¹æ€§èƒ½å¼€å§‹äº§ç”Ÿäº†å½±å“.<br>æœ‰çš„é—®é¢˜æ˜¯æ€è€ƒå¤ªå°‘,ç€æ€¥å†™ä»£ç è€Œæ²¡æœ‰è€ƒè™‘å¥½åº”ç”¨åœºæ™¯,å¯¹åæ¥çš„æ‰©å±•å’Œæ€§èƒ½äº§ç”Ÿäº†å½±å“.<br>æœ‰çš„åˆ™æ˜¯è‡ªå·±æ°´å¹³ä¸å¤Ÿ,æ²¡æœ‰å¥½å¥½å­¦ä¹ ,æ„è¯†ä¸åˆ°å­˜åœ¨é—®é¢˜.</p>
<p>ç°åœ¨åˆè®©æˆ‘æƒ³èµ·äº†ä»£ç æ•´æ´ä¹‹é“é‡Œçš„é‚£å¥è¯.<div class="note danger">
            <p>è®©è¥åœ°æ¯”ä½ æ¥æ—¶æ›´å¹²å‡€ </p>
          </div>ä»¥ååœ¨å†™ä»£ç æ—¶ä¸€å®šè¦é»˜å¿µ,æ—¶åˆ»è­¦æƒ•è®©å…¶æˆä¸ºä¸€ç§ä¹ æƒ¯,è¿™æ ·è‡ªå·±æ‰€çŠ¯çš„é”™è¯¯ä¹Ÿå°±å°‘ä¸€ç‚¹.</p>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><h2 id="å›¾ç‰‡å†…å­˜åŠæ—¶é‡Šæ”¾"><a href="#å›¾ç‰‡å†…å­˜åŠæ—¶é‡Šæ”¾" class="headerlink" title="å›¾ç‰‡å†…å­˜åŠæ—¶é‡Šæ”¾"></a>å›¾ç‰‡å†…å­˜åŠæ—¶é‡Šæ”¾</h2><p>é¡¹ç›®ç›®å‰ä½¿ç”¨çš„æ˜¯å›¾ç‰‡æ¡†æ¶æ˜¯ Glide3.7.0 ç‰ˆæœ¬,ç”±äºå…¶ä»– library ä¹Ÿåœ¨ä¾èµ–è¿™ä¸ªç‰ˆæœ¬,æ‰€ä»¥ç›®å‰è¿˜æ²¡æœ‰è¿ç§»åˆ°æœ€æ–°ç‰ˆæœ¬,æ‰“ç®—æŠ½ç©ºæ›´æ–°ä¸‹,æ¯•ç«Ÿå›¾ç‰‡åŠ è½½æ¡†æ¶å¯¹äºåŠ è½½å¤§é‡å›¾ç‰‡çš„åº”ç”¨è¿˜æ˜¯å¾ˆé‡è¦çš„,ç›´æ¥å…³ä¹ä½“éªŒå’Œæ€§èƒ½.Fresco æœ¬èº«å¯¹äºå›¾ç‰‡çš„è¯·æ±‚ã€å†…å­˜çš„ä¼˜åŒ–å’Œå„ç§å›¾å½¢å˜æ¢,æœ‰å¾ˆå¥½çš„æ”¯æŒå’Œä½“éªŒ,ä½†æ˜¯ç”±äºå…¶å¿…é¡»æŒ‡å®šå®½åº¦æˆ–è€…é«˜åº¦,å¯¹äºç›®å‰é¡¹ç›®çš„è¿ç§»å­˜åœ¨è¾ƒå¤§çš„éšœç¢,ç›®å‰ä¸äºˆè€ƒè™‘.</p>
<p>åœ¨æ•´åˆè¿›é¡¹ç›®ä¸­,æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰ ImageView,å°† Glide å„ç§é»˜è®¤ç­–ç•¥å°è£…åœ¨ View å†…,å¯¹å¤–ç›´æä¾›é»˜è®¤çš„æ–¹æ³•å°±å¯ä»¥ä½¿ç”¨,æ¶ˆé™¤æœ‰å¤šä½™é…ç½®,å¯¹äºç‰¹æ®Šçš„éœ€æ±‚æä¾›ç»Ÿä¸€æ–¹æ³•,è¿›è¡Œè‡ªå®šä¹‰é…ç½®.ç®€åŒ–è°ƒç”¨é€»è¾‘.</p>
<p>å½“åœ¨é¡µé¢å†…æ»‘åŠ¨æ—¶,é¡µé¢æ»‘å‡ºå±å¹•,è¿™æ—¶å€™ View å·²ç»çœ‹ä¸åˆ°,ä½†æ˜¯å†…å­˜ä¾æ—§åœ¨å ç”¨,è€Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾,è€Œè¿™æ ·çš„çš„æƒ…å†µåœ¨æ‰“å¼€é¡µé¢è¾ƒå°‘æ—¶çœ‹èµ·æ¥æ— æ‰€è°“,ä½†æ˜¯ä¸€æ—¦ Activity æ ˆä¸­æœ‰å¤§é‡å†å² Activity è€Œæœªé”€æ¯,å°±ä¼šç»™å†…å­˜å¸¦æ¥å¾ˆå¤§å‹åŠ›,<strong>é›ªå´©æ—¶,æ²¡æœ‰ä¸€ç‰‡é›ªèŠ±æ˜¯æ— è¾œçš„</strong>.æ‰€ä»¥è¦é˜²èŒƒè¿™ç§æƒ…å†µçš„å‘ç”Ÿ.å¦‚æœé¦–é¡µå°±åŠ è½½äº†å¤§é‡çš„å›¾ç‰‡,å ç”¨è¿‡å¤šå†…å­˜,é‚£ä¹ˆå¯¹äºæ•´ä¸ªç¨‹åºå¯ä½¿ç”¨çš„å†…å­˜å°±ä¼šå‡å°‘å¾ˆå¤š,ç”¨æˆ·éšä¾¿è¿›å…¥å¤šçº§é¡µé¢,å†…å­˜å°±å¿«é¢„è­¦.</p>
<p>ç»è¿‡ä¸Šé¢çš„åˆ†æ,åŠæ—¶é‡Šæ”¾å›¾ç‰‡å ç”¨çš„æœ€å¥½çš„æ—¶æœºå°±æ˜¯ View æ»‘å‡ºæ—¶å›æ”¶,æ˜¾ç¤ºå‡ºæ¥æ—¶å†åŠ è½½.äºæ˜¯<code>onAttachedToWindow</code>å’Œ<code>onDetachedFromWindow</code>è¿™ä¸¤ä¸ª View ç”Ÿå‘½å‘¨æœŸé‡Œçš„æ–¹æ³•å°±èµ·ä½œç”¨äº†.Activity ä¸­çš„ onAttachedToWindowè°ƒç”¨æ˜¯åœ¨ onResume ä¹‹åè°ƒç”¨,è€Œ onDetachedFromWindow è°ƒç”¨æ˜¯åœ¨ onDestroy ä¹‹å,æ‰€ä»¥å½“ Activity å¢åŠ æ—¶,å†å² Activity å±å¹•ä¸­çš„å›¾ç‰‡å†…å­˜é‡Šæ”¾ä¸æ‰,ä¹Ÿæ˜¯ä¸€ä¸ªéšæ‚£ç‚¹,ä½†æ˜¯é…åˆä¸šåŠ¡é€»è¾‘ä¸ä¼šå‡ºç°ç‰¹åˆ«å¤šçš„ Activity å åŠ çš„æƒ…å†µ,è¿˜æ˜¯å¯ä»¥æ¥å—,å¦‚æœæœ‰å¿…è¦è¿™ä¸ªç‚¹å¯ä»¥ä»¥åä¼˜åŒ–.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmartImageView</span> <span class="keyword">extends</span> <span class="title">AppCompatImageView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Â·Â·Â· çœç•¥å…¶ä»–å˜é‡</span><br><span class="line">    <span class="keyword">private</span> String mUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onAttachedToWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onAttachedToWindow();</span><br><span class="line">        onAttach();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDetachedFromWindow();</span><br><span class="line">        onDetach();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å½“Viweå¯è§æ—¶,å°†å›¾ç‰‡é‡æ–°åŠ è½½</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onAttach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setImageUrl(mUrl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†å›¾ç‰‡ä¸å¯è§æ—¶,åŠæ—¶æ¸…é™¤Viewçš„å›¾ç‰‡</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onDetach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setImageDrawable(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åªæ˜¯ç¤ºä¾‹æ–¹æ³•,æ‰€ä»¥å¾ˆç®€å•çš„æè¿°æ¸…æ¥šåŸç†,å¯¹äºæœåŠ¡å™¨è¿”å›å›¾ç‰‡çš„å°ºå¯¸å,æ ¹æ®ViewçœŸæ˜¯å¤§å°,è®¡ç®—ç¼©æ”¾æ¯”ä¾‹,ä½¿ç”¨overrideå»åŠ è½½åœ¨å±å¹•å®é™…å°ºå¯¸,å‡å°‘ä¸å¿…è¦çš„å†…å­˜æ¶ˆè€—</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImageUrl</span><span class="params">(String url)</span></span>&#123;</span><br><span class="line">        DrawableRequestBuilder&lt;String&gt; builder = Glide.with(getContext().getApplicationContext())</span><br><span class="line">                    .load(url)</span><br><span class="line">                    .dontAnimate()<span class="comment">//æœ‰çš„æœºå‹å‡ºç°å›¾ç‰‡åå‡ºç°åç§»,æ•…å»æ‰åŠ è½½åŠ¨ç”»,ä¾¿æ¢å¤æ­£å¸¸</span></span><br><span class="line">                    .fitCenter();</span><br><span class="line">            <span class="comment">//ä¸èƒ½ä½¿ç”¨builder.into(this) ä»¥ä¸ºContextä½¿ç”¨ApplicationContext,æ‰€ä»¥æœ‰å¯èƒ½æ­¤æ—¶viewé”€æ¯,è€Œå›¾ç‰‡åŠ è½½æˆåŠŸå,å¯¼è‡´å†…å­˜æ³„æ¼</span></span><br><span class="line">            builder.into(<span class="keyword">new</span> SimpleTarget&lt;GlideDrawable&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(GlideDrawable resource, GlideAnimation&lt;? <span class="keyword">super</span> GlideDrawable&gt; glideAnimation)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (resource != <span class="keyword">null</span> &amp;&amp; getContext() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        setImageDrawable(resource);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å°±å¯ä»¥ä¿è¯å›¾ç‰‡åœ¨æ»‘å‡ºå±å¹•åå†…å­˜å¾—åˆ°åŠæ—¶çš„å›æ”¶,è€Œä¸ç”¨ç­‰åˆ°ç•Œé¢é”€æ¯åæ‰èƒ½å›æ”¶å›¾ç‰‡å†…å­˜.æœ€å¤§é™åº¦çš„é™ä½å›¾ç‰‡å¯¹äºå†…å­˜çš„å‹åŠ›.<br>å¯¹äº Android 8.0 ä»¥ä¸Šå›¾ç‰‡ä¸å†ä½¿ç”¨å †å­˜æ”¾,è€Œæ˜¯åˆ†é…åœ¨ Native ä¸­,å¹¶ä¸” <strong>ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å›æ”¶ã€ä¸å—åº”ç”¨å†…å­˜åˆ†é…é™åˆ¶</strong>,å¯¹äºå¤šåº”ç”¨æ¥è¯´çœŸæ˜¯è«å¤§çš„å¥½æ¶ˆæ¯,è™½ç„¶ä¸å—æœ€å¤§å †é™åˆ¶,ä½†æ˜¯å½“ Native å†…å­˜è¿‡å¤§ä¹Ÿä¼šé€ æˆç³»ç»Ÿå±‚é¢çš„ OOM,è€Œä¸”åº”ç”¨æœ¬èº«ä¸ä¼šæ•è·æ­¤å¼‚å¸¸. åœ¨ Android 2.3 ä»¥ä¸‹å›¾ç‰‡å†…å­˜åˆ†é…ä¹Ÿæ˜¯è¿™æ ·çš„é€»è¾‘,ç”±äºä¸èƒ½å›æ”¶ä¸åŠæ—¶æ‰€ä»¥åºŸå¼ƒä¸ä½¿ç”¨,ä½†æ˜¯åœ¨ Android 8.0 åŠ å…¥ä¸€ç§è‡ªåŠ¨å›æ”¶ Native å…§å­˜çš„ NativeAllocationRegistryæœºåˆ¶,å¯¹å¼€å‘è€…è€Œè¨€æ˜¯é€æ˜çš„.ä¸ç”¨æ‰‹åŠ¨å›æ”¶æ‰€åˆ†é…çš„å†…å­˜.</p>
<h2 id="æœ¬åœ°å›¾ç‰‡å¤„ç†"><a href="#æœ¬åœ°å›¾ç‰‡å¤„ç†" class="headerlink" title="æœ¬åœ°å›¾ç‰‡å¤„ç†"></a>æœ¬åœ°å›¾ç‰‡å¤„ç†</h2><ul>
<li>å¯¹äºæœ¬åœ°èµ„æºå›¾ç‰‡éœ€è¦å°½é‡å‹ç¼©,è®¾è®¡å¸ˆç»™è¿‡æ¥å°±ç›´æ¥æ”¾è¿›é¡¹ç›®äº†,å†æ¬¡æ£€æŸ¥æ—¶å‘ç°æœ‰çš„å›¾ç‰‡è¾ƒå¤§,å½“è½½å…¥æ—¶ä¼šå ç”¨æ›´å¤šå†…å­˜.</li>
<li>å¯¹äºå›¾ç‰‡æ ¼å¼å¯ä»¥è½¬æ¢ webp,è¿™ç§ç¼–ç æ ¼å¼åœ¨å¤§å°å’Œè´¨é‡æœ‰å¾ˆå¥½çš„å¹³è¡¡,åœ¨ Android4.2 ç‰ˆæœ¬ä»¥ä¸Šè§£å†³äº†æœ‰å…³bug,å¯ä»¥æ”¾å¿ƒä½¿ç”¨,å½“ç„¶å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æ”¯æŒåˆ° Android4.1 ç‰ˆæœ¬.</li>
<li>å¯¹äºå°ºå¯¸è¾ƒå¤§çš„å›¾ç‰‡å¯ä»¥æ”¾å…¥ xxhdpi,å¦‚æœå°†é«˜åˆ†è¾¨ç‡å›¾ç‰‡æ”¾å…¥ä½å¯†åº¦ç›®å½•ï¼Œå°†ä¼šé€ æˆä½ç«¯æœºå ç”¨è¾ƒå¤§å†…å­˜å¯èƒ½é€ æˆ OOM.<h2 id="å¸ƒå±€ä¼˜åŒ–"><a href="#å¸ƒå±€ä¼˜åŒ–" class="headerlink" title="å¸ƒå±€ä¼˜åŒ–"></a>å¸ƒå±€ä¼˜åŒ–</h2></li>
<li>å¼€å‘ä¸­ç»å¸¸æœ‰å¤šä¸ª View ç»„åˆ,ç®€åŒ– Activity ä¸­ä»£ç çš„é€»è¾‘,å¯ä»¥åœ¨å¤šä¸ªé¡µé¢å¤ç”¨,æ¯”å¦‚æœ‰æ—¶ä¼šç»§æ‰¿ LinearLayout ç„¶ååœ¨æ„é€ æ–¹æ³•é‡Œç”¨ LayouInfflate rå°† xml å¸ƒå±€ä»£ç åŠ è½½è¿›æ¥,è¿™ä¸ªæ–¹å¼çœ‹ä¼¼æ²¡æœ‰æ¯›ç—…,åŸæ¥ä¹Ÿç»å¸¸è¿™ä¹ˆå†™,ä½†æ˜¯åœ¨ä½¿ç”¨ Layout Inspector åˆ†æå¸ƒå±€æ—¶å‘ç°é€ æˆäº†ä¸å¿…è¦çš„åµŒå¥—,æ‰€ä»¥éœ€è¦æ”¹å˜æ–¹å¼.<ul>
<li>ç»§æ‰¿å„ç§ Layout åç›´æ¥newå‡ºæ‰€éœ€è¦çš„ widget,ä½†æ˜¯è¿™æ ·ä¸åˆ©äºç›´è§‚çš„åˆ†æå¸ƒå±€,å¹¶ä¸”å­˜åœ¨å¤§é‡çš„ java ä»£ç ,å¾ˆè´¹åŠ›.</li>
<li>ç»§æ‰¿å„ç§ Layout åå¹¶ä¸”ä½¿ç”¨ LayoutInflater åŠ è½½ xml å¸ƒå±€,ä½†æ˜¯ xml å¸ƒå±€é‡Œä½¿ç”¨ merge,è¿™æ ·å°±å¯ä»¥å‡å°‘ä¸€å±‚å¸ƒå±€åµŒå¥—.<br>ç›¸æ¯”è¾ƒè€Œè¨€ç¬¬äºŒç§æ–¹å¼æ›´æ–¹ä¾¿ã€æ›´ç›´è§‚å’Œç¬¦åˆä¹ æƒ¯,æˆ‘ä»¬ä¹Ÿé‡‡ç”¨ç¬¬äºŒç§æ–¹å¼.<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">merge</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:parentTag</span>=<span class="string">"android.widget.FrameLayout"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">merge</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>ä½¿ç”¨ parentTag æŒ‡å®šå½“å‰å¸ƒå±€çš„æ˜¯å“ªç§ç±»å‹.è¿™æ ·åšå¯ä»¥å®æ—¶é¢„è§ˆæ•ˆæœ,ä½†æ˜¯æ ¹å¸ƒå±€çš„å±æ€§éƒ½è¦åœ¨ java ä»£ç æŒ‡å®š.</p>
<ul>
<li>Google åœ¨ 2016 I/O å¤§ä¼šä¸Šæ¨å‡º ConstrainLayout å¸ƒå±€.è§£å†³äº†å¤æ‚å¸ƒå±€ä½¿ç”¨å„ç§ Layouts äº’ç›¸åµŒå¥—çš„é—®é¢˜,å¯ä»¥è®©å¸ƒå±€æ›´åŠ æ‰å¹³åŒ–,å¯¹äºç°åœ¨å¼€å‘ä½¿ç”¨ LinearLayout, FrameLayout å’Œ ConstrainLayout å®Œå…¨è¶³ä»¥.å…·ä½“çš„ç”¨æ³•å¯ä»¥å‚è€ƒ<a href="https://developer.android.com/training/constraint-layout/" target="_blank" rel="noopener">ConstrainLayout Guide</a>.</li>
<li><p>æ‰“å¼€ä¸€ä¸ªæ–°Activityå¹¶ä¸”è¯·æ±‚ç½‘ç»œæ—¶,å°±ä¼šå‡ºç°å››ç§çŠ¶æ€:åŠ è½½ä¸­ã€æ˜¾ç¤ºå†…å®¹ã€æ˜¾ç¤ºé”™è¯¯ã€æ˜¾ç¤ºç©ºé¡µé¢,å¯¹äºä¸ç»å¸¸æ˜¾ç¤ºçš„é”™è¯¯å’Œç©ºé¡µé¢æˆ‘ä»¬åœ¨ Activity æ ¹å¸ƒå±€ä¸­å´ä¸€ç›´è§£æ,åªæ˜¯è°ƒç”¨ setVisible(GONE),æ¶ˆè€—äº†ä¸å¿…è¦çš„æ€§èƒ½å’Œå†…å­˜.å› æ­¤ä½¿ç”¨ ViewStub å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜,è¿™ä¸ª ViewStub ç›¸å½“äºæ‡’åŠ è½½,åªæœ‰è®°è½½å®ƒæ—¶æ‰ä¼šåˆå§‹åŒ–,å¦åˆ™ä¸ä¼šè§£æ. ViewStub ä¸èƒ½åº”ç”¨ merge æ ‡ç­¾.è¿™ä¸ªç‰¹æ€§å¾ˆé€‚åˆåœ¨é¦–é¡µå¼¹å‡ºä¿ƒé”€çš„ WebView,å¹³æ—¶ä¸éœ€è¦åŠ è½½èŠ‚çœå†…å­˜.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">((ViewStub) findViewById(R.id.my_layout)).setVisibility(View.VISIBLE);</span><br><span class="line"><span class="comment">// æˆ–è€…</span></span><br><span class="line">View importPanel = ((ViewStub) findViewById(R.id.my_layout)).inflate();</span><br></pre></td></tr></table></figure>
  <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  android:layout æŒ‡å®šæ‰€è¦åŠ è½½çš„å¸ƒå±€--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ViewStub</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/stub_home_web"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@android:color/transparent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout</span>=<span class="string">"@layout/layout_web"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Android-Profiler"><a href="#Android-Profiler" class="headerlink" title="Android Profiler"></a>Android Profiler</h1><p>å†…å­˜ä¼˜åŒ–æ˜¯ä¸ªä»»é‡é“è¿œçš„çš„è¿‡ç¨‹,éœ€è¦ä¸æ–­çš„éªŒè¯è§‚å¯Ÿ,Android Studio æä¾›äº†å¼ºå¤§çš„æ€§èƒ½åˆ†æå·¥å…·,åœ¨ Android Profiler é‡Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è§‚å¯Ÿå’Œåˆ†æ CPUã€å†…å­˜å’Œç½‘ç»œçš„çŠ¶æ€.<a href="https://developer.android.google.cn/studio/profile/memory-profiler" target="_blank" rel="noopener">Android Profiler ä½¿ç”¨å‚è€ƒ</a>é‡Œé¢å…·ä½“ç”¨æ³•,å¯ä»¥å¸®åŠ©æˆ‘ä»¬å‘ç°å„ç§æ½œåœ¨é—®é¢˜.</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>æ€§èƒ½è°ƒä¼˜</tag>
      </tags>
  </entry>
  <entry>
    <title>Flutter ä½“éªŒäºŒ(packageå¼€å‘)</title>
    <url>/2018/08/31/flutter-douban-2/</url>
    <content><![CDATA[<p>Flutter åªæ˜¯ä¸€ä¸ª UI æ¡†æ¶,å¯¹äºä¸€äº›ç³»ç»Ÿè°ƒç”¨æˆ–è€…å„è‡ªå¹³å°çš„çš„ç‰¹æœ‰å®ç°éœ€è¦å¼€å‘è€…è‡ªè¡Œç¼–å†™ package,é€šè¿‡åœ¨ package å†…å®ç°ä¸åŒå¹³å°çš„è°ƒç”¨æ–¹å¼,ä»¥è¿™æ ·çš„æ–¹å¼è¿›è¡Œé€‚é….ä»Šå¤©è®°å½•ä¸‹æ€æ ·åœ¨ä¸åŒå¹³å°ç¼–å†™ package.ç”±äºè‡ªå·±ä¸ä¼š iOS,æ‰€ä»¥åªæ˜¯å®ç°ä¸€ä¸ªç®€å•çš„ Android Toast.iOS ç«¯ä½¿ç”¨å®šæ—¶çš„UIAlertViewå»æ¨¡æ‹Ÿ.<br><a id="more"></a></p>
<h5 id="æ–°å»º-package"><a href="#æ–°å»º-package" class="headerlink" title="æ–°å»º package"></a>æ–°å»º package</h5><p>æˆ‘çš„å·¥å…·æ˜¯ Android Studio,é¦–å…ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹new-&gt;module-&gt;é€‰æ‹© Fullter package,ç‚¹å‡» next,ç„¶åçœ‹åˆ°è¿™ä¸ªç•Œé¢<img src="https://def-201655.cos.ap-shanghai.myqcloud.com/fultter_2_new_package.png" alt="Flutter ç›®å½•ç»“æ„">ä¿®æ”¹æŠ¥åå’Œæè¿°,å¹¶ä¸”é€‰æ‹©è‡ªå·±çš„ Flutter SDK ç›®å½•,æœ€åç‚¹å‡» finish.ä¸€ä¸ªæ–°çš„ package å°±æ–°å»ºå®Œæˆäº†.å½“ç„¶å¦‚æœä½¿ç”¨ VSCode çš„è¯ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œæ–°å»º package.<br>packageç›®å½•å¦‚ä¸‹å›¾æ‰€ç¤º<img src="https://def-201655.cos.ap-shanghai.myqcloud.com/flutter_2_package_module.png" alt="ç»“æ„è¯´æ˜"></p>
<h5 id="Android-ç«¯å®ç°-å³åœ¨è¿™è¿™é‡Œç¼–å†™åŸç”Ÿè°ƒç”¨ä»£ç "><a href="#Android-ç«¯å®ç°-å³åœ¨è¿™è¿™é‡Œç¼–å†™åŸç”Ÿè°ƒç”¨ä»£ç " class="headerlink" title="Android ç«¯å®ç°,å³åœ¨è¿™è¿™é‡Œç¼–å†™åŸç”Ÿè°ƒç”¨ä»£ç "></a>Android ç«¯å®ç°,å³åœ¨è¿™è¿™é‡Œç¼–å†™åŸç”Ÿè°ƒç”¨ä»£ç </h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlutterToastPlugin</span> <span class="keyword">implements</span> <span class="title">MethodCallHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"FlutterToastPlugin"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Plugin registration.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerWith</span><span class="params">(Registrar registrar)</span> </span>&#123;</span><br><span class="line">        context = registrar.context();</span><br><span class="line">        <span class="keyword">final</span> MethodChannel channel = <span class="keyword">new</span> MethodChannel(registrar.messenger(), <span class="string">"flutter_toast"</span>);<span class="comment">//è¿™é‡Œçš„  flutter_toast åŒ…åä¸å¯ä¿®æ”¹,éœ€è¦å’ŒiOSä¿æŒä¸€ç›´è¿™æ ·æ‰å¯ä»¥è°ƒç”¨ç”Ÿæ•ˆ.</span></span><br><span class="line">        channel.setMethodCallHandler(<span class="keyword">new</span> FlutterToastPlugin());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMethodCall</span><span class="params">(MethodCall call, Result result)</span> </span>&#123;</span><br><span class="line">        String message = call.argument(<span class="string">"message"</span>);<span class="comment">//è·å– flutter ä¼ å…¥çš„å‚æ•° </span></span><br><span class="line">        <span class="comment">//è·å–ä¼ å…¥çš„æ–¹æ³•å,è°ƒç”¨ç›¸åº”çš„ä¸åŒé€»è¾‘</span></span><br><span class="line">        <span class="keyword">switch</span> (call.method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"showToast"</span>:</span><br><span class="line">                Toast.makeText(context, message, Toast.LENGTH_SHORT).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"showLongToast"</span>:</span><br><span class="line">                Toast.makeText(context, message, Toast.LENGTH_LONG).show();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"getPlatformVersion"</span>:</span><br><span class="line">                <span class="comment">//é»˜è®¤å®ç°</span></span><br><span class="line">                result.success(<span class="string">"Android "</span> + android.os.Build.VERSION.RELEASE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                result.notImplemented();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="package-é¡¹ç›®å…¥å£-æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨æœ¬èº«å®ç°çš„åŠŸèƒ½-é€‰æ‹©æ­¤æ–‡ä»¶-run-åŠæ—¶æŸ¥çœ‹æ•ˆæœ"><a href="#package-é¡¹ç›®å…¥å£-æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨æœ¬èº«å®ç°çš„åŠŸèƒ½-é€‰æ‹©æ­¤æ–‡ä»¶-run-åŠæ—¶æŸ¥çœ‹æ•ˆæœ" class="headerlink" title="package é¡¹ç›®å…¥å£,æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨æœ¬èº«å®ç°çš„åŠŸèƒ½,é€‰æ‹©æ­¤æ–‡ä»¶ run åŠæ—¶æŸ¥çœ‹æ•ˆæœ"></a>package é¡¹ç›®å…¥å£,æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè°ƒç”¨æœ¬èº«å®ç°çš„åŠŸèƒ½,é€‰æ‹©æ­¤æ–‡ä»¶ run åŠæ—¶æŸ¥çœ‹æ•ˆæœ</h5><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/services.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter_toast/flutter_toast.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(<span class="keyword">new</span> MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyAppState createState() =&gt; <span class="keyword">new</span> _MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">String</span> _platformVersion = <span class="string">'Unknown'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    initPlatformState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Future&lt;<span class="keyword">void</span>&gt; initPlatformState() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">String</span> platformVersion;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//é»˜è®¤å®ç°è°ƒç”¨æ‰‹æœºç³»ç»Ÿç‰ˆæœ¬å·</span></span><br><span class="line">      platformVersion = <span class="keyword">await</span> FlutterToast.platformVersion;</span><br><span class="line">    &#125; <span class="keyword">on</span> PlatformException &#123;</span><br><span class="line">      platformVersion = <span class="string">'Failed to get platform version.'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!mounted) <span class="keyword">return</span>;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _platformVersion = platformVersion;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//è°ƒç”¨å®ç°.showToast å³åŸç”Ÿä»£ç çš„çš„æ–¹æ³•å call.method, test toast å³åŸç”Ÿä»£ç çš„å‚æ•°call.argument("message")</span></span><br><span class="line">    FlutterToast.showToast(<span class="string">"test toast"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MaterialApp(</span><br><span class="line">      home: <span class="keyword">new</span> Scaffold(</span><br><span class="line">        appBar: <span class="keyword">new</span> AppBar(</span><br><span class="line">          title: <span class="keyword">const</span> Text(<span class="string">'Plugin example app'</span>),</span><br><span class="line">        ),</span><br><span class="line">        body: <span class="keyword">new</span> Center(</span><br><span class="line">          child: <span class="keyword">new</span> Text(<span class="string">'Running on: <span class="subst">$_platformVersion</span>\n'</span>),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="iOS-ç«¯å®ç°-ç”±äºè‡ªå·±ä¸ä¼š-Object-C-æ‰€ä»¥ä»£ç å¾ˆç®€å•-å¾ˆå®¹æ˜“çœ‹æ‡‚"><a href="#iOS-ç«¯å®ç°-ç”±äºè‡ªå·±ä¸ä¼š-Object-C-æ‰€ä»¥ä»£ç å¾ˆç®€å•-å¾ˆå®¹æ˜“çœ‹æ‡‚" class="headerlink" title="iOS ç«¯å®ç° ç”±äºè‡ªå·±ä¸ä¼š Object-C æ‰€ä»¥ä»£ç å¾ˆç®€å•,å¾ˆå®¹æ˜“çœ‹æ‡‚"></a>iOS ç«¯å®ç° ç”±äºè‡ªå·±ä¸ä¼š Object-C æ‰€ä»¥ä»£ç å¾ˆç®€å•,å¾ˆå®¹æ˜“çœ‹æ‡‚</h5><figure class="highlight objc"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FlutterToastPlugin.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FlutterToastPlugin</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)registerWithRegistrar:(<span class="built_in">NSObject</span>&lt;FlutterPluginRegistrar&gt;*)registrar &#123;</span><br><span class="line">  FlutterMethodChannel* channel = [FlutterMethodChannel</span><br><span class="line">      methodChannelWithName:<span class="string">@"flutter_toast"</span></span><br><span class="line">            binaryMessenger:[registrar messenger]];</span><br><span class="line">  FlutterToastPlugin* instance = [[FlutterToastPlugin alloc] init];</span><br><span class="line">  [registrar addMethodCallDelegate:instance channel:channel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)handleMethodCall:(FlutterMethodCall*)call result:(FlutterResult)result &#123;</span><br><span class="line">  <span class="keyword">if</span> ([<span class="string">@"getPlatformVersion"</span> isEqualToString:call.method]) &#123;</span><br><span class="line">    <span class="comment">//é»˜è®¤å®ç°</span></span><br><span class="line">    result([<span class="string">@"iOS "</span> stringByAppendingString:[[<span class="built_in">UIDevice</span> currentDevice] systemVersion]]);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>([<span class="string">@"showToast"</span> isEqualToString:call.method]) &#123;<span class="comment">//åˆ¤æ–­è°ƒç”¨æ–¹æ³•å</span></span><br><span class="line">    <span class="comment">//è·å–è°ƒç”¨å‚æ•°</span></span><br><span class="line">    <span class="built_in">NSString</span> *msg = call.arguments[<span class="string">@"message"</span>];</span><br><span class="line">    <span class="built_in">UIAlertView</span> *alert = [[<span class="built_in">UIAlertView</span> alloc]</span><br><span class="line">                                 initWithTitle:<span class="literal">nil</span></span><br><span class="line">                                       message:msg</span><br><span class="line">                                      delegate:<span class="literal">nil</span></span><br><span class="line">                             cancelButtonTitle:<span class="literal">nil</span></span><br><span class="line">                             otherButtonTitles:<span class="literal">nil</span>, <span class="literal">nil</span>];</span><br><span class="line">    [alert show];</span><br><span class="line">    <span class="keyword">double</span> duration = <span class="number">0.5</span>;</span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [alert dismissWithClickedButtonIndex:<span class="number">0</span> animated:<span class="literal">YES</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span>([<span class="string">@"showLongToast"</span> isEqualToString:call.method]) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *msg = call.arguments[<span class="string">@"message"</span>];</span><br><span class="line">    <span class="built_in">UIAlertView</span> *alert = [[<span class="built_in">UIAlertView</span> alloc]</span><br><span class="line">                                 initWithTitle:<span class="literal">nil</span></span><br><span class="line">                                       message:msg</span><br><span class="line">                                      delegate:<span class="literal">nil</span></span><br><span class="line">                             cancelButtonTitle:<span class="literal">nil</span></span><br><span class="line">                             otherButtonTitles:<span class="literal">nil</span>, <span class="literal">nil</span>];</span><br><span class="line">    [alert show];</span><br><span class="line">    <span class="keyword">double</span> duration = <span class="number">1</span>;</span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(duration * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [alert dismissWithClickedButtonIndex:<span class="number">0</span> animated:<span class="literal">YES</span>];</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">       result(FlutterMethodNotImplemented);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>è‹¥ç¬¬ä¸€æ¬¡æŠŠ package è¿è¡Œåœ¨ iOS ç«¯ä¼šæç¤ºé”™è¯¯,æŒ‰ç…§æç¤ºä¾æ¬¡æ‰§è¡Œ <code>brew install cocoapods</code> å’Œ <code>pod setup</code> ,ç­‰å¾…å®‰è£…å®Œæˆå,å†æ¬¡è¿è¡Œå°±å¯ä»¥åœ¨æ¨¡æ‹Ÿå™¨æŸ¥çœ‹æ•ˆæœäº†.</p>
<h5 id="Flutter-æ¡¥æ¥ä»£ç å®ç°"><a href="#Flutter-æ¡¥æ¥ä»£ç å®ç°" class="headerlink" title="Flutter æ¡¥æ¥ä»£ç å®ç°"></a>Flutter æ¡¥æ¥ä»£ç å®ç°</h5> <figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">import</span> <span class="string">'dart:async'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/services.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlutterToast</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">const</span> MethodChannel _channel = <span class="keyword">const</span> MethodChannel(<span class="string">'flutter_toast'</span>);</span><br><span class="line">  <span class="comment">//é»˜è®¤å®ç°</span></span><br><span class="line">  <span class="keyword">static</span> Future&lt;<span class="built_in">String</span>&gt; <span class="keyword">get</span> platformVersion <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">String</span> version = <span class="keyword">await</span> _channel.invokeMethod(<span class="string">'getPlatformVersion'</span>);</span><br><span class="line">    <span class="keyword">return</span> version;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//å¯¹å¤–æä¾›è°ƒç”¨çš„æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> showToast(<span class="built_in">String</span> message) &#123;</span><br><span class="line">      <span class="comment">//showToast å³è°ƒç”¨åŸç”Ÿçš„æ–¹æ³•å, message å³è°ƒç”¨åŸç”Ÿçš„å‚æ•°å,å¿…é¡»è¦ä¸€è‡´å¦åˆ™æ— æ³•è°ƒç”¨</span></span><br><span class="line">    _channel.invokeMethod(<span class="string">"showToast"</span>, &#123;</span><br><span class="line">      <span class="string">"message"</span>: message,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">void</span> showLongToast(<span class="built_in">String</span> message) &#123;</span><br><span class="line">    _channel.invokeMethod(<span class="string">"showLongToast"</span>, &#123;</span><br><span class="line">      <span class="string">"message"</span>: message,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>Flutter æ’ä»¶ç¼–å†™é€»è¾‘è¿˜æ˜¯å¾ˆç®€å•,å…·ä½“çš„å®ç°æ–¹å¼è¿˜æ²¡æœ‰å…·ä½“ç ”ç©¶,æœ‰æ—¶é—´éœ€è¦å¤§æ¦‚ç†è§£åŸç†,è¿™æ ·ä¹Ÿåˆä¾¿äºç¼–ç¨‹æ€ç»´çš„å¼€æ‹“.é€šè¿‡è¿™ä¸ª demo,ç†Ÿæ‚‰äº†æ’ä»¶ç¼–å†™æ–¹å¼,å¯¹äºä¸€äº› Flutter ä¸æ”¯æŒçš„åŠŸèƒ½å°±å¯ä»¥è®©åŸç”Ÿå®ç°,æ¯”å¦‚åµŒå…¥WebViewå°±å¯ä»¥é€šè¿‡åŸç”Ÿæä¾›å®ç°.<br><a href="https://github.com/Thewhitelight/DouBanMovie">GitHubåœ°å€</a><br><a href="https://flutterstudio.app/" target="_blank" rel="noopener">åœ¨çº¿ç¼–å†™Flutterå®æ—¶é¢„è§ˆ</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title>åšå®¢è‡ªå®šä¹‰åŸŸåæ”¯æŒ HTTPS</title>
    <url>/2018/08/30/github-page-https/</url>
    <content><![CDATA[<p>æœ€æ—©çš„åšå®¢ä½¿ç”¨ Jekyll æ¨¡ç‰ˆ,ä½†æ˜¯æ„Ÿè§‰å®¡ç¾ç–²åŠ³,æ ·å¼å¤ªä¸‘,æ‰€ä»¥è¿ç§»åˆ°äº† Hexo æ¨¡ç‰ˆ,ç›®å‰å¯¹è¿™ä¸ªä¸»é¢˜å¾ˆæ»¡æ„.ä»Šå¹´ GihHub å¼€å§‹æ”¯æŒ https åŠ å¯†è®¿é—®åšå®¢äº†,æ‰€ä»¥æŠ½ç©ºæŠ˜è…¾äº†ä¸‹è‡ªå·±çš„åŸŸåè§£æ.<br><a id="more"></a></p>
<h4 id="GitHubé…ç½®"><a href="#GitHubé…ç½®" class="headerlink" title="GitHubé…ç½®"></a>GitHubé…ç½®</h4><p>ç½‘ä¸Šæ–¹å¼è®²è§£å¾ˆå¤šå…¶å®ä¹Ÿå¾ˆç®€å•,åœ¨åšå®¢ä»“åº“çš„è®¾ç½®é‡Œä¸‹æ‹‰æ‰¾åˆ° Enforce HTTPS å‹¾é€‰ä¸Š,å¹¶ä¸”è¾“å…¥æ¡†é‡Œè¾“å…¥è‡ªå·±è´­ä¹°çš„åŸŸå,ä¸éœ€è¦<code>http://</code>æˆ–è€…<code>https://</code>,ç‚¹å‡» save åå°±å¯ä»¥ç­‰å¾…äº†ç”Ÿæˆé…ç½®å¥½äº†,ç¬¬ä¸€æ¬¡æœ‰ç‚¹æ…¢éœ€è¦ç‚¹æ—¶é—´.å¦‚æœç¬¬ä¸€æ¬¡è®¾ç½®è‡ªå®šä¹‰åŸŸå,éœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ–°å»º CNAME æ–‡ä»¶,é‡Œé¢åªéœ€è¦è¾“å…¥è‡ªå·±çš„åŸŸåä¾‹å¦‚<code>libery.cn</code>å³å¯.<br><img src="http://7qndg9.com1.z0.glb.clouddn.com/github_add_https.png" alt="githubæ·»åŠ https"></p>
<h4 id="è§£æé…ç½®"><a href="#è§£æé…ç½®" class="headerlink" title="è§£æé…ç½®"></a>è§£æé…ç½®</h4><p>æˆ‘çš„åŸŸåæ˜¯åœ¨ä¸‡ç½‘è´­ä¹°,æ‰€ä»¥è§£æä¹Ÿåœ¨é˜¿é‡Œäº‘é‡Œ,åŸæ¥çš„è§£æä½¿ç”¨ç±»å‹æ˜¯ A å¹¶ä¸”è®°å½•å€¼æ˜¯ ip åœ°å€,æ›¿æ¢ä¸º HTTPS åæµè§ˆå™¨è¾“å…¥åŸŸåä¸€ç›´æŠ¥é”™,æ‰€ä»¥æ€€ç–‘æ˜¯è§£æé—®é¢˜,ç„¶åå°†è®°å½•ç±»å‹æ¢ä¸º CNAME,è®°å½•å€¼æ”¹ä¸ºåšå®¢åˆå§‹åç§°ä¹Ÿå°±ä»“åº“åç§°,ç‚¹å‡»ç¡®å®š.å†æ¬¡åˆ·æ–°åšå®¢å°±æ˜¯ HTTPS ç±»å‹äº†.åœ¨ Chrome é‡Œçœ‹ç€ç»¿è‰²çš„æ ‡è®°,å¾ˆèˆ’æœäº†.<br><img src="http://7qndg9.com1.z0.glb.clouddn.com/github_https_cname.png" alt="åŸŸåè§£æ"></p>
<h4 id="Tip"><a href="#Tip" class="headerlink" title="Tip"></a>Tip</h4><p>å¦‚æœé…ç½®åè¿˜æ˜¯æ— æ³•è®¿é—®,ç»¿è‰²çš„æç¤ºæ¡†ä¼šå˜æˆçº¢è‰²,é‡Œé¢æœ‰ç›¸åº”çš„æç¤º,å¯ä»¥å‚è€ƒä¸‹è§£å†³ç›¸åº”é—®é¢˜.<br><img src="http://7qndg9.com1.z0.glb.clouddn.com/github_https_tip.png" alt="å¸®åŠ©"></p>
<h4 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h4><p>åšå®¢çš„å›¾åºŠç”¨çš„æ˜¯ä¸ƒç‰›äº‘,ä½†æ˜¯ä¸ƒç‰›çš„å›¾ç‰‡å¤–é“¾æ˜¯ http,å¯¼è‡´åšæ–‡çš„è¿æ¥æ˜¯ https æ— æ³•è¯†åˆ«,å¦‚æœè¦å‡çº§ä¸º https,åŸŸåå¿…é¡»è¦åœ¨å›½å†…å¤‡æ¡ˆ,å¾ˆæ˜¯æ¶å¿ƒ.æ‰€ä»¥å°†å›¾åºŠè¿ç§»åˆ°è…¾è®¯äº‘,å¹¶ä¸”è…¾è®¯äº‘æä¾›ä¸Šä¼ çš„å®¢æˆ·ç«¯,æ–¹ä¾¿æ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½,è…¾è®¯äº‘çš„å­˜å‚¨æœåŠ¡åœ¨ä¸€å®šé™é¢å†…æ˜¯å…è´¹çš„,å¯¹äºä¸ªäººåšå®¢æ¥è¯´æ˜¯å®Œå…¨å¤Ÿç”¨çš„,ä¸éœ€è¦é¢å¤–çš„ä»˜è´¹å³å¯æ»¡è¶³.</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title>Fultter ä½“éªŒä¸€(è±†ç“£ç”µå½± Api ç®€å•ä½¿ç”¨)</title>
    <url>/2018/08/26/flutter-douban/</url>
    <content><![CDATA[<h4 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h4><p>Flutter æ˜¯ Google å¼€å‘çš„ä¸€å¥—å…¨æ–°çš„è·¨å¹³å°ã€å¼€æºUIæ¡†æ¶ï¼Œæ”¯æŒ iOSã€Android ç³»ç»Ÿå¼€å‘ï¼Œå¹¶ä¸”æ˜¯æœªæ¥æ–°æ“ä½œç³»ç»Ÿ Fuchsia çš„é»˜è®¤å¼€å‘å¥—ä»¶ã€‚ç‰©è”ç½‘æ˜¯æœªæ¥è¶‹åŠ¿,æ‰€ä»¥è¿˜æ˜¯å¾ˆçœ‹å¥½ Flutter é¡¹ç›®,çœ‹åˆ°è·¨å¹³å°å°±æ„Ÿè§‰å¾ˆç†Ÿæ‚‰äº†,æœ‰ Cordovaã€ReactNativeã€Weex ç­‰å‰è¾ˆ,ä½†æ˜¯Flutterçš„æ€è·¯ä¸ä¸Šè¿°çš„æ¡†æ¶æœ‰æœ¬è´¨å´åˆ«.Flutter ä½¿ç”¨å…¨æ–°çš„ Dart è¯­è¨€å¼€å‘,åˆ†åˆ«åœ¨ iOSã€Android å®ç°äº†å„è‡ªçš„ UI æ§ä»¶ã€æ¸²æŸ“é€»è¾‘,æ‰€ä»¥ç›¸æ¯”å…¶ä»–æ¡†æ¶å…¶æ€§èƒ½æ›´æ¥è¿‘åŸç”Ÿ,ç¾å›¢çš„å®é™…å¯¹æ¯”ä¹Ÿç¡®å®è¯´æ˜äº†è¿™ä¸ªé—®é¢˜.è®°å¾—å‰ä¸¤å¹´ Google æ¨å‡ºè¿‡åŸºäº Dart è¯­è¨€çš„ Sky é¡¹ç›®,å½“æ—¶å†™è¿‡ Demo ä½“éªŒäº†ä¸‹,ç„¶è€Œç¡®å®æ˜™èŠ±ä¸€ç°å†ä¹Ÿæ²¡æœ‰äººè®¨è®ºäº†,ä¸è¿‡ç°åœ¨æˆ‘ä¼°è®¡æ˜¯ Sky é¡¹ç›®å­µåŒ–å‡ºäº† Flutter é¡¹ç›®.</p>
<a id="more"></a>
<p>Dart è¯­è¨€çš„ä½¿ç”¨ç›¸å¯¹ Java å¼€å‘è€…è¿˜æ˜¯å¾ˆå‹å¥½çš„,çœ‹çœ‹å®˜æ–¹çš„ Demo å’Œ Api å°±å¯ä»¥ä¸Šæ‰‹å¼€å‘äº†,æ—¢æœ‰é™æ€è¯­è¨€çš„ç‰¹æ€§ä¹Ÿæœ‰åŠ¨æ€è¯­è¨€çš„ç‰¹æ€§,å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒé¡¹ç›®é‡æ„äº†.Dart çš„é¡µé¢åˆ·æ–°æœ‰ç‚¹åƒ ReactNative æ”¹å˜ State åˆ™é¡µé¢è‡ªåŠ¨å¯¹æ¯”åˆ·æ–°.ç›¸åŒé¡µé¢æ•ˆæœç›¸æ¯”åŸç”Ÿå¯ä»¥å°‘å†™å¾ˆå¤šä»£ç ,å¹¶ä¸”å®˜æ–¹æ”¯æŒMaterial Design ç»„ä»¶,å¾ˆå¤šäº¤äº’é€»è¾‘å·²ç»é»˜è®¤å®ç°,å¹¶ä¸”ç¤¾åŒºä¹Ÿæœ‰å¾ˆå¤šå¼€æºç»„ä»¶ä¾›å¼€å‘ç€è°ƒç”¨åŸç”ŸåŠŸèƒ½.Dart æ”¯æŒ Hot Reload åŠŸèƒ½,å¯¹äºå¼€å‘ç¡®å®æ–¹ä¾¿å¾ˆå¤š,ç¾å›¢æ–‡ç« ä¸­ä»‹ç»äº†çƒ­åˆ·æ–°çš„é™åˆ¶,ä½†æ˜¯åœ¨æˆ‘å®é™…ä½¿ç”¨çš„æ—¶å€™è¿˜æ˜¯å‘ç”Ÿäº†æ„æƒ³ä¸åˆ°æƒ…å†µ,æˆ‘æ”¹å˜å˜é‡ç±»å‹,ä½†æ˜¯ä¿å­˜åæ²¡æœ‰åˆ·æ–°çš„é—®é¢˜,å¯¼è‡´æˆ‘ä»¥ä¸ºæ˜¯ä»£ç å†™çš„æœ‰ç‚¹é—®é¢˜æ”¹äº†å‡ æ¬¡,æƒ³åˆ°è¯•ç€é‡æ–°è¿è¡Œä¸‹,å‘ç°å°±æ­£å¸¸è¯†åˆ«äº†.</p>
<h4 id="Flutter-å®è·µ"><a href="#Flutter-å®è·µ" class="headerlink" title="Flutter å®è·µ"></a>Flutter å®è·µ</h4><p>Flutter çš„å®‰è£…å‚è€ƒä¸­æ–‡ç½‘ä¸€æ­¥ä¸€æ­¥èµ°ä¸‹å»,ä½¿ç”¨å›½å†…é•œåƒå‡ ä¹ä¸ä¼šé‡åˆ°ä»€ä¹ˆå‘,Android Studio å¯¹å…¶å¼€å‘æ”¯æŒä¹Ÿååˆ†å‹å¥½,åªéœ€è¦ä¸‹è½½ Flutter å’Œ Dart æ’ä»¶åå˜å¯ä»¥ç¼–å†™ä»£ç äº†.<br>ä½¿ç”¨è±†ç“£ api,å®ç°ä¸€ä¸ªå¯ä»¥æŸ¥çœ‹æœ€è¿‘ä¸Šæ˜ ã€top250 ç”µå½±çš„ç®€å•App<img src="http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_yaml.png" alt="Flutter åŒ…ç®¡ç†">ä¸Šå›¾æ˜¯æˆ‘é¡¹ç›®çš„ä¾èµ–åŒ…,å…¶ä¸­ flutter_toast æ˜¯æœ¬åœ° Flutter package æ¡¥æ¥åŸç”Ÿçš„ Toast,ç›®å‰è¿˜æ²¡æœ‰é€‚é… iOS,æ‰€ä»¥iOSç«¯ä¸èƒ½è¿è¡Œæ­¤é¡¹ç›®.Dio æ˜¯ä¸€ä¸ªç½‘ç»œè¯·æ±‚æ¡†æ¶,æ–¹ä¾¿æ·»åŠ  header intercept ç­‰.cached_network_image æ˜¯ä¸€ä¸ªå›¾ç‰‡åŠ è½½æ¡†æ¶,å¯ä»¥è®¾ç½®ç¼“å­˜ã€åŠ è½½åŠ¨ç”»ä¹‹ç±».<br><img src="http://7qndg9.com1.z0.glb.clouddn.com/flutter_douban_dir.png" alt="é¡¹ç›®ç›®å½•ç»“æ„">è¿™æ˜¯é¡¹ç›®çš„ç›®å½•ç»“æ„,main.dartå³é¡¹ç›®å…¥å£.<br><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¯¼åŒ…</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:dou_ban_movie/douban/douban_hot_movies.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:dou_ban_movie/douban/douban_top_movies.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¨‹åºå…¥å£</span></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(<span class="keyword">new</span> MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">      <span class="comment">//ä½¿ç”¨ Material ç»„ä»¶,æ„å»ºç¬¦åˆ Material Design è§„èŒƒçš„ app</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MaterialApp(</span><br><span class="line">      title: <span class="string">'Welcome to Flutter'</span>,</span><br><span class="line">      <span class="comment">//Android ä¸­style.xmlä¸­çš„å±æ€§</span></span><br><span class="line">      theme: <span class="keyword">new</span> ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: <span class="keyword">new</span> MyHomePage(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyHomePageState createState() =&gt; <span class="keyword">new</span> _MyHomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> mCurrentIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(<span class="string">"Douban Movies"</span>),</span><br><span class="line">      ),</span><br><span class="line">      bottomNavigationBar: <span class="keyword">new</span> BottomNavigationBar(</span><br><span class="line">        items: [</span><br><span class="line">          <span class="keyword">new</span> BottomNavigationBarItem(</span><br><span class="line">              icon: <span class="keyword">new</span> Icon(Icons.all_inclusive), title: <span class="keyword">new</span> Text(<span class="string">'HOT'</span>)),</span><br><span class="line">          <span class="keyword">new</span> BottomNavigationBarItem(</span><br><span class="line">              icon: <span class="keyword">new</span> Icon(Icons.favorite), title: <span class="keyword">new</span> Text(<span class="string">'TOP'</span>))</span><br><span class="line">        ],</span><br><span class="line">        currentIndex: mCurrentIndex,</span><br><span class="line">        onTap: (index) &#123;</span><br><span class="line">            <span class="comment">//ç‚¹å‡»åˆ·æ–°tab</span></span><br><span class="line">          setState(() &#123;</span><br><span class="line">            mCurrentIndex = index;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">      ),</span><br><span class="line">      body: _setupCurrentPage(mCurrentIndex),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Widget _setupCurrentPage(<span class="built_in">int</span> mCurrentIndex) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (mCurrentIndex) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HotMoviesPage();</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TopMoviesPage();</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HotMoviesPage();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ˜¯é¦–é¡µçš„ Dart ä»£ç ,ä»–ä¸åŒäº Android åŸç”Ÿå°†é¡µé¢æ ·å¼å’Œæ§åˆ¶ä»£ç åˆ†ç¦»çš„é€»è¾‘,ä»–æ˜¯å…¨éƒ½æ‰å’Œåœ¨ä¸€èµ·,æ›´å¤šçš„é€šè¿‡ç»„ä»¶çš„ç»„åˆæ¥å®ç°ä»£ç çš„å¤ç”¨.å¹¶ä¸”ä»£ç é‡å¤§å¹…å‡å°‘.å¯ä»¥åŠ å¿«å¼€å‘é€Ÿåº¦.</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>Flutterå¯¹äºæå‡å¼€å‘æ•ˆç‡ç¡®å®æœ‰ä¸€å®šå¸®åŠ©,å¹¶ä¸”æœ‰ Google åŠ æŒ,å‰æ™¯æ„Ÿè§‰ä¹Ÿå¾ˆä¸é”™,æœ‰æ–°ç³»ç»Ÿå¯¹å…¶çš„æ”¯æŒ,åº”è¯¥æ¯”å…¶ä»–è·¨å¹³å°æ–¹æ¡ˆæ›´æœ‰ä¼˜åŠ¿,ä½†æ˜¯ç›®å‰è€Œè¨€è¿˜æ˜¯åœ¨æˆé•¿æœŸ,è¿˜æ˜¯ä¸å¤Ÿç¨³å®š.è·¨å¹³å°å¼€å‘ç¡®å®å¾ˆå¸å¼•äºº,æ„Ÿè§‰ä¸€ä¸ªå‰ç«¯å¯ä»¥æ‰›èµ·å¾ˆå¤šåŸç”Ÿå¼€å‘çš„ä»»åŠ¡,å¯¹äº mvp é˜¶æ®µçš„çš„é¡¹ç›®ç¡®å®å¾ˆé€‚åˆ,ä½†æ˜¯å¯¹äºä¸­å¤§å‹é¡¹ç›®å…¨éƒ¨ä½¿ç”¨è¿™ç§æŠ€æœ¯,å…¶ä¸­çš„é£é™©å¾ˆå¤§,å‰æ–¹å„ç§å‘ç­‰ç€è¶Ÿè¿‡å»,æœ€åå‘ç°è¿˜æ˜¯å¾—èµ°æ··åˆå¼€å‘çš„è·¯å­.æ‰€ä»¥æ‰“ç®—è¯•è¯•å°† Flutter ä½œä¸º module æ•´åˆè¿›åŸç”Ÿé‡Œé¢,è¿™æ ·æ›´åŠ çµæ´».åœ¨åŸæ¥ReactNativeå®è·µä¸­ä¹Ÿè¯•è¿‡è¿™æ ·çš„åšæ³•,å‘ç°è¿˜æ˜¯å¾ˆä¸é”™,å¯¹äºä¸€äº›ç®€å•çš„åŠŸèƒ½ç”¨æ­¤å¼€å‘å¾ˆæ–¹ä¾¿,å¯¹äºå¤æ‚çš„åŠŸèƒ½å¯ä»¥ç›´æ¥åˆ‡æ¢åˆ°åŸç”Ÿå»åš.</p>
<h4 id="æˆªå›¾"><a href="#æˆªå›¾" class="headerlink" title="æˆªå›¾"></a>æˆªå›¾</h4><p><img src="http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225527.jpg" alt="é¦–é¡µ"><br><img src="http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225535.jpg" alt="è¯¦æƒ…é¡µ"><br><img src="http://7qndg9.com1.z0.glb.clouddn.com/Screenshot_20180826-225548.jpg" alt="æŸ¥çœ‹å›¾ç‰‡"></p>
<h4 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h4><p><a href="https://github.com/Thewhitelight/DouBanMovie">Github åœ°å€</a></p>
<h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="https://flutter-io.cn/" target="_blank" rel="noopener">Flutter ä¸­å›½å®˜ç½‘</a><br><a href="https://flutterchina.club/" target="_blank" rel="noopener">Flutter ä¸­æ–‡ç½‘</a><br><a href="https://mp.weixin.qq.com/s/cJjKZCqc8UuzvEtxK1BJCw" target="_blank" rel="noopener">Flutter çš„åŸç†åŠç¾å›¢çš„å®è·µ</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Flutter</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»£å¸çš„æœ€ä½³ç»„åˆ</title>
    <url>/2018/08/10/coin-best-combination/</url>
    <content><![CDATA[<p>ä¸Šä¸€ç¯‡å†™äº†å…³äºä¸‹å•ä¼˜æƒ çš„è®¡ç®—,é¡¹ç›®è¿­ä»£äº†å‡ æœŸ,äº§å“åˆæå‡ºè¦åœ¨ä¸‹å•åæ”¯ä»˜å‰è¿˜è¦æœ‰æ–°çš„ä¼˜æƒ æªæ–½,ä»¥ä¸€ç§ä¸åŒé¢å€¼çš„ä»£å¸å½¢å¼.ä¹°å®¶å¯ä»¥é€‰æ‹©ä¸åŒé¢å€¼çš„ç»„åˆå‡å…æ”¯ä»˜é‡‘é¢.</p>
<h4 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h4><p>å½“ç”¨æˆ·ä¸‹å•åè¿›å…¥æ”¯ä»˜é¡µé¢,ç³»ç»Ÿä¼˜å…ˆè®¡ç®—å‡ºæœ€åˆ’ç®—çš„ç»„åˆ,ä¾›ç»™ç”¨æˆ·é€‰æ‹©.æ•…å®é™…ä»˜æ¬¾é‡‘é¢=ä¸‹å•é‡‘é¢-ä»£å¸ç»„åˆå€¼,ä»£å¸ä¸é™æ•°é‡,æ‰€ä»¥ç»„åˆä¼šæœ‰å¾ˆå¤šç»„åˆ.ä¾‹å¦‚æœ‰10,10,45,50,100çš„é¢å€¼çš„ä»£å¸,ä¸‹å•é‡‘é¢ä¸º75,æœ€ä¼˜ç»„åˆä¸º10,10,50.</p>
<a id="more"></a>
<h4 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h4><h5 id="å…¨æ’åˆ—æ–¹å¼"><a href="#å…¨æ’åˆ—æ–¹å¼" class="headerlink" title="å…¨æ’åˆ—æ–¹å¼"></a>å…¨æ’åˆ—æ–¹å¼</h5><p>æ—¢ç„¶æ˜¯å¤šç§ç»„åˆ,å½“æˆ‘ä»¬ä½¿ç”¨è¿­ä»£æ’åˆ—å‡ºå…¨éƒ¨ç»„åˆ,ç„¶åæ‰¾å‡ºæœ€ä¼˜çš„è§£,ä½†æ˜¯è¿™æ ·çš„æš´åŠ›ç©·ä¸¾æ³•,æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦éƒ½æ˜¯å¾ˆå¤§,ç§»åŠ¨ç«¯æ€§èƒ½æœ¬èº«å°±è¾ƒå¼±,è¿™æ ·è®¡ç®—é‡å’Œå­˜å‚¨æ— æ³•è´Ÿæ‹…,å¹¶ä¸”è®¡ç®—æ—¶é—´é•¿,æ²¡æœ‰ç°å®æ„ä¹‰.åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­å½“æœ‰24ä¸ªæ•°å­—æ—¶, fullCombination æ–¹æ³•è€—æ—¶å¹³å‡15så·¦å³,å¹¶ä¸”è¿™æ˜¯åœ¨ PC æ‰§è¡Œçš„ç»“æœ.<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Coin&gt;&gt; fullCombination(List&lt;Coin&gt; lstSource) &#123;</span><br><span class="line">    <span class="keyword">int</span> n = lstSource.size();</span><br><span class="line">    <span class="keyword">int</span> max = <span class="number">1</span> &lt;&lt; n;<span class="comment">//2çš„næ¬¡æ–¹</span></span><br><span class="line">    List&lt;List&lt;Coin&gt;&gt; lstResult = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; max; i++) &#123;</span><br><span class="line">        List&lt;Coin&gt; lstTemp = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="comment">//ié™¤ä»¥2çš„jæ¬¡æ–¹</span></span><br><span class="line">            <span class="keyword">if</span> ((i &gt;&gt; j &amp; <span class="number">1</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                lstTemp.add(lstSource.get(j));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        lstResult.add(lstTemp);</span><br><span class="line">    &#125;</span><br><span class="line">    lstResult.remove(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> lstResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h5 id="å›æº¯ç®—æ³•"><a href="#å›æº¯ç®—æ³•" class="headerlink" title="å›æº¯ç®—æ³•"></a>å›æº¯ç®—æ³•</h5><p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªé—®é¢˜æŠ½è±¡æˆ:ç»™å®šä¸€ä¸ªæ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆ.candidates ä¸­çš„æ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ä¸€æ¬¡.è¿™ä¸ªå°±æ˜¯ LeetCode ä¸­çš„ç»„åˆæ€»å’ŒIIçš„é¢˜ç›®,æˆ‘ä»¬çš„éœ€æ±‚å®Œå…¨ä¸€æ ·,åªéœ€è¦å°è°ƒæ•´å°±å¯ä»¥ä½¿ç”¨,å¹¶ä¸”åœ¨æ—¶é—´å¤æ‚åº¦O(n!)å†…,å®é™…åº”ç”¨ä¸­å¯å®Œå…¨æ¥å—.ä½¿ç”¨ä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹,å¾—åˆ°æœ€åçš„æœ€ä¼˜ç»„åˆåªéœ€è¦20mså·¦å³.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Coin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é¢å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> denomination;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æœ€ä¼˜ç»„åˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target ä¸‹å•é‡‘é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> coins  æ‰€æœ‰ä»£å¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æœ€ä¼˜ç»„åˆä¸­çš„ä»£å¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Coin&gt; <span class="title">getBestCombination</span><span class="params">(<span class="keyword">double</span> target, List&lt;Coin&gt; coins)</span> </span>&#123;</span><br><span class="line">        List&lt;Coin&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">        List&lt;ArrayList&lt;Coin&gt;&gt; combinations = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//æ‰€æœ‰ä»£å¸ç»„åˆ</span></span><br><span class="line">        combinations = combinationSum(coins, target, combinations);</span><br><span class="line"></span><br><span class="line">        TreeMap&lt;Integer, List&lt;Coin&gt;&gt; lastResult = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//æ ¹æ®ç»„åˆä¸­çš„ä»£å¸ è®¡ç®—å‡ºæ€»å’ŒæŒ‰å‡åºæ’åˆ—</span></span><br><span class="line">        <span class="keyword">for</span> (List&lt;Coin&gt; arrays : combinations) &#123;</span><br><span class="line">            <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (Coin c : arrays) &#123;</span><br><span class="line">                temp += c.denomination;</span><br><span class="line">            &#125;</span><br><span class="line">            lastResult.put(temp, arrays);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è·å–æœ€åä¸€ä¸ªç»„åˆå³ä¸ºæœ€ä¼˜ç»„åˆ</span></span><br><span class="line">        result.addAll(lastResult.lastEntry().getValue());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;ArrayList&lt;Coin&gt;&gt; combinationSum(List&lt;Coin&gt; coins,</span><br><span class="line">                                                 <span class="keyword">double</span> target,</span><br><span class="line">                                                 List&lt;ArrayList&lt;Coin&gt;&gt; result) &#123;</span><br><span class="line">        List&lt;ArrayList&lt;Coin&gt;&gt; res = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (coins == <span class="keyword">null</span> || coins.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">        List&lt;Coin&gt; realCoins = <span class="keyword">new</span> ArrayList&lt;&gt;(coins.size());</span><br><span class="line">        <span class="keyword">for</span> (Coin c : coins) &#123;</span><br><span class="line">            <span class="keyword">if</span> (c.denomination &lt;= target) &#123;</span><br><span class="line">                realCoins.add(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.sort(realCoins, <span class="keyword">new</span> Comparator&lt;Coin&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Coin c1, Coin c2)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> Double.compare(c1.denomination, c2.denomination);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> dfs(realCoins, <span class="number">0</span>, target, <span class="keyword">new</span> ArrayList&lt;Coin&gt;(<span class="number">10</span>), res, result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;ArrayList&lt;Coin&gt;&gt; dfs(List&lt;Coin&gt; candidates,</span><br><span class="line">                                      <span class="keyword">int</span> startIndex,</span><br><span class="line">                                      <span class="keyword">double</span> target,</span><br><span class="line">                                      List&lt;Coin&gt; combination,</span><br><span class="line">                                      List&lt;ArrayList&lt;Coin&gt;&gt; res, List&lt;ArrayList&lt;Coin&gt;&gt; result) &#123;</span><br><span class="line">        <span class="comment">//å­˜å‚¨æ‰€æœ‰ç»„åˆç»“æœ</span></span><br><span class="line">        result.add(<span class="keyword">new</span> ArrayList&lt;&gt;(combination));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (target == <span class="number">0</span>) &#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> ArrayList&lt;&gt;(combination));</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = startIndex, size = candidates.size(); i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i != startIndex &amp;&amp; candidates.get(i).denomination == candidates.get(i - <span class="number">1</span>).denomination) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (target &lt; candidates.get(i).denomination) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            combination.add(candidates.get(i));</span><br><span class="line">            dfs(candidates, i + <span class="number">1</span>, target - candidates.get(i).denomination, combination, res, result);</span><br><span class="line">            combination.remove(combination.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/CoinTest.java">é¡¹ç›®åœ°å€</a> åŒ…å«ä¸¤ç§æ–¹æ³•çš„æ‰€æœ‰ä»£ç å’Œæµ‹è¯•ç”¨ä¾‹.</p>
<h4 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h4><p><a href="https://leetcode-cn.com/problems/combination-sum-ii/description/" target="_blank" rel="noopener">ç»„åˆæ€»å’Œ II LeetCode</a><br><a href="https://blog.csdn.net/James_T_Kirk/article/details/76895209" target="_blank" rel="noopener">æµ…è°ˆå›æº¯ä¸æ·±åº¦ä¼˜å…ˆæœç´¢</a><br><a href="https://www.jiuzhang.com/solution/combination-sum-ii/" target="_blank" rel="noopener">ç»„åˆæ€»å’Œ II è§£æ³•</a></p>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>æ ¹æ®è®¢å•é‡‘é¢åŒ¹é…æœ€åˆ’ç®—çš„ä¼˜æƒ åˆ¸ä¸å®šé‡‘</title>
    <url>/2018/08/09/best-price-calculation/</url>
    <content><![CDATA[<p>åœ¨ç”µå•†å¹³å°é€šå¸¸ä¼šæœ‰ä¸€äº›ä¼˜æƒ æªæ–½,æ¯”å¦‚ä»¥ä¼˜æƒ åˆ¸ã€å®šé‡‘æˆ–è€…ä»£å¸ä¹‹ç±»çš„å½¢å¼åœ¨ä¸‹å•æ—¶ç»™äºˆç”¨æˆ·ç›´è§‚çš„å‡å…é‡‘é¢.ä¸€èˆ¬ç”¨æˆ·é¢†å–åº—é“ºä¼˜æƒ åˆ¸,ä¼˜æƒ åˆ¸æœ‰ä¸åŒçš„ä½¿ç”¨æ¡ä»¶,æ»¡è¶³æ¡ä»¶æ—¶æ–¹å¯ä½¿ç”¨.å®šé‡‘ä¸ºç”¨æˆ·è‡ªå·±å‘åº—é“ºè´­ä¹°çš„å½¢å¼,å®šé‡‘åœ¨ç‰¹å®šçš„æ—¶é—´æˆ–è€…é’ˆå¯¹æŸä¸ªå•†å“å¯ä»¥è†¨èƒ€ä½¿ç”¨,è†¨èƒ€å‡ºå¤šä½™çš„éƒ¨åˆ†ç›¸å½“å•†å®¶è®©åˆ©,å¯ä»¥ä¼˜æƒ è´­ä¹°.ä»£å¸ä¸ºå•†å®¶ä»¥ä¸åŒé¢å€¼å‘æ”¾ç»™ç”¨æˆ·,ä»¥æŠµæ‰£ä¸‹å•é‡‘é¢.</p>
<h4 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h4><p>å‡è®¾æŸä¸ªåº—é“ºæœ‰å¥½å¤šä¸åŒä½¿ç”¨æ¡ä»¶çš„ä¼˜æƒ åˆ¸æ¯”å¦‚æ»¡20å‡å»5,æ»¡20å‡10,æ¯æ»¡20å‡5,æ¯æ»¡20å‡21(å…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸ªçš„æ„ä¹‰ä»€ä¹ˆ,ä½†æ˜¯äº§å“è¯´å°±è¦å‘è¿™æ ·çš„åˆ¸),ç„¶åç”¨æˆ·è¿˜åˆ†åˆ«è´­ä¹°äº†20,30,60çš„å®šé‡‘,å½“ç”¨æˆ·ä¸‹å•é‡‘é¢ä¸º200å…ƒæ—¶,ç”¨æˆ·è‡ªå·±å°±éš¾ä»¥é€‰æ‹©,æ— æ³•ç«‹å³è®¡ç®—å‡ºæ”¯ä»˜æœ€å°‘çš„é’±è´­ä¹°æ­¤å•å•†å“,æ‰€ä»¥éœ€è¦æˆ‘ä»¬è®¡ç®—åŒ¹é…å‡ºä¸€ä¸ªæœ€åˆ’ç®—çš„ç»„åˆç»™ç”¨æˆ·.å½“ç„¶ä¼˜æƒ åˆ¸å’Œå®šé‡‘åªèƒ½å„é€‰ä¸€ä¸ª.</p>
<h4 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h4><p>ä½œä¸ºç”¨æˆ·æ¥è®²,å½“ç„¶ä¼˜å…ˆä½¿ç”¨ä¼˜æƒ åˆ¸,å› ä¸ºä¼˜æƒ åˆ¸ä¸ºå•†å®¶èµ ä¸è€Œå®šé‡‘æ—¶è‡ªå·±è´­ä¹°,æ•…æ”¯ä»˜é‡‘é¢=è®¢å•é‡‘é¢-ä¼˜æƒ åˆ¸çš„ä¼˜æƒ é‡‘é¢(å› ä¸ºåŒ…å«æ¯æ»¡ç±»å‹,æ‰€ä»¥ä¸ä¸€æ˜¯ä¼˜æƒ åˆ¸é¢å€¼)-å®šé‡‘.é‚£ä¹ˆå¤§æ¦‚æ€è·¯å°±æ˜¯å®šé‡‘å’Œä¼˜æƒ åˆ¸çš„ç»„åˆ,ç›¸å½“äºä¸¤å±‚forå¾ªç¯,ç„¶åæŒ‰ç…§è¿™ä¸ªå…¬å¼ç®—å‡ºæ”¯ä»˜é‡‘é¢å¤§äºç­‰äºé›¶çš„é‚£ä¸ªå€¼å°±å¯ä»¥äº†.æ€è·¯æ—¶æŒºç®€å•,ä½†æ˜¯ä¼˜æƒ åˆ¸çš„é€»è¾‘å°±æœ‰ç‚¹å¤æ‚,ä»¥ä¸ºä¼˜æƒ åˆ¸è‡ªèº«å°±æœ‰å¥½å¤šç§ç»„åˆ,ä¾‹å¦‚æ»¡10å‡5,æ»¡10å‡8,æ¯æ»¡10å‡8,æ»¡5å‡8,æ¯æ»¡5å‡8,æ‰€ä»¥ä¼˜æƒ åˆ¸çš„é¡ºåºåº”è¯¥æ ¹æ®æ˜¯å¦æ¯æ»¡ã€ä¼˜æƒ æ»¡è¶³é‡‘é¢ã€ä¼˜æƒ é‡‘é¢æ’åº.</p>
<a id="more"></a>
<h4 id="å…·ä½“æ–¹æ¡ˆ"><a href="#å…·ä½“æ–¹æ¡ˆ" class="headerlink" title="å…·ä½“æ–¹æ¡ˆ"></a>å…·ä½“æ–¹æ¡ˆ</h4><p>å…ˆå®šä¹‰å¥½ä¼˜æƒ åˆ¸ã€å®šé‡‘å’Œæœ€ä¼˜ç»„åˆçš„æ¨¡å‹<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Coupon</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜æƒ åˆ¸id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜æƒ åˆ¸æ»¡è¶³é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> spending;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æ¯æ»¡ 0ä¸ºå¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> every;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜æƒ é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> discount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Booking</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šé‡‘Id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šé‡‘é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> amount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BestCombination</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨å®šé‡‘é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> bookingAmount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ä¼˜æƒ åˆ¸é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span> couponAmount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨çš„å®šé‡‘</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Booking booking;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨çš„ä¼˜æƒ åˆ¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Coupon coupon;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BestCombination</span><span class="params">(Booking booking, Coupon coupon, <span class="keyword">double</span> bookingAmount, <span class="keyword">double</span> couponAmount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.booking = booking;</span><br><span class="line">        <span class="keyword">this</span>.coupon = coupon;</span><br><span class="line">        <span class="keyword">this</span>.bookingAmount = bookingAmount;</span><br><span class="line">        <span class="keyword">this</span>.couponAmount = couponAmount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åå…ˆå¯¹ä¼˜æƒ åˆ¸å’Œå®šé‡‘åˆ—è¡¨æ’åº<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Coupon&gt; <span class="title">initCoupon</span><span class="params">(<span class="keyword">double</span> totalPrice, List&lt;Coupon&gt; coupons)</span> </span>&#123;</span><br><span class="line">        List&lt;Coupon&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (coupons.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Coupon b : coupons) &#123;</span><br><span class="line">                <span class="comment">//æ’é™¤æ‰é¢å€¼å¤§äºè®¢å•é‡‘é¢çš„åˆ¸</span></span><br><span class="line">                <span class="keyword">if</span> (b.spending &lt;= totalPrice) &#123;</span><br><span class="line">                    result.add(b);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¾æ¬¡æ ¹æ®æ˜¯å¦æ¯æ»¡ã€ä¼˜æƒ æ»¡è¶³é‡‘é¢ã€ä¼˜æƒ é‡‘é¢æ’åº</span></span><br><span class="line">        Collections.sort(result, <span class="keyword">new</span> Comparator&lt;Coupon&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Coupon o1, Coupon o2)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//æ¯æ»¡åˆ¸åœ¨å‰</span></span><br><span class="line">                <span class="keyword">int</span> compareEvery = Integer.compare(o2.every, o1.every);</span><br><span class="line">                <span class="keyword">if</span> (compareEvery == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//é¢å€¼å°çš„åœ¨å‰,ä¸ºäº†è¿‘å¯èƒ½çš„ä¸è®©ç”¨æˆ·ä½¿ç”¨å®šé‡‘</span></span><br><span class="line">                    <span class="keyword">int</span> compareSpending = Double.compare(o1.spending, o2.spending);</span><br><span class="line">                    <span class="keyword">if</span> (compareSpending == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> Double.compare(o1.discount, o2.discount);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> compareSpending;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> compareEvery;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸é€‚ç”¨ä»»ä½•ä¼˜æƒ åˆ¸,æ‰€ä»¥éœ€è¦æ·»åŠ æ­¤</span></span><br><span class="line">        Coupon emptyCoupon = <span class="keyword">new</span> Coupon();</span><br><span class="line">        emptyCoupon.discount = <span class="number">0</span>;</span><br><span class="line">        emptyCoupon.spending = <span class="number">0</span>;</span><br><span class="line">        emptyCoupon.id = <span class="string">"-1"</span>;</span><br><span class="line">        emptyCoupon.every = <span class="number">0</span>;</span><br><span class="line">        result.add(emptyCoupon);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šé‡‘åªéœ€è¦åŠ å…¥ä¸ä½¿ç”¨å®šé‡‘çš„é€‰é¡¹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Booking&gt; <span class="title">initBooking</span><span class="params">(List&lt;Booking&gt; bookings)</span> </span>&#123;</span><br><span class="line">        List&lt;Booking&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (bookings.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            result.addAll(bookings);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Booking emptyBooking = <span class="keyword">new</span> Booking();</span><br><span class="line">        emptyBooking.amount = <span class="number">0</span>;</span><br><span class="line">        emptyBooking.id = <span class="string">"-1"</span>;</span><br><span class="line">        result.add(emptyBooking);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€åå°±å¯ä»¥æ ¹æ®è®¢å•é‡‘é¢ã€ä¼˜æƒ åˆ¸å’Œå®šé‡‘è®¡ç®—å‡ºæœ€ä¼˜çš„ç»„åˆ<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è®¡ç®—æœ€åˆ’ç®—çš„ç»„åˆ</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> totalPrice è®¢å•é‡‘é¢</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> coupons    æ’å¥½åºçš„ä¼˜æƒ åˆ¸åˆ—è¡¨</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> bookings   å®šé‡‘åˆ—è¡¨</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> æœ€ä¼˜ç»„åˆ</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BestCombination <span class="title">calculatorBestCombination</span><span class="params">(<span class="keyword">double</span> totalPrice, List&lt;Coupon&gt; coupons, List&lt;Booking&gt; bookings)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//TreeMapå·²å¯¹keyè¿›è¡Œæ’åº,ç”¨æ¥è£…å¡«æ‰€æœ‰çš„ç»„åˆç»“æœ,keyä¸ºæ”¯ä»˜é‡‘é¢</span></span><br><span class="line">      SortedMap&lt;Double, BestCombination&gt; map = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">      <span class="keyword">double</span> couponPrice;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (Coupon c : coupons) &#123;</span><br><span class="line">          <span class="keyword">for</span> (Booking b : bookings) &#123;</span><br><span class="line">              <span class="keyword">double</span> tempPrice = totalPrice;</span><br><span class="line">              <span class="keyword">if</span> (c.every == <span class="number">1</span>) &#123;</span><br><span class="line">                  <span class="comment">//æ¯æ»¡åˆ¸ç›¸å½“äºå¤šå¼ åˆ¸ å¼ æ•°*ä¼˜æƒ é‡‘é¢</span></span><br><span class="line">                  couponPrice = Math.floor(tempPrice / c.spending) * c.discount;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  couponPrice = c.discount;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">//è®¢å•é‡‘é¢-æ‰€æœ‰ä¼˜æƒ é‡‘é¢</span></span><br><span class="line">              tempPrice = tempPrice - couponPrice;</span><br><span class="line"></span><br><span class="line">              <span class="comment">//æ”¯ä»˜é‡‘é¢</span></span><br><span class="line">              tempPrice = tempPrice - b.amount;</span><br><span class="line">              <span class="comment">//å½“å®šé‡‘é¢å€¼ä¸ºæ­£å€¼ä¸”æ”¯ä»˜é‡‘é¢ä¸ºè´Ÿå€¼æ—¶ï¼Œæ’é™¤æ­¤ä»·æ ¼è¿›å…¥æœ€ä¼˜ä»·æ ¼é˜Ÿåˆ—</span></span><br><span class="line">              <span class="keyword">if</span> (!(tempPrice &lt; <span class="number">0</span> &amp;&amp; b.amount &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">                  <span class="keyword">if</span> (map.containsKey(tempPrice)) &#123;</span><br><span class="line">                      <span class="comment">//å½“æ”¯ä»˜é‡‘é¢ç›¸åŒæ—¶,å¦‚æœç»„åˆå†…çš„å®šé‡‘å¤§äºå°†è¦æ’å…¥çš„å®šé‡‘é‡‘é¢(æ„å‘³ç€æ‰€ä½¿ç”¨çš„ä¼˜æƒ åˆ¸å°)ï¼Œåˆ™æ›¿æ¢åŸæœ‰çš„ç»„åˆ</span></span><br><span class="line">                      BestCombination best = map.get(tempPrice);</span><br><span class="line">                      <span class="keyword">if</span> (best.bookingAmount &gt;= b.amount) &#123;</span><br><span class="line">                          map.put(tempPrice, <span class="keyword">new</span> BestCombination(b, c, b.amount, couponPrice));</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      map.put(tempPrice, <span class="keyword">new</span> BestCombination(b, c, b.amount, couponPrice));</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      BestCombination bestCombination;</span><br><span class="line">      <span class="keyword">if</span> (map.size() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">//ç»„åˆé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æ— æœ€ä¼˜ç»„åˆ</span></span><br><span class="line">          bestCombination = <span class="keyword">null</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (map.firstKey() &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="comment">//å½“ç»„åˆé˜Ÿåˆ—ç¬¬ä¸€ä¸ªå€¼å¤§äºé›¶ï¼Œåˆ™å–ç¬¬ä¸€ä¸ªï¼Œæ­¤æ—¶ä¸ºæœ€ä¼˜æƒ </span></span><br><span class="line">              bestCombination = map.get(map.firstKey());</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">double</span> key = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">for</span> (Map.Entry&lt;Double, BestCombination&gt; e : map.entrySet()) &#123;</span><br><span class="line">                  System.out.println(e.getKey() + <span class="string">" "</span> + e.getValue().toString());</span><br><span class="line">                  <span class="keyword">if</span> (e.getValue().booking.amount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                      <span class="keyword">if</span> (e.getKey() &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                          <span class="keyword">break</span>;</span><br><span class="line">                      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                          <span class="comment">//å®šé‡‘å¤§äºé›¶åˆ™è¯´æ˜ä¼˜æƒ åˆ¸ä½¿ç”¨äº†æ¯æ»¡ä¸”ç±»ä¼¼10å‡20çš„ç±»å‹ å½“æ”¯ä»˜é‡‘é¢å°äºé›¶æ—¶</span></span><br><span class="line">                          key = e.getKey();</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      <span class="keyword">if</span> (e.getKey() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                          <span class="keyword">break</span>;</span><br><span class="line">                      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                          <span class="comment">//å®šé‡‘ç­‰äº0 ä¸”æ”¯ä»˜é‡‘é¢å°äºç­‰äºé›¶</span></span><br><span class="line">                          key = e.getKey();</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              bestCombination = map.get(key);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> bestCombination;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>è®¡ç®—æœ€åˆ’ç®—çš„ç»„åˆ,é‡ç‚¹åœ¨äºè®¡ç®—å‰çš„æ•°æ®æ’åºã€è®¡ç®—æ—¶æ›¿æ¢ç›¸åŒæ”¯ä»˜é‡‘çš„ç»„åˆå’Œè®¡ç®—åæœ€ä¼˜ç»„åˆçš„é€‰æ‹©.<strong><em><a href="https://github.com/Thewhitelight/Tinder/blob/master/app/src/test/java/cn/libery/tinder/BestOfferTest.java">é¡¹ç›®åœ°å€</a></em></strong>å¯ä»¥è¿è¡Œæµ‹è¯•ç”¨ä¾‹.</p>
]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>å›¾ç‰‡é€‰æ‹© Library</title>
    <url>/2018/08/06/avatar-select-img/</url>
    <content><![CDATA[<p>é€‰æ‹©å¤´åƒã€å›¾ç‰‡æ—¶ç»å¸¸ä½¿ç”¨æ‹ç…§å’Œç›¸å†ŒåŠŸèƒ½,ä½†æ˜¯ç”±äº Android ç¢ç‰‡åŒ–é—®é¢˜,ä¸åŒç‰ˆæœ¬ API æœ‰å·®å¼‚,å¹¶ä¸”åœ¨ä¸åŒé¡µé¢å¤„ç† onActivityResult æ„Ÿè§‰å¤ªéº»çƒ¦,æ‰€ä»¥å°±æƒ³ç€å¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨,å°†è¿™äº›é€»è¾‘å°è£…èµ·æ¥,è®©æ•´ä¸ªä»£ç å†™èµ·æ¥ç®€æ´æ¸…æ™°æ˜äº†,ä¸è‡³äºå¥½å¤šç±»ä¼¼ä»£ç é‡å¤,æé«˜å¼€å‘æ•ˆç‡.</p>
<h4 id="é€‰æ‹©å›¾ç‰‡å­˜åœ¨çš„é—®é¢˜"><a href="#é€‰æ‹©å›¾ç‰‡å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="é€‰æ‹©å›¾ç‰‡å­˜åœ¨çš„é—®é¢˜"></a>é€‰æ‹©å›¾ç‰‡å­˜åœ¨çš„é—®é¢˜</h4><h5 id="Android-6-0-è¿è¡Œæ—¶æƒé™"><a href="#Android-6-0-è¿è¡Œæ—¶æƒé™" class="headerlink" title="Android 6.0 è¿è¡Œæ—¶æƒé™"></a>Android 6.0 è¿è¡Œæ—¶æƒé™</h5><p>åœ¨ Android 6.0 ä¸­ä¸¥æ ¼é™åˆ¶Appçš„æƒé™æˆäºˆ,è¯»å– SD å¡ã€æ‹ç…§ã€å½•éŸ³ã€å®šä½ã€çŸ­ä¿¡ã€é€šè®¯å½•ç­‰å…³é”®æƒé™éœ€è¦åœ¨ä»£ç ä¸­ç”³è¯·è¿™äº›æƒé™,å¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸å¯¼è‡´ç¨‹åºå¥”æºƒ,å½“ App ç”³è¯·æƒé™è¢«æ‹’ç»åæˆ‘ä»¬åº”è¯¥ç»™ç”¨æˆ·å¼¹å‡ºæç¤ºæ¡†,å¼•å¯¼ç”¨æˆ·å»è®¾ç½®é¡µå¼€å¯æ­¤æƒé™,ç„¶ååœ¨ onRequestPermissionsResult ä¸­å¤„ç†å›è°ƒç»“æœ.</p>
<h5 id="Android-7-0-StrictMode-é—®é¢˜"><a href="#Android-7-0-StrictMode-é—®é¢˜" class="headerlink" title="Android 7.0 StrictMode é—®é¢˜"></a>Android 7.0 StrictMode é—®é¢˜</h5><p>åœ¨ Android 7.0 ä¸­å¼ºåˆ¶å¯ç”¨äº†è¢«ç§°ä½œ StrictMode çš„ç­–ç•¥ï¼Œå¸¦æ¥çš„å½±å“å°±æ˜¯ä½ çš„Appå¯¹å¤–æ— æ³•æš´éœ² file:// ç±»å‹çš„ URI,å¦åˆ™ä¼šå‡ºç° FileUriExposedException å¼‚å¸¸,è¿›ç¨‹é—´åº”ä½¿ç”¨ FileProvider å…±äº«æ–‡ä»¶.</p>
<h5 id="ä¸‰æ˜Ÿæœºå‹å›¾ç‰‡é€‰æ‹©é—®é¢˜"><a href="#ä¸‰æ˜Ÿæœºå‹å›¾ç‰‡é€‰æ‹©é—®é¢˜" class="headerlink" title="ä¸‰æ˜Ÿæœºå‹å›¾ç‰‡é€‰æ‹©é—®é¢˜"></a>ä¸‰æ˜Ÿæœºå‹å›¾ç‰‡é€‰æ‹©é—®é¢˜</h5><p>åœ¨ä¸‰æ˜Ÿæœºå‹ä¸­,å½“æˆ‘ä»¬è°ƒç”¨ç›¸æœºæ‹ç…§å,è·å–çš„å›¾ç‰‡å‘ç°è¢«æ—‹è½¬90åº¦,æ‰€ä»¥éœ€è¦è·å–å›¾ç‰‡çš„ ExifInterface ä¿¡æ¯,ç„¶åæ ¹æ® orientation è¿›è¡Œå›¾ç‰‡çš„è§’åº¦æ—‹è½¬,ä½¿ä¹‹æ–¹å‘æ­£ç¡®.</p>
<h4 id="è§£å†³æ–¹å¼"><a href="#è§£å†³æ–¹å¼" class="headerlink" title="è§£å†³æ–¹å¼"></a>è§£å†³æ–¹å¼</h4><p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜å†™ä¸€ä¸ª library å°±æ˜¾å¾—å¾ˆæœ‰å¿…è¦.æ–¹ä¾¿åœ¨ä¸ç”¨é¡µé¢è°ƒç”¨é€‰æ‹©å›¾ç‰‡.åœ¨ä¸€ä¸ªé€æ˜èƒŒæ™¯çš„ Activity ä¸­å¤„ç†ä»¥ä¸Šé—®é¢˜,è®©è°ƒç”¨æ–¹æ— æ„ŸçŸ¥ä»¥ä¸Šé—®é¢˜,åªç”¨ä¼ å…¥å¿…è¦çš„è®¾ç½®æ¡ä»¶æœ€åæ‹¿åˆ°å›¾ç‰‡æ–‡ä»¶å°±å¯ä»¥,ç„¶åé’ˆå¯¹æ–‡ä»¶è¿›è¡Œè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ“ä½œå³å¯.</p>
<a id="more"></a>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è°ƒç”¨æ–¹å¼ </span></span><br><span class="line">Avatar.getInstance()</span><br><span class="line">                   <span class="comment">//é€‰æ‹©æ¨¡å¼ ALL æ‹ç…§å’Œç›¸å†Œ CAMERA æ‹ç…§ GALLERY ç›¸å†Œ</span></span><br><span class="line">                   .setSelectMode(Avatar.ALL)</span><br><span class="line">                   <span class="comment">//æ–‡ä»¶ç›®å½•åå­— éå¿…å¡« é»˜è®¤é¡¹ç›®åŒ…å</span></span><br><span class="line">                   .setImageFileDir(<span class="string">"Tinder"</span>)</span><br><span class="line">                   <span class="comment">//æ˜¯å¦å‰ªè£</span></span><br><span class="line">                   .setHasCrop(<span class="keyword">true</span>)</span><br><span class="line">                   <span class="comment">//è·å–å›¾ç‰‡æ–‡ä»¶å›è°ƒ</span></span><br><span class="line">                   .imageFile &#123; imageFile -&gt;</span><br><span class="line">                       run &#123;</span><br><span class="line">                           Log.e(<span class="string">"file:"</span>, imageFile.absolutePath)</span><br><span class="line">                           img.setImageBitmap(BitmapFactory.decodeFile(imageFile.absolutePath))</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">                   .build(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨ Avatar ä¸­ä½¿ç”¨ä½¿ç”¨é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼,å‡å°‘å¯¹è±¡åˆ›å»º,å¹¶æ–¹ä¾¿ Activity ä¸­ä¼ å›å›¾ç‰‡æ–‡ä»¶ç›®å½•,SelectAvatarActivity ä½¿ç”¨é€æ˜ä¸»é¢˜,å¹¶åœ¨å¤„ç†æƒé™è¯·æ±‚ä¸ç…§ç‰‡å›è°ƒå¤„ç†.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Avatar.java</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Avatar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Avatar <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> AvatarHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AvatarHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> Avatar INSTANCE = <span class="keyword">new</span> Avatar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">SelectAvatarActivity.java</span><br><span class="line"></span><br><span class="line">    <span class="comment">//setImageFile æ–¹æ³•åŒ…çº§ç§æœ‰,æ•…åŒ…å¤–ä¸å¯è°ƒç”¨,ä¿è¯å°è£…</span></span><br><span class="line">    Avatar.getInstance().setImageFile(mAvatarFile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€‰æ‹©ç…§ç‰‡</span></span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent(MediaStore.ACTION_IMAGE_CAPTURE);</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.N) &#123;</span><br><span class="line">            mOrigUri = Uri.fromFile(cameraFile);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ContentValues contentValues = <span class="keyword">new</span> ContentValues(<span class="number">1</span>);</span><br><span class="line">            contentValues.put(MediaStore.Images.Media.DATA, cameraFile.getAbsolutePath());</span><br><span class="line">            mOrigUri = getContentResolver().insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, contentValues);</span><br><span class="line">        &#125;</span><br><span class="line">        intent.putExtra(MediaStore.EXTRA_OUTPUT, mOrigUri);</span><br><span class="line">        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_CAMERA);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é€‰æ‹©ç›¸å†Œ</span></span><br><span class="line">    Intent intent;</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            intent = <span class="keyword">new</span> Intent(Intent.ACTION_GET_CONTENT);</span><br><span class="line">            intent.setType(<span class="string">"image/*"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        startActivityForResult(intent, REQUEST_CODE_GET_IMAGE_SDCARD);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šè¿‡å›¾ç‰‡è·¯å¾„,è·å–å›¾ç‰‡ExifInterfaceä¿¡æ¯å¾—åˆ°æ—‹è½¬è§’åº¦,ä½¿ç”¨Matrixæ—‹è½¬ç”Ÿæˆæ–°çš„å›¾ç‰‡ä¿å­˜</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">readPictureDegree</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> degree = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ExifInterface exifInterface = <span class="keyword">new</span> ExifInterface(path);</span><br><span class="line">            <span class="keyword">int</span> orientation = exifInterface.getAttributeInt(</span><br><span class="line">                    ExifInterface.TAG_ORIENTATION,</span><br><span class="line">                    ExifInterface.ORIENTATION_NORMAL);</span><br><span class="line">            <span class="keyword">switch</span> (orientation) &#123;</span><br><span class="line">                <span class="keyword">case</span> ExifInterface.ORIENTATION_ROTATE_90:</span><br><span class="line">                    degree = <span class="number">90</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> ExifInterface.ORIENTATION_ROTATE_180:</span><br><span class="line">                    degree = <span class="number">180</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> ExifInterface.ORIENTATION_ROTATE_270:</span><br><span class="line">                    degree = <span class="number">270</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> degree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ImageUtil.java </span><br><span class="line">    <span class="comment">//æ—‹è½¬å›¾ç‰‡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">rotateImageView</span><span class="params">(<span class="keyword">int</span> angle, Bitmap bitmap)</span> </span>&#123;</span><br><span class="line">        Matrix matrix = <span class="keyword">new</span> Matrix();</span><br><span class="line">        matrix.postRotate(angle);</span><br><span class="line">        <span class="keyword">if</span> (bitmap != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Bitmap.createBitmap(bitmap, <span class="number">0</span>, <span class="number">0</span>, bitmap.getWidth(), bitmap.getHeight(), matrix, <span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é€æ˜ä¸»é¢˜ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"TransparentTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.NoActionBar"</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsTranslucent"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowAnimationStyle"</span>&gt;</span>@android:style/Animation.Translucent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowNoTitle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowContentOverlay"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- FileProvider é€‚é…7.0--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"android.support.v4.content.FileProvider"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:authorities</span>=<span class="string">"$&#123;applicationId&#125;.fileProvider"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:exported</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:grantUriPermissions</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">"android.support.FILE_PROVIDER_PATHS"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:resource</span>=<span class="string">"@xml/provider_paths"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- provider_paths.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">paths</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä¸ºäº†æ–¹ä¾¿ç›´æ¥ä½¿ç”¨ root-path å¯¹æ‰€æœ‰æ–‡ä»¶æˆæƒ,å½“ç„¶å®‰å…¨èµ·è§è€ƒè™‘è¿˜æ˜¯ä¸è¦è¿™ä¹ˆå†™,ä½¿ç”¨external-pathèŒƒå›´è¶Šå°è¶Šå¥½--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root-path</span></span></span><br><span class="line"><span class="tag">    <span class="attr">name</span>=<span class="string">"root_path"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">path</span>=<span class="string">"."</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨<code>&lt;paths&gt;</code> ä¸­å¯ä»¥æ·»åŠ <code>&lt;files-path&gt;</code> åˆ†äº«appå†…éƒ¨çš„å­˜å‚¨; <code>&lt;external-path&gt;</code> åˆ†äº«å¤–éƒ¨çš„å­˜å‚¨; <code>&lt;cache-path&gt;</code>åˆ†äº«å†…éƒ¨ç¼“å­˜ç›®å½•.æ ¹æ®ä¸åŒçš„éœ€æ±‚å¯¹æ–‡ä»¶å¤¹è¿›è¡Œæˆæƒè®¿é—®.</p>
<p>å½“å°è£…å¥½è¿™äº›åŠŸèƒ½å,åœ¨è°ƒç”¨é¡µé¢è·å–å›¾ç‰‡çš„ä»£ç æœ€å¤šçŸ­çŸ­æ˜¯å‡ è¡Œ,è€Œä¸åƒåŸæ¥éœ€è¦ä¸Šç™¾è¡Œçš„å¤„ç†å„ç§é—®é¢˜,å¹¶ä¸” API å˜åŠ¨æ—¶,åªéœ€è¦æ”¹åŠ¨ library å°±å¯ä»¥å®Œæˆé€‚é….<br><strong><a href="https://github.com/Thewhitelight/Tinder">é¡¹ç›®åœ°å€</a></strong></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>OKHttpåŠ¨æ€åˆ‡æ¢Host</title>
    <url>/2018/07/21/okhttp-host-switch/</url>
    <content><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¼šåˆ†æµ‹è¯•ã€é¢„å‘ã€ç”Ÿäº§ç­‰ç¯å¢ƒ,ä¸åŒç¯å¢ƒä¸‹è¯·æ±‚ Host ä¸ä¸€è‡´,åŸæ¥çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡å®šåˆ¶ä¸åŒçš„ Flavors,é€šè¿‡æ·»åŠ  applicationIdSuffix å¯ä»¥è®©å¤šä¸ª App åŒæ—¶å®‰è£…åœ¨æ‰‹æœºæ–¹ä¾¿æµ‹è¯•,ä½†æ˜¯åˆäº§ç”Ÿæ–°çš„é—®é¢˜,æ¯æ¬¡éƒ½è¦æ‰“åŒ…ä¸Šä¼ ä¸åŒçš„ App è®©æµ‹è¯•å®‰è£…,è¿™æ ·æ„Ÿè§‰ç•¥æ˜¾éº»çƒ¦,æ‰€ä»¥å°±æƒ³åˆ°èƒ½ä¸èƒ½ App å†…éƒ¨åšç¯å¢ƒåˆ‡æ¢,è¿™æ ·åˆ‡æ¢è‡ªå¦‚,æ— éœ€é‡æ–°æ‰“åŒ….</p>
<a id="more"></a>
<h4 id="ä½¿ç”¨å®˜æ–¹æä¾›çš„-urlä¿®æ”¹Host"><a href="#ä½¿ç”¨å®˜æ–¹æä¾›çš„-urlä¿®æ”¹Host" class="headerlink" title="ä½¿ç”¨å®˜æ–¹æä¾›çš„@urlä¿®æ”¹Host"></a>ä½¿ç”¨å®˜æ–¹æä¾›çš„@urlä¿®æ”¹Host</h4><p>å®˜æ–¹æä¾›@urlæ–¹æ³•æ¥åŠ¨æ€æ”¹å˜è¯·æ±‚çš„url,ä½†æ˜¯ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚,ä½¿ç”¨@urlåªé€‚åˆä¿®æ”¹ä¸ªåˆ«æ¥å£çš„æƒ…å†µ,æˆ‘ä»¬è¿™æ ·æ”¯æŒå…¨éƒ¨æ¥å£çš„ä¿®æ”¹æ˜¾ç„¶å·¥ä½œé‡å¤ªå¤§,å‡ ä¹æ— æ³•ç»´æŠ¤,å¦‚æœAppä¸­ä½¿ç”¨ç¬¬ä¸‰æ–¹å›¾ç‰‡æˆ–è€…æ–‡ä»¶ä¸Šä¼ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•,åªåœ¨ä¸ªåˆ«æ¥å£ä¿®æ”¹urlä½¿ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApiService</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@GET</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Call&lt;ResponseBody&gt; <span class="title">uploadImg</span><span class="params">(@Url String url)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å°è£…ä¸åŒ-Host-çš„-OKHttpClient"><a href="#å°è£…ä¸åŒ-Host-çš„-OKHttpClient" class="headerlink" title="å°è£…ä¸åŒ Host çš„ OKHttpClient"></a>å°è£…ä¸åŒ Host çš„ OKHttpClient</h4><p>ç”±äº OKHttp ä¸æ”¯æŒåŠ¨æ€åˆ‡æ¢h ost å¹¶ä¸” api è¯·æ±‚ä¸ºå•ä¾‹æ¨¡å¼,ç„¶åæƒ³åˆ°å°è£…3ä¸ªä¸åŒHostçš„OkHttpClient,ç„¶åé€šè¿‡ç­–ç•¥æ¨¡å¼å»å®ç°ä¸åŒçš„è¯·æ±‚è°ƒç”¨,ä½†æ˜¯è¿™æ ·æ€»æ„Ÿè§‰ä¸å¤ªä¼˜é›…,åˆå ç”¨å†…å­˜.</p>
<h4 id="åˆ©ç”¨-Interceptor-åˆ‡æ¢-Host"><a href="#åˆ©ç”¨-Interceptor-åˆ‡æ¢-Host" class="headerlink" title="åˆ©ç”¨ Interceptor åˆ‡æ¢ Host"></a>åˆ©ç”¨ Interceptor åˆ‡æ¢ Host</h4><p>ç»§ç»­æƒ³ä¼šä¸ä¼šæœ‰é€šè¿‡æ”¹å˜ api çš„æ–¹å¼å»å®ç°è¿™ä¸ªåŠŸèƒ½,ç„¶åçªç„¶æƒ³åˆ°æˆ‘ä»¬åœ¨æ·»åŠ  Cookie æ—¶ç”¨åˆ°çš„ Interceptor,æ—¢ç„¶å®ƒæ¯æ¬¡éƒ½ä¼šæ‹¦æˆªè¯·æ±‚,é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨æ‹¦æˆªåˆ°è¯·æ±‚æ—¶æ¢æ‰ Host,å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½.æœ‰äº†æ€è·¯å°±å¯ä»¥åŠ¨æ‰‹å¼€å§‹çœ‹æºç æ”¹é€ äº†.</p>
<p>åœ¨ Intercept æ–¹æ³•ä¸­é€šè¿‡ Chainè·å– Request,ä¿®æ”¹ Request ä¸­çš„ HttpUrl æ¥æ”¹å˜ Host.HttpUrlç±»ç”¨äºè·å– Hostã€ç«¯å£,URLè§£æ,å’Œå¤„ç†URLå­—ç¬¦ä¸²ç­‰,ä½†æ˜¯å‘ç°HttpUrl,URL,Requestç±»ä¸­çš„å˜é‡éƒ½æ˜¯ç§æœ‰å¹¶ä¸”æ²¡æœ‰ä¿®æ”¹æ–¹æ³•,åªèƒ½é€šè¿‡åå°„æ–¹æ³•å»ä¿®æ”¹.ä¸å¤šè¯´ç›´æ¥ä¸Šä»£ç .</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨Apiå®šä¹‰å¥½ä¸åŒçš„ç¯å¢ƒçš„Host</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String mHost = Api.getHost();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String HOST = <span class="string">"host"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹å¤–æä¾›åŠ¨æ€ä¿®æ”¹host</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host è®¾ç½®çš„æ–°host</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setHost</span><span class="params">(String host)</span> </span>&#123;</span><br><span class="line">        mHost = host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mHost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Request request = chain.request();</span><br><span class="line">        <span class="comment">//æ ¹æ®è‡ªå·±çš„åˆ¤æ–­é€»è¾‘ æ˜¯å¦ä¿®æ”¹host</span></span><br><span class="line">        <span class="keyword">if</span> (AppUtil.canCheckoutHost() &amp;&amp; !mHost.equals(Api.getHost())) &#123;</span><br><span class="line">            request = replaceHost(request);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> chain.proceed(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Request <span class="title">replaceHost</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">        HttpUrl httpUrl = request.url();</span><br><span class="line">        URL url = httpUrl.url();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//åå°„ä¿®æ”¹URLä¸­çš„Host</span></span><br><span class="line">            Class&lt;?&gt; urlClz = url.getClass();</span><br><span class="line">            Field urlHost = urlClz.getDeclaredField(HOST);</span><br><span class="line">            urlHost.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            urlHost.set(url, mHost);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åå°„ä¿®æ”¹HttpUrlä¸­çš„Host</span></span><br><span class="line">            Class&lt;?&gt; httpUrlClz = httpUrl.getClass();</span><br><span class="line">            Field httpUrlHost = httpUrlClz.â‰ˆgetDeclaredField(HOST);</span><br><span class="line">            httpUrlHost.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            httpUrlHost.set(httpUrl, mHost);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åå°„ä¿®æ”¹Requestä¸­çš„HttpUrl</span></span><br><span class="line">            Class&lt;?&gt; requestUrlClz = request.getClass();</span><br><span class="line">            Field requestUrl = requestUrlClz.getDeclaredField(<span class="string">"url"</span>);</span><br><span class="line">            requestUrl.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            requestUrl.set(request, httpUrl);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç”¨ä¿®æ”¹åçš„HttpUrlæ„é€ æ–°çš„HttpUrl</span></span><br><span class="line">        request = request.newBuilder().url(httpUrl).build();</span><br><span class="line">        <span class="keyword">return</span> request;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åœ¨OkHttpClient.Builderä¸­åŠ å…¥å³å¯å®ŒæˆåŠ¨æ€åˆ‡æ¢</span></span><br><span class="line">builder.addInterceptor(<span class="keyword">new</span> DynamicInterceptor());</span><br></pre></td></tr></table></figure>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><a href="https://github.com/Thewhitelight/DynamicRetrofitHost.git">é¡¹ç›®åœ°å€</a> ç›®å‰è¿™ä¸ªæ–¹æ³•å·²ç»æ»¡è¶³éœ€æ±‚,åœ¨MainActivityä¸­ä½¿ç”¨æ‚¬æµ®æŒ‰é’®å»åŠ¨æ€åˆ‡æ¢Hostå¾ˆå®ç”¨.</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>OKHttp</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¾è®¡æ¨¡å¼ç®€å•è®°å½•</title>
    <url>/2018/07/20/android-design-pattern/</url>
    <content><![CDATA[<h2 id="é¢å‘å¯¹è±¡çš„å…­å¤§åŸåˆ™"><a href="#é¢å‘å¯¹è±¡çš„å…­å¤§åŸåˆ™" class="headerlink" title="é¢å‘å¯¹è±¡çš„å…­å¤§åŸåˆ™"></a>é¢å‘å¯¹è±¡çš„å…­å¤§åŸåˆ™</h2><ul>
<li>å•ä¸€èŒè´£åŸåˆ™(SRP):ä¸€ä¸ªç±»åº”è¯¥ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚</li>
<li>å¼€é—­åŸåˆ™(OCP):è½¯ä»¶ä¸­çš„å¯¹è±¡åº”è¯¥å¯¹äºæ‰©å±•æ˜¯å¼€æ”¾çš„ï¼Œå¯¹äºä¿®æ”¹æ˜¯å°é—­çš„ã€‚</li>
<li>é‡Œæ°æ›¿æ¢åŸåˆ™(LSP):æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜çš„ä½¿ç”¨å…¶å­ç±»ã€‚</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™(DIP):æ¨¡å—é—´çš„ä¾èµ–é€šè¿‡æŠ½è±¡å‘ç”Ÿï¼Œå®ç°ç±»ä¹‹é—´ä¸å‘ç”Ÿç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œå…¶ä¾èµ–å…³ç³»æ˜¯é€šè¿‡æ¥å£æˆ–è€…æŠ½è±¡ç±»äº§ç”Ÿçš„ã€‚</li>
<li>æ¥å£éš”ç¦»åŸåˆ™(ISP):å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ã€‚</li>
<li>è¿ªç±³ç‰¹åŸåˆ™(LOD):ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡æœ‰æœ€å°‘çš„äº†è§£ã€‚</li>
</ul>
<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­æŠŠæ¡å¹³è¡¡ç‚¹ï¼Œä½¿ç³»ç»Ÿå¯ä»¥å…·æœ‰é«˜ç¨³å®šæ€§ã€é«˜å¯æ‰©å±•æ€§å¹¶ä¸”é«˜å†…èšã€ä½è€¦åˆï¼Œåœ¨ä¸æ–­è¿­ä»£ä¸­å®Œå–„æ¶æ„ã€‚<br><a id="more"></a></p>
<h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>å®šä¹‰:ç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ã€‚</p>
<p>åœºæ™¯:å¯¹äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡éœ€è¦æ¶ˆè€—è¿‡å¤šçš„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œå¦‚ï¼šè®¿é—®æ•°æ®åº“ã€ç½‘ç»œã€IOã€‚</p>
<p>å•ä¾‹æ¨¡å¼ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ„é€ å‡½æ•°ç§æœ‰</li>
<li>é€šè¿‡ä¸€ä¸ªé™æ€æ–¹æ³•æˆ–è€…æšä¸¾è¿”å›å•ä¾‹ç±»å¯¹è±¡</li>
<li>ç¡®ä¿å•åˆ©ç±»çš„å¯¹è±¡æœ‰ä¸”åªæœ‰ä¸€ä¸ª</li>
<li>ç¡®ä¿å•åˆ©ç±»å¯¹è±¡åœ¨ååºåˆ—åŒ–æ—¶ä¸ä¼šé‡æ–°åˆ›å»ºå¯¹è±¡</li>
</ul>
<p>ä¸€èˆ¬æœ€å¸¸ç”¨çš„ä¸ºé™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ï¼Œå¯ä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€å¯¹è±¡å”¯ä¸€ã€åŒæ—¶ä¹Ÿå»¶è¿Ÿå®ä¾‹åŒ–ã€‚<br>Androidä¸­ä½¿ç”¨å•ä¾‹æ¨¡å¼æœ€ç›´è§‚åˆ™æ˜¯Application,ä½†å¦‚æœåº”ç”¨ä¸ºå¤šè¿›ç¨‹æ—¶ï¼Œåˆ™onCreateæ–¹æ³•æ‰§è¡Œå¤šæ¬¡ã€‚å•ä¾‹æ¨¡å¼æŒæœ‰Contextæ—¶åº”æŒæœ‰Application Contextï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</p>
<h2 id="Builderæ¨¡å¼"><a href="#Builderæ¨¡å¼" class="headerlink" title="Builderæ¨¡å¼"></a>Builderæ¨¡å¼</h2><p>å®šä¹‰:å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>ç›¸åŒæ–¹æ³•ï¼Œä¸åŒæ‰§è¡Œé¡ºåºï¼Œäº§ç”Ÿä¸åŒçš„äº‹ä»¶ç»“æœ</li>
<li>å¤šä¸ªå‚æ•°è£…é…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œäº§ç”Ÿçš„ç»“æœä¸ç›¸åŒ</li>
<li>å¯¹è±¡å¤æ‚ï¼Œå‚æ•°å¤šä¸”æœ‰é»˜è®¤å€¼</li>
</ul>
<p>Androidä¸­æœ€å¸¸è§çš„ä¸ºAlertDialog.Builder,è™½ç„¶ä¸æ˜¯ç»å…¸å®ç°ï¼Œä½†çµæ´»è¿ç”¨è®¾è®¡æ¨¡å¼åˆ™ååˆ†é‡è¦ã€‚åœ¨å®é™…å¼€å‘ä¸­å¾ˆå¤šæ—¶å€™ä¸ºäº†ä¸åº”ç”¨è®¾è®¡ç»Ÿä¸€ï¼Œä¼šæ›¿æ¢ç³»ç»ŸAlertDialogæ ·å¼ï¼Œè¿™æ—¶å¯ä»¥è¿ç”¨Builderæ¨¡å¼ï¼Œæ„å»ºç»Ÿä¸€Dialog,æ–¹ä¾¿è°ƒç”¨ã€‚Intentæœ‰æ—¶éœ€è¦æºå¸¦å¾ˆå¤šå‚æ•°åœ¨é¡µé¢é—´ä¼ é€’ï¼Œè¿™æ—¶ä½¿ç”¨Builderæ¨¡å¼ä¹Ÿä¼šæ›´åŠ æ¸…æ™°ã€‚</p>
<h2 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h2><p>å®šä¹‰:ç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶é€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>ç±»åˆå§‹åŒ–éœ€è¦æ¶ˆè€—å¾ˆå¤šèµ„æº</li>
<li>newä¸€ä¸ªå¯¹è±¡éœ€è¦éå¸¸ç¹ççš„æ•°æ®å‡†å¤‡æˆ–è€…è®¿é—®æƒé™</li>
<li>ä¸€ä¸ªå¯¹è±¡éœ€è¦æä¾›ç»™å…¶ä»–å¯¹è±¡è®¿é—®ï¼Œè€Œä¸”å„ä¸ªè°ƒç”¨è€…å¯èƒ½éƒ½éœ€è¦ä¿®æ”¹å…¶å€¼ï¼Œè€ƒè™‘ä½¿ç”¨åŸå‹æ¨¡å¼æ‹·è´å¤šä¸ªå¯¹è±¡æä¾›ç»™è°ƒç”¨è€…</li>
</ul>
<p>å½“å¯¹è±¡å®ç°Cloneableæ¥å£æ—¶ï¼Œå…¶æ„é€ å‡½æ•°ä¸ä¼šæ‰§è¡Œã€‚ä¸ºå‡å°‘é”™è¯¯ï¼Œå°½é‡ä½¿ç”¨æ·±æ‹·è´ï¼Œé¿å…æ“åšå‰¯æœ¬æ—¶å½±å“åŸå§‹å¯¹è±¡ã€‚</p>
<h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><p>å®šä¹‰:å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚</p>
<p>åœºæ™¯:ç”Ÿæˆå¤æ‚å¯¹è±¡çš„åœ°æ–¹</p>
<p>æ¸…æ™°å®šä¹‰ä¸€ä¸ªäº§å“çš„å±‚çº§ç»“æ„ï¼Œå®è·µä¸­å¯ä»¥å°†å…·æœ‰ç›¸åŒæ¨¡å¼çš„Activityã€Viewã€æ•°æ®å­˜å‚¨ç­‰è¿›è¡Œå°è£…ã€‚</p>
<h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>å®šä¹‰:ä¸ºåˆ›å»ºä¸€ç»„ç›¸å…³æˆ–è€…äº’ç›¸ä¾èµ–çš„å¯¹è±¡æä¾›ä¸€ä¸ªæ¥å£ï¼Œè€Œä¸éœ€è¦æŒ‡å®šå®ƒä»¬çš„å…·ä½“ç±»ã€‚</p>
<p>åœºæ™¯:ä¸€ä¸ªå¯¹è±¡æ—æœ‰ç›¸åŒçš„çº¦æŸæ—¶å¯ä»¥ä½¿ç”¨</p>
<p>æ¸…æ™°å®šä¹‰ä¸€ä¸ªäº§å“æ—çš„å±‚çº§ç»“æ„ã€‚</p>
<h2 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h2><p>å®šä¹‰:å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†å…¶å°è£…ä¸”å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>é’ˆå¯¹åŒä¸€ç±»å‹é—®é¢˜å¤šç§å¤„ç†æ–¹å¼</li>
<li>éœ€è¦å®‰å…¨çš„å°è£…å¤šç§åŒä¸€ç±»å‹çš„æ“ä½œæ—¶</li>
<li>åŒä¸€æŠ½è±¡ç±»æœ‰å¤šä¸ªå­ç±»ï¼Œä¸”éœ€è¦ä½¿ç”¨if-elseæˆ–è€…switch-caseé€‰æ‹©å…·ä½“å­ç±»æ—¶</li>
</ul>
<p>å¯ä»¥åœ¨ç›¸é€šçš„æŠ½è±¡ä¸‹å®ç°ä¸åŒçš„ç­–ç•¥ï¼Œå¦‚å¯¹äºå„ç§ç¬¬ä¸‰åˆ†äº«çš„è°ƒç”¨å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚</p>
<h2 id="çŠ¶æ€æ¨¡å¼"><a href="#çŠ¶æ€æ¨¡å¼" class="headerlink" title="çŠ¶æ€æ¨¡å¼"></a>çŠ¶æ€æ¨¡å¼</h2><p>å®šä¹‰:å½“ä¸€ä¸ªå¯¹è±¡çš„å†…åœ¨çŠ¶æ€æ”¹å˜æ—¶å…è®¸æ”¹å˜å…¶è¡Œä¸ºï¼Œè¿™ä¸ªå¯¹è±¡çœ‹èµ·æ¥åƒæ˜¯æ”¹å˜äº†å…¶ç±»ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>ä¸€ä¸ªå¯¹è±¡çš„è¡Œä¸ºå–å†³äºå®ƒçš„çŠ¶æ€ï¼Œå¹¶ä¸”ä»–å¿…é¡»åœ¨è¿è¡Œæ—¶æ›´å…·çŠ¶æ€æ”¹å˜ä»–çš„è¡Œä¸º</li>
<li>ä»£ç ä¸­åŒ…å«å¤§é‡ä¸å¯¹è±¡æœ‰å…³çš„æ¡ä»¶è¯­å¥</li>
</ul>
<p>ä¸åŒçš„çŠ¶æ€ä¸‹å¯¹äºåŒä¸€è¡Œä¸ºæœ‰ä¸åŒçš„å“åº”ï¼Œå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼Œå¤æ‚ç•Œé¢Viewçš„æ˜¾ç¤ºä¸éšè—ï¼Œç”¨å¤šæ€æ›¿æ¢æ¡ä»¶è¯­å¥ã€‚</p>
<h2 id="è´£ä»»é“¾æ¨¡å¼"><a href="#è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼"></a>è´£ä»»é“¾æ¨¡å¼</h2><p>å®šä¹‰:ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…äº†è¯·æ±‚çš„å‘é€è€…å’Œæ¥å—è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾æ¡ä¼ é€’è¯¥è¯·æ±‚ï¼Œåªåˆ°æœ‰å¯¹è±¡å¤„ç†ä¸ºæ­¢ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€è¯·æ±‚ï¼Œä½†å…·ä½“æœ‰å“ªä¸ªå¯¹è±¡å¤„ç†åˆ™åœ¨è¿è¡Œæ—¶åŠ¨æ€å†³å®š</li>
<li>åœ¨è¯·æ±‚å¤„ç†è€…ä¸æ˜ç¡®çš„æƒ…å†µä¸‹å‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚</li>
<li>éœ€è¦åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚</li>
</ul>
<p>Androidå¯¹äºäº‹ä»¶çš„åˆ†å‘å¤„ç†åˆ™ç±»ä¼¼äºè´£ä»»é“¾æ¨¡å¼ï¼Œè‹¥å¤„ç†è€…å¤ªå¤šåˆ™ä¼šå½±å“æ€§èƒ½ã€‚</p>
<h2 id="è§£é‡Šå™¨æ¨¡å¼"><a href="#è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="è§£é‡Šå™¨æ¨¡å¼"></a>è§£é‡Šå™¨æ¨¡å¼</h2><p>å®šä¹‰:ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¯¥è§£é‡Šå™¨ä½¿ç”¨è¯¥è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>å¦‚æœæŸä¸ªç®€å•çš„è¯­è¨€éœ€è¦è§£é‡Šæ‰§è¡Œè€Œä¸”å¯ä»¥å°†è¯¥è¯­è¨€ä¸­çš„è¯­å¥è¡¨ç¤ºä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨è§£é‡Šå™¨æ¨¡å¼</li>
<li>åœ¨æŸäº›ç‰¹å®šçš„é¢†åŸŸå‡ºç°ä¸æ–­é‡å¤çš„é—®é¢˜æ—¶ï¼Œå¯ä»¥å°†è¯¥é¢†åŸŸçš„é—®é¢˜è½¬åŒ–ä¸ºä¸€ç§è¯­æ³•è§„åˆ™ä¸‹çš„è¯­å¥ï¼Œç„¶åæ„å»ºè§£é‡Šå™¨æ¥è§£é‡Šè¯¥è¯­å¥</li>
</ul>
<p>Androidä¸­AndroidManifestçš„è§£æåˆ™å¯ä»¥çœ‹ä½œä¸ºå¯¹è§£é‡Šå™¨æ¨¡å¼çš„è¿ç”¨ã€‚</p>
<h2 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h2><p>å®šä¹‰:å°†ä¸€ä¸ªè¯·æ±‚åˆ†è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œè®©ç”¨æˆ·ä½¿ç”¨ä¸åŒçš„è¯·æ±‚æŠŠå®¢æˆ·ç«¯å‚æ•°åŒ–ï¼›å¯¹è¯·æ±‚é˜Ÿåˆ—æˆ–è€…è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>éœ€è¦æŠ½è±¡å‡ºå¾…æ‰§è¡Œçš„åŠ¨ä½œï¼Œç„¶åä»¥å‚æ•°çš„å½¢å¼æä¾›å‡ºæ¥â€”â€”ç±»ä¼¼äºè¿‡ç¨‹è®¾è®¡ä¸­çš„å›è°ƒæœºåˆ¶ï¼Œè€Œå‘½ä»¤æ¨¡å¼æ­£æ˜¯å›è°ƒæœºåˆ¶çš„ä¸€ä¸ªé¢å‘å¯¹è±¡çš„æ›¿ä»£å“</li>
<li>åœ¨ä¸åŒçš„æ—¶åˆ»æŒ‡å®šã€æ’åˆ—å’Œæ‰§è¡Œè¯·æ±‚ã€‚ä¸€ä¸ªå‘½ä»¤å¯¹è±¡å¯ä»¥æœ‰ä¸åˆå§‹è¯·æ±‚æ— å…³çš„ç”Ÿå­˜æœŸ</li>
<li>éœ€è¦æ”¯æŒå–æ¶ˆæ“ä½œ</li>
<li>æ”¯æŒä¿®æ”¹æ—¥å¿—åŠŸèƒ½ï¼Œè¿™æ ·ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè¿™äº›ä¿®æ”¹å¯ä»¥è¢«é‡æ–°åšä¸€é</li>
<li>éœ€è¦æ”¯æŒäº‹åŠ¡æ“ä½œ</li>
</ul>
<p>å½“ä¸€èµ·è¯·æ±‚æ“åšè¾ƒå¤šçš„å¯¹è±¡æ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼Œä½¿ä»£ç æ¡ç†æ¸…æ™°ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§ã€‚</p>
<h2 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h2><p>å®šä¹‰:å®šä¹‰å¯¹è±¡é—´ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ¯å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€ï¼Œåˆ™æ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>å…³è”è¡Œä¸ºåœºæ™¯ï¼Œå…³è”è¡Œä¸ºæ˜¯å¯æ‹†åˆ†ï¼Œè€Œä¸æ˜¯ç»„åˆå…³ç³»</li>
<li>äº‹ä»¶å¤šçº§è§¦å‘åœºæ™¯</li>
<li>è·¨ç³»ç»Ÿçš„æ¶ˆæ¯äº¤æ¢åœºæ™¯</li>
</ul>
<p>Androidä¸­BroadcastReceiverä¸ListViewæ•°æ®æ›´æ–°è¿™æ˜¯å…¸å‹çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p>
<h2 id="å¤‡å¿˜å½•æ¨¡å¼"><a href="#å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼"></a>å¤‡å¿˜å½•æ¨¡å¼</h2><p>å®šä¹‰:åœ¨ä¸ç ´åå°é—­çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œè¿™æ ·ï¼Œä»¥åå°±å¯ä»¥å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸæ¥ä¿å­˜çš„çŠ¶æ€ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>éœ€è¦ä¿å­˜ä¸€ä¸ªå¯¹è±¡åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€æˆ–è€…éƒ¨åˆ†çŠ¶æ€</li>
<li>å¦‚æœç”¨ä¸€ä¸ªæ¥å£æ¥è®©å…¶ä»–å¯¹è±¡å¾—åˆ°è¿™äº›çŠ¶æ€ï¼Œå°†ä¼šæš´éœ²å¯¹è±¡çš„å®ç°ç»†èŠ‚å¹¶ç ´åå¯¹è±¡çš„å°è£…æ€§ï¼Œä¸€ä¸ªå¯¹è±¡ä¸å¸Œæœ›å¤–ç•Œç›´æ¥è®¿é—®å…¶å†…éƒ¨çŠ¶æ€ï¼Œé€šè¿‡ä¸­é—´å¯¹è±¡å¯ä»¥é—´æ¥è®¿é—®å…¶å†…éƒ¨çŠ¶æ€</li>
</ul>
<p>Androidä¸­Activityã€Fragmentã€Viewçš„çŠ¶æ€ä¿å­˜ä¸ºå¤‡å¿˜å½•æ¨¡å¼ï¼Œå¯¹äºéœ€è¦å›æ»šæ“ä½œä½¿æ­¤æ¨¡å¼å¯ä»¥å¾ˆå¥½çš„æ”¯æŒã€‚</p>
<h2 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h2><p>å®šä¹‰:æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªå®¹å™¨å¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p>
<p>åœºæ™¯:éå†ä¸€ä¸ªå®¹å™¨å¯¹è±¡æ—¶</p>
<p>Androidä¸­æ•°æ®åº“æŸ¥è¯¢ä¼šä½¿ç”¨åˆ°Cursor,ä½†é¡¹ç›®é€šå¸¸ä½¿ç”¨ç¬¬ä¸‰æ–¹ORMå°è£…,å‡ ä¹å¾ˆå°‘ä½¿ç”¨å…¶æ¨¡å¼ã€‚</p>
<h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>å®šä¹‰:å®šä¹‰ä¸€ä¸ªæ“åšä¸­çš„ç®—æ³•çš„æ¡†æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>å¤šä¸ªå­ç±»æœ‰å…¬æœ‰çš„æ–¹æ³•ï¼Œå¹¶ä¸”é€»è¾‘åŸºæœ¬ç›¸åŒ</li>
<li>é‡è¦ã€å¤æ‚çš„ç®—æ³•ï¼Œå¯ä»¥æŠŠæ ¸å¿ƒç®—æ³•è®¾è®¡ä¸ºæ¨¡æ¿æ–¹æ³•ï¼Œå‘¨è¾¹çš„ç›¸å…³ç»†èŠ‚åŠŸèƒ½åˆ™ç”±å„ä¸ªå­ç±»å®ç°</li>
<li>é‡æ„æ—¶ï¼Œæ¨¡æ¿æ–¹æ³• æ¨¡å¼æ˜¯ä¸€ä¸ªç»å¸¸ä½¿ç”¨çš„æ¨¡æ¿ï¼ŒæŠŠç›¸åŒçš„ä»£ç æŠ½å–åˆ°çˆ¶ç±»ä¸­ï¼Œç„¶åé€šè¿‡é’©å­å‡½æ•°çº¦æŸè¡Œä¸º</li>
</ul>
<p>Androidä¸­Activityã€Fragmentå’ŒAsyncTaskï¼Œéƒ½æ˜¯å¯¹æµç¨‹è¿›è¡Œå°è£…ï¼Œä¾¿äºè°ƒç”¨ã€‚é‡æ„æ—¶å¯ä»¥å°†å­ç±»ä¸­ç›¸åŒçš„æ–¹æ³•ä¸Šç§»åˆ°çˆ¶ç±»ä¸­ã€‚</p>
<h2 id="è®¿é—®è€…æ¨¡å¼"><a href="#è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¿é—®è€…æ¨¡å¼"></a>è®¿é—®è€…æ¨¡å¼</h2><p>å®šä¹‰:å°è£…ä¸€äº›ä½œç”¨äºæŸç§æ•°æ®ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œï¼Œå®ƒå¯ä»¥åœ¨ä¸æ”¹å˜è¿™ä¸ªæ•°æ®ç»“æ„çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>å¯¹è±¡ç»“æ„æ¯”è¾ƒç¨³å®šï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ­¤å¯¹è±¡ç»“æ„ä¸Šå®šä¹‰æ–°çš„æ“ä½œ</li>
<li>éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œéœ€è¦é¿å…è¿™äº›æ“ä½œâ€æ±¡æŸ“â€è¿™äº›å¯¹è±¡çš„ç±»ï¼Œä¹Ÿä¸å¸Œæœ›åœ¨å¢åŠ æ–°æ“ä½œæ—¶ä¿®æ”¹è¿™äº›ç±»</li>
</ul>
<p>å°†æ•°æ®ç»“æ„å’Œæ•°æ®æ“ä½œåˆ†ç¦»ï¼Œå®é™…å¼€å‘ä¸­å¾ˆå°‘ä½¿ç”¨è¯¥æ¨¡å¼ã€‚</p>
<h2 id="ä¸­ä»‹è€…æ¨¡å¼"><a href="#ä¸­ä»‹è€…æ¨¡å¼" class="headerlink" title="ä¸­ä»‹è€…æ¨¡å¼"></a>ä¸­ä»‹è€…æ¨¡å¼</h2><p>å®šä¹‰:å®šä¹‰ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’ã€‚ä¸­ä»‹è€…ä½¿å„ä¸ªå¯¹è±¡ä¸éœ€è¦æ˜¾ç¤ºçš„ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ€§æ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹æ”¹å˜ä»–ä»¬ä¹‹é—´çš„äº¤äº’ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>ä¸€ç»„å®šä¹‰è‰¯å¥½çš„å¯¹è±¡ï¼Œéœ€è¦è¿›è¡Œå¤æ‚çš„é€šä¿¡</li>
<li>å®šåˆ¶ä¸€ä¸ªåˆ†å¸ƒåœ¨å¤šä¸ªç±»ä¸­çš„è¡Œä¸ºï¼Œè€Œä¸æƒ³ç”Ÿæˆå¤ªå¤šçš„å­ç±»</li>
</ul>
<p>Androidä¸­Binderæœºåˆ¶ä¹Ÿä½¿ç”¨åˆ°äº†ä¸­ä»‹è€…æ¨¡å¼ï¼Œå¼€å‘ä¸­å¯¹å¤æ‚é¡µé¢çš„ViewçŠ¶æ€æ”¹å˜ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œè®©ä»£ç æ›´æ¸…æ™°è¡¨è¾¾ã€‚</p>
<h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><p>å®šä¹‰:ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</p>
<p>åœºæ™¯:å½“æ— æ³•æˆ–ä¸æƒ³ç›´æ¥è®¿é—®æŸä¸ªå¯¹è±¡æˆ–è®¿é—®æŸä¸ªå¯¹è±¡åœ¨å›°éš¾æ—¶å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç†å¯¹è±¡æ¥é—´æ¥è®¿é—®ï¼Œä¸ºä¿è¯å®¢æˆ·ç«¯ä½¿ç”¨çš„é€æ˜æ€§ï¼Œå§”æ‰˜å¯¹è±¡ä¸ä»£ç†å¯¹è±¡éœ€è¦å®ç°ç›¸åŒçš„æ¥å£</p>
<p>Androidä¸­AMSä¹Ÿç”¨åˆ°äº†æ­¤æ¨¡å¼ï¼Œæœ€å¸¸ç”¨çš„Retrofitä¹Ÿç”¨åˆ°äº†åŠ¨æ€ä»£ç†ï¼Œæ­¤æ¨¡å¼åœ¨åº”ç”¨è¿‡ç¨‹ä¸­æœ€ä¸ºå¸¸è§ã€‚</p>
<h2 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h2><p>å®šä¹‰:å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ï¼Œæ˜¯çš„ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨æ›´æœ‰ä¸€è‡´æ€§ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ†-æ•´ä½“å±‚æ¬¡ç»“æ„æ—¶</li>
<li>ä»ä¸€ä¸ªæ•´ä½“ä¸­èƒ½å¤Ÿç‹¬ç«‹å‡ºéƒ¨åˆ†æ¨¡å—æˆ–è€…åŠŸèƒ½çš„åœºæ™¯</li>
</ul>
<p>Androidä¸­Viewä¸ViewGroupåˆ™æ˜¯ç»„åˆæ¨¡å¼çš„æç°ï¼Œè‡ªå®šä¹‰Viewä¹Ÿå¯ä½¿ç”¨æ­¤æ¨¡å¼ã€‚</p>
<h2 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h2><p>å®šä¹‰:æŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£ä¸åŒ¹é…è€Œæ— æ³•åœ¨ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿåœ¨ä¸€èµ·å·¥ä½œã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>ç³»ç»Ÿéœ€è¦ä½¿ç”¨ç°æœ‰çš„ç±»ï¼Œè€Œæ­¤ç±»çš„æ¥å£ä¸ç¬¦åˆç³»ç»Ÿçš„éœ€è¦ï¼Œå³å€Ÿå£ä¸å…¼å®¹</li>
<li>æƒ³è¦å»ºç«‹ä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„ç±»ï¼Œç”¨äºä¸€äº›å½¼æ­¤é—´æ²¡æœ‰å¤ªå¤§å…³è”çš„ä¸€äº›ç±»ï¼ŒåŒ…æ‹¬ä¸€äº›åœ¨å°†æ¥å¼•è¿›çš„ç±»ä¸€èµ·å·¥ä½œ</li>
<li>éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„è¾“å‡ºæ¥å£ï¼Œè€Œè¾“å…¥ç«¯çš„ç±»å‹ä¸å¯é¢„çŸ¥</li>
</ul>
<p>ListViewå’ŒRecyclerViewå‡ä¸ºæ­¤æ¨¡å¼çš„åº”ç”¨ï¼Œå¼€å‘ä¸­è¾ƒå°‘ç”¨åˆ°æ­¤æ¨¡å¼ï¼Œåœ¨è°ƒç”¨ä¸€äº›ç¬¬ä¸‰æ–¹æ—¶ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œä¾‹å¦‚åˆ†äº«åˆ°ä¸åŒå¹³å°å…·ä½“æ–¹å¼ä¸åŒï¼Œå¯ä»¥ä½¿ç”¨è½¬æ¢æˆåŒä¸€ä¸ªæ¥å£ï¼Œæ–¹ä¾¿è°ƒç”¨æ›¿æ¢ã€‚</p>
<h2 id="è£…é¥°æ¨¡å¼"><a href="#è£…é¥°æ¨¡å¼" class="headerlink" title="è£…é¥°æ¨¡å¼"></a>è£…é¥°æ¨¡å¼</h2><p>å®šä¹‰:åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚å°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°æ¨¡å¼ç›¸æ¯”ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ã€‚</p>
<p>åœºæ™¯:éœ€è¦é€æ˜ä¸”åŠ¨æ€æ‰©å±•ç±»çš„åŠŸèƒ½æ—¶</p>
<p>Androidé‡ŒContextWrapperåˆ™åº”ç”¨äº†è£…é¥°æ¨¡å¼ï¼Œå¯¹äºç±»çš„ä¸€äº›åˆå§‹åŒ–æ–¹æ³•å¯ä»¥çœ‹ä½œæ˜¯æ­¤æ¨¡å¼çš„å®è·µã€‚</p>
<h2 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h2><p>å®šä¹‰:ä½¿ç”¨å…±äº«å¯¹è±¡å¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡åœ°ç»†ç²’åº¦çš„å¯¹è±¡ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡çš„ç›¸ä¼¼æ¨¡å¼</li>
<li>ç»†ç²’åº¦çš„å¯¹è±¡éƒ½å…·å¤‡è¾ƒæ¥è¿‘çš„å¤–éƒ¨çŠ¶æ€ï¼Œè€Œä¸”å†…éƒ¨çŠ¶æ€ä¸ç¯å¢ƒæ— å…³ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹è±¡æ²¡æœ‰ç‰¹å®šèº«ä»½</li>
<li>éœ€è¦ç¼“å†²æ± åœºæ™¯</li>
</ul>
<p>Messageåº”ç”¨æ­¤æ¨¡å¼ï¼Œæ‰€æœ‰çš„å¯¹è±¡æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰æ—¶å¿…é¡»ä½¿ç”¨equals,å¦‚æœä½¿ç”¨==åˆ™ä¼šå‡ºç°ç”±äºå¸¸é‡æ± å¼•èµ·çš„ä¸ç›¸ç­‰ã€‚</p>
<h2 id="å¤–è§‚æ¨¡å¼"><a href="#å¤–è§‚æ¨¡å¼" class="headerlink" title="å¤–è§‚æ¨¡å¼"></a>å¤–è§‚æ¨¡å¼</h2><p>å®šä¹‰:è¦æ±‚ä¸€ä¸ªå­ç³»ç»Ÿçš„å¤–éƒ¨é¢„æœŸå†…éƒ¨çš„é€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„å¯¹è±¡è¿›è¡Œï¼Œå¤–è§‚æ¨¡å¼æä¾›ä¸€ä¸ªé«˜å±‚æ¬¡çš„æ¥å£ï¼Œä½¿å¾—å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>ä¸ºä¸€ä¸ªå¤æ‚å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç®€å•æ¥å£ï¼Œå¯¹å¤–éšè—å­ç³»ç»Ÿçš„å…·ä½“å®ç°ã€éš”ç¦»å˜åŒ–</li>
<li>å½“éœ€è¦æ„å»ºä¸€ä¸ªå±‚æ¬¡ç»“æ„çš„å­ç³»ç»Ÿæ—¶ï¼Œä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰å­ç³»ç»Ÿçš„æ¯å±‚å…¥å£ç‚¹ï¼Œä»è€Œç®€åŒ–äº†ä»–ä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»</li>
</ul>
<p>ContextImplåº”ç”¨äº†å¤–è§‚æ¨¡å¼,å¯¹äºå¤æ‚çš„æ¨¡å—ä½¿ç”¨Moduleè§£è€¦ä¹Ÿå¯ä»¥çœ‹åšæ˜¯å¤–è§‚æ¨¡å¼ã€‚</p>
<h2 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h2><p>å®šä¹‰:å°†æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚</p>
<p>åœºæ™¯:</p>
<ul>
<li>å½“ä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªå˜åŒ–å› ç´ çš„æ—¶å€™ï¼Œé€šè¿‡æŠ½è±¡è¿™äº›å˜åŒ–å› ç´ ï¼Œå°†ä¾èµ–å…·ä½“å®ç°ï¼Œä¿®æ”¹ä¸ºä¾èµ–æŠ½è±¡</li>
<li>å½“æŸä¸ªå˜åŒ–å› ç´ åœ¨å¤šä¸ªå¯¹è±¡ä¸­å…±å­˜æ—¶</li>
<li>å½“æˆ‘ä»¬æœŸæœ›ä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå˜åŒ–å› ç´ å¯ä»¥åŠ¨æ€çš„å˜åŒ–ï¼Œè€Œä¸å½±å“å®¢æˆ·çš„ç¨‹åºçš„ä½¿ç”¨æ—¶</li>
</ul>
<p>Androidä¸­éŸ³è§†é¢‘æ’­æ”¾å°±ç±»ä¼¼æ¡¥æ¥æ¨¡å¼ï¼Œä½¿åº”ç”¨å±‚apiå¯ä»¥è°ƒç”¨åº•å±‚ã€‚</p>
]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
      </tags>
  </entry>
  <entry>
    <title>Clean Code é˜…è¯»ç¬”è®°(2)</title>
    <url>/2018/07/20/clean-code-2/</url>
    <content><![CDATA[<h2 id="ç³»ç»Ÿ"><a href="#ç³»ç»Ÿ" class="headerlink" title="ç³»ç»Ÿ"></a>ç³»ç»Ÿ</h2><ul>
<li>å°†ç³»ç»Ÿçš„æ„é€ ä¸ä½¿ç”¨åˆ†å¼€ï¼Œå¦‚ä¾èµ–æ³¨å…¥(DI)ã€æ§åˆ¶åè½¬(IoC)</li>
<li>ä¿è¯ç³»ç»Ÿè‰¯å¥½çš„çš„æ‰©å®¹æ€§ï¼Œä½¿ç”¨é¢å‘åˆ‡é¢ç¼–ç¨‹(AOP)æ–¹å¼ç¼–ç¨‹</li>
</ul>
<p>å¯¹äºç³»ç»Ÿè¿™ç« ä¸èƒ½é€å½»ç†è§£ï¼Œå¹³æ—¶å¯¹äºæ¶æ„æ²¡æœ‰æ·±å…¥ç†è§£ï¼Œç³»ç»Ÿåº”è¯¥æ˜¯éšç€ä¸šåŠ¡çš„å˜åŒ–è€Œå˜åŒ–ï¼Œæ²¡å¿…è¦å…ˆåšå¤§è®¾è®¡è€Œé™åˆ¶åç»­è®¾è®¡æ€è·¯ï¼Œä¿è¯å¤§æ¦‚å¯å·¥ä½œçš„æœ€ç®€å•æ–¹æ¡ˆå³æœ€åˆé€‚ã€‚</p>
<a id="more"></a>
<h2 id="è¿­è¿›"><a href="#è¿­è¿›" class="headerlink" title="è¿­è¿›"></a>è¿­è¿›</h2><ul>
<li>è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œå¯ä»¥å¯¼å‘ç±»ä¿æŒçŸ­å°ä¸”å•ä¸€</li>
<li>ä¸å¯é‡å¤ï¼Œå°½é‡æŠ½è±¡å¦‚ä½¿ç”¨æ¨¡æ¿æ–¹æ³•</li>
<li>è¡¨è¾¾ç¨‹åºå‘˜çš„æ„å›¾ï¼Œä½¿ç”¨æ ‡å‡†çš„å‘½åæ³•ã€æ–Ÿé…Œå¥½çš„åç§°</li>
<li>å°½å¯èƒ½å‡å°‘ç±»å’Œæ–¹æ³•çš„æ•°é‡ï¼ŒæŒ‰ç…§å®é™…å¹³è¡¡å¿Œæ•™æ¡</li>
</ul>
<p>å®è·µä¸­å¾ˆå°‘èƒ½ä¸€è¹´è€Œå°±ï¼Œåœ¨ä¸æ–­åœ°è¿­ä»£ä¸­æ”¹è¿›æ˜¯æœ€å¥½çš„æ–¹å¼ï¼Œæ—¶å¸¸å…³æ³¨ä»£ç è´¨é‡ã€‚</p>
<h2 id="å‘³é“å’Œå¯å‘"><a href="#å‘³é“å’Œå¯å‘" class="headerlink" title="å‘³é“å’Œå¯å‘"></a>å‘³é“å’Œå¯å‘</h2><ul>
<li>æ³¨é‡Š<ul>
<li>ä¸æ°å½“çš„ä¿¡æ¯åˆ é™¤æ‰ï¼Œåªæ”¾æè¿°æœ‰å…³ä»£ç å’Œè®¾è®¡çš„æŠ€æœ¯æ€§ä¿¡æ¯</li>
<li>åºŸå¼ƒçš„æ³¨é‡Šå°½å¿«æ›´æ–°æˆ–åˆ é™¤</li>
<li>æ³¨é‡Šåº”æåŠä»£ç è‡ªèº«æœªæåŠçš„ä¿¡æ¯</li>
<li>ä¿æŒæ³¨é‡Šç®€æ´</li>
<li>åŠæ—¶åˆ é™¤æ³¨é‡Šæ‰çš„ä»£ç </li>
</ul>
</li>
<li>å‡½æ•°<ul>
<li>é¿å…è¿‡å¤šå‚æ•°ï¼Œæ²¡æœ‰æœ€ä½³ï¼Œä¸€ä¸ªæ¬¡ä¹‹ï¼Œå°½é‡é¿å…ä¸‰ä¸ªä»¥ä¸Šå‚æ•°</li>
<li>é¿å…è¾“å‡ºå‚æ•°</li>
<li>é¿å…ä½¿ç”¨booleanå‹å‚æ•°ï¼Œä½¿ç”¨å¤šä¸ªå‡½æ•°ä¼˜äºæƒ³å•ä¸ªå‡½æ•°ä¼ é€’å‚æ•°é€‰æ‹©å‡½æ•°è¡Œä¸º</li>
<li>åˆ é™¤æœªè°ƒç”¨çš„å‡½æ•°</li>
</ul>
</li>
<li>ä¸€èˆ¬æ€§é—®é¢˜<ul>
<li>å‡å°‘æ–‡ä»¶ä¸­é¢å¤–è¯­è¨€çš„æ•°é‡å’ŒèŒƒå›´</li>
<li>éµå¾ªâ€œæœ€å°æƒŠå¼‚åŸåˆ™â€ï¼Œå‘½åå’Œè¡Œä¸ºä¸€è‡´</li>
<li>äº†è§£è¾¹ç•Œï¼Œåˆ«ä¾èµ–ç›´è§‰</li>
<li>é‡è§†å®‰å…¨</li>
<li>æ¶ˆé™¤é‡å¤</li>
<li>åˆ›å»ºåˆ†ç¦»è¾ƒé«˜å±‚çº§ä¸€èˆ¬æ€§æ¦‚å¿µå’Œè¾ƒä½å±‚çº§ç»†èŠ‚æ€§çš„æŠ½è±¡æ¨¡å‹</li>
<li>è¾ƒé«˜å±‚çº§åŸºç±»æ¦‚å¿µä¸ä¾èµ–äºè¾ƒä½å±‚çº§æ´¾ç”Ÿç±»æ¦‚å¿µ</li>
<li>ä¿æŒæ¥å£ç´§å‡‘ï¼Œéšè—å®ç°ï¼Œå‡å°‘è€¦åˆ</li>
<li>åŠæ—¶æ£€æŸ¥åˆ é™¤æ­»ä»£ç </li>
<li>å‚ç›´åˆ†éš”</li>
<li>å‘½åå‰åä¸€è‡´</li>
<li>ä¿æŒæ–‡ä»¶æ•´æ´ï¼Œè‰¯å¥½çš„ç»„ç»‡</li>
<li>ä»£ç å°½å¯èƒ½çš„å…·æœ‰è¡¨è¾¾åŠ›</li>
<li>å€¾å‘ä½¿ç”¨éé™æ€å‡½æ•°ï¼Œå¦‚æœä½¿ç”¨ç¡®ä¿æ²¡æœºä¼šæ‰“ç®—å…¶æœ‰å¤šæ€è¡Œä¸º</li>
<li>ä½¿ç”¨è§£é‡Šæ€§å˜é‡</li>
<li>å‡½æ•°åç§°åº”æ¸…æ™°è¡¨è¾¾å…¶è¡Œä¸º</li>
<li>å°†é€»è¾‘ä¾èµ–æ”¹ä¸ºç‰©ç†ä¾èµ–</li>
<li>ç”¨å¤šæ€æ›¿ä»£if/elseå’Œswitch/case</li>
<li>ç”¨å‘½åå¸¸é‡æ›¿ä»£é­”æ³•æ•°</li>
<li>ç»“æ„ç”šäºçº¦å®š</li>
<li>åˆ†è£…æ¡ä»¶</li>
<li>é¿å…å¦å®šæ€§æ¡ä»¶</li>
<li>å‡½æ•°åªåšä¸€ä»¶äº‹</li>
<li>æ©ç›–æ—¶åºè€¦åˆ</li>
<li>å°è£…è¾¹ç•Œæ¡ä»¶</li>
<li>å‡½æ•°åº”è¯¥åªåœ¨ä¸€ä¸ªæŠ½è±¡å±‚çº§ä¸Š</li>
<li>åœ¨è¾ƒé«˜å±‚æ”¾ç½®å¯é…ç½®èµ„æº</li>
<li>é¿å…ä¼ é€’æµè§ˆ</li>
</ul>
</li>
</ul>
<p>åœ¨å®è·µè¿‡ç¨‹ä¸­åº”è¯¥æ—¶åˆ»æ³¨æ„è¿™äº›é—®é¢˜ï¼Œé¿å…ä»£ç è…çƒ‚è”“å»¶ã€‚è®©ä»£ç æ—¶åˆ»ä¿æŒæ¸…æ™°çš„æ„å›¾ï¼Œé¿å…çŒœæµ‹ã€‚</p>
]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>ç¼–ç¨‹æŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title>Clean Code é˜…è¯»ç¬”è®°(1)</title>
    <url>/2018/07/20/clean-code-1/</url>
    <content><![CDATA[<p>è¯»çš„æŠ€æœ¯ä¹¦ã€ç¤¾ç§‘ä¹¦ï¼Œç°åœ¨æƒ³æƒ³æ€»æ„Ÿè§‰èƒ½å›å¿†èµ·æ¥çš„å¤ªå°‘ï¼Œçœ‹è¿‡ä¹Ÿå°±å½“çœ‹è¿‡äº†ï¼Œæ²¡æœ‰å†…åŒ–ä¸ºè‡ªå·±çš„å†…å®¹ã€‚æ‰€ä»¥è¿™æœ¬ä¹¦èµ·å¼€å§‹åšè¯»ä¹¦ç¬”è®°ï¼Œä¹Ÿä¾¿äºä»¥åæŸ¥é˜…ã€‚çœ‹äº†ä¸‹ä¸Šç¯‡åšæ–‡è·ç¦»ç°åœ¨ç«Ÿç„¶æœ‰ä¸€å¹´å¤šäº†ï¼ŒçœŸæ˜¯å¿«åºŸäº†ï¼Œè¿˜å¥½ç°åœ¨æ‹¾èµ·æ¥ã€‚</p>
<h1 id="æ•´æ´ä»£ç ï¼š"><a href="#æ•´æ´ä»£ç ï¼š" class="headerlink" title="æ•´æ´ä»£ç ï¼š"></a>æ•´æ´ä»£ç ï¼š</h1><p>å¤–è¡¨æˆ–ä¸¾æ­¢ä¸Šä»¤äººæ„‰æ‚¦çš„ä¼˜ç¾å’Œé›…è§‚ï¼›ä»¤äººæ„‰æ‚¦çš„ç²¾è‡´å’Œç®€å• â€“Bjarne Stroustrup</p>
<p>å¦‚æœæ¯ä¸ªä¾‹ç¨‹éƒ½è®©ä½ æ„Ÿåˆ°æ·±åˆå·±æ„ï¼Œé‚£å°±æ˜¯æ•´æ´ä»£ç ã€‚å¦‚æœä»£ç è®©ç¼–ç¨‹è¯­è¨€çœ‹èµ·æ¥åƒæ˜¯ä¸“ä¸ºè§£å†³é‚£ä¸ªé—®é¢˜è€Œå­˜åœ¨ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸ºæ¼‚äº®çš„ä»£ç ã€‚  â€“Ward Cunningham</p>
<p>è¿™ä¾¿æ˜¯ä¹¦å†™ä»£ç çš„æœ€é«˜å¢ƒç•Œï¼Œåœ¨å®è·µè¿‡ç¨‹ä¸­ç¡®å®ä¸æ˜“,å”¯æœ‰æŒä¹‹ä»¥æ’çš„åšæŒè‡ªçœï¼Œæ­£å¦‚ä¸æ˜“ç¡®å®éœ€è¦ä¸€ä¸ªå†›è§„<strong>è®©è¥åœ°æ¯”ä½ æ¥æ—¶æ›´å¹²å‡€</strong>ï¼Œåœ¨æ¯æ¬¡ä¿®æ”¹æ—¶å¿ƒé‡Œé»˜å¿µè¿™å¥ï¼Œå¯¹çœ‹åˆ°ç¹ççš„ä»£ç åŠæ—¶æ¢³ç†ä½¿å…¶å˜å¾—ç®€æ´ã€æ¸…æ™°ã€æ˜äº†ï¼Œæˆ–è®¸ä»…ä»…é‡å‘½åå°±å¯ä»¥æœ‰è¿™æ ·çš„æ•ˆæœã€‚</p>
<a id="more"></a>
<h2 id="å‘½åï¼š"><a href="#å‘½åï¼š" class="headerlink" title="å‘½åï¼š"></a>å‘½åï¼š</h2><ul>
<li>åå‰¯å…¶å®ï¼šåœ¨ä¸Šä¸‹æ–‡ä¸­èƒ½æ˜ç¡®è¡¨ç¤ºå…¶å«ä¹‰ï¼Œæ— æ­§ä¹‰</li>
<li>é¿å…è¯¯å¯¼ï¼šå‘½åå‡†ç¡®ï¼Œå‡å°‘ç›¸ä¼¼æ€§ï¼Œé¿å…çŒœæµ‹</li>
<li>åšæœ‰æ„ä¹‰çš„åŒºåˆ†ï¼šå¦‚UserInfoæ¯”èµ·Useråˆ™æ˜¾å¾—æ²¡ä»€ä¹ˆæ„ä¹‰</li>
<li>ä½¿ç”¨è¯»çš„å‡ºæ¥çš„åç§°ï¼šå‡å°‘è¯¡å¼‚çš„ç¼©å†™ï¼Œé™¤éçº¦å®šä¿—æˆã€‚</li>
<li>ä½¿ç”¨å¯æœç´¢çš„åç§°ï¼šä½œç”¨åŸŸè¶Šå°ï¼Œå‘½åå¯ä»¥é€‚å½“ç®€å•ã€çŸ­å°</li>
<li>ç±»åä¸ºåè¯</li>
<li>æ–¹æ³•åä¸ºåŠ¨è¯æˆ–è€…åŠ¨è¯çŸ­è¯­</li>
<li>ç›¸åŒæ¦‚å¿µå¯¹åº”åŒä¸€åè¯</li>
<li>æ·»åŠ æœ‰æ„ä¹‰çš„è¯­å¢ƒ</li>
</ul>
<p>å‘½åè®©äººæ„Ÿè§‰å¾ˆç®€å•ï¼Œä½†æ˜¯åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œå´å‘ç°æ˜¯å¦‚æ­¤çš„ä»¤äººå¤´ç—›ï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆç†çš„å­—è¯ã€çŸ­è¯­æ˜¯å¦‚æ­¤çš„å›°éš¾ï¼Œå¯¹äºç†è§£ä¸Šä¸‹æ–‡æ˜¯å¦‚æ­¤çš„é‡è¦ï¼Œå½“å‘½åå˜å¾—æœ‰æ„ä¹‰ï¼Œå¯ä»¥è®©æˆ‘ä»¬å‡å°‘å¤§é‡æ³¨é‡Šå»è§£é‡Šä»£ç åˆ°åº•åšäº†ä»€ä¹ˆã€‚å½“åœ¨ä»£ç é‡Œçœ‹åˆ°ä¸åˆç†çš„å‘½åæ—¶ï¼Œä¸è¦æƒ³ç€ä¸‹æ¬¡æœ‰æ—¶é—´å†æ”¹ï¼Œè€Œæ˜¯ç«‹é©¬ä¿®æ”¹ï¼Œä¸‹æ¬¡ç›¸å½“äºæ²¡æœ‰ä¸‹æ¬¡ã€‚çƒ‚ä»£ç å°±æ˜¯è¿™æ ·æ…¢æ…¢è…çƒ‚ï¼Œæœ€åå¦‚æ²¼æ³½ä¸€èˆ¬ï¼Œä½ æƒ³ç©¿è¿‡æ—¶ä¼šä¸€ä¸å°å¿ƒé™·å…¥å…¶ä¸­ï¼Œéš¾ä»¥è„±èº«ã€‚æ‰€ä»¥ç°åœ¨ä¾¿æ˜¯æ”¹å˜çš„æœ€å¥½æ—¶æœºã€‚</p>
<h2 id="å‡½æ•°ï¼š"><a href="#å‡½æ•°ï¼š" class="headerlink" title="å‡½æ•°ï¼š"></a>å‡½æ•°ï¼š</h2><ul>
<li>çŸ­å°ï¼šå½“å¤§å—çš„å‡½æ•°æ‹†åˆ†åï¼Œå‘½åæœ‰æ„ä¹‰çš„çŸ­å°å‡½æ•°æ—¶ï¼Œä¾¿ç›¸å½“äºæ³¨é‡Šï¼Œæ›´å®¹æ˜“ç†è§£å…¶åˆ°åº•åšäº†ä»€ä¹ˆï¼Œæ€ä¹ˆåšï¼Œåªè¦å‡½æ•°å†…åšåŒçº§é€»è¾‘çš„äº‹æƒ…ä¾¿å¯æ— éœ€æ‹†åˆ†</li>
<li>åªåšä¸€ä»¶äº‹ï¼šåšå¥½è¿™ä»¶äº‹</li>
<li>æ¯ä¸ªå‡½æ•°ä¸€ä¸ªæŠ½è±¡å±‚çº§ï¼šæè¿°å½“å‰æŠ½è±¡å±‚çº§ï¼Œå¹¶å¼•ç”¨ä¸‹ä¸€å±‚çº§çš„åç»­</li>
<li>Switch:æ ¹æ®ä¸Šä¸‹æ–‡å¯ä»¥å°†switchæ”¾ç½®åœ¨æŠ½è±¡å·¥å‚ï¼Œä½†æ˜¯è¿™æ ·ä¼šé€ æˆä»£ç é‡çš„å¢åŠ ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µå–èˆ</li>
<li>ä½¿ç”¨æè¿°æ€§çš„åç§°å‘½åå‡½æ•°ï¼Œå‡½æ•°åç§°å­—æ•°å¤šä¹Ÿæ— æ‰€è°“ï¼ŒOCå‡½æ•°åæ›´é•¿</li>
<li>å°½é‡ä½¿å‡½æ•°å‚æ•°å°‘äºä¸‰ä¸ªï¼Œå¯¹äºè¿‡å¤šçš„å‚æ•°å¯ä»¥ä½¿ç”¨Builderæ¨¡å¼</li>
</ul>
<p>åˆšå¼€å§‹å¯¹äºå‡½æ•°è§„æ¨¡ä¸å¥½æŠŠæ¡ï¼Œå¯ä»¥å…ˆå®ç°åŠŸèƒ½ï¼Œç„¶åå†ä¼˜åŒ–ï¼Œä½¿å…¶çœ‹èµ·æ¥ç®€æ´æ˜å¿«ï¼Œå¦‚æ²æ˜¥é£ï¼Œæ¯•ç«Ÿç¼–ç¨‹æ—¶å¾ˆå¤šæ—¶å€™åœ¨äºæµè§ˆåŸæ¥ä»£ç çš„é€»è¾‘ï¼Œè¿™æ ·æ¸…æ™°çš„ä»£ç å¯ä»¥åŠ å¿«å¼€å‘é€Ÿåº¦å’Œæ„‰æ‚¦èº«å¿ƒã€‚</p>
<h2 id="æ³¨é‡Šï¼š"><a href="#æ³¨é‡Šï¼š" class="headerlink" title="æ³¨é‡Šï¼š"></a>æ³¨é‡Šï¼š</h2><ul>
<li>ç”¨ä»£ç é˜è¿°ç›®çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡å¤§é‡çš„æ³¨é‡Š</li>
<li>å¥½çš„æ³¨é‡Šï¼šæ³•å¾‹ä¿¡æ¯ã€æ„å›¾çš„æ³¨é‡Šã€è­¦ç¤º</li>
<li>åçš„æ³¨é‡Šï¼šæ²¡æœ‰è¡¨è¾¾å…·ä½“çš„å«ä¹‰ã€è¯¯å¯¼æ€§æ³¨é‡Šã€æ—¥å¿—å¼æ³¨é‡Šã€åºŸè¯ç©ç¬‘å¼æ³¨é‡Šã€æ»¥ç”¨ä½ç½®æ ‡è®°ã€å½’å±å’Œç­¾åã€æ³¨é‡Šæ‰çš„ä»£ç </li>
</ul>
<p>å¯¹äºåçš„æ³¨é‡Šæ·±æœ‰ä½“ä¼šï¼Œå½“ä»£ç å¤šä¸ªç‰ˆæœ¬è¿­ä»£åï¼Œæ³¨é‡Šå’Œä»£ç å·²ç»å®Œå…¨ä¸æ˜¯ä¸€ä¸ªå«ä¹‰å¼ï¼Œæ³¨é‡Šä»æ—§åœ¨ï¼Œå¾ˆå®¹æ˜“è¯¯å¯¼å¯¹ä»£ç çš„ç†è§£ã€‚åœ¨ç‰ˆæœ¬ç®¡ç†å·¥å…·å®Œå–„çš„ç°åœ¨ï¼Œå¯¹äºæ— ç”¨ä»£ç å®Œå…¨ä¸ç”¨æ‹…å¿ƒåˆ é™¤ä»¥åè¦ç”¨åˆ°æ—¶æ‰¾ä¸åˆ°çš„å°´å°¬ï¼Œå½“ç„¶å¿…é¡»æœ‰ä¸ªè§„èŒƒçš„Commitè®°å½•ï¼Œä¾¿äºæ‰¾å›ä»£ç ã€‚</p>
<h2 id="æ ¼å¼ï¼š"><a href="#æ ¼å¼ï¼š" class="headerlink" title="æ ¼å¼ï¼š"></a>æ ¼å¼ï¼š</h2><ul>
<li>å‚ç›´æ–¹å‘ï¼šæ–¹æ³•é—´ç©ºä¸€è¡Œï¼›å‡½æ•°è°ƒç”¨äº’ç›¸é è¿‘(è°ƒç”¨è€…åœ¨å‰ï¼Œè¢«è°ƒç”¨è€…åœ¨å)ï¼›å˜é‡å£°æ˜é è¿‘å…¶ä½¿ç”¨ä½ç½®ï¼Œå®ä½“å˜é‡å£°æ˜åœ¨ç±»é¡¶éƒ¨ï¼›ç›¸å…³æ¦‚å¿µä»£ç  æ”¾åœ¨ä¸€èµ·</li>
<li>æ°´å¹³æ–¹å‘ï¼šè®¾ç½®ä»£ç æ˜¾ç¤ºæœ€å¤§åˆ—ï¼›å½“æ–¹æ³•å±‚çº§è¿‡å¤šå¯¼è‡´å¤§é‡ç¼©è¿›æ—¶ï¼ŒæŠ½å–ä¸ºæ–¹æ³•ï¼Œå‡å°‘æ–¹æ³•å†…ç¼©è¿›å±‚çº§ï¼›</li>
</ul>
<p>ä¹¦å†™ä»£ç æœ‰è‰¯å¥½çš„æ ¼å¼ååˆ†é‡è¦ï¼Œæœ‰çš„é¡¹ç›®é‡ŒTabå’ŒSpaceæ··ç”¨ï¼Œå¯¼è‡´ä¸åŒæ–‡ä»¶æ ¼å¼çœ‹èµ·æ¥ååˆ†åˆ«æ‰­ï¼Œå¯¹äºæœªæ ¼å¼åŒ–çš„ä»£ç å †ç§¯åœ¨ä¸€èµ·ï¼Œå¾ˆéš¾çœ‹æ¸…è°ƒç”¨é€»è¾‘ï¼Œå†™å®Œä»£ç æ ¼å¼åŒ–æ˜¯ä¸ªå¥½çš„ä¹ æƒ¯ï¼Œå½“ç„¶å¯¹äºä¸å®Œç¾çš„åœ°æ–¹å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ï¼Œå½“ä¸‹æ¬¡æ‰“å¼€æ—¶ä¼šæé«˜é˜…è¯»é€Ÿåº¦ï¼Œé¡¹ç›®æ ¼å¼ç»Ÿä¸€ååˆ†æœ‰å¿…è¦ï¼Œå¯ä»¥ç”¨CheckStyleç­‰å·¥å…·çº¦æŸä»£ç è§„èŒƒã€‚</p>
<h2 id="å¯¹è±¡å’Œæ•°æ®ç»“æ„ï¼š"><a href="#å¯¹è±¡å’Œæ•°æ®ç»“æ„ï¼š" class="headerlink" title="å¯¹è±¡å’Œæ•°æ®ç»“æ„ï¼š"></a>å¯¹è±¡å’Œæ•°æ®ç»“æ„ï¼š</h2><ul>
<li>æ•°æ®æŠ½è±¡ï¼šæš´éœ²å®ç°ï¼Œéšè—æ•°æ®ç»“æ„</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å…·è±¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">double</span> x;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">double</span> y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠ½è±¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Point</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">getX</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">getY</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setCartesian</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">getR</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">getTheta</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">viod <span class="title">setPolar</span><span class="params">(<span class="keyword">double</span> r,<span class="keyword">double</span> theta)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å‡å°‘è¿‡ç¨‹å¼ç¼–ç ï¼Œè¿‡ç¨‹å¼ç¼–ç (ä½¿ç”¨æ•°æ®ç»“æ„çš„ä»£ç )ä¾¿äºåœ¨ä¸æ”¹åŠ¨æ—¢æœ‰æ•°æ®ç»“æ„çš„å‰æä¸‹æ·»åŠ æ–°å‡½æ•°ï¼Œé¢å‘å¯¹è±¡ä»£ç ä¾¿äºåœ¨ä¸æ”¹åŠ¨æ—¢æœ‰å‡½æ•°çš„å‰æä¸‹æ–°ç±»ï¼Œåä¹‹äº¦ç„¶</li>
<li>æ•°æ®ä¼ é€å¯¹è±¡ï¼Œä¾‹å¦‚é¿å…ä½¿ç”¨ORMæ—¶ï¼Œç±»å†…æ—¢æœ‰å…¬å…±å˜é‡ä¹Ÿæœ‰saveã€findç­‰æ–¹æ³•</li>
</ul>
<p>åœ¨å®ç°è¿‡ç¨‹ä¸­è¦å¾ˆæŠŠæ¡è¿™ç‚¹ç¡®å®å¾ˆéš¾ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡ç¯å¢ƒè¿›è¡Œç›¸åº”çš„å–èˆï¼Œå¯¹äºç°å®çš„ç¼–ç¨‹ç¡®å®æ›´ä¸ºæœ‰åˆ©ç‚¹ã€‚</p>
<h2 id="é”™è¯¯å¤„ç†ï¼š"><a href="#é”™è¯¯å¤„ç†ï¼š" class="headerlink" title="é”™è¯¯å¤„ç†ï¼š"></a>é”™è¯¯å¤„ç†ï¼š</h2><ul>
<li>ä½¿ç”¨å¼‚å¸¸è€Œéé”™è¯¯ç </li>
<li>å…ˆå†™Try-Catch-Finally</li>
<li>ä½¿ç”¨æœªå—æ£€å¼‚å¸¸</li>
<li>åˆ«è¿”å›nullå€¼</li>
<li>åˆ«ä¼ é€’nullå€¼</li>
</ul>
<p>å¼‚å¸¸å¤„ç†åœ¨å®è·µè¿‡ç¨‹ä¸­ç¡®å®æœ‰æ—¶èƒ½æ•‘ä¸€å‘½ï¼Œä½†æ˜¯å¾ˆå¤šçš„å¼‚å¸¸ä»£ç å’Œæ­£å¸¸é€»è¾‘æ··åˆï¼Œéœ€è¦å°å¿ƒå°†å…¶å°½é‡åˆ†ç¦»ï¼Œå¯¹äºnullä¼ é€’ï¼Œå…¥å‚ä¸­åšåˆ¤ç©ºå¤„ç†ï¼Œä»¥é˜²NPE,åœ¨å›¢é˜Ÿåä½œè¿‡ç¨‹ä¸­æœ€å¥½æœ‰ç»Ÿä¸€çš„å®šä¹‰æ€æ ·å¤„ç†ï¼Œå¤§é‡çš„åˆ¤ç©ºå¤„ç†ç¡®å®æ˜¾å¾—æ— æ„ä¹‰ä½†æ˜¯æœ‰æ—¶æ²¡åŠæ³•çš„äº‹æƒ…ã€‚</p>
<h2 id="è¾¹ç•Œï¼š"><a href="#è¾¹ç•Œï¼š" class="headerlink" title="è¾¹ç•Œï¼š"></a>è¾¹ç•Œï¼š</h2><p>åœ¨ä»¥å¾€ç¼–ç¨‹ä¸­ç¡®å®å¾ˆå°‘æ³¨æ„è¾¹ç•Œé—®é¢˜ï¼Œå¯¹äºæ¥å…¥ç¬¬ä¸‰æ–¹ï¼Œæ²¡æœ‰åœ¨æ„å…¶å½±å“è€Œå»ç¼–å†™ç›¸åº”çš„TestCaseï¼Œå½“ç¬¬ä¸‰æ–¹apiæœ‰è¾ƒå¤§çš„æ”¹åŠ¨æ—¶ï¼Œè‡ªå·±ä»£ç ä¹Ÿä¼šå‘ç”Ÿå¾ˆå¤§æ”¹åŠ¨ï¼Œå¹¶ä¸”å†æ¬¡å›å½’æµ‹è¯•ï¼Œè€—è´¹å¤§é‡æ—¶é—´ã€‚å¯¹å¾…ç¬¬ä¸‰æ–¹æ¥å…¥åº”è¯¥å°½é‡å°è£…ï¼Œå…å—å®ƒçš„æ§åˆ¶ã€‚</p>
<h2 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h2><ul>
<li>ä¿æŒæµ‹è¯•æ•´æ´ï¼Œæ˜ç¡®ã€ç®€æ´æœ‰è¾ƒé«˜çš„å¯è¯»æ€§ï¼Œéµå¾ªæ„é€ -æ“åš-æ£€éªŒæ¨¡å¼</li>
<li>FIRST:å¿«é€Ÿã€ç‹¬ç«‹ã€å¯é‡å¤ã€è‡ªè¶³éªŒè¯ã€åŠæ—¶</li>
</ul>
<p>åœ¨å¹³æ—¶å¼€å‘ä¸­ï¼Œå¯¹äºå•å…ƒæµ‹è¯•å®è·µçš„å¤ªå°‘ï¼Œæœ€å¤šåªæµ‹è¯•ä¸€äº›å·¥å…·ç±»ï¼Œç”±äºAndroidç‰¹æ®Šæ€§ï¼Œç›¸å¯¹æµ‹è¯•ç”¨ä¾‹ç¼–å†™ä¸æ–¹ä¾¿ã€‚</p>
<h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h2><ul>
<li>ç¬¦åˆè‡ªé¡¶å‘ä¸‹åŸåˆ™</li>
<li>ä¿æŒå˜é‡å’Œå·¥å…·å‡½æ•°çš„ç§æœ‰æ€§ï¼Œä½†ä¸åº”æ‰§ç€äºæ­¤</li>
<li>å•ä¸€æƒè´£åŸåˆ™(SRP)ï¼Œç±»æˆ–è€…æ¨¡å—åº”æœ‰ä¸”åªæœ‰ä¸€æ¡åŠ ä»¥ä¿®æ”¹çš„ç†ç”±</li>
<li>å†…èšï¼šç±»åº”åªæœ‰å°‘é‡çš„å®ä½“å˜é‡ï¼Œå†…èšæ€§åº”ä¿æŒåœ¨è¾ƒé«˜çš„ä½ç½®</li>
<li>ä¾èµ–å€’ç½®åŸåˆ™(DIP)ï¼šç±»åº”å½“ä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯å…·ä½“ç»†èŠ‚</li>
</ul>
<p>å¯¹äºSRPã€DIPåªæœ‰åœ¨äº†è§£ä¸šåŠ¡æƒ…å†µä¸‹ï¼Œå¤šæ¬¡é‡æ„å¾—åˆ°åˆé€‚çš„æ–¹æ¡ˆï¼Œæ—¶å¸¸ä¿æŒé‡æ„ä¼šå¯¹ä»£ç è´¨é‡æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚</p>
]]></content>
      <categories>
        <category>è¯»ä¹¦ç¬”è®°</category>
      </categories>
      <tags>
        <tag>ç¼–ç¨‹æŠ€å·§</tag>
      </tags>
  </entry>
</search>
